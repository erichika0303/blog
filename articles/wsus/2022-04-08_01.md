---
title: WSUS サーバーを新しいハードへ移設したい 
date: 2022-04-08
tags:
  - WSUS
---

# WSUS サーバーを新しいハードへ移設したい

みなさま、こんにちは。 WSUS サポート チームです。

今回は、旧サーバーから新サーバーへ WSUS を移行する方法をご紹介します。  
ハードウェアの老朽化や運用上の様々な理由から WSUS サーバー を移行する必要があるといったようなときに際にお役立ていただける情報です。  


- **A. 一時的にレプリカ構成にする**
- **B. 更新プログラム情報をファイル ベースで移行する**
- **C. データベースバックアップをリストアし移行する**  
 


### **A. 一時的にレプリカ構成にする**  

旧 WSUS サーバーを親とし、移設先の新しい WSUS サーバーを子として新規構築します
この時、新しい WSUS サーバーをレプリカとして設定し、旧 WSUS サーバーと同期を行う方法です。  
＜手順＞    
1. WSUS コンソールを開き、 [オプション] - [更新元およびプロキシ サーバー] にて以下の設定を行います。  
・親となる旧 WSUS サーバーの指定  
・[このサーバーはアップストリーム サーバーのレプリカです] へのチェック  
![](2022-04-08_01/2022-04-08_01_1.PNG)  

2. 同期が完了した後で親子構成を解除すると、新しい WSUS サーバーへ、旧 WSUS サーバーの情報が複製された状態で、スタンドアロンの WSUS が出来上がります。  
忘れずに新しい WSUS サーバー側でオプションを再設定すれば、移行は完了です。  

※ 注意 ※  
レプリカ構成の場合、WSUS サーバーのバージョンは、下位が上位と同じバージョン又は上位よりも下位が古いバージョンである必要があります。  
下位が上位よりもバージョンが新しい場合はサポートされません。（ ※ WSUS バージョンは OS バージョンと紐づいています ）  
 

### **B. 更新プログラム情報をファイル ベースで移行する**  
  
オフライン環境に WSUS サーバーを構築するのと同じ要領で、旧 WSUS サーバーで保持している更新プログラムの情報を移行させる方法です。  

下記の 2 つを旧 WSUS サーバーより取得し、新しい WSUS サーバーへインポートし取り入れます。  
– カタログのメタデータ ( 更新プログラムのリスト )  
– WsusContent フォルダ ( 更新ファイル )  

＜手順＞  
1. 旧 WSUS サーバー上で下記のコマンドを実行し、データベース内の更新プログラム情報をファイルへエクスポートします。  

C:\Program Files\Update Services\Tools に作成する場合  
```
　cd "C:\Program Files\Update Services\Tools"  
　wsusutil.exe export export.xml.gz export.log  
```


2. 旧 WSUS サーバーの WsusContent フォルダ内にあるダウンロード済みファイルを、すべて新 WSUS サーバーへコピーします。
もし新 WSUS サーバーでファイルのダウンロードをやり直す場合には、コピー不要です。  


3. 新 WSUS サーバー上で下記のコマンドを実行し、旧 WSUS サーバーの更新プログラム情報をインポートします。  

C:\Program Files\Update Services\Tools にコピーした場合    
```
cd "C:\Program Files\Update Services\Tools"  
wsusutil.exe import import.xml.gz import.log  
```
  
4. 新 WSUS サーバー上で下記のコマンドを実行し、データベース内の更新プログラム情報と、WsusContent フォルダ内のファイル情報の整合性をチェックします。  
ドキュメントに記載のない手順なのですが、もしファイル コピーに抜けがあると配布に支障が出るため、念のために実行してください。  
```
wsusutil.exe reset  
```
もし 3. でファイルのコピーを実施しなかった場合や、コピーに抜けがありファイルが不足している場合には、ダウンロードが行われます。  

※ 注意 ※  
この方法では、データベース内の更新プログラムのカタログ情報 及び その更新プログラムの実体となるコンテンツファイルのコピーを新 WSUS サーバーへ取り入れる方法ですので、旧 WSUS サーバーのインストール承認や拒否済みの情報、コンピュータグループ情報などは移行されません。  

参考情報  
 [コマンド ラインからの WSUS の管理](https://docs.microsoft.com/ja-jp/security-updates/windowsupdateservices/18111626)


### **C. データベースバックアップをリストアし移行する**  
  
旧 WSUS サーバーのバックアップを取得し、新 WSUS サーバーにリストアする方法です。  

＜手順＞  
下記の公開記事にてデータベースを取得してリストアする方法での手順をご紹介しておりますのでご参照ください。    
参考情報  
[WSUS 移行手順について (WID -> WID)](https://jpmem.github.io/blog/wsus/2021-10-19_01/#WSUS-%E7%A7%BB%E8%A1%8C%E6%89%8B%E9%A0%86%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6-WID-gt-WID)