---
title: WSUS コンソールが全く開かなくなってしまった！　WSUSPool　の停止とは
date: 2022-05-20
tags:
  - WSUS
---
# WSUS コンソールが全く開かなくなってしまった！　WSUSPool　の停止とは
みなさま、こんにちは。 WSUS サポート チームです。  
今回は、 WSUS コンソールが全く開かず、以下のような接続エラーがでてしまっているときにご一読いただきたい WSUSPoolの停止 についてご紹介します。  
![](2022-05-20_01\2022-05-20_01_1.png)   


# WSUS コンソールが全く開かなくなってしまった！  
WSUS は、 IIS の WSUSPool を介してデータベースへアクセスする仕組みになっています。  
その為、WSUS コンソールが全く開かず上記のような接続エラーとなってしまう場合には、WSUSPool が停止しデータベースへアクセスできない状態となっている可能性が考えられるのです。  

# WSUSPool の停止とは
なぜ WSUSPool が停止していると考えられるでしょうか。  
これは、IIS の保護機能により WSUSPool が停止した可能性があるからです。  

WsusPool のメモリ上限値であるプライベートメモリ制限値に達した場合、リサイクルを実行しメモリを解放する動作が起こります。このリサイクルの処理が短期間に頻繁に発生すると、 IIS のラピッドフェール保護と呼ばれる機能が働き、WSUSPool を停止させるのです。  

参考 [ラピッド フェール保護機能について](https://jpdsi.github.io/blog/web-apps/Rapid-Fail-Protection/)  

その為、 WsusPool のメモリ上限値であるプライベートメモリ制限値に達してリサイクルが頻発する状態を改善することで、ラピッドフェール保護による WSUSPool が停止する事象を防ぐことができます。

# 発生要因
WsusPool のメモリ上限値であるプライベートメモリ制限値に達してしまう主な要因はなにか。  
それは以下の2点です。  
１．WSUSPool のメモリチューニングが実施されていない  
２．クライアントのスキャン対象となる更新プログラムが多い  

# 対処方法
上記の要因を解消するためには、以下の対処により改善が見込めます。    

１．WSUSPool のメモリチューニング  
WSUSPool のメモリチューニングを実施することにより、ラピッドフェール保護の発生を抑止することができます。  
実施内容については、以下の公開記事にてご紹介しておりますのでご参照ください。  
 [IIS チューニング設定](https://jpmem.github.io/blog/wsus/2022-05-09_01/#A-IIS-%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0%E8%A8%AD%E5%AE%9A)  


２．クライアントのスキャン対象となる更新プログラムの削減  
クライアントは WSUS 同様に IIS を介してデータベースへアクセスし更新プログラムのスキャン処理を行っています。  
スキャン処理は、WSUS が保持する更新プログラムの情報が参照され、メモリ領域の確保とメモリへのコピーが繰り返される為、 WSUSPool のメモリ使用量を高める大きな要因となることが事例より判っております。  

クライアントのスキャン処理の対象は、状態が "未承認" 及び "承認済み" の更新プログラムです。  
このため、状態を "拒否済み" へ変更いただくことにより、スキャン対象から外すことができます。  
実施内容ついては、以下の公開記事にてご紹介しておりますのでご参照ください。  
[不要な更新プログラムは「拒否済み」に設定しよう！](https://jpmem.github.io/blog/wsus/2017-12-11_01/)  










