---
title: WSUS クライアントが Microsoft Update から更新プログラムを取得する動作 デュアル スキャン とは？
date: 2022-09-30
tags:
  - WSUS
---

# WSUS クライアントが Microsoft Update から更新プログラムを取得する動作 デュアル スキャン とは？  
みなさま、こんにちは。WSUS サポート チームです。今回はデュアル スキャンについてご紹介したいと思います。  
Microsoft Update の更新先を WSUS として指定しているにもかかわらず、「インターネットから更新プログラムを取得してしまった。」 「意図しない更新プログラムが適用された。」というお問い合わせをいただくことがあります。このような事象が発生した際にご確認頂きたい内容が詰まった記事となっておりますので是非ご一読ください。　　

#　デュアル スキャンとは？  
デュアル スキャンとは、 WSUS クライアントが WSUS サーバーではなく、インターネット上の弊社 Microsoft Update サイトに対して更新プログラムの検出を試みてしまうする動作です。[イントラネットの Microsoft 更新サービスの場所を指定する]のポリシー設定を構成いただくことで、  WSUS サーバーに対して Microsoft Update を実行するように構成いただくことが可能ですが、バージョンやビルドの管理の為に、OS の機能である Windows Update for Business 関連の設定を構成した場合に、クライアントは WSUS サーバーではなく、 Microsoft Update を検索して更新プログラムを取得を試みる動作となります。なお、デュアル スキャンが発生した場合、OS 向けの更新プログラム（累積更新プログラム等）のみを対象に更新プログラムをインターネットから取りに行こうとする動作が行われますが、Office や ドライバー 向けの更新プログラムについては WSUS 側から取得できる状態となります。

# どんな条件下で発生するのか？  
Windows 10 1607 / Windows Server 2016 以降の環境において、以下の両方の設定が構成されている場合に発生します。    

## ・[イントラネットの Microsoft 更新サービスの場所を指定する] が構成されている  
以下のポリシーにて、 Microsoft Update の更新先に WSUS を指定している  
```
[コンピュータの構成] > [管理用テンプレート] > [Windows コンポーネント] > [Windows Update]   
[イントラネットの Microsoft 更新サービスの場所を指定する]   
```
## ・Windows Update for Business 関連の設定を構成している  
以下のポリシーまたは設定にて、 Windows Update for Business の構成設定をしている  
 ```
- [コンピュータの構成] > [管理用テンプレート] > [Windows コンポーネント] > [Windows Update]   
[Windows Update の延期] 又は [Windows Update for Business]   
 または  
- Windows の設定画面にて
[設定] > [更新とセキュリティ] > [Windows Update] > [詳細オプション] にて延期設定をしている  
```
参考情報　[Windows Update for Business の構成](https://docs.microsoft.com/ja-jp/windows/deployment/update/waas-configure-wufb)  

# 対処方法   
以下のポリシーの適用によりデュアル スキャンを抑止することができます。  
```
[コンピューターの構成] > [管理用テンプレート] > [Windows コンポーネント] > [Windows Update]   
[Windows Update に対するスキャンを発生させる更新遅延ポリシーを許可しない]   
```
 上記のポリシーは Windows 11 でサポートされなくなりました為、以下のポリシーの適用が必要です。
 ```
 [コンピューターの構成] > [管理用テンプレート] > [Windows コンポーネント] > [Windows Update] > [Windows Server Update Services から提供される更新プログラムの管理] 
[Windows Update の特定のクラスにソースサービスを指定する] 
```  

[Windows Update に対するスキャンを発生させる更新遅延ポリシーを許可しない] の場合には、  
OS向けの更新プログラムに対してインターネット上の弊社 Microsoft Update サイト経由では取得しないように制御する 一方で、  
[Windows Update の特定のクラスにソースサービスを指定する] の場合には、  
WindowsUpdateソースの指定に準じて動作し、更新プログラムの分類ごとにインターネット上の弊社 Microsoft Update サイト経由 または WSUS 経由どちらから更新プログラムを取得するかを決めることができます。  

# 補足
※ 例外として、Windows Server 2016 / Windows 10 LTSB 2016 においては、上記記載の [Windows Update に対するスキャンを発生させる更新遅延ポリシーを許可しない] を有効にした状態で、下記を有効にするとデュアル スキャンが発生してしまいます。
```
 [設定] > [更新とセキュリティ] > [Windows Update] > [詳細オプション] の "機能の更新を延期する"
```
この場合の対処につきましては、下記ポリシーを設定いただくことで、"機能の更新を延期する" のチェックボックスをグレーアウトさせることができるため、デュアル スキャンを発生させないようにすることができます。
```
[コンピューターの構成] > [管理用テンプレート] > [Windows コンポーネント] > [Windows Update] > [Windows Update の延期]   
[機能更新プログラムをいつ受信するかを選択してください] 
 ※ ブランチ準備レベルや延期日数については任意の値で設定ください。 
 ``` 
 


