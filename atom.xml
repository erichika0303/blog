<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Microsoft Endpoint Manager Support Blog</title>
  
  <subtitle>日本マイクロソフトの Microsoft Endpoint Manager に関するサポート情報のブログです。</subtitle>
  <link href="https://jpmem.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpmem.github.io/blog/"/>
  <updated>2021-12-01T15:56:55.225Z</updated>
  <id>https://jpmem.github.io/blog/</id>
  
  <author>
    <name>Microsoft Endpoint Manager Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>MECM クライアント 手動インストール手順</title>
    <link href="https://jpmem.github.io/blog/mecm/20211122_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20211122_01/</id>
    <published>2021-11-21T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.225Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>本日は、Configuration Manager を手動でインストールする基本的な手順について解説致します。</p><p>ご利用頂いているインストール手法が失敗する際などに、本手順によるインストールも失敗するのかを切り分ける方法として、ご活用下さい。</p><ol><li>SCCM サイト サーバーから以下の “client” フォルダを丸ごとコピーし、クライアント端末のローカルの任意の場所に貼り付けます。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Microsoft Configuration Manager\Client</span><br></pre></td></tr></table></figure><ol start="2"><li><p>クライアント端末にてコマンド プロンプトを管理者権限で開きます。</p></li><li><p>以下のようなコマンドを実行し、クライアントをインストールします。</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Client フォルダをコピーしたパス&gt;\client\ccmsetup.exe /<span class="built_in">source</span>:&lt;Client フォルダをコピーしたパス&gt;\client  SMSSITECODE=&lt;サイトコード&gt; SMSMP=&lt;プライマリサイトの管理ポイントサーバーの FQDN&gt;</span><br></pre></td></tr></table></figure><p>例えば、client フォルダのコピー先が、”c:\temp”で、サイトコードが “P01”、プライマリサイトの管理ポイントサーバーの FQDN が “sccm.contoso.com” の場合、以下のコマンドを実行します。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\temp\client\ccmsetup.exe /<span class="built_in">source</span>:c:\temp\client SMSSITECODE=P01 SMSMP=sccm.contoso.com</span><br></pre></td></tr></table></figure><p>※ サイトコードやプライマリサイトの管理ポイントサーバーの FQDN は、SCCM コンソールの以下の画面にてご確認いただけます。<br>[管理] &gt; [概要] &gt; [サイトの構成] &gt; [サーバーとサイト システムの役割]</p><p><img src="/blog/mecm/20211122_01/20211122_01_01.png"></p><ol start="4"><li><p>コマンドプロンプトを閉じます。</p></li><li><p>インストールが行われる間、クライアント端末のタスクマネージャーにて、ccmsetup が動作していることをご確認いただけます。<br>インストールの完了は、以下のログにてご確認いただけます。</p></li></ol><ul><li>ファイル場所<br>C:\Windows\ccmsetup\logs\ccmsetup.log<br></li><li>ログ出力<br>最後に、以下のログが出力されたことで、インストール完了と判断できます。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CcmSetup is exiting with return code 0</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;本日は、Configuration Manager を手動でインストールする基本的な手順について解説致します。&lt;/p&gt;
&lt;p&gt;ご利用頂いているインストール手法が失敗する際</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>MECM クライアント インストールがうまく行かない時の確認箇所</title>
    <link href="https://jpmem.github.io/blog/mecm/20211122_02/"/>
    <id>https://jpmem.github.io/blog/mecm/20211122_02/</id>
    <published>2021-11-21T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.225Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>今回は Configuration Manager のクライアント インストール・登録がうまく行かない際にご確認頂きたいポイントについて、解説させて頂きます。</p><hr><h4 id="bulb-クライアント登録の大まかな流れについて"><a href="#bulb-クライアント登録の大まかな流れについて" class="headerlink" title=":bulb:クライアント登録の大まかな流れについて"></a>:bulb:クライアント登録の大まかな流れについて</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR;</span><br><span class="line">   cs -- 管理ポイントと通信 --&gt; rg</span><br><span class="line">   rg -- 登録完了 --&gt; pd</span><br><span class="line">   cs[1.ccmsetup]</span><br><span class="line">   rg[2.registration]</span><br><span class="line">   pd[3.policy download]</span><br></pre></td></tr></table></figure><ol><li>ccmsetup（クライアント インストール）を実行します。</li><li>インストールが成功すると、管理ポイントと通信し、クライアント登録を試行します。</li><li>登録が完了すると、各種ポリシーをダウンロードします。<br>これが成功すると、コントロール パネル &gt; Configuration Manager の [操作] タブの各項目が表示されます。</li></ol><p>クライアント登録がうまく行かない場合には、上記フロー中のどこかで失敗していることになりますので、以下の確認ポイントに沿って切り分けを行うことが有効です。</p><hr><h4 id="bulb-クライアント登録がうまく行かない時の確認ポイント"><a href="#bulb-クライアント登録がうまく行かない時の確認ポイント" class="headerlink" title=":bulb:クライアント登録がうまく行かない時の確認ポイント"></a>:bulb:クライアント登録がうまく行かない時の確認ポイント</h4><h5 id="1-ccmsetup-log-の確認"><a href="#1-ccmsetup-log-の確認" class="headerlink" title="1. ccmsetup.log の確認"></a>1. ccmsetup.log の確認</h5><p>まずは ccmsetup のログを確認しましょう。クライアント端末の下記のログファイルを開きます。<br>C:\Windows\ccmsetup\logs\ccmsetup.log</p><p>最終的な実行結果がご確認いただけます。正常であれば 0 となります。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CcmSetup is exiting with return code 0</span><br></pre></td></tr></table></figure><p>ここで 0 以外のコードで終了している場合には、ccmsetup が失敗している可能性がありますので、調査が必要となります。</p><h5 id="2-ClientIDManagerStartup-log-の確認"><a href="#2-ClientIDManagerStartup-log-の確認" class="headerlink" title="2. ClientIDManagerStartup.log の確認"></a>2. ClientIDManagerStartup.log の確認</h5><p>ccmsetup が return code 0 で終了していれば、インストール処理は問題なく完了していますので、次は登録処理の確認です。<br>クライアント端末の下記のログファイルを開きます。<br>C:\Windows\CCM\Logs\ClientIDManagerStartup.log</p><p>下記のような出力が確認できれば、クライアントの登録処理は成功していることがご確認いただけます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[RegTask] - Client is registered. Server assigned ClientID is GUID:XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX. Approval status 1</span><br></pre></td></tr></table></figure><h5 id="3-管理ポイントとの疎通確認"><a href="#3-管理ポイントとの疎通確認" class="headerlink" title="3. 管理ポイントとの疎通確認"></a>3. 管理ポイントとの疎通確認</h5><p>もし、ClientIDManagerStartup.log にて上記出力が確認できなかった場合には、管理ポイントとの通信状況を確認しましょう。</p><p>クライアント端末にて、PowerShell を開き、下記コマンドを実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;http://&lt;管理ポイントの FQDN&gt;/sms_mp/.sms_aut?mplist&quot;</span> <span class="literal">-UseBasicParsing</span></span><br></pre></td></tr></table></figure><p>正常にアクセスできる場合、StatusCode : 200 となります。<br>それ以外の場合には、クライアントと管理ポイントとの間で疎通できていない状態となりますので、ネットワーク観点で問題の特定を進める必要がございます。</p><h5 id="4-管理ポイントとの疎通も問題がない場合"><a href="#4-管理ポイントとの疎通も問題がない場合" class="headerlink" title="4.管理ポイントとの疎通も問題がない場合"></a>4.管理ポイントとの疎通も問題がない場合</h5><p>この場合には、詳細な調査が必要となることが想定されますので、弊社サポートへのお問い合わせをご検討下さいませ。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は Configuration Manager のクライアント インストール・登録がうまく行かない際にご確認頂きたいポイントについて、解説させて頂きます。&lt;/p&gt;
&lt;</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>MECM CB 2103 以前での 「クラウド管理」Azure サービス作成時における AAD アプリケーション設定の仕様変更の影響について</title>
    <link href="https://jpmem.github.io/blog/mecm/20211108_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20211108_01/</id>
    <published>2021-11-07T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.225Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>本日は、10/15に Azure AD Applicationの仕様が一部変更されたのに伴い、Configuration Manaer (CM) 側で<br>「クラウド管理」の Azure サービスが利用する Azure AD アプリケーションを作成する際の仕様変更についてご連絡致します。</p><p>なお、上記 Azure サービスは主にクラウド管理ゲートウェイ関連で利用することが多いものでございます。</p><p>以下の記事の通り、Azure アプリケーションを作成する際に指定する App ID URI のフォーマット形式が変更となりました。</p><p><a href="https://docs.microsoft.com/en-US/azure/active-directory/develop/reference-breaking-changes#appid-uri-in-single-tenant-applications-will-require-use-of-default-scheme-or-verified-domains">https://docs.microsoft.com/en-US/azure/active-directory/develop/reference-breaking-changes#appid-uri-in-single-tenant-applications-will-require-use-of-default-scheme-or-verified-domains</a></p><h1 id="影響を受ける範囲"><a href="#影響を受ける範囲" class="headerlink" title="影響を受ける範囲"></a>影響を受ける範囲</h1><p>すでに作成済みの Azure サービスは影響を受けません。そのまま利用可能でございます。</p><p>影響を受けるのは、<br>Configuration Manager Current Branch (CM CB) 2103 以前で「クラウド管理」のアプリケーションを作成する場合となります。</p><h1 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h1><p>Configuration Manager Current Branch (CM CB) 2103 以前で、新規に「クラウド管理」アプリケーションを作成する際の、 “Web App” を指定する際の、URIの形式を下記サイトでもご案内している通り、デフォルトの形式<a href="https://configmgrservice/">https://ConfigMgrService</a> に近い文字列ではなく、以下のフォーマットに従った文字列を指定くださいますようお願い致します。</p><ul><li>api://{tenantId}/{string}</li><li>https://{verifiedCustomerDomain}/{string}</li></ul><p><a href="https://docs.microsoft.com/en-us/mem/configmgr/core/clients/manage/cmg/configure-azure-ad#create-the-web-server-app-registration">https://docs.microsoft.com/en-us/mem/configmgr/core/clients/manage/cmg/configure-azure-ad#create-the-web-server-app-registration</a></p><ul><li>{tenantId}: アプリケーションを作成する対象の Azure AD のテナント ID を指定ください。<br>[Azure Portal]- [Azure Active Directory] - [概要] から確認できます。</li><li>{verifiedCustomerDomain}: アプリケーションを作成する対象の利用可能なカスタム ドメインを指定ください。<br>[Azure Portal]- [Azure Active Directory] - [カスタム ドメイン名] から確認できます。</li><li>{string}:　自由な文字列を指定ください。ただし、他の Azure AD アプリケーションと URI が重複しないようにする必要がございます。</li></ul><p>※例: </p><ul><li>api://a8573488-ff46-450a-b09a-6eca0c6a02dc/ConfigMgrService</li><li><a href="https://contoso.onmicrosoft.com/ConfigMgrService">https://contoso.onmicrosoft.com/ConfigMgrService</a></li></ul><h1 id="対処を行わない場合に発生する事象"><a href="#対処を行わない場合に発生する事象" class="headerlink" title="対処を行わない場合に発生する事象"></a>対処を行わない場合に発生する事象</h1><p>上記形式に従わない URI を指定すると、正しい ID でログインしているのに ログイン エラーが発生します。</p><p><img src="/blog/mecm/20211108_01/20211108_01_03.png"></p><h1 id="CM-CB-2107-以降の対応"><a href="#CM-CB-2107-以降の対応" class="headerlink" title="CM CB 2107 以降の対応"></a>CM CB 2107 以降の対応</h1><p>CM CB 2107 以降については、本 URI の指定は以下のようにシステム側で自動的に行われるため、必要がございませんので、ご安心ください。</p><p><img src="/blog/mecm/20211108_01/20211108_01_01.png"></p><p>Azure AD アプリケーション画面から該当のURIが自動作成されていると確認できます。</p><p><img src="/blog/mecm/20211108_01/20211108_01_02.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;本日は、10/15に Azure AD Applicationの仕様が一部変更されたのに伴い、Configuration Manaer (CM) 側で&lt;br&gt;「クラウ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Windows Update の有効期限ポリシーについて</title>
    <link href="https://jpmem.github.io/blog/mecm/20211028_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20211028_01/</id>
    <published>2021-10-27T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.221Z</updated>
    
    <content type="html"><![CDATA[<p>** この投稿は、2021 年 10 月 19 日に、<a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/windows-update-expiration-policy-explained/ba-p/2860928">Windows update expiration policy explained</a> に掲載されたブログ(英語)の抄訳です。 **</p><p>Microsoft は、サポートされているWindows プラットフォームごとに毎月2〜3つの更新プログラムを作成しています。<br>これにより、更新のバックログが発生し、更新パッケージのサイズが大きくなる可能性があります。<br>ただし、これらの更新の多くは累積的であり、そのプラットフォーム用に公開された以前のすべての更新が含まれています。<br>つまり、古いパッケージの有効期限が切れても、累積的な更新をインストールすることで、それらのパッケージに含まれている更新を引き続き受け取ることができます。</p><p>古い冗長パッケージを期限切れにすることで、パフォーマンスが向上し、スキャン時間が短縮され、ユーザーエクスペリエンスが向上し、新しい、より安全な更新に置き換えられた古い更新を展開するリスクが軽減されます。<br>WindowsUpdate の有効期限ポリシーに関してよく寄せられる質問への回答は次のとおりです。</p><h2 id="更新パッケージはどのくらいの頻度で期限切れになりますか？"><a href="#更新パッケージはどのくらいの頻度で期限切れになりますか？" class="headerlink" title="更新パッケージはどのくらいの頻度で期限切れになりますか？"></a>更新パッケージはどのくらいの頻度で期限切れになりますか？</h2><p>公開されたパッケージは、定期的に有効期限が評価されます。十分な数の候補が見つかると、有効期限が切れます。</p><h2 id="古いアップデートの有効期限が切れていないのはなぜですか？"><a href="#古いアップデートの有効期限が切れていないのはなぜですか？" class="headerlink" title="古いアップデートの有効期限が切れていないのはなぜですか？"></a>古いアップデートの有効期限が切れていないのはなぜですか？</h2><p>一部の古いパッケージは、まだ評価されていないか、有効期限の基準を満たしていない可能性があります。<br>その特定の更新への既存の依存関係のために、それらがまだ期限切れになっていない可能性もあります。</p><h2 id="有効期限が切れないパッケージはありますか？"><a href="#有効期限が切れないパッケージはありますか？" class="headerlink" title="有効期限が切れないパッケージはありますか？"></a>有効期限が切れないパッケージはありますか？</h2><p>Windows 8.1、Windows Server 2012 SP2、Windows Server 2012、Windows 7 SP1、Windows Server 2008 R2、およびWindows Server 2008 SP2 のセキュリティのみの更新パッケージは、累積的ではなく、1か月分の修正しか保持されていないため、有効期限はありません。<br>さらに、最新の更新パッケージが古いパッケージに依存している場合、古いパッケージは、新しいパッケージに置き換えられるまで期限切れになりません。</p><h2 id="アップデートの有効期限が切れているかどうかを確認するにはどうすればよいですか？"><a href="#アップデートの有効期限が切れているかどうかを確認するにはどうすればよいですか？" class="headerlink" title="アップデートの有効期限が切れているかどうかを確認するにはどうすればよいですか？"></a>アップデートの有効期限が切れているかどうかを確認するにはどうすればよいですか？</h2><p>更新の有効期限が切れている場合は、support.microsoft.com の特定の更新に関連するリリースノート記事のタイトルに「EXPIRED」という単語が追加されています。</p><p><img src="/blog/mecm/20211028_01/1.png" alt="image.png"></p><p>記事の上部にも有効期限の通知があります。</p><p><img src="/blog/mecm/20211028_01/2.png" alt="image.png"></p><p>Windows Server Update Services（WSUS）を使用している場合、特定の更新プログラムの有効期限が切れていると、詳細ウィンドウの上部にバナーが表示されます。</p><p>注：このポリシーは、WindowsUpdate にのみ適用されます。他の Microsoft ソフトウェアまたはファームウェアの更新には異なるポリシーがある場合があるため、個別に検討する必要があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;** この投稿は、2021 年 10 月 19 日に、&lt;a href=&quot;https://techcommunity.microsoft.com/t5/windows-it-pro-blog/windows-update-expiration-policy-explained</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>スクリプト機能のご紹介</title>
    <link href="https://jpmem.github.io/blog/mecm/20211025_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20211025_01/</id>
    <published>2021-10-24T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.217Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>本日は Configuration Manager (CM) の便利な機能である<strong>スクリプト機能</strong>のご紹介をさせていただきます。本機能により CM 管理下の端末にリアルタイムに遠隔からスクリプトを実行させることが出来ます。</p><p>Configuration Manager コンソールから PowerShell スクリプトを作成して実行する<br><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/apps/deploy-use/create-deploy-scripts">https://docs.microsoft.com/ja-jp/mem/configmgr/apps/deploy-use/create-deploy-scripts</a></p><h1 id="機能の説明"><a href="#機能の説明" class="headerlink" title="機能の説明"></a>機能の説明</h1><p>CM サーバーから CM コンソールを使って、デバイス単位、コレクション単位に指定したPowershell を、<strong>リアルタイム</strong>に実行する機能です。同じことは Enter-PSSession コマンドレットを使えば出来ますが、本機能は複数のデバイスに対して Powershell を実行できることに強みがあります。また、Intune によるスクリプト配布機能と比較した場合、こちらの方がオンデマンドな処理を行う際には便利です。</p><h1 id="ユースケース"><a href="#ユースケース" class="headerlink" title="ユースケース"></a>ユースケース</h1><p>Powershell で実現できることは何でも出来ますが、CM 管理者であれば例えば以下のような点で利用出来るでしょう。</p><ol><li>一時的に、デバイスのレジストリの値を採取する。定期的な回収が必要ではないようなものには便利。(定期的な回収はハードウェア インベントリを利用したほうが良い)</li><li>あるデバイスから、あるサーバーへのネットワーク到達性のチェック。HTTPリクエストが通るか、デバイスに対してポートが開放されているか、はたまたデバイスでサーバーのURLへの名前解決が可能かどうか、などをチェックする。</li><li>CM クライアントの状態チェック。あるソフトウェア センターの表示状態のアイテムの確認。</li></ol><h1 id="利用に当たっての推奨事項"><a href="#利用に当たっての推奨事項" class="headerlink" title="利用に当たっての推奨事項"></a>利用に当たっての推奨事項</h1><p>「大いなる力には大いなる責任が伴う」の言葉通り、何でも出来るということはセキュリティ上のリスクでもあります。ご利用の組織のポリシーに従って、明確なルールを制定してご利用ください。</p><p>以下、ご利用に当たっての推奨事項になります。</p><h2 id="スクリプトの承認プロセスを設ける"><a href="#スクリプトの承認プロセスを設ける" class="headerlink" title="スクリプトの承認プロセスを設ける"></a>スクリプトの承認プロセスを設ける</h2><p>スクリプトの作成者と承認者で担当者を分け、CM にスクリプトを追加する前に承認が必要なようにしましょう。<br>なお、CM コンソール上の既定の設定では、作成者が直接承認を行えないよう、<br>以下のフラグが有効化されています。  </p><p>[CM コンソール] - [管理] - [概要] - [サイトの構成] - [サイト]-対象のサイトを選択-[階層設定] - [全般タブ] -「スクリプトの作成者には追加のスクリプト承認者が必要」</p><p><img src="/blog/mecm/20211025_01/20211025_01_01.png"></p><h2 id="承認ルールを定める"><a href="#承認ルールを定める" class="headerlink" title="承認ルールを定める"></a>承認ルールを定める</h2><p>スクリプトの承認者が判断に迷わないよう、承認に当たってルールを決めておきましょう。例えば、以下のようなルールが考えられるかと思います。</p><ul><li><p>CM クライアントに対して変更処理が入るようなスクリプトは承認しない</p><ul><li>例: ファイルの作成、機能の有効化、レジストリ値の変更、等</li></ul></li><li><p>操作誤りによりインフラに影響を与えるようなスクリプトは承認しない</p><ul><li>例: 複数クライアントによる負荷テスト</li></ul></li></ul><h2 id="実行ルールを定める"><a href="#実行ルールを定める" class="headerlink" title="実行ルールを定める"></a>実行ルールを定める</h2><p>CM としてはスクリプトの実行後、特に証跡が残るような仕組みは用意されておりません。また、実行にあたっての承認プロセスを実装する仕組みもまた、提供されておりません。</p><p>お客様のポリシーに依るかと存じますが、ポリシー上、厳密な管理を要求される場合であれば、スクリプトの実行記録について台帳等で記録を残す<br>る、スクリプト実行前後に承認プロセスを用意する、等の実行ルールを定めると良いかと存じます。</p><h1 id="スクリプト作成のコツ"><a href="#スクリプト作成のコツ" class="headerlink" title="スクリプト作成のコツ"></a>スクリプト作成のコツ</h1><h2 id="スクリプトの結果は少ない文字数で標準出力しよう。"><a href="#スクリプトの結果は少ない文字数で標準出力しよう。" class="headerlink" title="スクリプトの結果は少ない文字数で標準出力しよう。"></a>スクリプトの結果は少ない文字数で標準出力しよう。</h2><p>CMでスクリプトを実行すると、以下のように、デバイスごとに標準出力の内容が1行で出力されます。</p><p><img src="/blog/mecm/20211025_01/20211025_01_03.png"></p><p>スクリプトの出力欄をダブルクリックすると、以下のように出力内容の詳細を確認できます。</p><p><img src="/blog/mecm/20211025_01/20211025_01_04.png"></p><p>コレクションに対する実行結果を一覧で見たい時などは、上記の例のような出力だと比較が難しいので、スクリプトの実行目的に従って、出力結果の文字数を制限するようにしましょう。</p><p>例えば、以下のような形が良いかと存じます。この例では、.Net Framework の Version を確認するためのスクリプトを実行し、結果を短い文字列で出力するようにしています。</p><p><img src="/blog/mecm/20211025_01/20211025_01_05.png"></p><p>なお、スクリプトを上手く作ると、実行結果を出した後、「概要」タブを選択することで、出力結果を以下のようにグラフ表示できます。</p><p><img src="/blog/mecm/20211025_01/20211025_01_06.png"></p><h2 id="実行失敗時は終了コードを0以外の数値を出力しよう。"><a href="#実行失敗時は終了コードを0以外の数値を出力しよう。" class="headerlink" title="実行失敗時は終了コードを0以外の数値を出力しよう。"></a>実行失敗時は終了コードを0以外の数値を出力しよう。</h2><p>上記のスクリーンショットで示したとおり、「スクリプトの出力」で表示される文字数は限定されていますので、実行時エラーもスクリプト出力に表示させると一覧性が悪化します。<br>代わりに、想定されるエラー発生時のエラーコードを決め、エラーコードを内部で保持し、対応する方が良いでしょう。</p><h2 id="パラメータを受け取る場合は、パラメーター内容の妥当性確認を実施しよう"><a href="#パラメータを受け取る場合は、パラメーター内容の妥当性確認を実施しよう" class="headerlink" title="パラメータを受け取る場合は、パラメーター内容の妥当性確認を実施しよう"></a>パラメータを受け取る場合は、パラメーター内容の妥当性確認を実施しよう</h2><p>スクリプト作成時に下記の通り Param を指定することで実行時パラメーターを指定することが出来ます。</p><p><img src="/blog/mecm/20211025_01/20211025_01_07.png"></p><p>パラメーターを入力すると、下記画面で各パラメーターの妥当性確認を行います。正規表現も利用可能ですので、受け取ったパラメーターの妥当性を厳密に実施するようにしましょう。こちらで妥当性確認が出来ない内容についてはスクリプト側で確認するようにしましょう。</p><p><img src="/blog/mecm/20211025_01/20211025_01_08.png"></p><h2 id="スクリプトを-CM-コンソールに登録する前に開発環境でテストしよう"><a href="#スクリプトを-CM-コンソールに登録する前に開発環境でテストしよう" class="headerlink" title="スクリプトを CM コンソールに登録する前に開発環境でテストしよう"></a>スクリプトを CM コンソールに登録する前に開発環境でテストしよう</h2><p>お客様のポリシーによりますが、本番環境に置いては、上記の通りスクリプトの登録時に承認プロセスがある筈ですので、CMコンソールで実施する前に開発環境で十分にスクリプトをテストしてからスクリプトを登録するようにした方が良いかと存じます。ちょっとしたスクリプトの修正で承認プロセス通してたら時間がかかってしまいますので･･･。</p><h1 id="スクリプトの作成手順"><a href="#スクリプトの作成手順" class="headerlink" title="スクリプトの作成手順"></a>スクリプトの作成手順</h1><p><strong>以下、パラメーターを指定しない場合の</strong>、スクリプト 作成者による CM コンソールでのスクリプトの作成手順は以下の通りです。</p><ol><li><strong>スクリプト作成者</strong>の ID で CM コンソールが動く端末にログインします。  </li><li>[CMコンソール]-[ソフトウェア ライブラリ]-[概要]-[スクリプト]に遷移します。  </li><li>[スクリプトの作成]をクリックします。<br><img src="/blog/mecm/20211025_01/20211025_01_02.png"></li><li>「スクリプト名」に適宜名前を付けます。  </li><li>「スクリプト」にスクリプトを書きます。「インポート」でps1ファイルから読み込む事も出来ます。<br><img src="/blog/mecm/20211025_01/20211025_01_09.png">  </li><li>以降はウィザードに従って、最後まで「次へ」をクリックし、完了後「閉じる」をクリックします。  </li></ol><h1 id="スクリプトの承認手順"><a href="#スクリプトの承認手順" class="headerlink" title="スクリプトの承認手順"></a>スクリプトの承認手順</h1><ol><li><strong>スクリプト承認者</strong>の ID で  CM コンソールが動く端末にログインします。  </li><li>[CM コンソール] - [ソフトウェア ライブラリ] - [概要] - [スクリプト]に遷移します。  </li><li>スクリプト作成者から報告のあったスクリプトの名前を選択します。「承認状態」が「承認を待っています」となっていることからも判断出来ます。<br><img src="/blog/mecm/20211025_01/20211025_01_10.png">  </li><li>画面上部「承認/拒否」ボタンをクリックします。<br><img src="/blog/mecm/20211025_01/20211025_01_11.png">  </li><li>起動したウィザードにて、スクリプト内容を確認、レビューします。<br><img src="/blog/mecm/20211025_01/20211025_01_12.png">  </li><li>レビュー結果を記載します。適宜レビューコメントを入力できます。<br><img src="/blog/mecm/20211025_01/20211025_01_13.png">  </li><li>以降はウィザードに従って、最後まで「次へ」をクリックし、完了後「閉じる」をクリックします。  </li><li>登録完了後、該当のスクリプトが「承認済み」となっていることを確認します。<br><img src="/blog/mecm/20211025_01/20211025_01_14.png">  </li></ol><h1 id="スクリプトの実行手順"><a href="#スクリプトの実行手順" class="headerlink" title="スクリプトの実行手順"></a>スクリプトの実行手順</h1><ol><li>スクリプトの実行権限を持つ ID で、CM コンソールが動く端末にログインします。  </li><li>スクリプトの実行対象によって以下を選択します。  <ul><li>[CM コンソール] - [資産とコンプライアンス] - [概要] - [デバイス]  </li><li>[CM コンソール」- [資産とコンプライアンス] - [概要] - [デバイス コレクション]  </li></ul></li><li>実行対象を右クリックすると、「スクリプトの実行」メニューがあるので、そちらをクリックします。<br><img src="/blog/mecm/20211025_01/20211025_01_15.png">  </li><li>実行するスクリプトを選択し、「次へ」をクリックします。<br><img src="/blog/mecm/20211025_01/20211025_01_16.png"><br>5．概要画面で「次へ」を選択します。<br><img src="/blog/mecm/20211025_01/20211025_01_17.png">  </li><li>実行が完了するのを待機します。オンデマンドで指定したクライアントに対してスクリプトを配布し、実行し、その結果を表示しますので時間がかかります。  </li><li>実行結果を確認します。適宜、結果をスクリーンショット等に取りましょう。<br><img src="/blog/mecm/20211025_01/20211025_01_18.png">  </li><li>出力セルを選択した後、「Ctrl+A」を押下して、メモ帳等に貼り付けると結果をテキスト形式で取得できます。<br><img src="/blog/mecm/20211025_01/20211025_01_19.png">  </li><li>ウィザードを適宜閉じます。  </li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;本日は Configuration Manager (CM) の便利な機能である&lt;strong&gt;スクリプト機能&lt;/strong&gt;のご紹介をさせていただきます。本機能に</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Windows Server 2012 R2 WSUS から Windows Server 2022 WSUS への移行手順 (WID -&gt; WID の場合)</title>
    <link href="https://jpmem.github.io/blog/wsus/2021-10-19_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2021-10-19_01/</id>
    <published>2021-10-18T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.265Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。WSUS サポート チームです。</p><p>今回は Windows Server 2012 R2 にインストールした WSUS を、最新の 2022 へ移行する手順をご紹介します。</p><p>サポート ライフサイクルにあわせて、新しいバージョンへの移行を検討されている方も多いかと思います。<br>WSUS サーバーを新しいバージョンに移行する場合、以下の方法があります。</p><ol><li>新サーバーで WSUS を新規構築  </li><li>旧サーバーでバックアップを取得し、新サーバーにリストア</li></ol><p>基本的には 1. 新規構築してご利用いただく方法が最もシンプルな方法になります。<br>既存のデータを引き継ぎたい場合には、今回ご紹介する 2. データベースのバックアップ / リストアをご検討ください。  </p><p>なお、WSUS データベースの変更に関して、こちら (<a href="https://docs.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/manage/wid-to-sql-migration">https://docs.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/manage/wid-to-sql-migration</a>) にデータベースのアタッチ / デタッチの方法を掲載していますが、こちらは同一サーバー上で WSUS データベースを WID から SQL に変更することを目的とした手順であり、今回のように異なるサーバー間の移行シナリオにはご利用いただけませんのでご留意ください。  </p><h1 id="WSUS-移行手順について-WID-gt-WID"><a href="#WSUS-移行手順について-WID-gt-WID" class="headerlink" title="WSUS 移行手順について (WID -&gt; WID)"></a>WSUS 移行手順について (WID -&gt; WID)</h1><ul><li><p>前提条件<br>移行元 サーバー : Windows Server 2012 R2 の WSUS 環境<br>移行先 サーバー : Windows Server 2022 の WSUS 環境<br>WSUS は移行元も移行先もデータベースに Windows Internal Database (WID) を利用していることを前提とします。</p></li><li><p>手順<br>Windows Server 2022 の WSUS のインストールとデータ移行の手順は以下の通りです。</p></li></ul><ol><li>Windows Server 2022 の WSUS のインストール  </li><li>データ移行  <ol><li>WSUS 更新プログラム バイナリを移行する  </li><li>WSUS セキュリティ グループを移行する  </li><li>WSUS データベースをバックアップする  </li><li>WSUS データベースのバックアップを移行先サーバーで復元する  </li><li>WSUS サーバー ID を変更する  </li><li>インデックスを再構成する  (任意)</li><li>不足ファイルをダウンロードする  (任意) </li></ol></li><li>完了確認  </li></ol><p>各手順の詳細を以下に記載いたします。</p><br>  <br>  <h1 id="1-Windows-Server-2022-への-WSUS-インストール"><a href="#1-Windows-Server-2022-への-WSUS-インストール" class="headerlink" title="1.Windows Server 2022 への WSUS インストール"></a>1.Windows Server 2022 への WSUS インストール</h1><p>まず初めに、Windows Server 2022 の WSUS のインストールは、サーバー マネージャーから[役割と機能の追加] をクリックして、インストールします。こちらの手順は以下の公開情報をご参照ください。<br><br>  </p><ul><li>手順 1:WSUS サーバー ロールをインストールする<br><a href="https://docs.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/deploy/1-install-the-wsus-server-role">https://docs.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/deploy/1-install-the-wsus-server-role</a></li></ul><p>WSUS サーバーの役割のインストールが正常に完了すると、Windows Server Update Services 設定ウィザードが自動的に起動しますが、このウィザードは閉じてください。</p><h1 id="2-データ移行"><a href="#2-データ移行" class="headerlink" title="2.データ移行"></a>2.データ移行</h1><h2 id="2-1-WSUS-更新プログラム-バイナリを移行する"><a href="#2-1-WSUS-更新プログラム-バイナリを移行する" class="headerlink" title="2.1. WSUS 更新プログラム バイナリを移行する"></a>2.1. WSUS 更新プログラム バイナリを移行する</h2><p>移行元のコンテンツ フォルダー「\&lt;移行元サーバー名&gt;\WsusContent」の内容を、移行先のコンテンツ フォルダー「\&lt;移行先サーバー名&gt;\WsusContent」へコピーします。エクスプローラー、xcopy コマンド、robocopy コマンド等を利用し、コピーすることが可能です。robocopy コマンドを利用する場合は、以下の通りです。</p><p>例) 移行元が WSUSOld で、移行先が WSUSNew の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">robocopy \\WSUSOld\WsusContent \\WSUSNew\WsusContent /E /COPYALL</span><br></pre></td></tr></table></figure><h2 id="2-2-WSUS-セキュリティ-グループを移行する"><a href="#2-2-WSUS-セキュリティ-グループを移行する" class="headerlink" title="2.2. WSUS セキュリティ グループを移行する"></a>2.2. WSUS セキュリティ グループを移行する</h2><p>WSUS Administrators ローカル セキュリティ グループと WSUS Reporters ローカル セキュリティ グループのみ手動で移行することを選択できます。</p><p>この手順を実行する前に、ローカル グループのメンバーであるドメイン ユーザーの名前を、移行先サーバーでも解決できることを確認します。移行元サーバーと移行先サーバーの属するドメインが異なる場合は、移行元ドメインのユーザー アカウントがあるフォレストのグローバル カタログ サーバーに移行先サーバーがアクセスできる必要があります。</p><p>WSUS Administrators ローカル セキュリティ グループと WSUS Reporters ローカル セキュリティ グループに手動でユーザーを移行するには、移行先サーバーで次の手順を実行します。</p><ul><li>手順  </li></ul><ol><li>「ファイル名を指定して実行」画面で lusrmgr.msc と入力して、Enter キーを押します。  </li><li>「ローカル ユーザーとグループ MMC スナップイン」のコンソール ツリーで、[ユーザー] をダブルクリックします。  </li><li>移行元サーバーの WSUS Administrators グループと WSUS Reporters グループに存在したユーザーを手動で作成します。  </li><li>ローカル ユーザーとグループ MMC スナップインのコンソール ツリーで、[グループ] をダブルクリックします。  </li><li>移行元サーバーの WSUS Administrators グループと WSUS Reporters グループに存在したユーザーを移行先サーバーの WSUS Administrators グループと WSUS Reporters グループに手動で追加します。</li></ol><h2 id="2-3-WSUS-データベースをバックアップする"><a href="#2-3-WSUS-データベースをバックアップする" class="headerlink" title="2.3. WSUS データベースをバックアップする"></a>2.3. WSUS データベースをバックアップする</h2><p>移行元 WSUS サーバーにおいて以下の手順を実施し、WSUS データベース (SUSDB) をバックアップします。</p><ol><li><p>下記 URL より SQL Server Management Studio をダウンロードし、WSUS サーバーにインストールします。<br>Microsoft SQL Server Management Studio<br>(<a href="https://docs.microsoft.com/ja-jp/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15">https://docs.microsoft.com/ja-jp/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15</a>)</p></li><li><p>SQL Server Management Studio を起動して、以下の接続文字列を指定してインスタンスに接続します。<br>サーバーの種類 : データベース エンジン<br>サーバー名 : \.\pipe\Microsoft##WID\tsql\query<br>認証 : Windows 認証</p></li><li><p>[データベース] を展開し、[SUSDB] データベースを選択します。  </p></li><li><p>データベースを右クリックし、[タスク] をポイントして、[バックアップ] をクリックします。[データベースのバックアップ] ダイアログ ボックスが表示されます。  </p></li><li><p>[データベース] ボックスの一覧で、データベース名を確認します。  </p></li><li><p>[バックアップの種類] ボックスの一覧で、[完全] をクリックします。  </p></li><li><p>[コピーのみのバックアップ] を選択します。コピーのみのバックアップとは、定期的に実行される一連の SQL Server バックアップとは別の SQL Server バックアップです。  </p></li><li><p>[バックアップ コンポーネント] で [データベース] をクリックします。  </p></li><li><p>[バックアップ先] に [ディスク] を選択して、[追加] からバックアップ先を選択します。  </p></li><li><p>[ページの選択] ウィンドウの [メディア オプション] をクリックします。  </p></li><li><p>[メディアに上書きする] オプションで、[既存のバックアップ セットに追加する] にチェックがされていることを確認します。  </p></li><li><p>[信頼性] セクションで、必要に応じて、次のチェック ボックスをオンにします。    </p><ul><li>[完了時にバックアップを検証する]  </li><li>[メディアに書き込む前にチェックサムを行う]  </li><li>[エラーのまま続行する]  </li></ul></li><li><p>[OK] をクリックして、バックアップを作成します。  </p></li><li><p>バックアップ完了後、指定したバックアップ先に作成されたバックアップ ファイルを移行先 WSUS サーバーの任意の場所にコピーします。  </p></li></ol><h2 id="2-4-WSUS-データベースのバックアップを移行先サーバーで復元する"><a href="#2-4-WSUS-データベースのバックアップを移行先サーバーで復元する" class="headerlink" title="2.4. WSUS データベースのバックアップを移行先サーバーで復元する"></a>2.4. WSUS データベースのバックアップを移行先サーバーで復元する</h2><p>移行先 WSUS サーバーにおいて以下の手順を実施し、WSUS データベース (SUSDB) を復元します。</p><ol><li><p>下記 URL より SQL Server Management Studio をダウンロードし、WSUS サーバーにインストールします。<br>Microsoft SQL Server Management Studio<br>(<a href="https://docs.microsoft.com/ja-jp/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15">https://docs.microsoft.com/ja-jp/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15</a>)</p></li><li><p>SQL Server Management Studio を起動して、以下の接続文字列を指定してインスタンスに接続します。<br>サーバーの種類 : データベース エンジン<br>サーバー名 : \.\pipe\Microsoft##WID\tsql\query<br>認証 : Windows 認証  </p></li><li><p>[新しいクエリ] をクリックし、次の SQL コマンドをコピーして [実行] をクリックしてクエリを実行します。このクエリにより、WSUS データベースが削除されます。</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">USE master</span><br><span class="line">GO</span><br><span class="line">ALTER DATABASE SUSDB SET SINGLE_USER WITH ROLLBACK IMMEDIATE</span><br><span class="line">GO</span><br><span class="line">DROP DATABASE SUSDB</span><br><span class="line">GO</span><br></pre></td></tr></table></figure><ol start="4"><li><p>[実行] をクリックしてクエリを実行します。  </p></li><li><p>続けて、次の SQL コマンドをコピーして [実行] をクリックしてクエリを実行します。WSUS データベースをバックアップから復元します。<br>例) バックアップ ファイルを C:\SUSDB.bak に配置している場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RESTORE DATABASE [SUSDB] FROM DISK = N&#x27;C:\SUSDB.bak&#x27; WITH FILE = 1, MOVE N&#x27;SUSDB&#x27; TO N&#x27;c:\Windows\WID\Data\susdb.mdf&#x27;, MOVE N&#x27;SUSDB_log&#x27; TO N&#x27;c:\Windows\WID\Data\SUSDB_log.ldf&#x27;, NOUNLOAD, STATS = 10</span><br></pre></td></tr></table></figure></li><li><p>この結果として、次のエラー メッセージが表示される場合があります。エラー メッセージを無視して、続行してください。<br>メッセージ 3605、レベル 16、状態 1、行 1<br>データベース ‘SUSDB’ のスキーマの検証が失敗しました。<br>メッセージ 3013、レベル 16、状態 1、行 1<br>RESTORE DATABASE が異常終了しています。</p></li><li><p>移行先 WSUS サーバー (Windows Server 2022) でコマンド プロンプトを [管理者として実行] にて開き、次のコマンドを実行します。<br>例) WSUS のインストール フォルダーが D:\WSUS の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd %programfiles%\Update Services\Tools</span><br><span class="line">wsusutil postinstall content_dir=D:\WSUS  </span><br></pre></td></tr></table></figure></li></ol><h2 id="2-5-WSUS-サーバー-ID-を変更する"><a href="#2-5-WSUS-サーバー-ID-を変更する" class="headerlink" title="2.5. WSUS サーバー ID を変更する"></a>2.5. WSUS サーバー ID を変更する</h2><p>移行先サーバーの WSUS サーバー ID は変更する必要があります。この手順を実行すると、移行プロセス中に WSUS 管理のクライアントは影響を受けなくなります。移行元サーバーと移行先サーバーが同じ ID を使用して実行されている場合、サーバーの一方に対して変更を行うと、クライアントとサーバー間の通信は失敗します。</p><ol><li><p>移行先サーバーで、Windows PowerShell を [管理者として実行] にて開き、次のスクリプトを実行します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$updateServer = get-wsusserver</span><br><span class="line">$config = $updateServer.GetConfiguration()</span><br><span class="line">$config.ServerId = [System.Guid]::NewGuid()</span><br><span class="line">$config.Save()</span><br></pre></td></tr></table></figure></li><li><p>サーバー ID が変更されたら、すぐにコマンド プロンプトを [管理者として実行] にて開き、次のコマンドを実行して新しい暗号化キーを生成します。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd %programfiles%\Update Services\Tools</span><br><span class="line">wsusutil.exe postinstall</span><br></pre></td></tr></table></figure><br>  </li></ol><h2 id="任意-2-6-インデックスを再構成する"><a href="#任意-2-6-インデックスを再構成する" class="headerlink" title="(任意) 2.6. インデックスを再構成する"></a>(任意) 2.6. インデックスを再構成する</h2><p>インデックスの再構成を定期的に実施していない場合、移行前の WSUS データベースにてインデックスの断片化が発生し、クエリ パフォーマンスが劣化していることがございます。その場合は、インデックス再構成により、クエリ パフォーマンスを改善できます。</p><p>コマンドを使ってインデックスの再構成を行う場合には、インデックス再構成用のスクリプトを sql ファイルに保存した上で、以下のコマンドを実行します。</p><p>例) C:\Temp\WsusDBMaintenance.sql に実行する SQL 文を保存しており、C:\Temp 配下に実行結果ログを出力する場合<br>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlcmd -E -S &lt;インスタンス名&gt; -i</span><br><span class="line">C:\Temp\WsusDBMaintenance.sql -o</span><br><span class="line">C:\Temp\WsusDBMaintenance.out -f 65001</span><br><span class="line">※ WSUS データベースに WID をご利用の場合、&lt;インスタンス名&gt; は、以下を指定します。</span><br><span class="line">\\.\pipe\Microsoft##WID\tsql\query</span><br></pre></td></tr></table></figure></p><p>出力ファイルに “Statistics for all tables have been updated” または”全テーブルの統計が更新されました” というメッセージが 表示されていれば、インデックスの再構成が完了しています。</p><p>～ 参考情報 ～<br>sqlcmd ユーティリティ<br><a href="https://msdn.microsoft.com/ja-jp/library/ms162773.aspx">https://msdn.microsoft.com/ja-jp/library/ms162773.aspx</a></p><p>WSUS DB インデックスの再構成の手順について<br><a href="https://blogs.technet.com/b/jpwsus/archive/2014/03/06/wsusdb.aspx">https://blogs.technet.com/b/jpwsus/archive/2014/03/06/wsusdb.aspx</a><br><br>  </p><h2 id="任意-2-7-不足ファイルをダウンロードする"><a href="#任意-2-7-不足ファイルをダウンロードする" class="headerlink" title="(任意) 2.7. 不足ファイルをダウンロードする"></a>(任意) 2.7. 不足ファイルをダウンロードする</h2><p>手順 2.1. でバイナリ ファイルは移行元からコピーされていますが、もし移行元で承認されていたにも関わらず、バイナリが不足している場合は、wsusutil reset コマンドで不足ファイルのみをダウンロードすることができます。もし、クライアントの接続確認の際に 80244019 エラー (HTTP status 404 File Not Found) が発生した場合は、サーバー側の WsusContent フォルダー配下に必要なファイルが不足している可能性がございますので、以下のコマンドの実行をお試しください。</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /d &quot;C:\Program Files\Update Services\Tools&quot;</span><br><span class="line">wsusutil reset</span><br></pre></td></tr></table></figure><p>コマンド ラインからの WSUS の管理<br><a href="https://technet.microsoft.com/ja-jp/library/cc720466(v=ws.10).aspx">https://technet.microsoft.com/ja-jp/library/cc720466(v=ws.10).aspx</a>  </p><p>—– 抜粋ここから —–<br>resetデータベースのすべての更新メタデータ行に、ファイル システムに格納されている対応する更新ファイルが含まれていることを確認します。更新ファイルが不足していたり壊れていた場合、WSUS は更新ファイルをもう一度ダウンロードします。  </p><ul><li>WSUS データベースを復元した後  </li><li>トラブルシューティング時    </li><li>—- 抜粋ここまで —–  <br>  <br>  </li></ul><h2 id="3-完了確認"><a href="#3-完了確認" class="headerlink" title="3.完了確認"></a>3.完了確認</h2><p>移行先サーバーで WSUS 管理コンソールを起動し、初回の設定を必要に応じて行います。WSUS 管理コンソール起動後、更新プログラムの情報や承認情報、グループ情報が移行されていることをご確認ください。また、ダウンストリーム サーバーの接続や WSUS クライアントを移行先の WSUS サーバーと接続できるかどうか確認するためには、以下の内容をご確認ください。  </p><p>～ 参考情報 ～<br>3.5. Apply security settings<br>-Point the downstream servers to the new WSUS server<br>-Point the WSUS clients to the new WSUS server<br><a href="https://docs.microsoft.com/ja-jp/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh852349(v=ws.11)?redirectedfrom=MSDN#point-the-downstream-servers-to-the-new-wsus-server">https://docs.microsoft.com/ja-jp/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh852349(v=ws.11)?redirectedfrom=MSDN#point-the-downstream-servers-to-the-new-wsus-server</a></p><p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。WSUS サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は Windows Server 2012 R2 にインストールした WSUS を、最新の 2022 へ移行する手順をご紹介します。&lt;/p&gt;
&lt;p&gt;サポート ライフサイクルにあわせて、新しいバージョンへの移行を</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Windows 11 のサポートについて (Configuration Manager と WSUS)</title>
    <link href="https://jpmem.github.io/blog/mecm/20211005_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20211005_01/</id>
    <published>2021-10-04T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.213Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>下記ページでも公開されておりますが、本日 (2021/10/5) に GA となりました Windows 11 につきまして、 Microsoft Endpoint Manager Configuration Manager のサポートが開始となりました。<br>以下、ご利用における注意点と、MECM および WSUS で Windows 11 の更新プログラムを配布するための設定についてご案内します。</p><p><a href="https://docs.microsoft.com/en-us/mem/configmgr/core/plan-design/configs/support-for-windows-11">https://docs.microsoft.com/en-us/mem/configmgr/core/plan-design/configs/support-for-windows-11</a></p><h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h2><ol><li>Windows 11 クライアント の サポート は MECM CB 2107 からの対応となります。</li><li>Windows 11 のタスクシーケンスによるデプロイには Windows 11 のADKが必要となります。<br><a href="https://docs.microsoft.com/en-us/mem/configmgr/core/plan-design/configs/support-for-windows-adk">https://docs.microsoft.com/en-us/mem/configmgr/core/plan-design/configs/support-for-windows-adk</a></li><li>現時点において、MECM コンソールのデバイス一覧表記では、オペレーティングシステム の項が Microsoft Windows NT Workstation 10.0 と表示されます。Windows 10との区別のためには、オペレーティング システム ビルドの項を確認ください。ビルド バージョン 10.0.22000 以降 が Windows 11 となります。</li><li>現時点において、Desktop Analytics は Windows 11 をサポートしておりません。</li><li>現時点において、MECM コンソールの “Windows Servicing” のダッシュボードでは Windows 11 デバイスも表示されます。</li></ol><h2 id="MECM-で-Windows-11-の更新プログラムを配布する"><a href="#MECM-で-Windows-11-の更新プログラムを配布する" class="headerlink" title="MECM で Windows 11 の更新プログラムを配布する"></a>MECM で Windows 11 の更新プログラムを配布する</h2><h3 id="前提事項"><a href="#前提事項" class="headerlink" title="前提事項"></a>前提事項</h3><p>弊社 Windows Update サイトとの同期が取れていることが必要でございます。</p><h3 id="設定手順"><a href="#設定手順" class="headerlink" title="設定手順"></a>設定手順</h3><p>弊社他製品と同様に下記を実施ください。</p><ol><li>[CMコンソール] - [管理] - [概要] - [サイトの構成] - [サイト] - 対象のサイトを選択 </li><li>[サイト コンポーネントの構成] - [ソフトウェアの更新ポイント]</li><li>[製品]タブ - [Windows 11] を有効化する</li></ol><p><img src="/blog/mecm/20211005_01/20211005_01_01.png"></p><p>上記設定後、Windows Update との同期が完了すると以下が表示されるようになります。</p><p><img src="/blog/mecm/20211005_01/20211005_01_02.png"></p><h2 id="WSUS-で-Windows-11-の更新プログラムを配布する"><a href="#WSUS-で-Windows-11-の更新プログラムを配布する" class="headerlink" title="WSUS で Windows 11 の更新プログラムを配布する"></a>WSUS で Windows 11 の更新プログラムを配布する</h2><h3 id="前提事項-1"><a href="#前提事項-1" class="headerlink" title="前提事項"></a>前提事項</h3><p>弊社 Windows Update サイトとの同期が取れていることが必要でございます。</p><h3 id="設定手順-1"><a href="#設定手順-1" class="headerlink" title="設定手順"></a>設定手順</h3><p>弊社他製品と同様に下記を実施ください。</p><ol><li>[WSUS コンソール] - [オプション] - [製品と分類]</li><li>[製品タブ] - 「Windows 11」を有効化する</li></ol><p><img src="/blog/mecm/20211005_01/20211005_01_03.png"></p><p>上記設定後、Windows Update との同期が完了すると以下が表示されるようになります。</p><p><img src="/blog/mecm/20211005_01/20211005_01_04.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;下記ページでも公開されておりますが、本日 (2021/10/5) に GA となりました Windows 11 につきまして、 Microsoft Endpoint </summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>重複 GUID の対処について</title>
    <link href="https://jpmem.github.io/blog/mecm/20210922_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20210922_01/</id>
    <published>2021-09-21T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.213Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>本日は、お客様をサポートする中、我々が頻繁に遭遇する「重複 GUID 問題」についてご案内させて頂きます。<br>是非、運用されている Configuration Manager (CM) について定期的にご確認いただき、System Health を良い状態に保つ一助にして頂きたく存じます。</p><h2 id="重複-GUID-問題-とは"><a href="#重複-GUID-問題-とは" class="headerlink" title="重複 GUID 問題 とは"></a>重複 GUID 問題 とは</h2><p>CM がクライアントの同定のために引き当てる、GUID “XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX” の形式の番号が、複数の端末にて重複してしまう問題です。</p><h2 id="何が問題なの"><a href="#何が問題なの" class="headerlink" title="何が問題なの?"></a>何が問題なの?</h2><p>CM がクライアントの同定を正しく行えなくなってしまうので、下記のような事象が発生します。<br>CM のほぼ全ての機能が正しく利用出来なくなってしまいます。</p><ul><li>意図しない端末に対して、アプリケーション、パッケージ、更新プログラム、タスクシーケンスの配布を行ってしまう。</li><li>収集したインベントリ情報が正しい端末に紐付かない (収集したインベントリ情報を信頼できなくなってしまう)</li></ul><h2 id="どうして問題が発生するの？"><a href="#どうして問題が発生するの？" class="headerlink" title="どうして問題が発生するの？"></a>どうして問題が発生するの？</h2><p>CM はクライアントが CM の管理ポイントに初めて接続した際に GUID を生成し、クライアント側に伝えます。そのクライアント側に伝えられた GUID は %windir%\SMSCFG.ini に保管されます。この一連の流れにより CM サーバーにクライアント情報が登録されます。クライアントは、この SMSCFG.ini に記載の GUID を利用して CM とのやりとりを行います。  </p><p>ということは、この登録作業が終わってしまっている CM のクライアントのデータを複製すると、複製元のクライアントと、複製先のクライアントにて、SMSCFG.ini もまた複製されてしまうわけですから、GUID も同じものを使ってしまいます。本当は違うクライアントでも、CM サーバーから見ると、GUID が同じなので、同じ端末と見なしてしまいます。</p><h2 id="どのような時に問題が発生するの？"><a href="#どのような時に問題が発生するの？" class="headerlink" title="どのような時に問題が発生するの？"></a>どのような時に問題が発生するの？</h2><p>CM への登録が終わってしまっている CM クライアントを複製した場合に発生します。<br>つまり、以下のような場合です。</p><ul><li>CM 登録済み OS のイメージをキャプチャして、キッティングの際のベースイメージとした場合。</li><li>CM 登録済みの仮想マシンを仮想マシンテンプレートとした場合。</li><li>CM 登録済みの仮想マシンをクローンした場合。</li><li>CM 登録済みのバックアップを他のマシンにリストアし、並行稼働した場合。</li></ul><p>特に VDI をご利用されている環境で多く発生している印象です。</p><h2 id="どのように問題を察知すれば良いの"><a href="#どのように問題を察知すれば良いの" class="headerlink" title="どのように問題を察知すれば良いの?"></a>どのように問題を察知すれば良いの?</h2><p>CM のデータベーステーブル System_HIST には CMが管理している端末についてホスト名が変わった際の履歴が残っております。このテーブルにて、MachineID と SMSID が同じなのに、ホスト名が頻繁に切り替わっているものがあった場合、GUID 重複が発生している可能性が非常に高いと判断できます。なお、本テーブルにて MachineID と SMSID が同じレコードの中で、TimeKey が最も古い端末が複製元となっている可能性が高いため、調査の参考にして頂ければと存じます。 </p><p>CM 管理者の方には本テーブル内容の確認を定期運用作業に組み込むことをお勧めいたします。</p><h2 id="どのように問題を解決すれば良いの？"><a href="#どのように問題を解決すれば良いの？" class="headerlink" title="どのように問題を解決すれば良いの？"></a>どのように問題を解決すれば良いの？</h2><p>環境の複製先と、複製元の端末にて以下の対処を実施ください。</p><h3 id="複製先端末"><a href="#複製先端末" class="headerlink" title="複製先端末"></a>複製先端末</h3><p>以下の手順で対処を実行ください。</p><ol><li>CCMExec サービスを停止します。</li><li>以下の Powershell スクリプトを実行します。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WMIObject</span> <span class="literal">-Namespace</span> root\CCMVDI <span class="literal">-Class</span> CCM_VDI_Identity_Store_Configuration <span class="literal">-Filter</span> “Name&lt;&gt;’RDV’” | <span class="built_in">Remove-WMIObject</span></span><br><span class="line"><span class="built_in">Remove-Item</span> <span class="literal">-Path</span> HKLM:\Software\Microsoft\SystemCertificates\SMS\Certificates <span class="literal">-Recurse</span> <span class="literal">-Force</span></span><br><span class="line"><span class="built_in">Remove-Item</span> <span class="literal">-Path</span> C:\Windows\SMSCFG.ini <span class="literal">-Force</span> <span class="literal">-ErrorAction</span> SilentlyContinue</span><br></pre></td></tr></table></figure></li><li>CCMExec サービスを起動します。</li></ol><h4 id="複製先端末が複数の場合の対処"><a href="#複製先端末が複数の場合の対処" class="headerlink" title="複製先端末が複数の場合の対処"></a>複製先端末が複数の場合の対処</h4><ol><li>重複している GUID を持つ端末を集めたデバイスコレクションを作成します。下記の WQL クエリをご利用ください。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span>  SMS_R_System <span class="keyword">where</span> SMS_R_System.SMSUniqueIdentifier <span class="operator">=</span> <span class="string">&#x27;[重複 GUID を起こしている GUID]&#x27;</span></span><br></pre></td></tr></table></figure></li><li>上記コレクションに対して単体対処の時に利用したPowershellをパッケージで配布します。パッケージ配布の際のコマンドは以下を指定ください。<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden -File XXXX.ps1</span><br></pre></td></tr></table></figure></li><li>パッケージを配布されたクライアントは再起動され次第、新しい GUID を順次取得します。配布対象のコレクションに所属するクライアント数が少なくなっていけば事象解消し始めていることになります。</li></ol><h3 id="複製元端末-マスターイメージ"><a href="#複製元端末-マスターイメージ" class="headerlink" title="複製元端末 (マスターイメージ)"></a>複製元端末 (マスターイメージ)</h3><ol><li>下記ブログにてご案内している手順で CM クライアントを完全アンインストールください。</li></ol><ul><li><a href="https://jpmem.github.io/blog/mecm/20190327_01/">https://jpmem.github.io/blog/mecm/20190327_01/</a></li></ul><ol start="2"><li>(Citrix VDI 端末のマスターイメージの場合) Powershellを管理者権限で開き、以下を実行ください。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WmiObject</span> <span class="literal">-Namespace</span> root\CCMVDI <span class="literal">-Class</span> CCM_VDI_Identity_Store_Configuration <span class="literal">-Filter</span> <span class="string">&quot;Name=&#x27;Citrix&#x27;&quot;</span> | <span class="built_in">Remove-WmiObject</span></span><br></pre></td></tr></table></figure></li><li>CM コンソールから、重複していた GUID を持つデバイスのレコードを削除します。</li><li>以下のマスターイメージ用の CM クライアント インストール手順を実施します。</li><li>マスターイメージを取得します。</li></ol><h4 id="マスターイメージ用-CM-クライアント-インストール手順"><a href="#マスターイメージ用-CM-クライアント-インストール手順" class="headerlink" title="マスターイメージ用 CM クライアント インストール手順"></a>マスターイメージ用 CM クライアント インストール手順</h4><h5 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h5><ul><li>SMS Agent Host サービスの停止とスタート アップの種類の変更<br>[管理ツール] - [サービス] を起動し、SMS Agent Host サービスを停止します。また、マスター イメージ採取前に自動でサービスが起動しないように、右クリックしてプロパティを開き、スタートアップの種類を [手動] に変更します。</li></ul><p>また、タスクスケジューラを開き [Microsoft] - [Configuration Manager] にある [Configuration Manager Health Evaluation] タスクを右クリックして [無効] にします。<br>これによって、SMS Agent Host サービスが自動で起動しないようになります。</p><h5 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h5><ol><li><p>以下の手順にて、サイト コードが “未割り当て” の状態でエージェントのセットアップを行います。</p><ol><li>サイト サーバーより、SCCM インストール フォルダー 配下に存在する Client フォルダーをコピーし保存します。インストール フォルダーの初期設定は以下になります。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\Program Files\Microsoft Configuration Manager\Client</span><br></pre></td></tr></table></figure></li><li>参照コンピューターにローカル管理者権限をもつユーザーでログインします。</li><li> 項番 1) でコピーした Client フォルダーを、クライアント上の任意のフォルダーに格納します。</li><li>サイト サーバーと通信できないようにするため、ネットワーク ケーブルを抜きます。</li><li>[管理者として実行] にてコマンド プロンプトを開き、cd コマンドでクライアントに格納した Client フォルダーに移動します。</li><li>以下のコマンドを実行します。<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccmsetup.exe</span><br></pre></td></tr></table></figure>※オプションなしで ccmsetup.exe を実行することにより、”未割り当て” の状態でエージェントがセットアップされます。</li><li>タスクマネージャーを起動して [プロセス] タブにて ccmsetup.exe が表示されなくなるまで待ちます。</li><li>[コントロール パネル] -&gt; [システムとセキュリティ] -&gt; [Configuration Manager] を開き、以下のようにサイト コードが “未割り当て” の状態であることを確認します。<ul><li>[コンポーネント] タブ : 「CCM 通知エージェント」以外のすべての項目が「インストール済み」であることを確認します。</li><li>※ 「CCM 通知エージェント」は「無効」になります。</li><li>[サイト] タブ : 「現在の割り当てサイト コード」が空欄であることを確認します。</li></ul></li></ol></li><li><p>SMS Agent Host サービスの停止とスタート アップの種類の変更<br>[管理ツール] - [サービス] を起動し、SMS Agent Host サービスを停止します。また、マスター イメージ採取前に自動でサービスが起動しないように、右クリックしてプロパティを開き、スタートアップの種類を [手動] に変更します。</p></li><li><p>SCCM で使用する自己署名証明書を削除する<br>以下の手順で自己署名証明書を削除します。  </p><ol><li>コマンド プロンプトを開き、”mmc” を入力して実行します。</li><li>[ファイル] - [スナップインの追加と削除] をクリックします。</li><li>左ペインから [証明書] をクリックして [追加] ボタンをクリックします。</li><li>“コンピューター アカウント” にチェックを入れて、[次へ] をクリックします。</li><li>“ローカル コンピューター” にチェックし、[完了] をクリックします。</li><li>右ペインに “証明書（ローカル コンピューター）” が追加されていることを確認し [OK] をクリックします。</li><li>左ペインにて、[証明書] - [SMS] - [証明書] を選択します。</li><li>中央ペインに表示された 2 つの “SMS” 証明書に対して、それぞれ右クリックして [削除] を選択します。<br>「選択された証明書を永久的に削除しますか?」というメッセージが表示されますので、[はい] を選択します。</li><li>[ファイル] - [終了] をクリックします。「コンソールの設定を コンソール1 に保存しますか?」というメッセージが表示されますので、[いいえ] を選択して、mmc を終了します。</li></ol></li><li><p>SCCM 独自の信頼キーと管理ポイントの証明書を削除する</p></li></ol><p>エージェントのインストール完了後に、もしネットワークに接続して、SCCM サーバー(管理ポイント サーバー) との通信が可能となった場合、参照コンピューターが、SCCM で使用する信頼キーと管理ポイントの証明書を WMI の中に保持した状態となる可能性があります。</p><p>この場合、参照コンピューターに保存されている信頼キーや管理ポイントの証明書を削除する必要があります。wbemtest より、WMI 名前空間 “root\ccm\locationservices” に接続できない場合は、SCCM サーバーと一度も接続がされていないため、問題ありません。接続できる場合は、情報を削除するため、以下の手順を実施してください。</p><p>以下の内容をサンプルとしてスクリプトを作成し、ps1 ファイルとして保存します。本スクリプトを実行することで、信頼キーや管理ポイントの証明書も削除されます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">gwmi</span> <span class="literal">-namespace</span> root\ccm\locationservices <span class="literal">-class</span> trustedrootkey | <span class="built_in">rwmi</span></span><br></pre></td></tr></table></figure><p>スクリプトを作成した後、参照コンピューターでコマンド プロンプトを “管理者として実行” にて起動し、<br>以下のコマンドを実行します。</p><p>※) C:\Temp にスクリプト DeleteTRK.ps1 を保存した場合</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Temp</span><br><span class="line">powershell.exe DeleteTRK.ps1</span><br></pre></td></tr></table></figure><p>スクリプト実行完了後、以下の手順で、正常に信頼キーや証明書が削除されたことを確認します。</p><ol><li><p>コマンド プロンプトを “管理者として実行” にて起動して wbemtest を実行し、”root\ccm\locationservices” 名前空間に接続します。</p></li><li><p>「スーパークラス名の入力」はブランクのまま、「クラスの列挙」を “再帰” を有効にして実行します。</p></li><li><p>一覧から “TrustedRootKey” を選択し、ダブルクリックして開きます。</p></li><li><p> 開いた画面で「インスタンス」をクリックします。</p></li><li><p> インスタンスが存在しないことを確認します。</p></li><li><p>SMS Agent Host サービスのスタート アップの種類の変更</p></li></ol><p>[管理ツール] - [サービス] を起動し、SMS Agent Host サービスを右クリックしてプロパティを開き、スタートアップの種類を [自動（遅延開始）] に変更します。SMS Agent Host サービスを開始しないように注意してください。<br>また、タスクスケジューラを開き [Microsoft] - [Configuration Manager] にある [Configuration Manager Health Evaluation] タスクを右クリックして [有効] にします。<br>SMS Agent Host サービスを手動で開始しないように注意してください。</p><ol start="6"><li>マスターイメージの採取<br>sysprep /generalize が実行された参照コンピューターをキャプチャして、マスター イメージを採取します。</li></ol><h2 id="どのように問題を予防すれば良いの"><a href="#どのように問題を予防すれば良いの" class="headerlink" title="どのように問題を予防すれば良いの?"></a>どのように問題を予防すれば良いの?</h2><p>恐れながら基本的に運用による予防をお願い致します。マスターイメージをキャプチャされる際は、CM に登録されないように。また、CMクライアントで管理されている実利用の端末（検証用途ではない）が仮想マシンで<br>作成されている場合、安易に仮想マシンの複製を行わないようにご対応ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;本日は、お客様をサポートする中、我々が頻繁に遭遇する「重複 GUID 問題」についてご案内させて頂きます。&lt;br&gt;是非、運用されている Configuration M</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 用にリモート デスクトップ クライアントをセットアップする手順</title>
    <link href="https://jpmem.github.io/blog/w365/2021-09-13_01/"/>
    <id>https://jpmem.github.io/blog/w365/2021-09-13_01/</id>
    <published>2021-09-12T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.237Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は、Windows 365 に接続する際に、リモート デスクトップ クライアントをセットアップする手順についてご案内します。</p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2021/9/13 時点で判明している内容についての記載となっております。今後内容が更新されることもございますので、その点ご承知置きくださいますようお願い致します。</p><h2 id="リモート-デスクトップ-クライアントを利用する理由"><a href="#リモート-デスクトップ-クライアントを利用する理由" class="headerlink" title="リモート デスクトップ クライアントを利用する理由"></a>リモート デスクトップ クライアントを利用する理由</h2><p>Windows クライアントから Windows 365 に接続するクライアントには、ブラウザのWeb クライアント、リモートデスクトップ クライアント、およびストア アプリのリモート デスクトップ クライアントがございますが、下記URLに記載の通り、各種デバイスのリダイレクション機能についてはそれぞれでサポート範囲が異なります。</p><p><a href="https://docs.microsoft.com/en-us/windows-365/manage-rdp-device-redirections#redirection-support">https://docs.microsoft.com/en-us/windows-365/manage-rdp-device-redirections#redirection-support</a></p><p>2021/9/13時点では最も制約が少ないクライアントがリモート デスクトップ クライアントとなります。<br>以下では、こちらのクライアントのことを MSRDC と呼びます。</p><p>なお、従来よりリモート デスクトップ接続用途にご利用頂いております、mstsc は Windows 365への接続が出来ません。</p><p><img src="/blog/w365/2021-09-13_01/20210913_01_01.png"></p><h2 id="リモート-デスクトップ-クライアント-MSRDC-の-URL"><a href="#リモート-デスクトップ-クライアント-MSRDC-の-URL" class="headerlink" title="リモート デスクトップ クライアント (MSRDC) の URL"></a>リモート デスクトップ クライアント (MSRDC) の URL</h2><p>下記ページにて MSRDC をご紹介しております。<br><a href="https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/remote-desktop-clients">https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/remote-desktop-clients</a></p><h2 id="リモート-デスクトップ-クライアント-MSRDC-のダウンロード"><a href="#リモート-デスクトップ-クライアント-MSRDC-のダウンロード" class="headerlink" title="リモート デスクトップ クライアント (MSRDC) のダウンロード"></a>リモート デスクトップ クライアント (MSRDC) のダウンロード</h2><p>下記ページにてご利用のPCのアーキテクチャに合ったものをダウンロードください。</p><p><a href="https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/windowsdesktop#install-the-client">https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/windowsdesktop#install-the-client</a></p><h2 id="リモート-デスクトップ-クライアント-MSRDC-のインストール"><a href="#リモート-デスクトップ-クライアント-MSRDC-のインストール" class="headerlink" title="リモート デスクトップ クライアント (MSRDC) のインストール"></a>リモート デスクトップ クライアント (MSRDC) のインストール</h2><ol><li><p>ダウンロードしたMSIファイルを開くとインストール ウィザードが開きます。「次へ」をクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_02.png"></p></li><li><p>「マイクロソフト ソフトウェア ライセンス条項」をご確認の上、「使用許諾契約書に同意します」にチェックを入れ、「次へ」をクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_03.png"></p></li><li><p>ご利用のユーザーの範囲を選択して、「インストール」をクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_04.png"></p></li><li><p>インストール画面の表示後、インストールが完了します。「完了」ボタンをクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_05.png"></p></li></ol><h2 id="リモート-デスクトップ-クライアント-MSRDC-の接続設定"><a href="#リモート-デスクトップ-クライアント-MSRDC-の接続設定" class="headerlink" title="リモート デスクトップ クライアント (MSRDC) の接続設定"></a>リモート デスクトップ クライアント (MSRDC) の接続設定</h2><ol><li><p>MSRDC を初回起動すると、下記の画面が表示されます。「URLで登録」を選択します。<br><img src="/blog/w365/2021-09-13_01/20210913_01_06.png"></p></li><li><p>下記ページで案内されているWindows 365 のサブスクライブ ページ (<a href="https://rdweb.wvd.microsoft.com/api/arm/feeddiscovery">https://rdweb.wvd.microsoft.com/api/arm/feeddiscovery</a>) を登録し、「次へ」をクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_07.png"></p></li></ol><p><a href="https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/windowsdesktop#subscribe-with-url">https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/windowsdesktop#subscribe-with-url</a></p><p><img src="/blog/w365/2021-09-13_01/20210913_01_08.png"></p><ol start="3"><li><p>認証ページが表示されるので、Windows 365 ライセンスを割り当てたアカウントで認証を行います。<br><img src="/blog/w365/2021-09-13_01/20210913_01_09.png"></p></li><li><p>登録が完了すると、ライセンスに割り当てられている Windows 365 クラウドPCが表示されます。<br><img src="/blog/w365/2021-09-13_01/20210913_01_10.png"></p></li></ol><h2 id="リモート-デスクトップ-クライアント-MSRDC-への接続"><a href="#リモート-デスクトップ-クライアント-MSRDC-への接続" class="headerlink" title="リモート デスクトップ クライアント (MSRDC)への接続"></a>リモート デスクトップ クライアント (MSRDC)への接続</h2><ol><li><p>MSRDCを起動し、表示されているクラウド PCをダブルクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_10.png"></p></li><li><p>クラウド PCの接続アカウント情報の入力を求められます。<br><img src="/blog/w365/2021-09-13_01/20210913_01_11.png"></p></li><li><p>認証に成功するとクラウド PCへ接続できます。<br><img src="/blog/w365/2021-09-13_01/20210913_01_12.png"></p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は、Windows 365 に接続する際に、リモート デスクトップ クライアントをセットアップする手順についてご案内します。&lt;/p&gt;
&lt;h2 id=&quot;免責事項&quot;&gt;&lt;</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 Cloud PC を日本語化する手順</title>
    <link href="https://jpmem.github.io/blog/w365/2021-08-20_01/"/>
    <id>https://jpmem.github.io/blog/w365/2021-08-20_01/</id>
    <published>2021-08-19T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.229Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。  </p><p>本日は Windows 365 でプロビジョニングした Cloud PC を日本語化する手順をご紹介します。<br>Windows 365 Enterprise の場合は、カスタム イメージを登録できますので、日本語化したイメージをプロビジョニングすれば、最初から日本語化された Cloud PC を利用できることになりますが、Windows 365 Business の場合は、カスタム イメージを使用することができず、英語版の Windows が動作する Cloud PC を利用することになります。</p><p>日本語化するための方法に関するお問い合わせも多くいただいておりますので、ここでは Windows 365 Business で用意した Cloud PC を日本語化する手順の例をご紹介します。</p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2021/8/20 時点の内容についての記載となっております。今後内容が更新されることもございますので、その点ご承知置きくださいますようお願い致します。</p><h2 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h2><ol><li><p><a href="https://windows365.microsoft.com/">https://windows365.microsoft.com</a> にアクセスし、Cloud PC を利用可能なユーザーでサインインして Cloud PC にログインします。</p></li><li><p>スタート メニューより歯車のマークを選択し、[Settings] を立ち上げます。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820150826185.png"></p></li><li><p>[Time &amp; Language] を選択します。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820150846942.png"></p></li><li><p>[Date &amp; time] の [Time zone] を “(UTC +09:00) Osaka, Sapporo, Tokyo” に設定します。</p><p><img src="/blog/w365/2021-08-20_01/image-20210827151309134.png"></p></li><li><p>[Region] を選択し、[Region] を “Japan”、[Regional format] を “Japanese (Japan)” に設定します。</p><p><img src="/blog/w365/2021-08-20_01/image-20210827151509134.png"></p></li><li><p>[Language] - [Add a language] を選択します。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820150903020.png"></p></li><li><p>“Japanese” を追加し、[Next] をクリックします。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151025805.png"></p></li><li><p>下記のように選択し、[Install] をクリックします。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151042379.png"></p></li><li><p>言語パックのインストールが開始されます。インストールが完了すると、下記のように通知されるため、[Yes, sign out now.] を選択し、一旦サインアウトします。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151101169.png"></p></li><li><p>再度 Cloud PC にサインインし、管理者として実行にて起動した PowerShell コンソールで、以下のコマンドを実行し、システム ロケールを ja-JP に変更します。  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-WinSystemLocale</span> <span class="literal">-SystemLocale</span> ja<span class="literal">-JP</span></span><br></pre></td></tr></table></figure></li><li><p>スタート メニューより歯車のマークを選択し、[設定] を立ち上げ直します。</p></li></ol><p>   <img src="/blog/w365/2021-08-20_01/image-20210820151139511.png"></p><ol start="12"><li>[時刻と言語] を選択します。</li></ol><p>   <img src="/blog/w365/2021-08-20_01/image-20210820151159119.png"></p><ol start="13"><li><p>[言語] - [日本語] を選択して [オプション] をクリックします。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151218317.png"></p></li><li><p>ハードウェア キーボード レイアウトより [レイアウトを変更する] を選択して、日本語キーボードをご利用の場合は、設定を変更して [今すぐ再起動する] を選択し、再起動を行います。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151237059.png"></p></li><li><p>再起動後に接続することで、日本語入力が出来ないか、ご確認ください。なお、IME の準備が整ってない場合、IME の切り替え時に下記のような通知が行われますため、この場合、数分程度お待ちいただけますと幸いです。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151247994.png"></p></li><li><p>ブラウザから利用する場合には、PC に接続後、下記の設定も有効化してください。</p></li></ol><p>   <img src="/blog/w365/2021-08-20_01/image-20210820151309134.png">4</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;本日は Windows 365 でプロビジョニングした Cloud PC を日本語化する手順をご紹介します。&lt;br&gt;Windows 365 Enterpri</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 FAQ</title>
    <link href="https://jpmem.github.io/blog/w365/2021-08-16_01/"/>
    <id>https://jpmem.github.io/blog/w365/2021-08-16_01/</id>
    <published>2021-08-15T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.229Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は Windows 365 のご利用においてよくお問い合わせを受ける内容に対するご回答 (FAQ) をお伝えします。</p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2021/8/16 時点で判明している内容についての記載となっております。今後内容が更新されることもございますので、その点ご承知置きくださいますようお願い致します。</p><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="Business-amp-Enterprise-共通"><a href="#Business-amp-Enterprise-共通" class="headerlink" title="Business &amp; Enterprise 共通"></a>Business &amp; Enterprise 共通</h3><h4 id="Windows-365-を試してみたいが、使用方法がわからない"><a href="#Windows-365-を試してみたいが、使用方法がわからない" class="headerlink" title="Windows 365 を試してみたいが、使用方法がわからない"></a>Windows 365 を試してみたいが、使用方法がわからない</h4><p>Business と Enterprise で構築方法が異なります。下記にまとまっておりますのでご参照ください。  </p><ul><li><a href="https://zenn.dev/takuyaot/books/507584243171c2">いまはじ！ Windows 365 - Business 編 (Zenn.dev) </a>  </li><li><a href="https://zenn.dev/takuyaot/books/60c3ced87ba86f">いまはじ！ Windows 365 - Enterprise 編 (Zenn.dev) </a>  </li></ul><h4 id="Windows-365-で-Windows-11-にアップグレードしたが、うまく動かない"><a href="#Windows-365-で-Windows-11-にアップグレードしたが、うまく動かない" class="headerlink" title="Windows 365 で Windows 11 にアップグレードしたが、うまく動かない"></a>Windows 365 で Windows 11 にアップグレードしたが、うまく動かない</h4><p>Windows 11 は、10/5 より Windows 365 Enterprise のみサポートを開始しました。<br>Windows 365 Business は、今後サポート予定ですが、現時点ではサポートされておりませんので、何卒ご了承くださいますようお願いいたします。</p><p>Title: Windows 365 Enterprise now supports Windows 11<br>URL: <a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/windows-365-enterprise-now-supports-windows-11/ba-p/2810334">https://techcommunity.microsoft.com/t5/windows-it-pro-blog/windows-365-enterprise-now-supports-windows-11/ba-p/2810334</a></p><blockquote><p>Windows 365 Business<br>In the coming weeks, we will release full Windows 11 support for Windows 365 Business, our service for small and midsized businesses, along with a new admin and management experience that enables the selection of Windows 10 or 11.</p></blockquote><h4 id="Android-や-iPhone-で接続した時に、カメラやマイク等が使えない"><a href="#Android-や-iPhone-で接続した時に、カメラやマイク等が使えない" class="headerlink" title="Android や iPhone で接続した時に、カメラやマイク等が使えない"></a>Android や iPhone で接続した時に、カメラやマイク等が使えない</h4><p>コピー &amp; ペースト、USBの接続、カメラ、マイク、ペン、プリンター、スキャナー等のリダイレクション可否は接続元のクライアントによって異なります。<br>下記にまとまっておりますので、ご参照ください。</p><p>Title: クラウド PC の RDP デバイス リダイレクトを管理します<br>URL: <a href="https://docs.microsoft.com/ja-jp/windows-365/manage-rdp-device-redirections">https://docs.microsoft.com/ja-jp/windows-365/manage-rdp-device-redirections</a></p><h4 id="Office-アプリのサインイン時にエラーが発生する"><a href="#Office-アプリのサインイン時にエラーが発生する" class="headerlink" title="Office アプリのサインイン時にエラーが発生する"></a>Office アプリのサインイン時にエラーが発生する</h4><p>下記記事にまとめておりますので、ご参照ください。<br><a href="https://jpmem.github.io/blog/w365/2021-08-11_02/">https://jpmem.github.io/blog/w365/2021-08-11_02/</a></p><h4 id="Android-や-iPhone-での-Windows-365-の使用はサポートされているか"><a href="#Android-や-iPhone-での-Windows-365-の使用はサポートされているか" class="headerlink" title="Android や iPhone での Windows 365 の使用はサポートされているか"></a>Android や iPhone での Windows 365 の使用はサポートされているか</h4><p>Windows 365 サポート対象デバイスは、Android と iPhone も含まれます。Windows 365 のハードウェア要件は以下の公開情報にてご案内しておりますので、ご確認ください。</p><p>Title: End-user hardware requirements to access a Cloud PC<br>URL: <a href="https://docs.microsoft.com/en-us/windows-365/enterprise/end-user-hardware-requirements">https://docs.microsoft.com/en-us/windows-365/enterprise/end-user-hardware-requirements</a></p><p>但し、以下の公開情報にございますとおり、ブラウザでの接続はサポートされておりませんので、リモート デスクトップ アプリで Windows 365 に接続してください。</p><p>Title: ユーザーにクラウド PC の使用を開始す<br>URL: <a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#windows-365-home-page">https://docs.microsoft.com/ja-jp/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#windows-365-home-page</a></p><blockquote><p>ユーザーは、[ブラウザーで 開く] を選択 してクラウド PC を開きます。<br>注意<br>モバイル デバイスは、現在、ブラウザーを使用してクラウド PC を開く場合はサポートされていません。 リモート デスクトップ アプリがサポートされています。  </p></blockquote><h3 id="Business"><a href="#Business" class="headerlink" title="Business"></a>Business</h3><h4 id="Windows-365-の利用開始が「クラウドPCを設定します」のまま進まない"><a href="#Windows-365-の利用開始が「クラウドPCを設定します」のまま進まない" class="headerlink" title="Windows 365 の利用開始が「クラウドPCを設定します」のまま進まない"></a>Windows 365 の利用開始が「クラウドPCを設定します」のまま進まない</h4><p>下記記事にてまとめておりますので、ご参照ください。<br><a href="https://jpmem.github.io/blog/w365/2021-08-11_01/">https://jpmem.github.io/blog/w365/2021-08-11_01/</a></p><h4 id="アプリケーションがインストールできない"><a href="#アプリケーションがインストールできない" class="headerlink" title="アプリケーションがインストールできない"></a>アプリケーションがインストールできない</h4><p>恐れながら、現在のWindows 365 Business は英語版の Windows 10 が既定で動作しているために、日本語版のみをサポートするアプリケーションにおいて問題が生じている可能性がございます。大変恐縮でございますが、各アプリケーションの開発元等に、英語版の Windoows 10に対応しているか、また対応している場合はインストール時の注意点等がないか、ご確認くださいますようお願い致します。</p><h4 id="固定-IP-アドレスを割り当てたい"><a href="#固定-IP-アドレスを割り当てたい" class="headerlink" title="固定 IP アドレスを割り当てたい"></a>固定 IP アドレスを割り当てたい</h4><p>誠に恐縮ながら、現在固定 IP アドレスの割り当てをサポートしておりません。</p><h4 id="Azure-の-VPN-機能-を利用したい"><a href="#Azure-の-VPN-機能-を利用したい" class="headerlink" title="Azure の VPN 機能 を利用したい"></a>Azure の VPN 機能 を利用したい</h4><p>大変申し訳ないのですが、Windows 365 Business では Express Route や Site to Site VPN はご利用できません。<br>Windows 365 Entertprise のご利用をご検討くださいませ。</p><h4 id="クラウド-PC-が動作するデータセンターの所在地-リージョン-の選択、変更は可能か"><a href="#クラウド-PC-が動作するデータセンターの所在地-リージョン-の選択、変更は可能か" class="headerlink" title="クラウド PC が動作するデータセンターの所在地 (リージョン) の選択、変更は可能か"></a>クラウド PC が動作するデータセンターの所在地 (リージョン) の選択、変更は可能か</h4><p>Windows 365 Businessでは展開時にご利用の地域からなるべく近いリージョンを選定する動作となりますが、その時点での各リージョンのリソースの負荷状況を考慮した上で自動的に判断されるため、お客様により明示的にリージョンを選択したり変更することはできません。</p><h3 id="Enterprise"><a href="#Enterprise" class="headerlink" title="Enterprise"></a>Enterprise</h3><h4 id="ユーザーのライセンスを割り当てても利用開始にならない。"><a href="#ユーザーのライセンスを割り当てても利用開始にならない。" class="headerlink" title="ユーザーのライセンスを割り当てても利用開始にならない。"></a>ユーザーのライセンスを割り当てても利用開始にならない。</h4><p>下記記事にも記載がございますが、Enterprise の場合、オンプレミスAD ドメイン コントローラー連携した Hybrid Azure AD Join 環境の構築が必要となります。</p><p><a href="https://jpmem.github.io/blog/w365/2021-08-04_01/">https://jpmem.github.io/blog/w365/2021-08-04_01/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は Windows 365 のご利用においてよくお問い合わせを受ける内容に対するご回答 (FAQ) をお伝えします。&lt;/p&gt;
&lt;h2 id=&quot;免責事項&quot;&gt;&lt;a hr</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 Business のプロビジョニングが長時間経過しても終了しない場合について</title>
    <link href="https://jpmem.github.io/blog/w365/2021-08-11_01/"/>
    <id>https://jpmem.github.io/blog/w365/2021-08-11_01/</id>
    <published>2021-08-10T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.225Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は多くの皆様からお問い合わせを頂いております、Windows 365 Business のプロビジョニングが長時間経過しても終了しない場合に、ご確認いただきたい内容についてお伝え致します。</p><p>また、本内容と同内容が、下記 Microsoft Docs でも公開されております。併せてご確認くださいませ。</p><p><a href="https://docs.microsoft.com/en-us/microsoft-365/admin/setup/troubleshoot-windows-365-business?view=o365-worldwide">https://docs.microsoft.com/en-us/microsoft-365/admin/setup/troubleshoot-windows-365-business?view=o365-worldwide</a></p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2021/8/25 時点で判明している内容についての記載となっております。今後内容が更新されることもございますので、その点ご承知置きくださいますよう<br>お願い致します。</p><h2 id="対象読者"><a href="#対象読者" class="headerlink" title="対象読者"></a>対象読者</h2><p>Windows 365 Business のプロビジョニングが長時間経過しても終了しないお客様。<br>(Windows 365 Enterprise とは異なりますのでご注意ください)</p><h2 id="プロビジョニングが完了しない場合のチェック事項"><a href="#プロビジョニングが完了しない場合のチェック事項" class="headerlink" title="プロビジョニングが完了しない場合のチェック事項"></a>プロビジョニングが完了しない場合のチェック事項</h2><p>以下の点についてご確認くださいませ。</p><ol><li>Azure AD デバイス登録設定の確認</li><li>“Windows 365 BPRT Permanent User” ユーザー (旧名:”CloudPCBPRT”) ユーザーの確認</li><li>Azure AD デバイス登録時の多要素認証が無効化されているか確認</li><li>Azure AD の デバイス 登録設定の確認</li><li>多要素認証がセットアップをブロックしていないかの確認</li><li> Intune の自動登録設定</li></ol><h3 id="Azure-AD-デバイス登録設定の確認"><a href="#Azure-AD-デバイス登録設定の確認" class="headerlink" title="Azure AD デバイス登録設定の確認"></a>Azure AD デバイス登録設定の確認</h3><p>Azure AD デバイスに登録可能な設定かどうかご確認ください。</p><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[デバイス] を選択する。</li><li>[デバイスの設定] を選択する。</li><li>[ユーザーはデバイスを Azure AD に参加させることができます] が 「すべて」 に設定されていることを確認する。</li></ol><h3 id="“Windows-365-BPRT-Permanent-User”-ユーザー-旧名-“CloudPCBPRT”-の確認"><a href="#“Windows-365-BPRT-Permanent-User”-ユーザー-旧名-“CloudPCBPRT”-の確認" class="headerlink" title="“Windows 365 BPRT Permanent User” ユーザー(旧名: “CloudPCBPRT”)の確認"></a>“Windows 365 BPRT Permanent User” ユーザー(旧名: “CloudPCBPRT”)の確認</h3><p>初めてお客様が Azure AD テナントに Windows 365 ライセンスを割り当てた際、ご利用の Azure AD テナントに “Windows 365 BPRT Permanent User” (旧名:”CloudPCBPRT”) という名前のユーザー ID が自動生成されます。<br>本 ID は Windows 365 Business の クラウド PC のプロビジョニングに必要な ID ですので、絶対に削除しないでください。</p><p>上記につきましては、下記URLにも注意事項として記載がございます。<br><a href="https://docs.microsoft.com/en-us/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#assign-licenses-to-users">https://docs.microsoft.com/en-us/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#assign-licenses-to-users</a></p><p>※旧名: “CloudPCBPRT”ユーザーは2021/8/25より順次”Windows 365 BPRT Permanent User”に自動変更されておりますのでご承知置きください。</p><p>完全削除されていない場合は、下記にご案内します手順で復旧できますが、完全削除してしまった場合はお手数をおかけして恐縮でございますが、サポート チケットをご依頼くださいますようお願い致します。</p><p>こちらの ID の存在は下記からご確認可能です。</p><h4 id="“Windows-365-BPRT-Permanent-User”-の表示"><a href="#“Windows-365-BPRT-Permanent-User”-の表示" class="headerlink" title="“Windows 365 BPRT Permanent User” の表示"></a>“Windows 365 BPRT Permanent User” の表示</h4><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[ユーザー] を選択する。</li><li>[すべてのユーザー (プレビュー)] が選択されていることを確認する。</li><li>[ユーザーの検索] に “Windows 365 BPRT Permanent User” を入力し、ユーザーが表示されることを確認する。</li></ol><p><img src="/blog/w365/2021-08-11_01/20210811_01_01.png"></p><h4 id="“Windows-365-BPRT-Permanent-User”-旧名-Cloud-PCBPRT-を完全削除していない場合の復帰"><a href="#“Windows-365-BPRT-Permanent-User”-旧名-Cloud-PCBPRT-を完全削除していない場合の復帰" class="headerlink" title="“Windows 365 BPRT Permanent User” (旧名: Cloud PCBPRT) を完全削除していない場合の復帰"></a>“Windows 365 BPRT Permanent User” (旧名: Cloud PCBPRT) を完全削除していない場合の復帰</h4><ol><li>Azure ポータルにアクセスする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[ユーザー] - [削除されたユーザー(プレビュー)] を選択。</li><li>[Windows 365 BPRT Permanent User] を選択後,「ユーザーの復元」を選択し、「OK」をクリック。</li></ol><h3 id="Azure-AD-の-デバイス-登録設定の確認"><a href="#Azure-AD-の-デバイス-登録設定の確認" class="headerlink" title="Azure AD の デバイス 登録設定の確認"></a>Azure AD の デバイス 登録設定の確認</h3><p>デバイスを Azure AD に参加させる際の登録設定が下記の通りとなっていることを確認ください。</p><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[デバイス] を選択する。</li><li>[デバイスの設定] を選択する。</li><li>[Azure AD を使用してデバイスを登録または参加させるには Multi-Factor Authentication が必要です] が「いいえ」 に設定されていることを確認する。</li></ol><p><img src="/blog/w365/2021-08-11_01/20210811_01_02.png"></p><h3 id="Azure-AD-デバイス登録時の多要素認証が無効化されているか確認"><a href="#Azure-AD-デバイス登録時の多要素認証が無効化されているか確認" class="headerlink" title="Azure AD デバイス登録時の多要素認証が無効化されているか確認"></a>Azure AD デバイス登録時の多要素認証が無効化されているか確認</h3><p>デバイスを Azure AD に参加させる際のMulti-Factor Authentication 認証 (多要素認証) につきましては下記手順で無効化されていることをご確認くださいますようお願い致します。</p><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[デバイス] を選択する。</li><li>[デバイスの設定] を選択する。</li><li>[Azure AD を使用してデバイスを登録または参加させるには Multi-Factor Authentication が必要です] が「いいえ」 に設定されていることを確認する。</li></ol><p><img src="../2021-08-11_01/20210811_01_02.png"></p><h3 id="多要素認証がセットアップをブロックしていないかの確認"><a href="#多要素認証がセットアップをブロックしていないかの確認" class="headerlink" title="多要素認証がセットアップをブロックしていないかの確認"></a>多要素認証がセットアップをブロックしていないかの確認</h3><p>Azure AD Premium P1 以上で、条件付きアクセスを設定されているお客様について、テナント内で初めて Windows 365 のホームページ (<a href="https://windows365.microsoft.com/">https://windows365.microsoft.com</a>) にアクセスするユーザーをお選びください。該当のユーザーにつきまして、下記手順にて多要素認証が無効化されていることをご確認ください。</p><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>サービスの検索欄に「条件付きアクセス」を入力し、検索された結果をクリックする。</li><li>ポリシー一覧に何も表示されなければ、「Intuneの自動登録設定」の確認に進む。</li><li>設定されているポリシーそれぞれをクリックし、「アクセス制御」「許可」の欄が「0個のコントロールが選択されました」となっていれば、次のポリシーを選択する。</li><li>「N個のコントロールが選択されました」となっている場合、リンクをクリックし、もし「多要素認証を要求する」が有効化されていた場合、無効化し、保存する。</li><li>全てのポリシーにおいて「多要素認証を要求する」を無効化し、「Intuneの自動登録設定」の確認に進む。</li></ol><p><img src="../2021-08-11_01/20210811_01_05.png"></p><h3 id="Intune-の自動登録設定"><a href="#Intune-の自動登録設定" class="headerlink" title="Intune の自動登録設定"></a>Intune の自動登録設定</h3><p>Intune をご利用されている場合、自動登録が有効になっている場合がございます。自動登録が有効になっている場合、”CloudPCBPPRT” ユーザーに Intune のライセンスを付与する必要がございます。Intune をご利用されていない場合、自動登録が無効化されていることをご確認ください。</p><h4 id="Intune-の自動登録が有効になっている場合の確認"><a href="#Intune-の自動登録が有効になっている場合の確認" class="headerlink" title="Intune の自動登録が有効になっている場合の確認"></a>Intune の自動登録が有効になっている場合の確認</h4><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[モビリティ MDM および MAM] を選択する。</li><li>[Microsoft Intune] を選択する。</li><li>[MDM ユーザー スコープ]が「すべて」となっていることを確認する。</li></ol><p><img src="/blog/w365/2021-08-11_01/20210811_01_03.png"></p><ol start="6"><li>Azure ポータル画面に戻る。</li><li>[Azure Active Directory] を選択する。</li><li>[ユーザー] を選択する。</li><li>[すべてのユーザー (プレビュー)] が選択されていることを確認する。</li><li>[ユーザーの検索] に “CloudPCBPRT” を入力し、ユーザーが表示されることを確認する。</li><li>“CloudPCBPRT” ユーザーを選択する。</li><li>[ライセンス] を選択し、Intune を含むライセンスが割当たっていることを確認する。</li><li>割当たっていない場合、[割り当て] を選択し、Intune を含むライセンスを割り当てる。</li></ol><h4 id="Intune-の自動登録が無効になっている場合の確認"><a href="#Intune-の自動登録が無効になっている場合の確認" class="headerlink" title="Intune の自動登録が無効になっている場合の確認"></a>Intune の自動登録が無効になっている場合の確認</h4><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[モビリティ MDM および MAM] を選択する。</li><li>[Microsoft Intune] を選択する。</li><li>[MDM ユーザー スコープ]が「なし」となっていることを確認する。</li></ol><p><img src="/blog/w365/2021-08-11_01/20210811_01_04.png"></p><h2 id="上記実施後の再プロビジョニング手順について"><a href="#上記実施後の再プロビジョニング手順について" class="headerlink" title="上記実施後の再プロビジョニング手順について"></a>上記実施後の再プロビジョニング手順について</h2><p>Windows 365 Business は新しいユーザーを作成して、ライセンスの再割り当てを実施することでプロビジョニングのリトライが実施されます。上記実施後や、上記設定に問題が無いがプロビジョニングが完了しない場合は下記手順をお試しください。</p><ol><li>Microsoft 365 管理センター (<a href="https://admin.microsoft.com/">https://admin.microsoft.com/</a>) にアクセスする。アカウントが要求された場合は管理者アカウントのIDとパスワードでログインする。</li><li>画面左ペインより [課金情報] - [ライセンス] を選択し、ご利用の Windows 365 for Business サブスクリプションを選択する。</li><li>現在ライセンス割り当てを行っているユーザーを選択し、「ライセンスの割り当て解除」を行う。</li><li>しばらく時間をおく。(30分程度推奨)</li><li>画面左ペインより [ユーザー] - [アクティブなユーザー] を選択し [ユーザーの追加]をクリックする。</li><li>ウィザードに従ってユーザーの追加を完了する。</li><li>画面左ペインより [課金情報] - [ライセンス] を選択し、ご利用の Windows 365 for Business サブスクリプションを選択する。</li><li>上記画面で「ライセンス割り当て」をクリックし、新規に作成したユーザーを設定する。</li><li><a href="https://windows365.microsoft.com/">https://windows365.microsoft.com/</a> にアクセスし、プロビジョニング完了を待機する。通常は1-2時間程度でプロビジョニングが完了する。</li></ol><h2 id="上記実施後もプロビジョニングが成功しない場合について"><a href="#上記実施後もプロビジョニングが成功しない場合について" class="headerlink" title="上記実施後もプロビジョニングが成功しない場合について"></a>上記実施後もプロビジョニングが成功しない場合について</h2><p>上記実施いただいてもプロビジョニングが完了しない場合、お手数をおかけして恐縮でございますが、サポートリクエストの発行をお願い致します。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は多くの皆様からお問い合わせを頂いております、Windows 365 Business のプロビジョニングが長時間経過しても終了しない場合に、ご確認いただきたい内容</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 で Microsoft 365 Apps のユーザー ログイン に失敗する</title>
    <link href="https://jpmem.github.io/blog/w365/2021-08-11_02/"/>
    <id>https://jpmem.github.io/blog/w365/2021-08-11_02/</id>
    <published>2021-08-10T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.229Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は多くの皆様からお問い合わせを頂いております、Windows 365 で Microsoft 365 Apps にログインしようとした時に<br>エラーが発生する場合の対処についてお伝え致します。</p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2021/8/11 時点で判明している内容についての記載となっております。今後内容が更新されることもございますので、その点ご承知置きくださいますよう<br>お願い致します。</p><h2 id="対象"><a href="#対象" class="headerlink" title="対象"></a>対象</h2><p>下記の Microsoft 365 ライセンスをお使いのお客様。</p><ul><li>Microsoft 365 Personal</li><li>Microsoft 365 Business Standard</li></ul><h2 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h2><p>Windows 365 ライセンスで作成したクラウド PC で、Microsoft 365 Apps にログインしようとした時に下記画面のように<br>“Account Issue: The products we found in your account cannot be used to activate Office in shared computer scenarios.” とエラー表示される</p><p><img src="/blog/w365/2021-08-11_02/20210811_02_01.png"></p><h2 id="解決策"><a href="#解決策" class="headerlink" title="解決策"></a>解決策</h2><p>お手数をおかけして大変恐縮でございますが、<br>クラウド PC にインストールされている Microsoft 365 Apps をアンインストールし、<a href="https://www.office.com/">office.com</a> から Microsoft 365 Apps のバイナリをダウンロード、インストールくださいますよう<br>お願い致します。</p><h2 id="エラー原因"><a href="#エラー原因" class="headerlink" title="エラー原因"></a>エラー原因</h2><p>クラウド PC にインストールされている Microsoft 365 Apps の前提ライセンスとお客様が利用されているライセンスが異なるために本件発生致します。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>本件、下記公開情報にも記載がございますのでご確認くださいませ。</p><p><a href="https://docs.microsoft.com/en-us/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#installing-apps">https://docs.microsoft.com/en-us/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#installing-apps</a></p><h2 id="補足情報"><a href="#補足情報" class="headerlink" title="補足情報"></a>補足情報</h2><p>Windows 365 のライセンスに Microsoft 365 のライセンスは含まれておりません。<br>同様に Microsoft 365 のライセンスに Windows 365 のライセンスも含まれておりません。それぞれ別途購入が必要となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は多くの皆様からお問い合わせを頂いております、Windows 365 で Microsoft 365 Apps にログインしようとした時に&lt;br&gt;エラーが発生する場</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 Enterprise をご利用の際の注意点</title>
    <link href="https://jpmem.github.io/blog/w365/2021-08-04_01/"/>
    <id>https://jpmem.github.io/blog/w365/2021-08-04_01/</id>
    <published>2021-08-03T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.225Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は、米国時間 8 月 2 日より一般提供を開始いたしました「Windows 365」の Enterprise をご利用いただく上での注意点をご紹介いたします。</p><h2 id="プランの違い"><a href="#プランの違い" class="headerlink" title="プランの違い"></a>プランの違い</h2><p>Windows 365 には、現在 Business と Enterprise という 2 つのプランがございます。<br>各プランの違いにつきましては、次の公開情報をご確認ください。</p><p><a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/get-started-with-windows-365-business/ba-p/2595485">Get started with Windows 365 Business - Microsoft Tech Community</a></p><table><thead><tr><th></th><th>Windows 365 Business</th><th>Windows 365 Enterprise</th></tr></thead><tbody><tr><td>製品ページから直接クリックしてプロビジョニング</td><td>X</td><td></td></tr><tr><td>「ドメインなし」の設定</td><td>X</td><td></td></tr><tr><td>セルフサービス トラブル シューティング – リセット</td><td>X</td><td></td></tr><tr><td>「クラウド保存」（最小限のAzureストレージと場合によってはOneDrive for Business）</td><td>X</td><td>X</td></tr><tr><td>セルフサービス アップグレード</td><td></td><td>X</td></tr><tr><td>ユニバーサル プリントの統合</td><td></td><td>X</td></tr><tr><td>パートナー/プログラムによる有効化（Graph API、MSPツール）</td><td></td><td>X</td></tr><tr><td>カスタム イメージの使用</td><td></td><td>X</td></tr><tr><td>イメージの管理 (保存、複製、展開)</td><td></td><td>X</td></tr><tr><td>Microsoft Endpoint Manager のポリシー展開によるプロビジョニング、管理、およびガイド付きシナリオ</td><td></td><td>X</td></tr><tr><td>エンドポイント分析のレポートと監視</td><td></td><td>X</td></tr><tr><td>サービス ヘルス、運用ヘルス アラート</td><td></td><td>X</td></tr><tr><td>オンプレミス (ネットワーク、アプリ、リソース) への接続 + 診断</td><td></td><td>X</td></tr><tr><td>Microsoft Endpoint Manager ベースの高度なトラブルシューティングとデバイス管理</td><td></td><td>X</td></tr></tbody></table><h2 id="構築時の注意点"><a href="#構築時の注意点" class="headerlink" title="構築時の注意点"></a>構築時の注意点</h2><p>上述のとおり、Windows 365 Business と Enterprise では使用できる機能が異なりますが、大きな違いとしては Windows 365 Enterprise をご利用いただく場合、<strong>オンプレミス Active Directory と Azure Active Directory を同期したハイブリッド Azure AD 参加可能な環境が必要</strong>となりますので、ご注意ください。</p><p>そのため、Windows 365 Enterprise の場合は、Business の場合と異なり、ライセンスを割り当てただけではご利用いただけませんので、何卒ご留意くださいますようお願い申し上げます。</p><p>なお、Windows 365 Enterprise を評価される場合は、以下のドキュメントに評価環境の構築手順のガイドが紹介されておりますので、ご参考賜れますと幸いです。</p><p><a href="https://zenn.dev/takuyaot/books/60c3ced87ba86f">いますぐ始める！ Windows 365 (zenn.dev)</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は、米国時間 8 月 2 日より一般提供を開始いたしました「Windows 365」の Enterprise をご利用いただく上での注意点をご紹介いたします。&lt;/p</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>System Center 2012 / R2 Configuration Manager のサポートが残り 1 年を切りました</title>
    <link href="https://jpmem.github.io/blog/mecm/20210802_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20210802_01/</id>
    <published>2021-08-01T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.213Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>長年ご愛顧いただいております System Center 2012 Configuration Manager 関連の下記製品の EoS (End of Support) が 2022 年 7 月 12 日までとなっております。</p><ul><li><a href="https://docs.microsoft.com/en-us/lifecycle/products/microsoft-system-center-2012-configuration-manager">System Center 2012 Configuration Manager</a></li><li><a href="https://docs.microsoft.com/en-us/lifecycle/products/microsoft-system-center-2012-r2-configuration-manager">System Center 2012 R2 Configuration Manaer</a></li><li><a href="https://docs.microsoft.com/en-us/lifecycle/products/microsoft-system-center-2012-endpoint-protection">System Center 2012 Endpoint Protection</a></li><li><a href="https://docs.microsoft.com/en-us/lifecycle/products/microsoft-system-center-2012-r2-endpoint-protection">System Center 2012 R2 Endpoint Protection</a></li></ul><p>EoS を迎えた製品につきましては、以下の提供が行われなくなります。</p><ul><li>EoS 後発生しうる問題へのテクニカルサポート</li><li>セキュリティ更新や修正</li><li>EoS 後の SCEP に対する定義ファイル、エンジンやプラットフォームの更新</li></ul><p>大変恐縮でございますが、ご利用のお客様におかれましては、 Microsoft Endpoint Configuration Manager (MECM) Current Branch 等への移行計画の策定、ご対応くださいますようお願い致します。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;長年ご愛顧いただいております System Center 2012 Configuration Manager 関連の下記製品の EoS (End of Support)</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Endpoint Configuration Manager 環境の HTTP のみの通信が非推奨となります</title>
    <link href="https://jpmem.github.io/blog/mecm/20210414_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20210414_01/</id>
    <published>2021-04-13T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.213Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>Microsoft Endpoint Configuration Manager (以下 MECM) 環境において、今後クライアントと Configuration Manager 間の HTTP のみの通信が非推奨となります。<br>そのため、通信を HTTPS または拡張 HTTP を有効にすることで、より安全な通信方法をサイトで有効にして頂く必要がございます。</p><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/deprecated/removed-and-deprecated-cmfeatures">Configuration Manager から削除された機能と非推奨の機能</a></p><p>MECM の バージョン 2103 以降については MECM のアップグレードを行って頂く際の前提条件のチェック時においても、”警告” として、HTTP が非推奨になる旨のメッセージが表示されるようになりましたため、対処の手段である HTTPS とする方法や拡張 HTTP を有効にするための情報をご案内します。</p><p><img src="/blog/mecm/20210414_01/1.png"></p><h2 id="サイトで-HTTPS-を有効にする方法について"><a href="#サイトで-HTTPS-を有効にする方法について" class="headerlink" title="サイトで HTTPS を有効にする方法について"></a>サイトで HTTPS を有効にする方法について</h2><p>通信を PKI の証明書を利用して、 HTTPS とする場合には以下の 3 つの設定変更が必要です。</p><ul><li><p>クライアントと通信を行うための役割である管理ポイント、配布ポイント、ソフトウェア更新ポイントをサイトシステムのプロパティ上で HTTPS を受け入れる設定に変更を行う。</p></li><li><p>IIS で HTTPS 通信を受け入れるように Web サーバー証明書を準備し、対象の IIS のサイトにバインドする。</p></li></ul><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/network/example-deployment-of-pki-certificates#deploy-the-web-server-certificate-for-site-systems-that-run-iis">IIS を実行するサイト システム用の Web サーバー証明書の展開</a></p><ul><li>MECM クライアント にクライアント認証用途のコンピューター証明書を配布する。</li></ul><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/network/example-deployment-of-pki-certificates#deploy-the-client-certificate-for-windows-computers">Windows コンピューター用のクライアント証明書の展開</a></p><h2 id="サイトで-拡張-HTTP-を有効にする方法について"><a href="#サイトで-拡張-HTTP-を有効にする方法について" class="headerlink" title="サイトで 拡張 HTTP を有効にする方法について"></a>サイトで 拡張 HTTP を有効にする方法について</h2><p>PKI 証明書を発行できる環境がない、または 管理が大変などの事情があるお客様向けに Configuration Manager の機能で通信を保護する機能が拡張 HTTP となります。</p><p>拡張 HTTP の主な目的は以下の通りです。</p><ul><li>PKI サーバー認証証明書を必要とせずに機密性のクライアント通信を保護できる。</li><li>クライアントは、ネットワーク アクセス アカウント、クライアント PKI 証明書、Windows 認証を必要とせずに、配布ポイントからコンテンツに安全にアクセスできる。</li></ul><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/hierarchy/enhanced-http">拡張 HTTP</a></p><p>また、拡張 HTTP 環境の構成手順についてはサイトのプロパティより、 [HTTP サイト システムには Configuration Manager によって生成された証明書を使用する] オプションを有効にするだけになります。</p><p><img src="/blog/mecm/20210414_01/2.png"></p><p>お客様の環境によって、上記手段のご検討を頂けますようお願い申し上げます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;Microsoft Endpoint Configuration Manager (以下 MECM) 環境において、今後クライアントと Configuration Man</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>WSUS メンテナンス ガイド</title>
    <link href="https://jpmem.github.io/blog/wsus/2020-07-21_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2020-07-21_01/</id>
    <published>2020-07-20T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.261Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。<br>本日は WSUS サーバーのメンテナンス方法について、纏めてご紹介をいたします。</p><p>WSUS は月々リリースされる更新プログラムを配信出来るよう、更新プログラムの情報をサーバー上に溜め込む必要があります。しかし、この製品の性質上、日々メンテナンスを実施しないと、データベースや情報が肥大化し、様々な障害や弊害が発生しやすくなってしまいます。<br>弊サポート部門へいただく様々なお問い合わせも、最終的にはこのいずれかの対処に行き着くことが、ほとんどですので是非 WSUS をこれから導入・構築される方々、また既に運用されている方々は、ご一読ください！</p><h2 id="WSUS-の各種メンテナンス"><a href="#WSUS-の各種メンテナンス" class="headerlink" title="WSUS の各種メンテナンス"></a>WSUS の各種メンテナンス</h2><p>一般的な WSUS のメンテナンスとして、下記の 3 種類のメンテナンスは更新プログラムのリリースと合わせて、月 1 回程度実行していただくことをオススメしております。各メンテナンスについては、既に以下のブログで、それぞれ紹介していますので、WSUS をご利用いただいている方で、まだ読んだことがない方は一度内容をご覧ください。</p><ol><li><a href="https://jpmem.github.io/blog/wsus/2014-03-05_01/">WSUS DB インデックスの再構成の手順について</a></li><li><a href="https://jpmem.github.io/blog/wsus/2017-12-05_01/">WSUS のクリーンアップ ウィザードについて</a></li><li><a href="https://jpmem.github.io/blog/wsus/2017-12-11_01/">不要な更新プログラムは「拒否済み」に設定しよう！</a></li></ol><p>また、これらのメンテナンスはいずれもコマンド ライン等から実行出来るため、タスク スケジューラと組み合わせて自動化することが可能です。今回は自動化の手順とそれに伴う注意事項も紹介しますので、運用の中に取り入れる上で参考としていただけると幸いです。</p><h2 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項"></a>注意事項</h2><p>以下にメンテナンスを実施いただく上での注意事項をご案内します。メンテナンスの自動化を行う前に、必ずご一読ください。</p><ul><li>初めてメンテナンスを実施する場合には、各メンテナンスが正常に動作することを一度必ずご確認ください。特に何年も運用しているような環境で、<strong>初めてメンテナンスを実施する場合には、処理が長時間 (数十時間 ～) に及ぶ可能性もあるので、ご留意ください。</strong> </li><li>各メンテナンスと WSUS の同期は、なるべく同じ時刻に実行されないようにしてください。いずれのメンテナンスも WSUS の負荷が高くなる可能性があるため、各メンテナンスを同時に実行したり、<strong>メンテナンスと同期を同時に実行すると失敗することがあります。</strong></li><li>「3」のブログで紹介している置き換えが行われた更新プログラムを「拒否済み」に設定するスクリプトを利用して貰えると、新しい更新プログラムにて置き換えられている古い更新プログラムのみを、簡単に「拒否済み」に設定することが可能です。今回ご案内の手順でも、このスクリプトを利用します。<strong>ただし、最新の更新プログラムを常に配信するような運用をしていない場合 (リリース後 1 ヶ月遅れで配信したり、特定の更新を除外して配信しているような場合) には、配信対処の更新プログラムが「拒否済み」に設定されてしまうこともあるため、ご注意ください。</strong></li><li>レプリカ構成の WSUS を利用している場合には、「2」のクリーンアップ ウィザードは上位のサーバーから実行する必要があるため、上位のサーバーから順番にメンテナンスが実行されるよう、スケジュールをしてください。 </li><li>階層構成の WSUS の場合でも「1」「2」のメンテナンスについては、上位下位双方の WSUS にて実施してください。なお。レプリカ構成の WSUS の場合には、「3」の「拒否済み」の設定については、上位の WSUS サーバーだけで実施すれば問題ありません。</li></ul><h2 id="メンテナンスの自動化"><a href="#メンテナンスの自動化" class="headerlink" title="メンテナンスの自動化"></a>メンテナンスの自動化</h2><p>それでは各メンテナンスを自動化する方法について、それぞれ紹介していきます。</p><h3 id="SUSDB-のインデックス再構築をタスク-スケジューラから自動実行させる"><a href="#SUSDB-のインデックス再構築をタスク-スケジューラから自動実行させる" class="headerlink" title="SUSDB のインデックス再構築をタスク スケジューラから自動実行させる"></a>SUSDB のインデックス再構築をタスク スケジューラから自動実行させる</h3><ol><li><p><a href="https://github.com/microsoft-jpcssmem/WSUS/releases/latest/download/WsusDBMaintenance.sql">こちら</a>より、インデックスの SUSDB のインデックス再構築を行うスクリプトを入手し、WSUS サーバー上に保存します。(WsusDBMaintenance.sql 等)</p></li><li><p>スタート メニューより、タスク スケジューラを立ち上げます。</p></li><li><p>[基本タスクの作成] を選択し、任意の名前を付けます。</p><p><img src="/blog/wsus/2020-07-21_01/image-20210731021225318.png"></p></li><li><p>インデックスの再構築を実施するスケジュールを指定します。以下の例では、毎月第一日曜日の AM 2:00 に実行するよう指定しています。</p><p><img src="/blog/wsus/2020-07-21_01/image-20210731021243281.png"></p></li><li><p>[プログラムの開始] を選択して、以下のような指定を行ないます。以下の指定では -i オプションで手順 1 で保存したスクリプトのパスを指定し、-o にてスクリプトの実行ログの出力パスを指定しています。</p></li></ol><p>Windows Server 2012 以降の WSUS で WID を利用している場合の指定例<br><code>&quot;C:\Program Files\Microsoft SQL Server\110\Tools\Binn\SQLCMD.exe&quot; -S \\.\pipe\Microsoft##WID\tsql\query -i C:\WSUS\WsusDBMaintenance.sql -o c:\WSUS\reindexout.txt</code><br>※ SQL Server を利用している場合には -S にて SQL Server のインスタンス名を指定します。<br><img src="/blog/wsus/2020-07-21_01/image-20210731021305833.png"></p><ol start="6"><li><p>以下のような警告が出力されますが [はい] を選択して、そのままタスクの作成を完了させます。</p><p><img src="/blog/wsus/2020-07-21_01/image-20210731021324032.png"></p></li><li><p>作成したタスクを右クリックして [プロパティ] を選択し、以下の 2 つの設定を行って [OK] をクリックします。</p><p><img src="/blog/wsus/2020-07-21_01/image-20210731021339489.png"></p></li><li><p>試しに作成したタスクを右クリックして [実行する] を選択して実行してみましょう。ログを確認してエラー等が出力されておらず、最後の方に <strong>“Statistics for all tables have been updated”</strong> または <strong>“全テーブルの統計が更新されました”</strong> が出力されていれば、問題なくタスクの登録が出来ています。</p></li></ol><h3 id="クリーンアップ-ウィザードをタスク-スケジューラから自動実行させる"><a href="#クリーンアップ-ウィザードをタスク-スケジューラから自動実行させる" class="headerlink" title="クリーンアップ ウィザードをタスク スケジューラから自動実行させる"></a>クリーンアップ ウィザードをタスク スケジューラから自動実行させる</h3><ol><li>インデックスの再構築の自動化の手順と同様にタスク スケジューラを起動し、基本タスクの作成を行ない、クリーンアップ ウィザードを実行するスケジュールを指定 (上述の手順 2 ~ 4) します。<br>※ インデックスの再構築とはスケジュールが被らないよう、インデックス再構築の実行開始の数時間後や別の日等を指定します。</li><li>[プログラムの開始] を選択して、実行したいクリーンアップの項目に合わせて、以下のような指定を行ないます。</li></ol><p>Windows Server 2012 以降の WSUS で WID を利用しており、全ての項目を実行する場合の指定例<br><code>Powershell -Command &quot;Invoke-WsusServerCleanup -CompressUpdates -CleanupObsoleteUpdates -CleanupObsoleteComputers -CleanupUnneededContentFiles -DeclineExpiredUpdates -DeclineSupersededUpdates&quot; &gt; C:\WSUS\wsusClean.txt</code><br>※ オプションとクリーンアップの各項目の対応については、<a href="https://jpmem.github.io/blog/wsus/2017-12-05_01/#%E5%8F%82%E8%80%83%E6%83%85%E5%A0%B1-%E5%AE%9A%E6%9C%9F%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%AE%E6%96%B9%E6%B3%95">こちらのブログの参考情報</a>を参照してください、</p><ol><li>インデックスの再構築の自動化の手順と同様にタスクの作成を完了 (上述の手順 6 ～ 7) させます。</li><li>試しに作成したタスクを右クリックして [実行する] を選択して実行してみましょう。出力ファイルに以下のようにエラー等が出力されていなければ、正常に登録されています。<br>出来ています。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">削除された古い更新プログラム:0</span><br><span class="line">拒否された期限切れの更新プログラム: 0</span><br><span class="line">削除された古い更新プログラム:87</span><br><span class="line">圧縮された更新プログラム:0</span><br><span class="line">削除された古いコンピューター:0</span><br><span class="line">解放されたディスク領域:0</span><br></pre></td></tr></table></figure><h3 id="不要な更新プログラムの「拒否済み」設定をタスク-スケジューラから自動実行させる"><a href="#不要な更新プログラムの「拒否済み」設定をタスク-スケジューラから自動実行させる" class="headerlink" title="不要な更新プログラムの「拒否済み」設定をタスク スケジューラから自動実行させる"></a>不要な更新プログラムの「拒否済み」設定をタスク スケジューラから自動実行させる</h3></li><li><a href="https://github.com/microsoft-jpcssmem/WSUS/releases/latest/download/Decline-SupersededUpdates.ps1">こちら</a> より、置き換えられた更新プログラムを「拒否済み」に設定するスクリプトを入手し、WSUS サーバー上に保存します。(Decline-SupersededUpdates.ps1 等)</li><li>インデックスの再構築の時と同様にタスク スケジューラを起動し、基本タスクの作成を行ない、不要な更新プログラムの「拒否済み」設定を実行するスケジュールを指定 (上述の手順 2 ~ 4) します。<br>※ こちらもインデックスの再構築やクリーンアップ ウィザードとはスケジュールが被らないよう、他のメンテナンスの実行開始の数時間後や別の日等を指定します。</li><li>[プログラムの開始] を選択して、以下のようにスクリプトを指定します。本指定については、利用しているポート番号によって -Port 以降の指定を変更する必要があるので、ご注意ください。Windows Server 2012 以降の WSUS 環境は既定で 8530 となります。<br><code>powershell -ExecutionPolicy Unrestricted -Command &quot;C:\WSUS\Decline-SupersededUpdates.ps1 -UpdateServer localhost -Port 8530&quot;</code>  </li><li>インデックスの再構築の自動化の手順と同様にタスクの作成を完了 (上述の手順 6 ～ 7) させます。</li><li>試しに作成したタスクを右クリックして [実行する] を選択して実行してみましょう。出力ファイル SupersededUpdates.csv や SupersededUpdatesBackup.csv が出力されていれば、正常に登録されています。</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;br&gt;本日は WSUS サーバーのメンテナンス方法について、纏めてご紹介をいたします。&lt;/p&gt;
&lt;p&gt;WSUS は月々リリースされる更新プログラムを配信出来るよう、更新プログラムの情報をサーバー上に溜め込む必要がありま</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>System Center Configuration Manager Current Branch クライアントに関連する情報を完全に削除する方法</title>
    <link href="https://jpmem.github.io/blog/mecm/20190327_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20190327_01/</id>
    <published>2019-03-26T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.213Z</updated>
    
    <content type="html"><![CDATA[<p>皆様、こんにちは。System Center Configuration Manager サポート チームです。</p><p>以前のバージョンの System Center Configuration Manager クライアントを完全に削除する手順については、次の通りご紹介しておりますが、今回は最新版である System Center Configuration Manager Current Branch の場合の手順をご案内します。</p><p><a href="https://social.msdn.microsoft.com/Forums/ja-JP/bb8fc444-ec6e-43ac-a077-9ebea7abb4a2/sccm2012-sccm?forum=jpsccmwsus">https://social.msdn.microsoft.com/Forums/ja-JP/bb8fc444-ec6e-43ac-a077-9ebea7abb4a2/sccm2012-sccm?forum=jpsccmwsus</a></p><p>System Center Configuration Manager クライアントの完全削除は、クライアントが正常に動作していないように見える場合に有効な手順です。本手順を実施してから、クライアントの再インストールを実施することで解消できる問題も多くありますので、回避優先の対処が求められる場合に、是非お役立てください。</p><blockquote><p><strong>注意事項 : 本手順は、SCCM クライアントがインストールされた、サイト サーバー、サイト システム サーバー (SCCM のサーバー側の管理ポイント・配布ポイントなどの役割を持つサーバー) では行わないでください。手順中で削除が必要なレジストリ キーは、SCCM のサーバー側各機能でも使用していることが多く、サイト サーバー、サイト システムとしての役割に支障をきたします。本手順は、あくまでも、クライアント OS の SCCM クライアントへのトラブルシュートや、マスター イメージ準備のためにご利用ください。</strong></p></blockquote><hr><ol><li>System Center Configuration Manager クライアントをアンインストールします。</li></ol><p>コマンド プロンプトを管理者として実行し、以下のコマンドを実行します。</p><p><code>%Windir%\ccmsetup\ccmsetup.exe /uninstall</code></p><blockquote><p>コントロールパネルを開き、”Configuration Manager” という項目が消えたら、アンインストール完了と判断出来ます。また、アンインストールが成功すると、ccmsetup.log に以下のログが記録されます。</p></blockquote><p><code>Uninstall succeeded.</code></p><ol start="2"><li>下記フォルダー、ファイルを削除します。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%windir%\CCM</span><br><span class="line">%windir%\ccmsetup</span><br><span class="line">%windir%\SMSCFG.ini</span><br></pre></td></tr></table></figure><ol start="3"><li>下記レジストリが残存している場合、削除します。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\SMS</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\CCM</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\CCMSetup</span><br></pre></td></tr></table></figure><ol start="4"><li>以下の手順で、SMS 証明書 (自己署名証明書) を削除します。</li></ol><ol><li>コマンド プロンプトを開き、”mmc” を入力して実行します。</li><li>[ファイル] - [スナップインの追加と削除] をクリックします。</li><li>左ペインから [証明書] をクリックして [追加] ボタンをクリックします。</li><li>“コンピューター アカウント” にチェックを入れて、[次へ] をクリックします。</li><li>“ローカル コンピューター” にチェックし、[完了] をクリックします。</li><li>右ペインに “証明書（ローカル コンピューター）” が追加されていることを確認し [OK] をクリックします。</li><li>左ペインにて、[証明書] - [SMS] - [証明書] を選択します。</li><li>中央ペインに表示された 2 つの “SMS” 証明書に対して、それぞれ右クリックして [削除] を選択します。「選択された証明書を永久的に削除しますか？」というメッセージが表示されますので、[はい] を選択します。</li><li>[ファイル] - [終了] をクリックします。「コンソールの設定を コンソール 1 に保存しますか？」というメッセージが表示されますので、[いいえ] を選択して、mmc を終了します。</li></ol><blockquote><p>PKI 証明書を利用している環境（HTTPS 構成）の場合<br>PKI 証明書を利用している場合は同様に以下の手順で PKI 証明書を削除します。</p><ol><li>コマンド プロンプトを開き、”mmc” を入力して実行します。</li><li>[ファイル] - [スナップインの追加と削除] をクリックします。</li><li>左ペインから [証明書] をクリックして [追加] ボタンをクリックします。</li><li>“コンピューター アカウント” にチェックを入れて、[次へ] をクリックします。</li><li>“ローカル コンピューター” にチェックし、[完了] をクリックします。</li><li>右ペインに “証明書（ローカル コンピューター）” が追加されていることを確認し [OK] をクリックします。</li><li>左ペインにて、[証明書] - [個人] - [証明書] を選択します。カスタム ストアを利用している場合は、該当箇所を選択してください。</li><li>中央ペインに表示された SCCM の HTTPS 接続用クライアント証明書を右クリックして [削除] を選択します。<br>「選択された証明書を永久的に削除しますか?」というメッセージが表示されますので、[はい] を選択します。</li><li>[ファイル] - [終了] をクリックします。「コンソールの設定を コンソール1 に保存しますか?」というメッセージが表示されますので、[いいえ] を選択して、mmc を終了します。</li></ol></blockquote><ol start="5"><li>下記フォルダーに移動し、”19c5cf…” ではじまるファイルが存在する場合には削除、またはリネームして別フォルダーにコピーします。(該当のファイルが存在しない場合も問題ありません。)</li></ol><p><code>C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys</code></p><blockquote><p>※ ProgramData フォルダーは隠しフォルダーです。</p></blockquote><ol start="6"><li>ソフトウェア センターのショートカットが含まれる下記フォルダーを削除します。SCCM 管理コンソールをインストールしている場合は、「Configuraiotn Manager コンソール」のリンクなども本フォルダーに含まれます。管理コンソールはアンインストールしない場合などは、必要に応じて「ソフトウェア センター」のショートカットのみ削除してください。</li></ol><p><code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Microsoft System Center</code></p><blockquote><p>※ ProgramData フォルダーは隠しフォルダーです。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;皆様、こんにちは。System Center Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;以前のバージョンの System Center Configuration Manager クライアントを完全に削除する手順については、次の通りご</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>WSUS の同期先の URL の追加について</title>
    <link href="https://jpmem.github.io/blog/wsus/2019-02-14_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2019-02-14_01/</id>
    <published>2019-02-13T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.261Z</updated>
    
    <content type="html"><![CDATA[<p>2019/03/04 更新：公開情報を更新いたしました。</p><p>みなさま、こんにちは。WSUS サポート チームです。</p><p>WSUS の同期時に接続する URL については以下の公開情報の「2.1.1. Connection from the WSUS server to the Internet」の箇所にて紹介をしておりますが、今回接続先の URL の追加を行いましたため紹介をいたします。</p><ul><li>Step 2: Configure WSUS</li></ul><p><a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#BKM_ConfigurenetworkConnections">https://docs.microsoft.com/en-us/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#BKM_ConfigurenetworkConnections</a></p><p>具体的には、WSUS サーバーが弊社サイトから更新プログラムをダウンロードする際に以下の URL を追加で利用するように変更を行いました。ご不便をおかけしますが、プロキシやファイア ウォールにて接続先の URL を制御している場合には、以下の URL に対する通信についても許可していただけますようお願い申し上げます。</p><p>[ 追加 URL ]</p><p><a href="http://dl.delivery.mp.microsoft.com/">http://dl.delivery.mp.microsoft.com</a></p><p><a href="https://dl.delivery.mp.microsoft.com/">https://dl.delivery.mp.microsoft.com</a></p><p>※1 上述の公開情報についても更新を行う予定です。</p><p>※2 本ブログの執筆時点 (2019 年 2 月 14 日) で本 URL がダウンロード時に用いられている更新プログラムは、Windows 10 Version 1709 向けの KB4486996 のみとなります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;2019/03/04 更新：公開情報を更新いたしました。&lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;/p&gt;
&lt;p&gt;WSUS の同期時に接続する URL については以下の公開情報の「2.1.1. Connection from the WSUS s</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>System Center Configuration Manager AD OU に基づくデバイス コレクションの作成について</title>
    <link href="https://jpmem.github.io/blog/mecm/20181010_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20181010_01/</id>
    <published>2018-10-09T15:00:00.000Z</published>
    <updated>2021-12-01T15:56:55.189Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。</p><p>日本マイクロソフト System Center Configuration Manager サポートの金です。</p><p>本日は、System Center Configuration Manager Current Branch (以下、SCCM CB) にて、Active Directory の組織単位 (以下、OU) に基づいて、デバイス コレクションを作成する方法をご紹介させていただきます。</p><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><hr><p>AD の OU に基づくコレクションの作成の際には、事前に、Active Directory システムの探索が実施されている必要があります。</p><p>SCCM の探索方法から、”Active Directory システムの探索” が正しく設定され、有効になっていることを確認してください。<br><img src="/blog/mecm/20181010_01/20181010_01_01.png"></p><h2 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h2><hr><p>本手順では、以下の OU をサンプルとしておりますので、お客様の環境に応じて、設定内容を変更していただきますようお願いいたします。</p><p>contoso.local/TestClient/TestOU<br><img src="/blog/mecm/20181010_01/20181010_01_02.png"></p><ol><li><p>SCCM プライマリ サイト サーバーにサインインし、[Configuration Manager コンソール] を開きます。</p></li><li><p>[資産とコンプライアンス] - [概要] - [デバイス コレクション] を右クリックし、[デバイス コレクションの作成] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_03.png"></p></li><li><p>[デバイス コレクションの作成ウィザード] が表示されますので、[全般] 画面で、”名前” に任意の名前を入力し、”限定コレクション” に、[すべてのシステム] を指定後、[次へ] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_04.png"></p></li></ol><ol start="4"><li><p>[メンバーシップの規則] で、[規則の追加] - [クエリ規則] を選択します。<br><img src="/blog/mecm/20181010_01/20181010_01_05.png"></p></li><li><p>[クエリ規則のプロパティ] 画面が表示されますので、[クエリ ステートメントの編集] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_06.png"></p></li><li><p>[クエリ ステートメントのプロパティ] 画面が表示されますので、[条件] タブを開きます。<br><img src="/blog/mecm/20181010_01/20181010_01_07.png"></p></li><li><p>[条件プロパティ] 画面で、”条件の種類” が、[単純な値] であることを確認し、[選択] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_08.png"></p></li><li><p>[属性の選択] の画面が表示されますので、以下のとおり選択し、[OK] をクリックします。</p></li></ol><ul><li>属性クラス : システム リソース</li><li>属性 : システム OU 名<br><img src="/blog/mecm/20181010_01/20181010_01_09.png"></li></ul><ol start="9"><li>[条件プロパティ] に戻りますので、”演算子” と “値” を、以下のように設定し、[OK] をクリックします。</li></ol><ul><li>演算子 : が次と類似</li><li>値 (例) : contoso.local/TestClient/TestOU<br>値につきましては、お客様の環境に合わせて変更してください。<br>“ドメイン名/OU名 (親)/OU名 (子)” の形式となります。<br><img src="/blog/mecm/20181010_01/20181010_01_10.png"></li></ul><ol start="10"><li><p>[クエリ ステートメントのプロパティ] 画面に戻りますので、[OK] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_11.png"></p></li><li><p>[クエリ条件のプロパティ] 画面に戻りますので、[OK] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_12.png"></p></li><li><p>[デバイス コレクションの作成ウィザード] に戻りますので、[次へ] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_13.png"></p></li><li><p>[概要] の画面で、[次へ] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_14.png"></p></li><li><p>[完了] の画面で、[閉じる] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_15.png"></p></li><li><p>[Configuration Manager コンソール] - [資産とコンプライアンス] - [概要] - [デバイス コレクション] の画面にて、上記で作成したデバイス コレクションが表示されていることを確認し、アイコンに、砂時計のマークがなくなるまで待機します。<br><img src="/blog/mecm/20181010_01/20181010_01_16.png"></p></li><li><p>アイコンに、砂時計のマークがなくなりましたら、コレクションをダブルクリックし、指定した OU に所属しているデバイスが該当コレクションに入っていることを確認します。<br><img src="/blog/mecm/20181010_01/20181010_01_17.png"></p></li></ol><p>以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。&lt;/p&gt;
&lt;p&gt;日本マイクロソフト System Center Configuration Manager サポートの金です。&lt;/p&gt;
&lt;p&gt;本日は、System Center Configuration Manager Current Branch </summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
</feed>
