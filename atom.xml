<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Microsoft Endpoint Manager Support Blog</title>
  
  <subtitle>日本マイクロソフト Microsoft Endpoint Manager サポート チームのブログです。</subtitle>
  <link href="https://jpmem.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpmem.github.io/blog/"/>
  <updated>2022-07-21T05:52:57.705Z</updated>
  <id>https://jpmem.github.io/blog/</id>
  
  <author>
    <name>Microsoft Endpoint Manager Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Configuration Manager から更新プログラムを配信する際の再起動通知の動作について (2022 新版)</title>
    <link href="https://jpmem.github.io/blog/mecm/20220714_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20220714_01/</id>
    <published>2022-07-13T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.705Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チーム青木です。<br>本記事では、Configuration Manager から更新プログラム配信時の再起動動作についてご紹介いたします。また、本記事は以下の記事の新版となります。  </p><p>Title : Configuration Manager から更新プログラムを配信する際の再起動動作について<br>URL : <a href="https://jpmem.github.io/blog/mecm/20180719_01/">https://jpmem.github.io/blog/mecm/20180719_01/</a>  </p><p>Configuration Manager から更新プログラムを展開する際に、Configuration Manager で再起動を抑制させる/再起動させる設定のお役立て情報おまとめいたしました。また、新版では再起動通知の動作についてもご紹介しております。   </p><h2 id="再起動を抑制する場合"><a href="#再起動を抑制する場合" class="headerlink" title="再起動を抑制する場合"></a>再起動を抑制する場合</h2><p>展開設定時に [デバイスの再起動] - [サーバー(サーバーOSの場合) or ワークステーション(クライアントOSの場合)]　にチェックを入れることで、再起動の抑制をすることが可能です。</p><p><img src="/blog/mecm/20220714_01/1.png" alt="image.png"></p><p>上記設定値を入れることで以下のポップアップとなります。</p><p><img src="/blog/mecm/20220714_01/2.png" alt="image.png"></p><h2 id="再起動をさせる場合"><a href="#再起動をさせる場合" class="headerlink" title="再起動をさせる場合"></a>再起動をさせる場合</h2><p>展開設定時に [デバイスの再起動] - [サーバー(サーバーOSの場合) or ワークステーション(クライアントOSの場合)]　のチェックを無効にすることで、強制的に再起動させることが可能です。  </p><p><img src="/blog/mecm/20220714_01/3.png" alt="image.png"></p><h2 id="再起動通知を制御するクライアント設定について"><a href="#再起動通知を制御するクライアント設定について" class="headerlink" title="再起動通知を制御するクライアント設定について"></a>再起動通知を制御するクライアント設定について</h2><p>Configuration Manager コンソールから、クライアント設定を設定することで再起動時の通知の動作を制御出来ます。<br>以下に具体的な設定とその動作をご紹介いたします。再起動が必要な旨をユーザーに通知させたい管理者の方々のご参考になりましたら幸いです。  </p><h3 id="lt-再起動通知の動作-gt"><a href="#lt-再起動通知の動作-gt" class="headerlink" title="&lt;再起動通知の動作&gt;"></a>&lt;再起動通知の動作&gt;</h3><p>Configuration Manager コンソールにて、クライアント設定の “コンピューターの再起動” タブで下記項目を “はい” に設定いただきますと、再起動を促すダイアログ通知をクライアントに表示させることができます。<br>下記項目を “いいえ” に設定するとトースト通知をクライアントに表示させることができます。これらの 2 種類の通知を、お好みによってお使い分けていただければと思います。</p><ul><li>該当のクライアント設定 (既定値は “いいえ” の為、”はい” に設定する必要が有ります。)  <pre><code>展開で再起動が必要な場合、トースト通知ではなくダイアログ ウインドウをユーザーに表示する  </code></pre></li></ul><p>▼ クライアント設定 サンプル画像 (既定値)<br><img src="/blog/mecm/20220714_01/4.png" alt="image.png">  </p><p>▼ ダイアログ通知 サンプル画像<br><img src="/blog/mecm/20220714_01/5.png" alt="image.png">  </p><p>なお、ダイアログ通知のタイミングにつきましては、下記 2 つのタイミングで行われます。  </p><ol><li>クライアントに再起動が必要な更新プログラムがインストールされた直後のタイミング  </li><li>クライアント設定の “期限後にユーザーへの再起動リマインダー通知の頻度を指定する” で設定した、リマインダー通知のタイミング<br>(リマインダー通知のタイミングとは、ダイアログ通知で “再通知” をクリックした後、次のダイアログ通知が表示される際のタイミング)  </li></ol><p>通知機能の詳細につきましては、以下の公開情報に記載されております為、こちらもご参考になりましたら幸いでございます。  </p><p>Title : Configuration Managerのデバイス再起動通知<br>URL : <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/deploy/device-restart-notifications">https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/deploy/device-restart-notifications</a></p><h2 id="実際の再起動通知の動作画面をご紹介します"><a href="#実際の再起動通知の動作画面をご紹介します" class="headerlink" title="実際の再起動通知の動作画面をご紹介します"></a>実際の再起動通知の動作画面をご紹介します</h2><p>下記の内容のクライアント設定を適用し、ダイアログ通知が行われるタイミングを検証いたしました為以下に併せてご案内いたします。ぜひ貴社ご運用のご参考になりましたら幸いでございます。  </p><p>▼ 検証の為に設定したクライアント設定<br><img src="/blog/mecm/20220714_01/6.png" alt="image.png">  </p><p>&lt;検証&gt;</p><ol><li><p>クライアントにて MECM から展開した更新プログラムのダウンロードが完了すると、以下の 2 つのトースト通知が行われた。<br><img src="/blog/mecm/20220714_01/7.png" alt="image.png">  </p></li><li><p>更新プログラムのインストール後に再起動を要する場合、直ぐに以下のダイアログ通知が行われた。<br>ダイアログ通知に表示されている “コンピューターが自動的に再起動するまでの残り時間” は、クライアント設定の “期限後からデバイスが再起動されるまでの経過時間を指定します” で設定した 10 分が反映している。<br><img src="/blog/mecm/20220714_01/8.png" alt="image.png">  </p></li><li><p>「2.」のダイアログ通知で “再通知” をクリックした場合、ダイアログ通知が一旦消え、2 分後に再度ダイアログ通知が行われた。<br>クライアント設定の “期限後にユーザーへの再起動リマインダー通知の頻度を指定する” で設定した 2 分が反映している。<br><img src="/blog/mecm/20220714_01/9.png" alt="image.png">  </p></li><li><p>リマインダー通知が行われたタイミングで、再起動までの時間が、クライアント設定の “デバイスが再起動されるまでの最終カウントダウン通知をユーザーに表示する時間を指定します” で設定した 5 分以内になった為、”再通知” がグレーアウトして押せなくなった。また、×をクリックしてもダイアログ通知が消えなくなった。<br><img src="/blog/mecm/20220714_01/10.png" alt="image.png"> </p></li></ol><p>上記のように、リマインダー通知のタイミングを制御する事で、どのくらいの頻度でユーザーへ通知を出すのか等の運用を決めることが出来る為、本記事をご参考にしていただきつつ会社の運用に併せて設定値を決めていただければと思います。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チーム青木です。&lt;br&gt;本記事では、Configuration Manager から更新プログラム配信時の再起動動作についてご紹介いたします。また、本記事は以下の記事の新版となります。  &lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Endpoint Configuration Manager におけるピアキャッシュ機能について - その 2 (動作編)</title>
    <link href="https://jpmem.github.io/blog/mecm/20220713_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20220713_01/</id>
    <published>2022-07-12T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.705Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チーム青木です。  </p><p>MECM からのコンテンツの配布の際に、ネットワークの負荷を軽減できるピアキャッシュ機能は実際にどのような動作となっているのか、ログの抜粋と共にご紹介させていただきます。<br>本ブログは以下ブログのシリーズ第 2 弾です。ピアキャッシュの概要については以下ブログをご参考にしてくださいませ。  </p><p>Title : System Center Configuration Manager における BranchCache、ピアキャッシュ機能について - その 1 (概要編)<br>URL : <a href="https://jpmem.github.io/blog/mecm/20180911_01/">https://jpmem.github.io/blog/mecm/20180911_01/</a>  </p><h2 id="ピアキャッシュを有効にして、コンテンツを展開した場合のログの解説"><a href="#ピアキャッシュを有効にして、コンテンツを展開した場合のログの解説" class="headerlink" title="ピアキャッシュを有効にして、コンテンツを展開した場合のログの解説"></a>ピアキャッシュを有効にして、コンテンツを展開した場合のログの解説</h2><p>ピアキャッシュが有効の場合のログを抜粋し、実際にどのような動作が行われるのかを解説します。  </p><p>ピアキャッシュを有効にしている場合に、ピアキャッシュ クライアントがコンテンツを取得する際の動作は C\Windows\CCM\Logs\ContentTransferManager.log に記述されます。  </p><hr><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">04-12-2022 20:32:57.986    ContentTransferManager    8316 (0x207c)    CTM_StartJob - Starting CTM job &#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;  </span><br><span class="line">04-12-2022 20:32:57.986    ContentTransferManager    8316 (0x207c)    Created CTM job &#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125; for user S-1-5-18  </span><br><span class="line">04-12-2022 20:32:58.001    ContentTransferManager    1936 (0x790)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessProgress - entered phase CCM_DOWNLOADSTATUS_WAITING_CONTENTLOCATIONS  </span><br><span class="line">04-12-2022 20:32:58.001    ContentTransferManager    1936 (0x790)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): Queued location request LSRequest(&#x27;&#123;028DE696-C020-4CF7-8B55-F478FC3EF3BE&#125;&#x27;).  </span><br></pre></td></tr></table></figure><p>コンテンツの展開を受け取ったクライアントは、クライアントがコンテンツを取得する先のピアキャッシュ ソース 及び 配布ポイントをリストアップするためのリクエストを管理ポイントへ行います。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">04-12-2022 20:32:58.220    ContentTransferManager    2532 (0x9e4)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::_PersistLocations - Persisted locations  </span><br><span class="line">(SUBNETPEER) https://&lt;ピアキャッシュ ソース 1 台目のFQDN&gt;:8003/SCCM_BranchCache$/5d595a40-5699-4775-99a7-5f28b083750a  </span><br><span class="line">(SUBNETPEER) https://&lt;ピアキャッシュ ソース 2 台目のFQDN&gt;:8003/SCCM_BranchCache$/5d595a40-5699-4775-99a7-5f28b083750a  </span><br><span class="line">(SUBNET) http://&lt;配布ポイント&gt;/SMS_DP_SMSPKG$/5d595a40-5699-4775-99a7-5f28b083750a  </span><br><span class="line">(SUBNET) https://&lt;配布ポイント&gt;/CCMTOKENAUTH_SMS_DP_SMSPKG$/5d595a40-5699-4775-99a7-5f28b083750a  </span><br></pre></td></tr></table></figure><p>ピアキャッシュ ソース 及び 配布ポイントが一覧でリストアップされます。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">04-12-2022 20:32:58.439    ContentTransferManager    2532 (0x9e4)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::_DownloadContent - Created corresponding DTSJob(&#123;00CDF3E3-5C6A-4AFF-8F0E-8622CD538C8A&#125;)  </span><br><span class="line">04-12-2022 20:32:58.439    ContentTransferManager    2532 (0x9e4)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::_DownloadContent - DTSJob(&#123;00CDF3E3-5C6A-4AFF-8F0E-8622CD538C8A&#125;) started to download from &#x27;https://FAB-W10Client2.fabrikam.com:8003/SCCM_BranchCache$/5d595a40-5699-4775-99a7-5f28b083750a&#x27; for full content download.  </span><br></pre></td></tr></table></figure><p>リスト内の一番上のピアキャッシュ ソースからコンテンツのダウンロードを開始します。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">04-12-2022 20:32:58.455    ContentTransferManager    4188 (0x105c)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessProgress - entered phase CCM_DOWNLOADSTATUS_DOWNLOADING_MANIFEST  </span><br><span class="line">04-12-2022 20:32:58.502    ContentTransferManager    2532 (0x9e4)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessProgress - entered phase CCM_DOWNLOADSTATUS_PROCESSING_MANIFEST  </span><br><span class="line">04-12-2022 20:32:58.517    ContentTransferManager    4384 (0x1120)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessProgress - entered phase CCM_DOWNLOADSTATUS_PREPARING_DOWNLOAD  </span><br><span class="line">04-12-2022 20:32:58.534    ContentTransferManager    4384 (0x1120)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessProgress - entered phase CCM_DOWNLOADSTATUS_DOWNLOADING_DATA  </span><br></pre></td></tr></table></figure><p>ダウンロードが進行中である事が記述されます。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">04-12-2022 20:35:06.731    ContentTransferManager    3384 (0xd38)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): _ModifyDTSDownloadLocation - switched to location &#x27;https://&lt;ピアキャッシュ ソース 2 台目のFQDN&gt;:8003/SCCM_BranchCache$/5d595a40-5699-4775-99a7-5f28b083750a&#x27;  </span><br></pre></td></tr></table></figure><p>ネットワーク イシュー等が原因でリスト内の一番上のピアキャッシュ ソースからダウンロードが出来なかった為、リスト内の上から 2 番目のピアキャッシュ ソースからのダウンロードにスイッチ (変更) しました。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">04-12-2022 20:35:06.731    ContentTransferManager    8592 (0x2190)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessProgress - entered phase CCM_DOWNLOADSTATUS_DOWNLOADING_MANIFEST  </span><br></pre></td></tr></table></figure><p>ダウンロードが進行中である事が記述されます。 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">04-12-2022 20:35:27.828    ContentTransferManager    5524 (0x1594)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): _ModifyDTSDownloadLocation - switched to location &#x27;http://&lt;配布ポイント&gt;/SMS_DP_SMSPKG$/5d595a40-5699-4775-99a7-5f28b083750a&#x27;  </span><br></pre></td></tr></table></figure><p>こちらもネットワーク イシュー等が原因でダウンロードが出来ず、リスト内の上から 3 番目の配布ポイントからのダウンロードにスイッチ (変更) しました。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">04-12-2022 20:35:27.828    ContentTransferManager    5900 (0x170c)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessProgress - entered phase CCM_DOWNLOADSTATUS_DOWNLOADING_MANIFEST  </span><br></pre></td></tr></table></figure><p>ダウンロードが進行中である事が記述されます。 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">04-12-2022 20:35:28.054    ContentTransferManager    5900 (0x170c)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessProgress - entered phase CCM_DOWNLOADSTATUS_PROCESSING_MANIFEST  </span><br><span class="line">04-12-2022 20:35:28.069    ContentTransferManager    3384 (0xd38)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessProgress - entered phase CCM_DOWNLOADSTATUS_PREPARING_DOWNLOAD  </span><br><span class="line">04-12-2022 20:35:28.085    ContentTransferManager    3384 (0xd38)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessProgress - entered phase CCM_DOWNLOADSTATUS_DOWNLOADING_DATA  </span><br><span class="line">04-12-2022 20:35:32.879    ContentTransferManager    3384 (0xd38)    CTMJob(&#123;C3D5CF8B-458E-425A-AEB2-365F6B78250C&#125;): CCTMJob::ProcessDownloadSuccess - successfully processed download completion.  </span><br></pre></td></tr></table></figure><p>最終的に配布ポイントからコンテンツのダウンロードが完了しました。  </p><hr><p>上記のようにピアキャッシュの動作は ContentTransferManager.log に記述される為、もし「ピアキャッシュを有効にしたが、きちんと動作しているか心配」というご状況でございましたら、上記のログの流れがご参考になりましたら幸いです。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チーム青木です。  &lt;/p&gt;
&lt;p&gt;MECM からのコンテンツの配布の際に、ネットワークの負荷を軽減できるピアキャッシュ機能は実際にどのような動作となっているのか、ログの抜粋と共にご紹介させていただ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>WSUS の仕組み レポート編</title>
    <link href="https://jpmem.github.io/blog/wsus/2022-07-07_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2022-07-07_01/</id>
    <published>2022-07-06T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.813Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。</p><p>今回は、WSUSのレポートの仕組みについて、ご紹介していきたいと思います。<br>WSUS ではクライアントから状態レポートが報告され、それをもとにクライアントの更新プログラムの適用状況などを把握することができますが、<br>その仕組みの理解やレポートが報告されていないときなどのトラブルシューティングの際に、お役立ていただける情報となっていますので是非ご一読ください！  </p><h1 id="WSUS-の仕組み"><a href="#WSUS-の仕組み" class="headerlink" title="WSUS の仕組み"></a>WSUS の仕組み</h1><p>WSUS にクライアントからレポートが送られるときの流れは以下の通りです。    </p><ol><li>クライアントが次の処理を実施（更新プログラムの検出、ダウンロード、インストール）  </li><li>その結果をもとに状態レポートが WSUS へ送信される  </li><li>WSUSが状態レポートを受け取る  </li></ol><p>解説  </p><ol><li>クライアントが次の処理を実施（更新プログラムの検出、ダウンロード、インストール）<br>各処理の流れは以下の通りです。</li></ol><p>ⅰ. 更新プログラムの検出処理開始<br>ⅱ. 更新プログラムの検出処理完了 ＞ 2 を実施<br>ⅲ．ダウンロード処理開始<br>ⅳ．ダウンロード処理完了 ＞ 2 を実施<br>ⅴ．インストール処理開始<br>ⅵ．インストール処理完了 ＞ 2 を実施  </p><ol start="2"><li><p>1.の結果をもとに状態レポートがクライアントからWSUSへ送信<br>以下のフォルダにイベントを含むファイルが生成されます。<br>作成されたファイルは、IISの ReportingWebService を介してWSUSデータベースへ送信されます。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%windir%\SoftwareDistribution\EventCache.v2</span><br></pre></td></tr></table></figure></li><li><p>WSUS が状態レポートを受け取る<br>送信されたイベントファイルが WSUS データベースへ格納され、状態レポートとして WSUS で表示されます。  </p></li></ol><p>状態レポートの見方については以下の記事をご参照ください。<br><a href="https://jpmem.github.io/blog/wsus/2017-09-04_02/">WSUS のレポートに表示される「状態」の項目の説明</a></p><h1 id="トラブルシュート方法"><a href="#トラブルシュート方法" class="headerlink" title="トラブルシュート方法"></a>トラブルシュート方法</h1><p>状態レポートが WSUS にあがらないときに、まずご実施いただきたいトラブルシュート方法についてご紹介します。<br>以下の手順に沿って、検出処理実行からイベントファイル作成及び送信の動作をご確認ください。</p><p>1-1.[設定]&gt;[WindowsUpdate]&gt;[更新プログラムのチェック]を実行し検出を完了させます。<br>1-2.下記フォルダにイベントファイルが作成されたことを確認します。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%windir%\SoftwareDistribution\EventCache.v2</span><br></pre></td></tr></table></figure><p>1-3.以下のコマンドを実行します。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wuauclt /reportnow</span><br></pre></td></tr></table></figure><p>1-4. 1-2 で作成されたファイルがフォルダから消えていることを確認します。  </p><h3 id="1-1-から-1-4-まで全てが確認できた場合"><a href="#1-1-から-1-4-まで全てが確認できた場合" class="headerlink" title="1-1 から 1-4 まで全てが確認できた場合"></a>1-1 から 1-4 まで全てが確認できた場合</h3><p>ここまでの処理が実行されているにもかかわらず、WSUS 側で状態レポートが更新されないなどの事象が発生している場合には、<br>WSUS データベースへの書き込み処理の失敗なども疑われます為 の WSUS 及びクライアントのファイル送信時のログなども併せて確認する必要があります。  </p><h3 id="1-4-にてイベントファイルが送信されず滞留してしまう場合"><a href="#1-4-にてイベントファイルが送信されず滞留してしまう場合" class="headerlink" title="1-4 にてイベントファイルが送信されず滞留してしまう場合"></a>1-4 にてイベントファイルが送信されず滞留してしまう場合</h3><p>Windows Update のクライアント情報のキャッシュをクリアすることで解消されることがありますので、以下の記事に記載の手順をご実施ください。<br><a href="https://social.msdn.microsoft.com/Forums/ja-JP/8cec0049-4b41-4976-a440-d4012c8510ca/windows-update?forum=jpsccmwsus">Windows Update クライアントの情報をクリアにする手順</a>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は、WSUSのレポートの仕組みについて、ご紹介していきたいと思います。&lt;br&gt;WSUS ではクライアントから状態レポートが報告され、それをもとにクライアントの更新プログラムの適用状況などを把握すること</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>MECM 自動展開規則 ~手順解説シリーズ~</title>
    <link href="https://jpmem.github.io/blog/mecm/20220706_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20220706_01/</id>
    <published>2022-07-05T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.693Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>手順解説シリーズ、今回は自動展開規則の設定方法をステップバイステップで解説致します。<br>設定方法がよくわからない方、今の設定を見直したい方はぜひ確認してみてください。  </p><h2 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h2><p>自動展開規則を作成する前に、必要となる準備を行います。  </p><p>1.自動展開規則を展開するデバイス コレクションを作成します。<br>2.自動展開規則で使用する展開パッケージを新規に作成する場合には、事前に共有フォルダーを作成しておく必要がございます。任意のパスにフォルダーを作成の上、共有設定を行ってください。</p><h2 id="自動展開規則の作成手順"><a href="#自動展開規則の作成手順" class="headerlink" title="自動展開規則の作成手順"></a>自動展開規則の作成手順</h2><p>1.MECM 管理コンソールを開き [ソフトウェア ライブラリ] &gt; [概要] &gt; [ソフトウェア更新プログラム] &gt; [自動展開規則] の順に開き、リボン上の [自動展開規則の作成] をクリックします。  </p><p><img src="/blog/mecm/20220706_01/20220706_01_01.png" alt="image.png"></p><p>2.自動展開規則の作成ウィザードが開きますので、「全般」にて下記の設定を行います。  </p><ul><li><strong>名前</strong>　→　任意の名前を入力ください。  </li><li><strong>コレクション</strong>　→　自動展開規則を展開するデバイス コレクションを指定ください。  </li><li><strong>ソフトウェア更新プログラム グループ</strong>　→　<br>こちらについてはいずれを選んで頂いても問題ございませんが、[新しいソフトウェア更新プログラム グループを作成する] を選択した場合には、自動展開規則から更新プログラムが展開されるたびに新しいソフトウェア更新プログラム グループが追加作成されるため、グループが多数存在する状況となります。<br>そのため、特にこだわりがない場合には [既存のソフトウェア更新プログラム グループ] を選択くださいませ。  </li></ul><p><img src="/blog/mecm/20220706_01/20220706_01_02.png" alt="image.png"></p><p>3.「展開設定」にて、「展開の種類」を設定します。  </p><ul><li><strong>[必須] を指定した場合</strong><br>　→　ユーザー操作なしで自動的にインストールされます。  </li><li><strong>[利用可能] を指定した場合</strong><br>　→　ユーザーがクライアント端末側でソフトウェア センターを開き、[インストール] ボタンをクリックすることでインストールが開始されます。  </li></ul><p><img src="/blog/mecm/20220706_01/20220706_01_03.png" alt="image.png"></p><p>4.「ソフトウェア更新プログラム」にて、展開を行いたい更新プログラムのみが対象となるような「検索条件」を設定します。<br>この設定は非常に重要です。この検索条件が誤っていると意図していない更新プログラムが展開されてしまう可能性がございますので正しく設定しましょう。<br>検索条件でよく利用する代表的な項目に関しまして、<a href="###%E4%BB%A3%E8%A1%A8%E7%9A%84%E3%81%AA%E6%A4%9C%E7%B4%A2%E6%9D%A1%E4%BB%B6">代表的な検索条件</a> にて解説しておりますのでご確認くださいませ。  </p><p><img src="/blog/mecm/20220706_01/20220706_01_09.png" alt="image.png"></p><p>5.「評価スケジュール」にて、任意の項目を選択の上、[次へ] をクリックします。  </p><ul><li><strong>[この規則を自動的に実行しない]</strong><br>　→　自動的に実行されないため手動での実行が必要となります。  </li><li><strong>[ソフトウェア更新ポイントが 1 つでも同期されたら、規則を実行する]</strong><br>　→　上部に表示されている [現在のソフトウェアの更新ポイントの同期スケジュール] のサイクルに沿って自動展開規則が実行されます。  </li><li><strong>[スケジュールに基づいて規則を実行する]</strong><br>　→　任意のスケジュールの設定が可能となります。  </li></ul><p>ソフトウェア更新ポイントの同期タイミングと自動展開規則の評価タイミングをずらしたいなど、特別なご事情が無い限りは [ソフトウェア更新ポイントが 1 つでも同期されたら、規則を実行する] を選択いただくことが一般的です。</p><p><img src="/blog/mecm/20220706_01/20220706_01_12.png" alt="image.png"></p><p>6.「展開スケジュール」にて、任意の項目を選択の上、[次へ] をクリックします。  </p><ul><li><strong>「基準」</strong><br>この展開のスケジュールを UTC、クライアントのローカル時刻のどちらを基準に評価するかを設定します。  </li></ul><p><strong>もしサーバーとタイムゾーンが異なるクライアントを管理する場合には「UTC」を選択頂く必要がございます。</strong><br>クライアントのタイムゾーンがすべて日本の場合には [クライアントのローカル時刻] を指定頂いても問題ございません。  </p><ul><li><strong>「ソフトウェアが使用可能な時間」および「インストールの期限」</strong><br>上記 2 つの設定によりクライアント側でインストールがスケジュールされる日時が決定します。<br>「ソフトウェアが使用可能な時間 ~ インストールの期限」の間でダウンロードがスケジュールされ、インストールの期限後にインストールが行われますので、すぐに適用させる場合にはいずれも [直ちに] を指定くださいませ。  </li></ul><p><img src="/blog/mecm/20220706_01/20220706_01_13.png" alt="image.png"></p><p>7.「ユーザー側の表示と操作」、「アラート」にて任意の設定を行い、[次へ] をクリックします。<br>8.「展開パッケージ」にて、既存の展開パッケージを使用する場合には [展開パッケージを選択する]、新しい展開パッケージを作成する場合には [新しい展開パッケージを使用する] を選択の上、「事前準備」で作成した共有フォルダーを [パッケージのソース] に指定し、[次へ] をクリックします。  </p><p><img src="/blog/mecm/20220706_01/20220706_01_14.png" alt="image.png"></p><p>※ 下記手順 9 におきましては新たに展開パッケージを作成する際の解説となります。  </p><p>9.「配布ポイント」にてこの自動展開規則にて展開する更新プログラムのコンテンツを配置する配布ポイントを指定し、[次へ] をクリックします。  </p><p><img src="/blog/mecm/20220706_01/20220706_01_15.png" alt="image.png"></p><p>10.「ダウンロード場所」にて [インターネットからソフトウェア更新プログラムをダウンロードする] を選択の上、[次へ] をクリックします。  </p><p><img src="/blog/mecm/20220706_01/20220706_01_16.png" alt="image.png"></p><p>11.「言語の選択」にて言語を選択の上、[次へ] をクリックします。<br>12.「ダウンロードの設定」にて、任意の設定を行い、[次へ] をクリックします。  </p><ul><li><strong>[クライアントが近隣の境界グループまたは既定サイトの境界グループから配布ポイントを使用する時に適用する配置オプションを選択します。]</strong><br>近隣の境界グループ（フォールバック設定された境界グループ）または Default-Site-Boudary-Group （既定サイトの境界グループ）に紐づく配布ポイントを使用する場合の挙動を設定します。  </li></ul></br><ul><li><strong>[現在または近隣の境界グループのどの配布ポイントでもソフトウェア更新プログラムを利用できない場合、クライアントは、サイト既定の境界グループ内の配布ポイントからソフトウェアの更新をダウンロードして、インストールできます。]</strong><br>現在または近隣の境界グループの配布ポイントを参照できない場合に、 Default-Site-Boudary-Group （既定サイトの境界グループ）を参照させるかどうかの挙動を設定します。  </li></ul></br><ul><li><p><strong>[関連する任意の境界グループ内の配布ポイントでソフトウェア更新プログラムを利用できない場合は…]</strong><br>配布ポイントからのダウンロードができなかった場合に、インターネット上の Microsoft Update から更新プログラムをダウンロードさせたい場合には、チェックを入れてください。  </p></li><li><p><strong>[インストールの期限後、クライアントが従量制のインターネット接続を使用してコンテンツをダウンロードできるようにする]</strong><br>これはインストール期限を迎えた場合には、クライアントが従量制課金のネットワークを使用している場合でもコンテンツのダウンロードを許可するかの設定となります。  </p></li></ul><p><img src="/blog/mecm/20220706_01/20220706_01_17.png" alt="image.png"></p><p>13.「概要」にて、これまでに設定した内容に誤りが無いか確認の上、[次へ] をクリックします。<br>14.「完了」にて、「正常に完了しました」と表示されることを確認し [閉じる] をクリックします。  </p><p><img src="/blog/mecm/20220706_01/20220706_01_18.png" alt="image.png"></p><p>以上で自動展開規則の設定は完了となります。<br>設定後、下記の通り「最後のエラーの説明」=「成功」となることをご確認くださいませ。  </p><p><img src="/blog/mecm/20220706_01/20220706_01_19.png" alt="image.png"></p><h3 id="代表的な検索条件"><a href="#代表的な検索条件" class="headerlink" title="代表的な検索条件"></a>代表的な検索条件</h3><p>設定方法は様々ありますので、代表的なもののみ解説させて頂きます。  </p><ul><li><strong>[置き換え済み]</strong><br>この設定は非常に重要です。この条件を設定することにより更新プログラムの置き換え状態を条件にすることができます。<br>累積的な更新プログラムは新しい更新プログラムがリリースされると古いものを置き換えます。<br>置き換えられた更新プログラムの内容は新しい更新プログラム内に内包されるため、古い更新プログラムを配信する必要がありません。<br>そのため [置き換え済み] = [いいえ] の更新プログラム（つまり置き換えられていない最新の更新プログラム）のみを展開対象とすることで無駄な更新プログラムの展開を行わずにすむ為、必須となる条件となります。  </li></ul><p><img src="/blog/mecm/20220706_01/20220706_01_07.png" alt="image.png"></p><ul><li><strong>[更新プログラムの分類] および [製品]</strong><br>各更新プログラムごとに、適用対象となる [更新プログラムの分類] および [製品] が決まっております。<br>そのため、この 2 つを条件に追加することで分類と製品によるフィルターをかけることが可能となります。</br>  </li></ul><p><strong>確認方法</strong><br>1.MECM 管理コンソール &gt; [ソフトウェア ライブラリ] &gt; [概要] &gt; [ソフトウェア更新プログラム] &gt; [すべてのソフトウェア更新プログラム] にて、項目名バーを右クリックし、[更新プログラムの分類] および [製品] にチェックを入れます。<br>2.配信対象の更新プログラムの [更新プログラムの分類] および [製品] をご確認ください。  </p><p><img src="/blog/mecm/20220706_01/20220706_01_04.png" alt="image.png"></p><ul><li><strong>[リリース日または変更日]</strong><br>特定の期間内にリリースまたは変更された更新プログラムを配信対象とすることができます。  </li></ul><p><img src="/blog/mecm/20220706_01/20220706_01_05.png" alt="image.png"></p><ul><li><strong>[必須]</strong><br>ソフトウェア更新プログラムの必須カウントを条件にすることができます。<br>これを設定することにより、必須と判定された更新プログラムのみを配信対象とすることができます。<br>下記では「&gt;=1」と設定することにより、必須カウントが 1 以上の場合には対象とする条件となります。</br><br>なお、必須カウントはクライアント端末側で定期的に実行される「ソフトウェア更新プログラムのスキャン サイクル」により、端末それぞれで必要な更新プログラムを必須と判断しカウントされていきます。<br>そのため、新しく同期されたばかりのソフトウェア更新プログラムはすぐには必須判定されず、クライアント側のスキャン サイクル実行後にカウントされる流れとなります。  </li></ul><p><img src="/blog/mecm/20220706_01/20220706_01_06.png" alt="image.png"></p><ul><li><strong>[タイトル]</strong><br>指定した文字列に部分一致するタイトルの更新プログラムを配信対象とすることができます。<br>例えば下記の「Beta」を指定する場合には、「Microsoft Edge-ARM64 ベース エディションの Beta チャネル バージョン」という更新プログラムが該当します。<br>なお、タイトルにおきましては、文字列の検索となるため、入力ミスなどで意図していない条件となってしまう可能性があります。<br>そのためその他の条件だけでは希望する更新プログラムを絞りきれない時にご活用くださいませ。  </li></ul><p><img src="/blog/mecm/20220706_01/20220706_01_08.png" alt="image.png"></p><h3 id="検索条件が正しいかの確認方法"><a href="#検索条件が正しいかの確認方法" class="headerlink" title="検索条件が正しいかの確認方法"></a>検索条件が正しいかの確認方法</h3><p>検索条件を設定し終わりましたら、[プレビュー] を表示してみましょう。<br>すると設定した検索条件に合致する更新プログラムの一覧を確認することができます。<br>ここで意図していない更新プログラムが表示されている場合には条件が不足している、誤っていることが想定されるので、意図した更新プログラムのみが表示されるまで検索条件を見直しましょう。  </p><p><img src="/blog/mecm/20220706_01/20220706_01_10.png" alt="image.png"></p><p><img src="/blog/mecm/20220706_01/20220706_01_11.png" alt="image.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;手順解説シリーズ、今回は自動展開規則の設定方法をステップバイステップで解説致します。&lt;br&gt;設定方法がよくわからない方、今の設定を見直したい方はぜひ確認してみてくださ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="手順解説" scheme="https://jpmem.github.io/blog/tags/%E6%89%8B%E9%A0%86%E8%A7%A3%E8%AA%AC/"/>
    
  </entry>
  
  <entry>
    <title>通常の機能更新プログラムとイネーブルメント パッケージ、どちらを展開するべき？</title>
    <link href="https://jpmem.github.io/blog/mecm/20220702_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20220702_01/</id>
    <published>2022-07-03T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.693Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート 山田です。  </p><p>今回は MECM や WSUS で、Windows 10 の OS を 21H1 や 21H2 などへアップグレードしたい場合、通常の機能更新プログラムとイネーブルメント パッケージのどちらを展開、承認するべきか解説させていただきます。  </p><h2 id="イネーブルメント-パッケージとは？"><a href="#イネーブルメント-パッケージとは？" class="headerlink" title="イネーブルメント パッケージとは？"></a>イネーブルメント パッケージとは？</h2><p>Windows 10 1903 と 1909、2004 ～ 21H2 は共通のコア オペレーティング システムを使用しています。<br>そのため、このイネーブルメント パッケージを展開するだけで、手軽に機能更新プログラムを適用できます。<br>通常の機能更新プログラムは数 GB ほどの大きい容量ですが、イネーブルメント パッケージは数十 KB ほどのため、ネットワークもひっ迫することなく機能更新が行えるため、とても便利です。  </p><h3 id="通常の機能更新プログラムとイネーブルメント-パッケージ、どちらを展開するべきか"><a href="#通常の機能更新プログラムとイネーブルメント-パッケージ、どちらを展開するべきか" class="headerlink" title="通常の機能更新プログラムとイネーブルメント パッケージ、どちらを展開するべきか"></a>通常の機能更新プログラムとイネーブルメント パッケージ、どちらを展開するべきか</h3><p>それではどちらを展開すべきか見ていきましょう。<br>具体的には、元の OS がどれを使用しているかに依存します。  </p><p>■ 例 21H2 にアップグレードしたい場合<br><strong>アップグレード元の OS が 1909 以前 (1909 を含む) → 通常の機能更新プログラム（例 Windows 10 (ビジネス エディション)、バージョン 21H2、ja-jp x64 の機能更新プログラム）を展開します。</strong>  </p><p><strong>アップグレード元の OS が 2004 以降 (2004 を含む) → イネーブルメント パッケージ（例 Windows 10 バージョン 21H2 x64ベースのシステムへの機能更新 2021-11 イネーブルメント パッケージ経由）を展開します。</strong>  </p><p>イネーブルメント パッケージを展開するためには前提条件が存在します。<br>前提条件を満たすことで MECM で “必須判定” されますので、あらかじめご確認ください。  </p><p>&lt;前提条件&gt;  </p><p>■20H2 へのアップグレードの場合 (KB4562830)  </p><p>・サービス スタック更新プログラム 2020 年 9 月 8 日 かそれ以降のサービス スタック更新プログラムを適用していること<br>・2020 年 10 月 13 日 KB4579311 (19041.572) かそれ以降のソフトウェア更新プログラムを適用していること  </p><p>参考情報 : <a href="https://support.microsoft.com/ja-jp/topic/feature-update-through-windows-10-version-20h2-enablement-package-02d91e04-931e-f00d-090c-015467c49f6c">Feature Update through Windows 10, version 20H2 Enablement Package</a>  </p><p>■21H1 へのアップグレードの場合</p><p>・サービス スタック更新プログラム 2020 年 9 月 8 日 かそれ以降のサービス スタック更新プログラムを適用していること<br>・2021 年 5 月 11 日 KB5003173 (19041.985) かそれ以降のソフトウェア更新プログラムを適用していること  </p><p>参考情報 : <a href="https://support.microsoft.com/ja-jp/topic/kb5000736-%E6%9C%89%E5%8A%B9%E5%8C%96%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%BF%E7%94%A8windows-10%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3-21h1-%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E4%B8%BB%E3%81%AA%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0-75a01e67-3b5f-4677-8efe-42852e41c7cf">KB5000736: 有効化パッケージを使用Windows 10バージョン 21H1 に対する主な更新プログラム</a>  </p><p>■21H2 へのアップグレードの場合</p><p>・サービス スタック更新プログラム 2020 年 9 月 8 日 かそれ以降のサービス スタック更新プログラムを適用していること<br>・2021 年 9 月 14 日 KB5005565 (19041.1237) かそれ以降のソフトウェア更新プログラムを適用していること  </p><p>参考情報 : <a href="https://support.microsoft.com/ja-jp/topic/kb5003791-%E6%9C%89%E5%8A%B9%E5%8C%96%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8windows-10%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3-21h2-%E3%82%92%E6%9B%B4%E6%96%B0-8bc077be-18d7-4aac-81ce-6f6dad2cd384">KB5003791: 有効化パッケージWindows 10バージョン 21H2 を更新 </a>  </p><h3 id="どちらが必須判定されているか確認する方法"><a href="#どちらが必須判定されているか確認する方法" class="headerlink" title="どちらが必須判定されているか確認する方法"></a>どちらが必須判定されているか確認する方法</h3><p>通常の機能更新プログラムとイネーブルメント パッケージのどちらが必須と判定しているか確認したい場合、MECM のレポート機能を使用すると一番わかりやすいです。  </p><p>■クライアント端末毎に確認するレポート<br>[監視] - [レポート] - [ソフトウェア更新プログラム - A コンプライアンス] - [コンプライアンス 5 - 特定のコンピューター]  </p><p>デバイス名：任意のクライアントを選択します。<br>更新クラス：Upgrades を選択します。  </p><p><img src="/blog/mecm/20220702_01/2022-07-04-10-05-50.png">  </p><p>上記はイネーブルメント パッケージが “必須判定” されている状態です。  </p><p>■更新プログラム毎に確認するレポート<br>[監視] - [レポート] - [ソフトウェア更新プログラム - A コンプライアンス] - [コンプライアンス 8 - 更新プログラムに対して特定のコンプライアンスの状態にあるコンピューター]  </p><p>更新：Windows 10 (ビジネス エディション)、バージョン 21H2、ja-jp x64 の機能更新プログラム など任意の更新プログラム<br>コレクション：対象のクライアントが所属するデバイス コレクション<br>状態名：2 - 更新を行う必要があります  </p><p><img src="/blog/mecm/20220702_01/2022-07-05-08-40-45.png"></p><p>上記は CL1 というデバイスが機能更新プログラムを必要と判定している状態です。  </p><h4 id="補足事項"><a href="#補足事項" class="headerlink" title="補足事項"></a>補足事項</h4><p>WSUS で承認する場合も上述の考え方は同じです。<br>WSUS もレポート機能がありますので、どちらが必要と判定しているか把握したい場合はレポートを参照してください。  </p><ul><li>レポートを出力する手順  </li></ul><ol><li>WSUS コンソールを開き、[WSUS サーバー名] - [コンピューター] - [すべてのコンピューター] と辿ります。  </li><li>該当のクライアント名を右クリックし、[状態レポート] を選択します。  </li><li>以下のように項目を選択し、[レポートの実行] を選択します。  </li></ol><p>次の分類に更新を含める：Upgrade<br>次の状態の更新プログラムを含める：必要  </p><p><img src="/blog/mecm/20220702_01/2022-07-04-19-04-38.png">  </p><p>[インストールされていません] という表記になっている場合は、該当の機能更新プログラムを必要と判定しています。  </p><p>参考情報<br><a href="https://jpmem.github.io/blog/wsus/2017-09-04_02/">WSUS のレポートに表示される「状態」の項目の説明</a>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート 山田です。  &lt;/p&gt;
&lt;p&gt;今回は MECM や WSUS で、Windows 10 の OS を 21H1 や 21H2 などへアップグレードしたい場合、通常の機能更新プログラムとイネーブルメン</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Azure Active Directory に存在する CPC-hth から始まるデバイス オブジェクトについて</title>
    <link href="https://jpmem.github.io/blog/w365/2022-06-16_01/"/>
    <id>https://jpmem.github.io/blog/w365/2022-06-16_01/</id>
    <published>2022-06-15T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.733Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート 山田です。<br>本日は、Windows 365 Enterprise 環境を使用している際に見かける、Azure Active Directory 上の CPC-hth から始まるデバイス オブジェクトについてご紹介します。  </p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2022/6/16 時点での内容についての記載となっております。<br>今後内容が更新されることもございますので、その点ご承知置きくださいますようお願い致します。  </p><h3 id="CPC-hth-とは"><a href="#CPC-hth-とは" class="headerlink" title="CPC-hth とは"></a>CPC-hth とは</h3><p>Windows 365 Enterprise で使用しているテナントの Azure Active Directory を開き、[すべてのデバイス] を見ると、以下のように CPC-hth から始まるデバイス オブジェクトが存在します。  </p><p><img src="/blog/w365/2022-06-16_01/2022-06-16-15-45-20.png">  </p><p>CPC-hth は Azure ネットワーク接続 (ANC) のチェックを行う際に、ドメイン参加を試みるために自動で生成されるデバイス オブジェクトです。<br>ANC は内部的に 6 時間に 1 回の頻度で行われ、CPC-hth から始まるデバイス オブジェクトを削除しても、チェックのタイミングで再生成されますが、ANC のチェック毎に CPC-hth のデバイス オブジェクトが増え続けることはございませんので、ご安心ください。  </p><p>■補足事項<br>オンプレミスの [Active Directory ユーザーとコンピューター] にも CPC-hth が存在することとなりますが、ANC のプロパティより以下の [組織単位] で指定した OU に CPC-hth のデバイス オブジェクトが生成されます。  </p><p><img src="/blog/w365/2022-06-16_01/2022-06-16-16-08-31.png">  </p><p>以上、CPC-hth から始まるデバイス オブジェクトについて、参考になれば幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート 山田です。&lt;br&gt;本日は、Windows 365 Enterprise 環境を使用している際に見かける、Azure Active Directory 上の CPC-hth から始まるデバイ</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>パッケージ展開機能による MECM クライアント エージェントのバージョンアップ方法</title>
    <link href="https://jpmem.github.io/blog/mecm/20220610_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20220610_01/</id>
    <published>2022-06-09T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.693Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>Configuration Manager では、MECM クライアント エージェントのバージョン アップ方法が複数ございます。<br>自動クライアント アップグレードという機能が用意されておりますが、事前にテスト可能なコレクションは 1 つしか指定することはできず、その後にサイト全体へアップグレードを行うため、もう少し小刻みにバージョン アップをしたいというニーズがあることを、サポート インシデントを通してご要望頂くことがございます。<br>そこで今回は、パッケージ展開機能を利用する方法についてご紹介いたします。  </p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><p><strong>A. パッケージとプログラムの作成</strong><br><strong>B. パッケージの展開</strong><br><strong>C. 展開結果の確認</strong><br><strong>D. 注意事項</strong>  </p><h2 id="A-パッケージとプログラムの作成"><a href="#A-パッケージとプログラムの作成" class="headerlink" title="A. パッケージとプログラムの作成"></a>A. パッケージとプログラムの作成</h2><ol><li><p>プライマリ サイト サーバー上で、事前に共有フォルダーを作成します。共有ファルダ―は新規で作成し、このパッケージ専用として扱います。<br>例：**”\\PriSite\MECMClient&quot;**  </p></li><li><p>プライマリ サイト サーバーの以下のフォルダーにアクセスします。<br>パス：**”&lt;サイトサーバーのインストール ドライブ&gt;:\Program Files\Microsoft Configuration Manager\Client”**</p></li><li><p>ccmsetup.exe ファイルのみを、共有フォルダーにコピーします。(手順 5. で使います)</p></li><li><p>MECM コンソールを起動し、[ソフトウェア ライブラリ] &gt; [アプリケーション管理] &gt; [パッケージ] を右クリックし、[パッケージの作成] をクリックします。</p></li><li><p>[パッケージとプログラムの作成ウィザード] の [パッケージ] より、任意の名前を入力し、[このパッケージにソース ファイルを含める] にチェックを入れ、[参照] をクリックします。</p></li><li><p>[ソース フォルダー] の設定より、さらに [参照] をクリックし、共有フォルダーのパスを入力し、[OK] をクリックします。</p></li><li><p>[パッケージ] より、共有フォルダーのパスが登録されていることを確認し、[次へ] をクリックします。</p></li><li><p>[プログラムの種類] より、[標準プログラム] が選択されている状態のまま、[次へ] をクリックします。</p></li><li><p>[標準プログラム] より、以下の項目を設定し、[参照] をクリックします。</p><ul><li>名前：任意の名前   </li><li>コマンド ライン：  </li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ccmsetup.exe /noservice /mp:&lt;管理ポイントの FQDN&gt; SMSMP=&lt;管理ポイントの FQDN&gt; SMSSITECODE=&lt;サイト コード&gt;</span><br><span class="line">例)：ccmsetup.exe /noservice /mp:PriSite.contoso.com SMSMP=PriSite.contoso.com SMSSITECODE=PS1</span><br></pre></td></tr></table></figure><ul><li>プログラムの実行条件：ユーザーのログオン状態に関係なし  </li><li>実行モード：管理者権限で実行する（自動で選択されます）  </li></ul></li><li><p>[要件] より、必要に応じて設定を行い、[次へ] をクリックします。</p></li><li><p>[概要] より、設定内容に誤りがないことを確認し、[次へ] をクリックします。</p></li><li><p>[完了] より、正常に完了したことを確認し、[閉じる] をクリックします。</p></li><li><p>[パッケージ] の [ナビゲーション ペイン] より、作成したパッケージが登録されていることを確認します。</p></li></ol><h2 id="B-パッケージの展開"><a href="#B-パッケージの展開" class="headerlink" title="B. パッケージの展開"></a>B. パッケージの展開</h2><ol><li><p>MECM コンソールより、[ソフトウェア ライブラリ] &gt; [アプリケーション管理] &gt; [パッケージ] を開きます。</p></li><li><p>先ほど作成したパッケージを右クリックし、[展開] をクリックし、[ソフトウェアの展開ウィザード] を開きます。</p></li><li><p>[全般] にて [コレクション] - [参照] をクリックし、展開先コレクションを指定し [OK] をクリックし、[次へ] をクリックします。</p></li><li><p>[コンテンツ] にて、[追加] をクリックし、配布ポイントを指定し、[次へ] をクリックします。</p></li><li><p>[展開設定] にて “目的” を [利用可能] とし、[次へ] をクリックします。<br>([必須] 場合にはサイレント実行されるため、テストする際には、[利用可能] とし、テストが成功することをご確認頂くことをお勧めいたします。)</p></li><li><p>[スケジュール] にて必要に応じたスケジュールを指定し、[次へ] をクリックします。</p></li><li><p>[ユーザー側の表示と操作] にて既定のまま [次へ] をクリックします。</p></li><li><p>[配布ポイント] にて、配布ポイントを指定して、[次へ] をクリックします。</p></li><li><p>[概要] にて [次へ] をクリックします。</p></li><li><p>ウィザードが完了したことを確認し、[閉じる] をクリックします。</p></li><li><p>展開後、[パッケージ] の [ナビゲーション ペイン] より、展開したパッケージのコンテンツ ステータスが緑色の円グラフになることを確認します。<br>※画面をリフレッシュして、円グラフの更新状況を確認ください。  </p></li></ol><h2 id="C-展開結果の確認"><a href="#C-展開結果の確認" class="headerlink" title="C. 展開結果の確認"></a>C. 展開結果の確認</h2><p>パッケージ展開機能により ccmsetup.exe の配布を行うと、MECM エージェントのサービスが再起動されるため、パッケージの展開ステータスで、「プログラムで問題が発生しました (予期しなかった再起動)」 と記録されることがございます。<br>これはステータスを送付するタイミングに依存して記録されるものであり、想定動作となりますのでご留意ください。  </p><p>そのため、バージョンアップが正しく行われたかどうかは、以下の確認方法を用います。<br>基本的には、MECM サーバー側でバージョンアップされていることが確認できましたら、クライアントから管理ポイントへバージョン情報が正しく渡っているため、これにより正しくクライアントが動作していることを判断します。  </p><h3 id="レポートによる確認"><a href="#レポートによる確認" class="headerlink" title="レポートによる確認"></a>レポートによる確認</h3><ol><li>MECM コンソールにて、[監視] &gt; [レポート] &gt; [レポート] &gt; [サイト - クライアント情報] を選択します。</li><li>[Configuration Manager クライアント バージョン別の数] を右クリックし、[実行] をクリックします。</li><li>レポートの結果が表示されますので、各バージョンをクリックすると、バージョン別のクライアント一覧がご確認頂けます。</li></ol><h3 id="デバイスの列名による確認"><a href="#デバイスの列名による確認" class="headerlink" title="デバイスの列名による確認"></a>デバイスの列名による確認</h3><ol><li><p>MECM コンソールにて、[資産とコンプライアンス] &gt; [デバイス] を選択します。</p></li><li><p>以下の列を追加し、各状態をチェックします。<br>・[アイコン]<br>・[名前]<br>・[クライアント]<br>・[クライアント アクティビティ]<br>・[クライアント バージョン]</p></li><li><p>目安としては、以下の点をチェックします。<br>・アイコン：<strong>緑色でチェックが付いているか</strong><br>・クライアント アクティビティ：<strong>アクティブになっているか</strong><br>・クライアント バージョン：<strong>想定バージョンになっているか</strong></p><p> <img src="/blog/mecm/20220610_01/20220609-01_01.png" alt="image.png">  </p></li><li><p>そのほか、実際にバージョンアップ後のクライアントに対して、<br>パッケージ展開や、ソフトウェア更新プログラムの展開を行い、目的の配信が正常に進みますか確認を行います。</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;Configuration Manager では、MECM クライアント エージェントのバージョン アップ方法が複数ございます。&lt;br&gt;自動クライアント アップグレー</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>MECM パッケージとアプリケーションどっちを使うべき？違いを解説！</title>
    <link href="https://jpmem.github.io/blog/mecm/20220608_02/"/>
    <id>https://jpmem.github.io/blog/mecm/20220608_02/</id>
    <published>2022-06-07T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.689Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>今回は MECM のパッケージとアプリケーションの違いを解説させていただきます。これから展開を行いたいコンテンツがどちらを使えば要望にマッチするのか意識しながら確認してみてください。  </p><h2 id="実行タイミングの違い"><a href="#実行タイミングの違い" class="headerlink" title="実行タイミングの違い"></a>実行タイミングの違い</h2><p>パッケージとアプリケーションとで実行タイミングに大きな違いがありますのでそれぞれ解説させていただきます。  </p><p>※ なお、これから解説を行う実行タイミングは <strong>「必須」展開を前提</strong> としております。<br>「利用可能」展開の場合には、展開後のクライアント端末上のソフトウェア センターからのユーザー操作により実行されます。  </p><h3 id="パッケージの実行タイミング"><a href="#パッケージの実行タイミング" class="headerlink" title="パッケージの実行タイミング"></a>パッケージの実行タイミング</h3><p>パッケージでは明確に実行のタイミングを指定することができます。<br>「何時何分に実行したい」などの要件が明確な場合にはパッケージの使用を検討しましょう。  </p><p><img src="/blog/mecm/20220608_02/20220608_02_01.png" alt="image.png"></p><p>また、任意の間隔で繰り返し実行を設定することも可能です。<br>「繰り返しパターン」では月、週、時間単位で繰り返し実行をスケジュールすることができるので、「月末に実行させたい」や「毎週金曜日に実行させたい」、「6 時間おきに実行させたい」など様々なパターンを設定可能です。  </p><p><img src="/blog/mecm/20220608_02/20220608_02_02.png" alt="image.png"></p><h3 id="アプリケーションの実行タイミング"><a href="#アプリケーションの実行タイミング" class="headerlink" title="アプリケーションの実行タイミング"></a>アプリケーションの実行タイミング</h3><p>アプリケーションではパッケージのような特定のタイミングで実行、繰り返し実行を設定することはできません。  </p><p>アプリケーションではインストール可能となる日時と、インストールの期限を設定します。<br>クライアントがアプリケーションが展開されたことを検知すると設定されたインストール可能日時とインストール期限の間でランダムにインストール日時をスケジュールします。  </p><p>なお、展開後すぐに実行させたい場合には、[アプリケーションが使用可能になる日時を指定する] のチェックを外し、「インストール期限」= [使用可能な時間後直ちに] を指定ください。</p><p><img src="/blog/mecm/20220608_02/20220608_02_04.png" alt="image.png"></p><h2 id="再実行の動作の違い"><a href="#再実行の動作の違い" class="headerlink" title="再実行の動作の違い"></a>再実行の動作の違い</h2><p>パッケージとアプリケーションとでは、実行が失敗した際の再実行の動作が異なります。  </p><p><strong>・パッケージ → 特定の設定が必要</strong><br><strong>・アプリケーション → 設定は不要で既定で用意された機能に沿って再実行される。</strong>  </p><p>パッケージでは失敗時にのみ再実行させるためには特定の設定が必要となるのに対して、アプリケーションでは失敗後、既定で設定されているアプリケーションの評価サイクルにより再実行が促されます。  </p><h3 id="パッケージの再実行"><a href="#パッケージの再実行" class="headerlink" title="パッケージの再実行"></a>パッケージの再実行</h3><p>パッケージにおける再実行の動作には抑えておくべきポイントがございます。<br>詳細におきましては「<a href="https://jpmem.github.io/blog/mecm/20220421_01/">MECM パッケージの再実行の設定方法について解説！</a>」をご参照ください。  </p><h3 id="アプリケーションの再実行"><a href="#アプリケーションの再実行" class="headerlink" title="アプリケーションの再実行"></a>アプリケーションの再実行</h3><p>アプリケーションの再実行におきましては、下記の [ソフトウェアの展開] クライアント設定の「展開の再評価スケジュールを指定する」のスケジュールに沿って再実行が必要かどうかを決定します。  </p><p><img src="/blog/mecm/20220608_02/20220608_02_05.png" alt="image.png"></p><p>この再評価スケジュールでは、該当のアプリケーションのインストール状況を確認し、未インストールと判定（後にご紹介する検出規則を元に判定します。）された場合には、このタイミングでインストールを再実行します。  </p><h2 id="アプリケーション特有の機能"><a href="#アプリケーション特有の機能" class="headerlink" title="アプリケーション特有の機能"></a>アプリケーション特有の機能</h2><p>以降はアプリケーション特有の機能についてご紹介させていただきます。  </p><h3 id="アプリケーションのインストール条件を設定する（検出規則）"><a href="#アプリケーションのインストール条件を設定する（検出規則）" class="headerlink" title="アプリケーションのインストール条件を設定する（検出規則）"></a>アプリケーションのインストール条件を設定する（検出規則）</h3><p>アプリケーションには検出規則というインストールを実行するかどうかの判定を行う機能がございます。例えば、特定のレジストリの値を評価し、特定の値よりも小さい場合にはインストールを行う（大きい場合にはインストールをしない）などを設定することができます。なお、検出規則はアプリケーション作成時には必ず設定が必要となります。  </p><p>設定できる検出規則の種類は以下の通りです。  </p><ul><li><strong>ファイル システム</strong><br>ファイル/フォルダの有無、または更新日などを判定条件とすることができます。  </li><li><strong>レジストリ</strong><br>特定のレジストリキーの有無や値の評価を条件とすることができます。  </li><li><strong>Windows インストーラー</strong><br>msi ファイルを読み込ませることで該当のアプリケーションのインストールの有無を条件とすることができます。  </li><li><strong>カスタム スクリプト</strong><br>PowerShell などのスクリプトの実行結果により、判定させることができます。スクリプトの実行結果や、STDOUT の有無などにより、判定結果を決定します。<br>詳細については、<a href="https://docs.microsoft.com/ja-jp/mem/configmgr/apps/deploy-use/create-applications#about-custom-script-detection-methods">カスタム スクリプト検出方法について</a> を参照くださいませ。  </li></ul><p>レジストリを検出規則とした例です。<br>※ アプリケーションの [展開の種類] にて設定を行います。<br><img src="/blog/mecm/20220608_02/20220608_02_06.png" alt="image.png">  </p><h3 id="置き換え関係の構成"><a href="#置き換え関係の構成" class="headerlink" title="置き換え関係の構成"></a>置き換え関係の構成</h3><p>置き換え関係を構成することにより、アプリケーションのインストール時に指定した置き換え関係にあるアプリケーションをアンインストールしてからインストールさせることができます。なお、置き換え規則は必要に応じて設定いただくことが可能でございますので、必須の設定ではございません。  </p><p>例えば、新しいバージョンのアプリケーションをインストールさせたい場合、過去のバージョンのアプリケーションを置き換え関係として設定することで、古いバージョンをアンインストールしてから新しいバージョンのインストールを実行させることができます。  </p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>パッケージとアプリケーションの違いについて解説させていただきました。おわかりの通り、アプリケーションではパッケージにはない様々な機能を使用することができます。しかし、パッケージの方が手軽に展開を行えることもまた、ご理解いただけたかと思います。  </p><p>そのため、  </p><ul><li><p>シンプルなコマンドの実行やアプリケーションのインストールをしたい</p></li><li><p>1 度だけ実行したい</p></li><li><p>繰り返し実行したい<br>　→　<strong>パッケージ</strong>  </p></li><li><p>インストールの条件を設定したい（条件を満たさない場合には自動的にインストールを促したい）</p></li><li><p>置き換えたいアプリケーションがある<br>　→　<strong>アプリケーション</strong>  </p></li></ul><p>のように使い分けてみましょう！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;今回は MECM のパッケージとアプリケーションの違いを解説させていただきます。これから展開を行いたいコンテンツがどちらを使えば要望にマッチするのか意識しながら確認し</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>「削除の承認」が Windows 10 2004 以降 / Windows 11 のクライアントに反映されない事象について</title>
    <link href="https://jpmem.github.io/blog/wsus/2022-06-08_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2022-06-08_01/</id>
    <published>2022-06-07T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.813Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。</p><p>今回は WSUS で 「削除の承認」 を設定しても  Windows 10 2004 以降 / Windows 11 のクライアントに反映されない事象についてご紹介します。</p><p>本問題は弊社でも同様の動作になることを確認できておりますが、誠に恐縮ながら現時点で修正可否は未定です。<br>本問題について進展がありましたら、本ブログを更新する予定ですので、ご不便をおかけしますが、何卒ご理解賜りますようお願い申し上げます。</p><h1 id="事象の概要"><a href="#事象の概要" class="headerlink" title="事象の概要"></a>事象の概要</h1><p>WSUS サーバー上で更新プログラムの 「削除の承認」 を実施しても、 Windows 10 2004 以降 / Windows 11 のクライアントで更新プログラムのアンインストールが行われません。</p><h1 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h1><p>現時点で本動作の修正予定はございませんので、恐れ入りますが、更新プログラムのアンインストールについては、手動でアンインストールを実施するか、下記のようなコマンドをスタートアップ スクリプトやシャットダウン スクリプト、資産管理ソフトウェアより配布して、アンインストールを実施してください。</p><p>下記は KB5006670 をアンインストールする場合の手順です。  </p><h2 id="パッケージ-IDの確認"><a href="#パッケージ-IDの確認" class="headerlink" title="パッケージ IDの確認"></a>パッケージ IDの確認</h2><p>対象の更新プログラムがインストールされているクライアントで、以下の手順を実施し、パッケージ ID を確認します。</p><ol><li>コマンド プロンプトを管理者権限で起動します。  </li><li>下記コマンドを実行します。  </li></ol><p><code>dism /get-packages /Online</code></p><ol start="3"><li>パッケージの一覧から KB5006670 に該当するパッケージ ID を探します。<br>※ KB5006670 の OS ビルドは、19041.1288、19042.1288、および 19043.1288 に該当します。</li></ol><p>Title: 2021 年 10 月 12 日 — KB5006670 (OS ビルド 19041.1288、19042.1288、および 19043.1288)<br>URL: <a href="https://support.microsoft.com/ja-jp/topic/2021-%E5%B9%B4-10-%E6%9C%88-12-%E6%97%A5-kb5006670-os-%E3%83%93%E3%83%AB%E3%83%89-19041-1288-19042-1288-%E3%81%8A%E3%82%88%E3%81%B3-19043-1288-8902fc49-af79-4b1a-99c4-f74ca886cd95">https://support.microsoft.com/ja-jp/topic/2021-%E5%B9%B4-10-%E6%9C%88-12-%E6%97%A5-kb5006670-os-%E3%83%93%E3%83%AB%E3%83%89-19041-1288-19042-1288-%E3%81%8A%E3%82%88%E3%81%B3-19043-1288-8902fc49-af79-4b1a-99c4-f74ca886cd95</a></p><p>実行例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">パッケージ ID : Package_for_RollupFix~31bf3856ad364e35~amd64~~19041.1288.1.7　</span><br><span class="line">状態 : インストール済み</span><br><span class="line">リリースの種類 : Security Update</span><br><span class="line">インストール時刻 : 2021/10/13 8:45</span><br></pre></td></tr></table></figure><h2 id="アンインストール-コマンド実行"><a href="#アンインストール-コマンド実行" class="headerlink" title="アンインストール コマンド実行"></a>アンインストール コマンド実行</h2><p>対象の更新プログラムをアンインストールしたいクライアントで、以下の手順コマンドで対象のパッケージ ID を指定し、更新プログラムをアンインストールします。<br><code>dism /Online /remove-package /PackageName:&lt;パッケージ ID&gt;</code></p><p>（例）<br><code>dism /Online /remove-package /PackageName:Package_for_RollupFix~31bf3856ad364e35~amd64~~19041.1288.1.7　/quiet /Norestart</code></p><p>※ /quiet は、サイレントでアンインストールするオプションです。/norestart は、更新プログラムのアンインストール後、再起動されないようにするためのオプションです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は WSUS で 「削除の承認」 を設定しても  Windows 10 2004 以降 / Windows 11 のクライアントに反映されない事象についてご紹介します。&lt;/p&gt;
&lt;p&gt;本問題は弊社でも</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Azure ネットワーク接続 (ANC) のチェック時にエラーが出る際のチェックポイント（Azure AD デバイス同期編）</title>
    <link href="https://jpmem.github.io/blog/w365/2022-06-06_01/"/>
    <id>https://jpmem.github.io/blog/w365/2022-06-06_01/</id>
    <published>2022-06-05T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.733Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート 山田です。<br>本日は、Windows 365 Enterprise 環境で、Azure ネットワーク接続 (ANC) のチェック時に Azure AD デバイス同期の項目でエラーが発生する際に確認するポイントについてご紹介します。  </p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2022/6/6 時点での内容についての記載となっております。<br>今後内容が更新されることもございますので、その点ご承知置きくださいますようお願い致します。  </p><h3 id="Azure-AD-デバイス同期とは"><a href="#Azure-AD-デバイス同期とは" class="headerlink" title="Azure AD デバイス同期とは"></a>Azure AD デバイス同期とは</h3><p>ANC チェック時の一番上の項目です。  </p><p><img src="/blog/w365/2022-06-06_01/2022-06-06-17-50-13.png">  </p><p>上記項目でエラーが発生する際に見るべき点について以下にご紹介いたします。  </p><h4 id="1-ANC-の-AD-ドメイン-が正しく構成されているか"><a href="#1-ANC-の-AD-ドメイン-が正しく構成されているか" class="headerlink" title="1. ANC の [AD ドメイン] が正しく構成されているか"></a>1. ANC の [AD ドメイン] が正しく構成されているか</h4><p>a. グローバル管理者などの権限を持つアカウントで Microsoft Endpoint Manager admin center (<a href="https://aka.ms/memac">https://aka.ms/memac</a>) にログインします。<br>b. [デバイス] - [Windows 365] - [Azure ネットワーク接続] と辿り、使用している ANC を選択します。<br>c. [プロパティ] を開き、[AD ドメイン] の右にある [編集] を選択します。<br>d. 以下の各項目を入力していきます。  </p><p>AD DNS ドメイン名：contoso.com のような形式でドメイン名を入力します。<br>組織単位：クラウド PC のコンピューターオブジェクトが生成される OU を指定します。  </p><p>■例<br>OU=CloudPC,DC=contoso,DC=com  </p><p>AD ユーザー名 UPN：ドメイン参加を実行し、コンピューターオブジェクトの書き込み権限がある UPN を指定します。  </p><p>■例<br><a href="mailto:&#119;&#105;&#x6e;&#100;&#x6f;&#119;&#115;&#x33;&#x36;&#53;&#x40;&#x63;&#x6f;&#x6e;&#x74;&#x6f;&#x73;&#111;&#x2e;&#x63;&#111;&#109;">&#119;&#105;&#x6e;&#100;&#x6f;&#119;&#115;&#x33;&#x36;&#53;&#x40;&#x63;&#x6f;&#x6e;&#x74;&#x6f;&#x73;&#111;&#x2e;&#x63;&#111;&#109;</a>  </p><p>AD ドメインのパスワード：上記 UPN のパスワードを入力します。<br>AD ドメインのパスワードの確認：同じパスワードを入力します。  </p><p>e. [次へ] を選択し、ANC のチェックがすべて成功することを確認します。  </p><h4 id="2-仮想ネットワークの-DNS-サーバー指定について"><a href="#2-仮想ネットワークの-DNS-サーバー指定について" class="headerlink" title="2. 仮想ネットワークの DNS サーバー指定について"></a>2. 仮想ネットワークの DNS サーバー指定について</h4><p>以下の手順で、ご使用いただいている仮想ネットワークの DNS サーバーが、オンプレミスの DNS サーバーを指定しているか確認します。  </p><p>a. Azure Portal（<a href="https://portal.azure.com)から、windows/">https://portal.azure.com）から、Windows</a> 365 Enterprise で使用する仮想ネットワークを開きます。<br>b. [概要] 内にある [DNS サーバー] がオンプレミスの DNS サーバーの IP アドレスが入力されているか確認します。  </p><h4 id="3-ネットワーク要件について"><a href="#3-ネットワーク要件について" class="headerlink" title="3. ネットワーク要件について"></a>3. ネットワーク要件について</h4><p>ご使用いただいている仮想ネットワークが VPN や Proxy などを使用している場合、ネットワーク構成を見直す必要がございます。<br>具体的には、仮想ネットワークから以下の公開情報に記載されているエンドポイント URL に直接アクセスできるように構成していただき、再度 ANC チェックに成功するかご確認ください。  </p><p><a href="https://docs.microsoft.com/ja-jp/windows-365/enterprise/requirements-network#allow-network-connectivity">ネットワーク要件</a>  </p><p>以上、Azure AD デバイス同期時のエラー解消の参考になれば幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート 山田です。&lt;br&gt;本日は、Windows 365 Enterprise 環境で、Azure ネットワーク接続 (ANC) のチェック時に Azure AD デバイス同期の項目でエラーが発生</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>WSUS の仕組み ダウンロード編</title>
    <link href="https://jpmem.github.io/blog/wsus/2022-06-06_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2022-06-06_01/</id>
    <published>2022-06-05T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.797Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。</p><p>今回は、WSUS の仕組みについて、少し掘り下げてご紹介していきたいと思います。<br>WSUS は更新プログラムをクライアントへ配信できる機能であることはご存じの方も多いかと思いますが、どのような過程を経て更新プログラムがクライアントに取得されるかご存じでしょうか。<br>仕組みの理解やトラブルシューティング時にもお役立ていただけるとなっておりますのでぜひご一読ください！</p><h1 id="WSUS-の仕組み"><a href="#WSUS-の仕組み" class="headerlink" title="WSUS の仕組み"></a>WSUS の仕組み</h1><p>WSUS からクライアントが更新プログラムを取得するまでの流れ配下の通りです。（既定動作）</p><ol><li>WSUS 同期</li><li>更新プログラムの承認</li><li>クライアントが承認情報を取得</li></ol><p>解説</p><ol><li><p>WSUS 同期<br> WSUS は、更新プログラムを同期させる際に、カタログ情報と呼ばれるメタデータをダウンロードします。<br> この時、更新プログラムのコンテンツ ファイルと呼ばれる実体ファイルはダウンロードしません。<br> このカタログ情報は実体となるコンテンツファイルよりもファイルサイズは小さいものとなり、カタログ情報は WSUS データベース (SUSDB) に格納されます。<br><img src="/blog/wsus/2022-06-06_01/2022-06-06_01_6.png"></p><p>また、このカタログ情報は、アップストリーム サーバーがインターネットになっている場合には、Microsoft Update からダウンロードされます。<br> 一方、アップストリーム WSUS が指定されている場合は、アップストリーム WSUS からダウンロードされます。<br> アップストリームサーバーは、 WSUS コンソールにて以下より設定いただけます。<br>[オプション] &gt; [更新元及びプロキシサーバー]<br> <img src="/blog/wsus/2022-06-06_01/2022-06-06_01_12.png"></p></li><li><p>更新プログラムの承認<br>2-1.承認作業を実施することにより、 WSUS データベースの承認情報が変更されます。<br> <img src="/blog/wsus/2022-06-06_01/2022-06-06_01_13.png"><br> <img src="/blog/wsus/2022-06-06_01/2022-06-06_01_14.png"><br>2-2. WSUS にて承認作業が行われることによって、更新プログラムのコンテンツ ファイルのダウンロードが開始されます。<br>このとき、更新プログラムの実体となるコンテンツ ファイルが WsusContent フォルダーにダウンロードされます。<br><img src="/blog/wsus/2022-06-06_01/2022-06-06_01_7.png"></p></li><li><p>クライアントが承認情報を取得<br>クライアントは、（ランダム時間を含む）既定で約 22 時間毎に WindowsUpdate の自動更新を実行し、 WSUS へスキャン処理を実施します。自らに必要な更新プログラムが承認されていた場合には、その情報をもとに、自動更新の構成ポリシーの設定に従って適用作業を実施します。<br><img src="/blog/wsus/2022-06-06_01/2022-06-06_01_8.png"></p></li></ol><h1 id="補足情報"><a href="#補足情報" class="headerlink" title="補足情報"></a>補足情報</h1><h2 id="WSUS-サーバー上のコンテンツ-ファイルの有無を確認"><a href="#WSUS-サーバー上のコンテンツ-ファイルの有無を確認" class="headerlink" title="WSUS サーバー上のコンテンツ ファイルの有無を確認"></a>WSUS サーバー上のコンテンツ ファイルの有無を確認</h2><p>1． WSUS コンソールで対象の更新プログラムを右クリックし「 ファイル情報 」を参照します。<br><img src="/blog/wsus/2022-06-06_01/2022-06-06_01_1.png"><br>2．更新プログラムの URI が表示されています。これが更新プログラムの実体ファイルの格納先になります。<br><img src="/blog/wsus/2022-06-06_01/2022-06-06_01_2.png"><br>3． WSUS サーバーのエクスプローラーから「 WsusContent 」フォルダーを開きます。<br> 　 2 ケタの英数字で名づけられたフォルダーが複数存在しますので、手順 2 で確認したファイルパス内に記載されているフォルダーをたどっていきます。<br> <img src="/blog/wsus/2022-06-06_01/2022-06-06_01_3.png"><br>4．フォルダー内に格納されているファイルが存在するかを確認します。<br> <img src="/blog/wsus/2022-06-06_01/2022-06-06_01_4.png"></p><p>5． WSUS コンソール上では [更新プログラム] の表示にて、ファイルの状態列を追加し、コンテンツ ファイルのダウンロード状況を確認いただけます。<br>カラムを右クリックし、” ファイルの状態 “　を列に追加します。<br><img src="/blog/wsus/2022-06-06_01/2022-06-06_01_9.png"><br>“ ファイルの状態 “ 列のアイコンで「ダウンロード中」や、「インストール準備完了」(コンテンツ ファイルのダウンロードが完了したことを示す) になっているかを確認できます。<br><img src="/blog/wsus/2022-06-06_01/2022-06-06_01_10.png"><br><img src="/blog/wsus/2022-06-06_01/2022-06-06_01_11.png"></p><h2 id="コンテンツ-ファイルの削除方法"><a href="#コンテンツ-ファイルの削除方法" class="headerlink" title="コンテンツ ファイルの削除方法"></a>コンテンツ ファイルの削除方法</h2><p>1.承認済みの更新プログラムの拒否済みへ変更します。<br>2.クリーンナップウィザードの “不要な更新ファイル” を実施しますと拒否済みとした更新プログラムのコンテンツ ファイルがサーバーから削除されます。<br><img src="/blog/wsus/2022-06-06_01/2022-06-06_01_5.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は、WSUS の仕組みについて、少し掘り下げてご紹介していきたいと思います。&lt;br&gt;WSUS は更新プログラムをクライアントへ配信できる機能であることはご存じの方も多いかと思いますが、どのような過程を</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>MEM における共同管理のよくある質問 (FAQ) とトラブルシューティング</title>
    <link href="https://jpmem.github.io/blog/mecm/20220529_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20220529_01/</id>
    <published>2022-05-28T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.689Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>本日は、Microsoft Endpoint Manager　(MEM) が提供する共同管理 のよくある質問 (FAQ)、およびよくあるトラブルシューティング方法についてご案内いたします。なお、本記事は随時アップデートされる予定です。</p><h2 id="よくある質問-FAQ"><a href="#よくある質問-FAQ" class="headerlink" title="よくある質問 (FAQ)"></a>よくある質問 (FAQ)</h2><h3 id="共同管理の利用条件"><a href="#共同管理の利用条件" class="headerlink" title="共同管理の利用条件"></a>共同管理の利用条件</h3><h4 id="Intune-と-MECM-の組み合わせ以外で共同管理は構成できるか"><a href="#Intune-と-MECM-の組み合わせ以外で共同管理は構成できるか" class="headerlink" title="Intune と MECM の組み合わせ以外で共同管理は構成できるか"></a>Intune と MECM の組み合わせ以外で共同管理は構成できるか</h4><p>大変申し訳ございませんが、他ベンダー様の製品と弊社製品での組み合わせにおける共同管理は構成できません。なお、他社 MDM 製品と MECM クライアントが同居している状態は以下でご案内している「共存」状態となりますのでご留意ください。</p><p>Configuration Manager (CM) における共存状態について<br><a href="https://jpmem.github.io/blog/mecm/20211214_01/">https://jpmem.github.io/blog/mecm/20211214_01/</a></p><h4 id="Azure-AD-Registered-状態のデバイスは共同管理できないのか"><a href="#Azure-AD-Registered-状態のデバイスは共同管理できないのか" class="headerlink" title="Azure AD Registered 状態のデバイスは共同管理できないのか"></a>Azure AD Registered 状態のデバイスは共同管理できないのか</h4><p>共同管理状態にできません。Azure AD Joined 状態もしくは Hybrid Azure AD Joined 状態にできるようにしてください。</p><h4 id="共同管理における-MECM-サーバーと-Intune-の接続条件は"><a href="#共同管理における-MECM-サーバーと-Intune-の接続条件は" class="headerlink" title="共同管理における MECM サーバーと Intune の接続条件は"></a>共同管理における MECM サーバーと Intune の接続条件は</h4><p>共同管理において、MECM サーバーは Intune と接続できる必要はございません。管理対象のクライアントがそれぞれ MECM サーバー、 Intune に接続できるようにしてください。その他のインターネット アクセス要件は以下をご確認ください。</p><p>インターネット アクセス要件<br><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/network/internet-endpoints">https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/network/internet-endpoints</a></p><h4 id="共同管理において、クラウド管理ゲートウェイ-CMG-の利用は必須か"><a href="#共同管理において、クラウド管理ゲートウェイ-CMG-の利用は必須か" class="headerlink" title="共同管理において、クラウド管理ゲートウェイ (CMG) の利用は必須か"></a>共同管理において、クラウド管理ゲートウェイ (CMG) の利用は必須か</h4><p>お客様のご利用要件によっては必須ではございません。以下のようなケースでは CMG が必要となってまいりますのでご検討ください。</p><ol><li>イントラネットでのキッティングを行わないため、インターネット経由で MECM サーバーに登録する必要がある。(AutoPilot の利用ケースなど)</li><li>長期出張などで長期間イントラネット内の MECM サーバーに接続出来ない期間がある</li></ol><h3 id="Intune-画面"><a href="#Intune-画面" class="headerlink" title="Intune 画面"></a>Intune 画面</h3><h4 id="特に共同管理設定を実施していないのに-Intune-上のデバイス一覧にて「管理者」項目が「共同管理」になった。"><a href="#特に共同管理設定を実施していないのに-Intune-上のデバイス一覧にて「管理者」項目が「共同管理」になった。" class="headerlink" title="特に共同管理設定を実施していないのに Intune 上のデバイス一覧にて「管理者」項目が「共同管理」になった。"></a>特に共同管理設定を実施していないのに Intune 上のデバイス一覧にて「管理者」項目が「共同管理」になった。</h4><p>以下の画面の状況かと存じます。  </p><p><img src="/blog/mecm/20220529_01/20220529_01_01.png" alt="image.png">  </p><p>2022 年 5 月現在、Intune クライアントは自身の端末に MECM クライアントが存在するのを検出すると、実際には共同管理状態になっていなくても、該当の項目を「共同管理」に切り替えてしまいます。 正しく共同管理状態にするには MECM コンソール上にて共同管理構成設定をする必要がございますので、ご理解くださいますようお願いいたします。共同管理の設定方法については以下ブログ記事をご参照ください。</p><p>Configuration Manager における共同管理機能について<br><a href="https://jpmem.github.io/blog/mecm/20220321_01/">https://jpmem.github.io/blog/mecm/20220321_01/</a></p><h4 id="共同管理設定後、Intune-上のデバイスの「管理者」項目が「ConfigMgr」となった。"><a href="#共同管理設定後、Intune-上のデバイスの「管理者」項目が「ConfigMgr」となった。" class="headerlink" title="共同管理設定後、Intune 上のデバイスの「管理者」項目が「ConfigMgr」となった。"></a>共同管理設定後、Intune 上のデバイスの「管理者」項目が「ConfigMgr」となった。</h4><p>以下の画面の状況かと存じます。  </p><p><img src="/blog/mecm/20220529_01/20220529_01_02.png" alt="image.png">  </p><p>上記は、共同管理状態ではなく、MECM コンソールの以下の設定により、MECM クライアントのみがインストールされているデバイスの識別情報がアップロードされている状態です。</p><ul><li>[MECM コンソール] - [管理] - [概要] - [クラウド サービス] - [クラウドの接続] - [プロパティ] - [アップロードを構成する]<ul><li>[Microsoft エンドポイント マネージャー管理センターにアップロードする] が有効化されている</li></ul></li></ul><p><img src="/blog/mecm/20220529_01/20220529_01_03.png" alt="image.png">  </p><p>本アップロードは「テナント アタッチ」機能のために行われ、テナント アタッチ機能は MECM コンソールで実施していた幾つかの作業を、代わりに Intune (MEM 管理センター)の画面を通して行うための機能です。共同管理とは直接は関係のない機能となりますのでご承知おきください。テナント アタッチについては以下を参照ください。</p><p>テナントのアタッチ ドキュメント<br><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/tenant-attach/">https://docs.microsoft.com/ja-jp/mem/configmgr/tenant-attach/</a></p><h3 id="共同管理にしたくない"><a href="#共同管理にしたくない" class="headerlink" title="共同管理にしたくない"></a>共同管理にしたくない</h3><h4 id="都合上、共同管理構成に出来ないのだが、デバイスにIntune-クライアントと-MECM-クライアントがインストールされている。この状態で継続利用可能か"><a href="#都合上、共同管理構成に出来ないのだが、デバイスにIntune-クライアントと-MECM-クライアントがインストールされている。この状態で継続利用可能か" class="headerlink" title="都合上、共同管理構成に出来ないのだが、デバイスにIntune クライアントと MECM クライアントがインストールされている。この状態で継続利用可能か"></a>都合上、共同管理構成に出来ないのだが、デバイスにIntune クライアントと MECM クライアントがインストールされている。この状態で継続利用可能か</h4><p>恐れ入りますが、 共同管理構成されていない、Intune クライアントと MECM クライアントの同居状態は 2022 年5 月時点では非サポートとなります。必ず共同管理構成にするか、出来ない場合はどちらかのクライアントをアンインストールくださいますようお願いいたします。</p><h4 id="MECM-で管理しているデバイス全てを共同管理構成にはしたくない"><a href="#MECM-で管理しているデバイス全てを共同管理構成にはしたくない" class="headerlink" title="MECM で管理しているデバイス全てを共同管理構成にはしたくない"></a>MECM で管理しているデバイス全てを共同管理構成にはしたくない</h4><p>パイロット コレクションをご利用ください。パイロット コレクションを利用することにより、MECM で管理している一部の端末のみ、ワークロードを Intune に寄せることが可能です。なお、ワークロードごとに設定するコレクションを変更することも可能です。なお、恐れながらパイロット コレクションに指定できるコレクションは各ワークロードごとに 1 つだけとなることにご留意ください。</p><h2 id="トラブルシューティング"><a href="#トラブルシューティング" class="headerlink" title="トラブルシューティング"></a>トラブルシューティング</h2><h3 id="共同管理状態にならない"><a href="#共同管理状態にならない" class="headerlink" title="共同管理状態にならない"></a>共同管理状態にならない</h3><p>共同管理状態にならない理由は大凡以下となります。</p><ol><li>クライアントが共同管理構成ポリシーを入手できない</li><li>クライアントが Hybrid Azure AD Join / Azure AD Join できない</li><li>クライアントが Intune に登録できない</li><li>クライアントに他社 MDM 製品がインストールされている </li></ol><h4 id="クライアントが-共同管理構成ポリシーを入手できない"><a href="#クライアントが-共同管理構成ポリシーを入手できない" class="headerlink" title="クライアントが 共同管理構成ポリシーを入手できない"></a>クライアントが 共同管理構成ポリシーを入手できない</h4><p>MECM のコントロールパネルアプレットを開いたとき、「構成」タブで「CoMgmtSettings～」の項目が無い場合、クライアントが MECM サーバー (管理ポイント) と接続できていない場合が多くございます。この場合、管理ポイントとの接続状況をご確認ください。ClientLocation.log, CcmMessaging.log , DataTransferService.log 等が参考になるかと存じます。</p><p><img src="/blog/mecm/20220529_01/20220529_01_04.png" alt="image.png">  </p><p>また、パイロット　コレクションに設定したのに、上記画面で「CoMgmtSettingsPilot～」の項目が無い場合、クライアントが該当のコレクションに所属していないことが考えられます。コレクションの参加条件をご確認ください。</p><h4 id="クライアントが-Hybrid-Azure-AD-Join-Azure-AD-Join-できない"><a href="#クライアントが-Hybrid-Azure-AD-Join-Azure-AD-Join-できない" class="headerlink" title="クライアントが Hybrid Azure AD Join / Azure AD Join できない"></a>クライアントが Hybrid Azure AD Join / Azure AD Join できない</h4><p>Hybrid Azure AD Join の状態は下記でご案内しております dsregcmd /status コマンドで確認できます。</p><p>Azure AD Join 状態の調査<br><a href="https://jpmem.github.io/memlog/general/azuread/dsregcmd-status.html">https://jpmem.github.io/memlog/general/azuread/dsregcmd-status.html</a></p><p>よくある事例は、以下の通りでございます。</p><ul><li>Proxy を介さないと Azure AD に到達できないため、AzureAdPRT の項が YES となっていない。この場合は、WinHTTP プロキシを設定する必要がございます。設定しても Proxy が Azure AD に到達できない場合は、到達できるように設定する必要がございます。ネットワークが頻繁に変わる場合は WPAD の採用をご検討ください。</li><li>Azure AD connect の同期が終わってない。この場合は同期が終わるまで待つ必要がございます。</li><li>Azure AD Registered の状態になっている。この場合は 一度 Registered 状態を解除する必要がございます。</li></ul><h4 id="クライアントが-Intune-に登録できない"><a href="#クライアントが-Intune-に登録できない" class="headerlink" title="クライアントが Intune に登録できない"></a>クライアントが Intune に登録できない</h4><p>Intune への接続が出来ない等の理由で登録が失敗している場合がございます。以下でご案内している Intune のインターネットアクセス要件をご確認ください。<br>また、この他 Intune 側の登録ポリシー等で制限されている場合もございますので、ご確認ください。</p><p>Microsoft Intune のネットワーク エンドポイント<br><a href="https://docs.microsoft.com/ja-jp/mem/intune/fundamentals/intune-endpoints">https://docs.microsoft.com/ja-jp/mem/intune/fundamentals/intune-endpoints</a></p><h4 id="クライアントに他社-MDM-製品がインストールされている"><a href="#クライアントに他社-MDM-製品がインストールされている" class="headerlink" title="クライアントに他社 MDM 製品がインストールされている"></a>クライアントに他社 MDM 製品がインストールされている</h4><p>クライアントに他社 MDM 製品がインストールされている場合、共同構成ではなく、共存状態となります。この場合、他社 MDM 製品をアンインストールする必要がございますので、ご理解賜りますようお願いいたします。MECM の CoManagementHandler.log に以下の出力があると、共存状態と判定されていると確認できます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This device is enrolled to an unexpected vendor, it will be set in co-existence mode</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;本日は、Microsoft Endpoint Manager　(MEM) が提供する共同管理 のよくある質問 (FAQ)、およびよくあるトラブルシューティング方法につ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="共同管理" scheme="https://jpmem.github.io/blog/tags/%E5%85%B1%E5%90%8C%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>WSUS コンソールが全く開かなくなってしまった！ WsusPool の停止とは</title>
    <link href="https://jpmem.github.io/blog/wsus/2022-05-23_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2022-05-23_01/</id>
    <published>2022-05-22T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.797Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。 WSUS サポート チームです。<br>今回は、 WSUS コンソールが全く開かず、以下のような接続エラーがでてしまっているときにご一読いただきたい WsusPoolの停止 についてご紹介します。<br><img src="/blog/wsus/2022-05-23_01/2022-05-23_01_1.png">   </p><h1 id="WSUS-コンソールが全く開かなくなってしまった！"><a href="#WSUS-コンソールが全く開かなくなってしまった！" class="headerlink" title="WSUS コンソールが全く開かなくなってしまった！"></a>WSUS コンソールが全く開かなくなってしまった！</h1><p>WSUS は、 IIS の WsusPool を介してデータベースへアクセスする仕組みになっています。<br>WsusPool は、IIS のアプリケーション プールであり、IIS のワーカープロセス (w3wp.exe) として動作しますので、以下のように IIS マネージャーから WsusPool の動作状況を確認できます。<br><img src="/blog/wsus/2022-05-23_01/2022-05-23_01_2.png"> </p><p>その為、 Windows Internal Database や SQL Server などデータベース サービスが動作しているにも関わらず、 WSUS コンソールが全く開かず上記のような接続エラーとなってしまう場合には、WsusPool が停止しデータベースへアクセスできない状態となっている可能性が考えられるのです。  </p><h1 id="WsusPool-の停止とは"><a href="#WsusPool-の停止とは" class="headerlink" title="WsusPool の停止とは"></a>WsusPool の停止とは</h1><p>なぜ WsusPool が停止していると考えられるでしょうか。<br>これは、IIS の保護機能により WsusPool が停止した可能性があるからです。  </p><p>WsusPool のメモリ上限値であるプライベート メモリ制限値に達した場合、リサイクルを実行しメモリを解放する動作が起こります。このリサイクルの処理が短期間に頻繁に発生すると、 IIS のラピッド フェール保護と呼ばれる機能が働き、WsusPool を停止させるのです。  </p><p>ラピッド フェール保護の機能解説としては以下の公開情報をご参照ください。<br><a href="https://jpdsi.github.io/blog/web-apps/Rapid-Fail-Protection/">ラピッド フェール保護機能について</a>  </p><p>その為、 WsusPool のメモリ上限値であるプライベート メモリ制限値に達してリサイクルが頻発する状態を改善することで、ラピッド フェール保護による WsusPool が停止する事象を防ぐことができます。</p><h1 id="発生要因"><a href="#発生要因" class="headerlink" title="発生要因"></a>発生要因</h1><p>WsusPool のメモリ上限値であるプライベート メモリ制限値に達してしまう主な要因はなにか。<br>それは主に以下の2点です。<br>1．WsusPool のチューニングが実施されていない<br>2．クライアントのスキャン対象となる更新プログラムが多い  </p><h1 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h1><p>上記の要因を解消するためには、以下の対処により改善が見込めます。    </p><h2 id="1．WsusPool-のチューニング"><a href="#1．WsusPool-のチューニング" class="headerlink" title="1．WsusPool のチューニング"></a>1．WsusPool のチューニング</h2><p>WsusPool のチューニングを実施することにより、WsusPool が使用可能なプライベート メモリ上限が引き上げられる上、ラピッドフェール保護の発生条件を緩和できますので、ラピッド フェール保護の発生による WsusPool の停止を抑止することができます。<br>実施内容については、以下の公開記事にてご紹介しておりますのでご参照ください。<br> <a href="https://jpmem.github.io/blog/wsus/2022-05-09_01/#A-IIS-%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0%E8%A8%AD%E5%AE%9A">IIS チューニング設定</a>  </p><h2 id="2．クライアントのスキャン対象となる更新プログラムの削減"><a href="#2．クライアントのスキャン対象となる更新プログラムの削減" class="headerlink" title="2．クライアントのスキャン対象となる更新プログラムの削減"></a>2．クライアントのスキャン対象となる更新プログラムの削減</h2><p>クライアントは WSUS 同様に IIS を介してデータベースへアクセスし更新プログラムのスキャン処理を行っています。<br>スキャン処理は、WSUS が保持する更新プログラムの情報（メタ データ）が参照され、メタ データをメモリ領域に展開するために必要なメモリ領域の確保とデータのメモリへのコピーが繰り返される為、 WsusPool のメモリ使用量を高める大きな要因となることが事例より判っております。</p><p>クライアントのスキャン処理の対象は、状態が “未承認” 及び “承認済み” の更新プログラムです。<br>“拒否済み” 状態の更新プログラムはスキャン処理の対象外であり、上記のようなメタ データへのメモリへのコピーは行われません。<br>このため、状態を “拒否済み” へ変更いただくことにより、スキャン対象から外すことができ、WsusPool のメモリ使用量を抑えることができます。<br>実施内容ついては、以下の公開記事にてご紹介しておりますのでご参照ください。<br><a href="https://jpmem.github.io/blog/wsus/2017-12-11_01/">不要な更新プログラムは「拒否済み」に設定しよう！</a>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。 WSUS サポート チームです。&lt;br&gt;今回は、 WSUS コンソールが全く開かず、以下のような接続エラーがでてしまっているときにご一読いただきたい WsusPoolの停止 についてご紹介します。&lt;br&gt;&lt;img src=&quot;/blog/wsus/20</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>クラウド管理ゲートウェイ (CMG) の監視と運用</title>
    <link href="https://jpmem.github.io/blog/mecm/20220522_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20220522_01/</id>
    <published>2022-05-21T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.685Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>本日は、クラウド管理ゲートウェイ (CMG) の監視と運用についてご案内させていただきます。CMG は クラウド上の PaaS 形式で提供されるサービスのため、必要な監視・運用作業は非常に少ないものとなっております。</p><h2 id="CMG-の監視"><a href="#CMG-の監視" class="headerlink" title="CMG の監視"></a>CMG の監視</h2><p>下記 Docs でご案内しております。CMG では CPU やメモリ使用量の監視は必要なく、主にトラフィック、コンテンツ、ログ状態を監視することになります。</p><p>CMG を監視する<br><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/cmg/monitor-clients-cloud-management-gateway">https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/cmg/monitor-clients-cloud-management-gateway</a></p><h3 id="トラフィック監視"><a href="#トラフィック監視" class="headerlink" title="トラフィック監視"></a>トラフィック監視</h3><p>Docs でご案内している通り、以下にて CMG のトラフィック状態を監視できます。</p><p>[CM コンソール] - [管理] - [概要] - [クラウド サービス] - [クラウド管理ゲートウェイ] - 該当の CMG を選択 - 画面下部「接続ポイント」タブ</p><p><img src="/blog/mecm/20220522_01/20220522_01_01.png" alt="image.png"></p><h3 id="ストレージ監視"><a href="#ストレージ監視" class="headerlink" title="ストレージ監視"></a>ストレージ監視</h3><p>CMG の項目表示列を右クリックから追加することで CMG のストレージ利用量や、CMG からクライアントにコンテンツがダウンロードされた量 を確認できます。</p><p><img src="/blog/mecm/20220522_01/20220522_01_02.png" alt="image.png"></p><h3 id="ログ監視"><a href="#ログ監視" class="headerlink" title="ログ監視"></a>ログ監視</h3><p>こちらも Docs にある通りですが、CMG 自体の動作ログは 5 分周期で Azure ストレージから最上位サイトサーバーの Logs フォルダーに同期される仕組みとなっております。</p><p>ログを監視する<br><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/cmg/monitor-clients-cloud-management-gateway#monitor-logs">https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/cmg/monitor-clients-cloud-management-gateway#monitor-logs</a></p><h3 id="クラウド管理ダッシュボード"><a href="#クラウド管理ダッシュボード" class="headerlink" title="クラウド管理ダッシュボード"></a>クラウド管理ダッシュボード</h3><p>Docsにもありますが以下に形で Azure AD 統計の後に CMG 関連の統計ダッシュボードを開けますのでご活用ください。CMG からの接続状況の確認にご活用できるかと存じます。</p><p>[監視] - [概要] - [クラウド管理]<br><img src="/blog/mecm/20220522_01/20220522_01_03.png" alt="image.png"></p><h2 id="CMG-の運用"><a href="#CMG-の運用" class="headerlink" title="CMG の運用"></a>CMG の運用</h2><p>CMG に必要な運用作業は以下となります。なお、下記の作業はすべて Azure ポータルからではなく、CM コンソールから実行ください。</p><ol><li>CMG の起動</li><li>CMG の停止</li><li>CMG と構成情報の同期</li><li>CMG サーバー証明書の更新</li><li>Azure AD アプリケーション秘密鍵の更新</li></ol><h3 id="CMG-の起動"><a href="#CMG-の起動" class="headerlink" title="CMG の起動"></a>CMG の起動</h3><p>以下を実行してください。  </p><p>[CM コンソール] - [管理] - [概要] - [クラウド サービス] - [クラウド管理ゲートウェイ] - 該当の CMG を選択 - [サービスの開始]</p><p><img src="/blog/mecm/20220522_01/20220522_01_06.png" alt="image.png"></p><p>実行すると ステータスの項目が「開始中」 -&gt; 「準備完了」と遷移します。</p><p><img src="/blog/mecm/20220522_01/20220522_01_07.png" alt="image.png"></p><h3 id="CMG-の停止"><a href="#CMG-の停止" class="headerlink" title="CMG の停止"></a>CMG の停止</h3><p>以下を実行してください。  </p><p>[CM コンソール] - [管理] - [概要] - [クラウド サービス] - [クラウド管理ゲートウェイ] - 該当の CMG を選択 - [サービスの停止]  </p><p><img src="/blog/mecm/20220522_01/20220522_01_04.png" alt="image.png"></p><p>実行すると ステータスの項目が「停止中」 -&gt; 「停止」と遷移します。  </p><p><img src="/blog/mecm/20220522_01/20220522_01_05.png" alt="image.png"></p><h3 id="CMG-と構成情報の同期"><a href="#CMG-と構成情報の同期" class="headerlink" title="CMG と構成情報の同期"></a>CMG と構成情報の同期</h3><p>接続するクラウド管理ゲートウェイサービス接続ポイントや管理ポイント等の設定変更等が行われると、構成情報の同期が必要となります。その際は以下を実行してください。  </p><p><img src="/blog/mecm/20220522_01/20220522_01_08.png" alt="image.png"></p><p>実行すると、ステータスの項目が「アップグレードしています」 -&gt; 「準備完了」と遷移後、ステータスの説明に「構成の更新が完了しました」と表示されます。</p><p><img src="/blog/mecm/20220522_01/20220522_01_09.png" alt="image.png"></p><h3 id="CMG-サーバー証明書の更新"><a href="#CMG-サーバー証明書の更新" class="headerlink" title="CMG サーバー証明書の更新"></a>CMG サーバー証明書の更新</h3><p>CMG のサーバー証明書の有効期限が切れる前に、サーバー証明書を更新ください。サーバー証明書のサブジェクト名、サブジェクト代替名の内容は変更せずに更新ください。</p><ol><li>[CM コンソール] - [管理] - [概要] - [クラウド サービス] - [クラウド管理ゲートウェイ] - [プロパティ] - [設定]タブ へ遷移します。</li><li>[参照]ボタンをクリックします。  </li></ol><p><img src="/blog/mecm/20220522_01/20220522_01_10.png" alt="image.png"></p><ol start="3"><li>更新したサーバー証明書を指定します。</li><li>指定した証明書ファイルが選択されていることを確認します。</li></ol><p><img src="/blog/mecm/20220522_01/20220522_01_11.png" alt="image.png">  </p><ol start="5"><li>ダイアログ右下の「適用」、「OK」ボタンをクリックします。</li><li>CMG のステータスが「準備完了」になれば終了です。</li></ol><h3 id="Azure-AD-アプリケーション秘密鍵の更新"><a href="#Azure-AD-アプリケーション秘密鍵の更新" class="headerlink" title="Azure AD アプリケーション秘密鍵の更新"></a>Azure AD アプリケーション秘密鍵の更新</h3><p>Azure AD アプリケーション秘密鍵の期限が切れる前に更新します。本秘密鍵は、MECM サーバーが Azure リソースとの通信の際に使われる秘密鍵になります。<strong>期限切れしてしまうと、 MECM サーバーが Azure リソースと通信できなくなるためご注意ください。 期限が切れてしまうと Azure AD アプリケーションの再作成、及び CMG の再構築が必要になってしまいます。</strong></p><p>なお、作業に該当の Azure AD のグローバル管理者権限が必要となりますので、事前に準備ください。</p><ol><li>[CMコンソール] - [管理] - [概要] - [クラウド サービス] - [Azure Active Directory テナント] - 利用しているテナントを選択 - 画面下部「アプリケーション」から 利用している Web アプリケーションを選択  </li></ol><p><img src="/blog/mecm/20220522_01/20220522_01_12.png" alt="image.png">  </p><ol start="2"><li>「秘密鍵を更新する」をクリックする。  </li></ol><p><img src="/blog/mecm/20220522_01/20220522_01_13.png" alt="image.png">  </p><ol start="3"><li>Azure AD 認証が求められたら、利用しているテナントのグローバル管理者権限でログインする。</li><li>ログイン後、以下のダイアログが表示されたら 「OK」をクリックする。　　</li></ol><p><img src="/blog/mecm/20220522_01/20220522_01_14.png" alt="image.png">  </p><ol start="5"><li>CM コンソールの画面を更新し、秘密キーの有効期限 (UTC) が更新されていることを確認する。</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;本日は、クラウド管理ゲートウェイ (CMG) の監視と運用についてご案内させていただきます。CMG は クラウド上の PaaS 形式で提供されるサービスのため、必要な</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="CMG" scheme="https://jpmem.github.io/blog/tags/CMG/"/>
    
  </entry>
  
  <entry>
    <title>MECM 環境下のクライアントにおける [更新プログラムのチェック] の動作について</title>
    <link href="https://jpmem.github.io/blog/mecm/20220520_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20220520_01/</id>
    <published>2022-05-19T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.685Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>今回は Microsoft Endpoint Configuration Manager (以下 MECM) 環境下において、クライアント側で [Windows の設定] - [Windows Update] - [更新とセキュリティ] - [更新プログラムのチェック] をクリックした際の動作についてご紹介いたします。</p><p><img src="/blog/mecm/20220520_01/1.png"></p><h1 id="MECM-環境下のクライアントで、-更新プログラムのチェック-をクリックすると、MECM-から展開した更新プログラムを受け取れるの？"><a href="#MECM-環境下のクライアントで、-更新プログラムのチェック-をクリックすると、MECM-から展開した更新プログラムを受け取れるの？" class="headerlink" title="MECM 環境下のクライアントで、[更新プログラムのチェック] をクリックすると、MECM から展開した更新プログラムを受け取れるの？"></a>MECM 環境下のクライアントで、[更新プログラムのチェック] をクリックすると、MECM から展開した更新プログラムを受け取れるの？</h1><p>いいえ。受け取れません。<br>Windows の更新とセキュリティでの [更新プログラムのチェック] のクリックしますと、クライアントが ソフトウェア更新ポイントの役割が追加されたサーバーにインストールした WSUS に対し WSUS コンソールで承認された更新プログラムの有無を確認する動作となります。<br>MECM 環境下においては、WSUS で承認を行わないため [更新プログラムのチェック] をクリックしても MECM からの展開を検出せず、更新プログラムはダウンロードされません。<br>その為、MECM クライアント コンソール で各サイクルの実行にて展開を受け取る操作を行う事が、MECM からの展開を受け取れているのかを確認する正しい方法となります。</p><p>展開を受け取るための MECM クライアント コンソールでの各サイクルの実行につきましては、以下ブログをご参考にしてくださいませ。<br>Title : Configuration Manager で、できる限り早く更新プログラムを適用する方法について<br>URL : <a href="https://jpmem.github.io/blog/mecm/20180619_01/">https://jpmem.github.io/blog/mecm/20180619_01/</a></p><h1 id="更新プログラムのチェック-と-MECM-クライアント-コンソールでの各サイクルの実行の動作の違いについて"><a href="#更新プログラムのチェック-と-MECM-クライアント-コンソールでの各サイクルの実行の動作の違いについて" class="headerlink" title="[更新プログラムのチェック] と MECM クライアント コンソールでの各サイクルの実行の動作の違いについて"></a>[更新プログラムのチェック] と MECM クライアント コンソールでの各サイクルの実行の動作の違いについて</h1><p>Windows の更新とセキュリティでの [更新プログラムのチェック] を実行した際の動作と MECM クライアントが展開された更新プログラムを受け取る場合の動作は異なるものでありますため、その差異を補足いたします。</p><p>クライアント側で Windows の更新とセキュリティでの「更新プログラムのチェック」を実行した際の動作としましては、OS の Update Orchestrator というサービスが Windows Update Agent (WUA) に要求を出し、 WSUS の承認情報を取得しにいきます。<br>その為、MECM 環境下においては、WSUS で承認を行わないため、[更新プログラムのチェック]をクリックしても MECM からの展開を検出せず、「最新です」と表示される動作になります。</p><p>一方、MECM から展開された更新プログラムを受け取る場合の動作としましては、以下の流れとなります。</p><ol><li>CcmExec (MECM クライアントのプロセス) が Windows Update Agent (WUA) に要求を出し、ソフトウェアの更新ポイント サーバー (WSUS サーバー) に対してスキャンを行い、更新プログラムの要否を判断します。</li><li>CcmExec が [コンピューター ポリシーの取得および評価サイクル] を実行するタイミングで MECM サーバーから更新プログラムの展開情報を受信します。</li><li>スキャンの結果「必要」と判断した更新プログラムが展開されている場合、展開設定に応じてダウンロード、インストールを行います。</li></ol><p>その為、MECM から展開されている更新プログラムが、すべて適用されているかの確認につきましては、Windows の更新とセキュリティでの [更新プログラムのチェック] ではなく、 MECM クライアント コンソールで、<a href="https://jpmem.github.io/blog/mecm/20180619_01/">上述の公開情報</a>に記載の各サイクルの実行にて展開を受け取る操作をご実施後、ダウンロードされてくる更新プログラムの有無によりご確認いただく事が可能でございます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は Microsoft Endpoint Configuration Manager (以下 MECM) 環境下において、クライアント側で [Windows の設定]</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager で削除された機能について</title>
    <link href="https://jpmem.github.io/blog/mecm/20220519_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20220519_01/</id>
    <published>2022-05-18T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.685Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>Configuration Manager では バージョン アップにより、新機能の実装や、機能の修正が行われておりますが、機能の削除も行われております。<br>今回は、Configuration Manager で削除された機能について、弊社公開情報を基に整理いたしましたのでご紹介いたします。</p><p>※ 本記事は バージョン 2203 (Microsoft Endpoint Configuration Manager 2203) までの情報を整理し、作成いたしました。<br>　 今後、削除予定の機能 (推奨されない機能) の一覧 ならびに 最新情報につきましては、以下の弊社公開情報をご参照くださいますよう、お願いいたします。</p><p>(本記事のベースとなる弊社公開情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/deprecated/removed-and-deprecated-cmfeatures">Configuration Managerの削除および非推奨の機能</a></p><hr><h2 id="バージョン-2203-Microsoft-Endpoint-Configuration-Manager-2203"><a href="#バージョン-2203-Microsoft-Endpoint-Configuration-Manager-2203" class="headerlink" title="バージョン 2203 (Microsoft Endpoint Configuration Manager 2203)"></a>バージョン 2203 (Microsoft Endpoint Configuration Manager 2203)</h2><h3 id="クラウド管理ゲートウェイ-CMG"><a href="#クラウド管理ゲートウェイ-CMG" class="headerlink" title="クラウド管理ゲートウェイ (CMG)"></a>クラウド管理ゲートウェイ (CMG)</h3><ul><li>クラウド管理ゲートウェイ (CMG) を クラウド サービス (クラシック) としてデプロイする機能<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/cmg/plan-cloud-management-gateway#virtual-machine-scale-sets">Configuration Managerで CMG を計画する - 仮想マシン スケール セット</a></li></ul></li></ul><h2 id="バージョン-2111-Microsoft-Endpoint-Configuration-Manager-2111"><a href="#バージョン-2111-Microsoft-Endpoint-Configuration-Manager-2111" class="headerlink" title="バージョン 2111 (Microsoft Endpoint Configuration Manager 2111)"></a>バージョン 2111 (Microsoft Endpoint Configuration Manager 2111)</h2><h3 id="その他"><a href="#その他" class="headerlink" title="その他"></a>その他</h3><ul><li>Microsoft .NET Framework バージョン 4.6.1 以前のバージョンを使用した Configuration Manager ライブラリに依存するサード パーティ製アドオン<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/get-started/2021/technical-preview-2109#bkmk_dotnetsdk">Configuration Manager テクニカル プレビュー バージョン 2109 の機能 - 外部依存関係には .NET 4.6.2 が必要</a></li></ul></li></ul><h2 id="バージョン-2107-Microsoft-Endpoint-Configuration-Manager-2107"><a href="#バージョン-2107-Microsoft-Endpoint-Configuration-Manager-2107" class="headerlink" title="バージョン 2107 (Microsoft Endpoint Configuration Manager 2107)"></a>バージョン 2107 (Microsoft Endpoint Configuration Manager 2107)</h2><h3 id="Azure-連携"><a href="#Azure-連携" class="headerlink" title="Azure 連携"></a>Azure 連携</h3><ul><li>Azure Monitor 用 Log Analytics コネクタ<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/logs/collect-sccm">Configuration Manager を Azure Monitor に接続する</a></li></ul></li></ul><h2 id="バージョン-2103-Microsoft-Endpoint-Configuration-Manager-2103"><a href="#バージョン-2103-Microsoft-Endpoint-Configuration-Manager-2103" class="headerlink" title="バージョン 2103 (Microsoft Endpoint Configuration Manager 2103)"></a>バージョン 2103 (Microsoft Endpoint Configuration Manager 2103)</h2><h3 id="ツール"><a href="#ツール" class="headerlink" title="ツール"></a>ツール</h3><ul><li>コレクション評価ビューアー<ul><li>(参考情報 1) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/support/ceviewer">Collection Evaluation Viewer</a></li><li>(参考情報 2) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/collections/collection-evaluation-view">コレクション評価の表示方法</a></li></ul></li></ul><h2 id="バージョン-1910-Microsoft-Endpoint-Configuration-Manager-1910"><a href="#バージョン-1910-Microsoft-Endpoint-Configuration-Manager-1910" class="headerlink" title="バージョン 1910 (Microsoft Endpoint Configuration Manager 1910)"></a>バージョン 1910 (Microsoft Endpoint Configuration Manager 1910)</h2><h3 id="コンプライアンス設定"><a href="#コンプライアンス設定" class="headerlink" title="コンプライアンス設定"></a>コンプライアンス設定</h3><ul><li>デバイス正常性構成証明の評価</li><li>Windows Hello for Business 設定における証明書ベース認証<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/protect/deploy-use/windows-hello-for-business-settings#configure-a-profile">Configuration Manager の Windows Hello for Business設定 - プロファイルを構成する</a></li></ul></li></ul><h3 id="アプリケーション-カタログ"><a href="#アプリケーション-カタログ" class="headerlink" title="アプリケーション カタログ"></a>アプリケーション カタログ</h3><ul><li>アプリケーション カタログの役割 および サイト システムの役割<br>(アプリケーション カタログ Web サイト ポイントと Web サービス ポイント)<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/apps/plan-design/plan-for-and-configure-application-management#remove-the-application-catalog">Configuration Manager でアプリケーション管理を計画および構成する - アプリケーション カタログを削除する</a></li></ul></li></ul><h3 id="クライアント"><a href="#クライアント" class="headerlink" title="クライアント"></a>クライアント</h3><ul><li>Configuration Manager ポータル サイト アプリ (Windows Phone 向けのアプリ)</li></ul><h2 id="バージョン-1810-System-Center-Configuration-Manager-1810"><a href="#バージョン-1810-System-Center-Configuration-Manager-1810" class="headerlink" title="バージョン 1810 (System Center Configuration Manager 1810)"></a>バージョン 1810 (System Center Configuration Manager 1810)</h2><h3 id="コンプライアンス設定-1"><a href="#コンプライアンス設定-1" class="headerlink" title="コンプライアンス設定"></a>コンプライアンス設定</h3><ul><li>セキュリティ コンテンツ オートメーション プロトコル (SCAP) 拡張機能<ul><li>(参考情報) <a href="https://www.microsoft.com/en-us/download/details.aspx?id=48741">Download Center - SCAP Extensions for System Center Configuration Manager</a></li></ul></li></ul><h2 id="バージョン-1806-System-Center-Configuration-Manager-1806"><a href="#バージョン-1806-System-Center-Configuration-Manager-1806" class="headerlink" title="バージョン 1806 (System Center Configuration Manager 1806)"></a>バージョン 1806 (System Center Configuration Manager 1806)</h2><h3 id="アプリケーション-カタログ-1"><a href="#アプリケーション-カタログ-1" class="headerlink" title="アプリケーション カタログ"></a>アプリケーション カタログ</h3><ul><li>アプリケーション カタログ Web サイト ポイントの Silverlight ユーザー エクスペリエンス<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/apps/plan-design/plan-for-and-configure-application-management#remove-the-application-catalog">Configuration Manager でアプリケーション管理を計画および構成する - アプリケーション カタログを削除する</a></li></ul></li></ul><h2 id="バージョン-1802-System-Center-Configuration-Manager-1802"><a href="#バージョン-1802-System-Center-Configuration-Manager-1802" class="headerlink" title="バージョン 1802 (System Center Configuration Manager 1802)"></a>バージョン 1802 (System Center Configuration Manager 1802)</h2><h3 id="ソフトウェア-センター"><a href="#ソフトウェア-センター" class="headerlink" title="ソフトウェア センター"></a>ソフトウェア センター</h3><ul><li>以前のバージョンのソフトウェア センター<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/apps/plan-design/plan-for-software-center">ソフトウェア センターの計画</a></li></ul></li></ul><h2 id="バージョン-1710-System-Center-Configuration-Manager-1710"><a href="#バージョン-1710-System-Center-Configuration-Manager-1710" class="headerlink" title="バージョン 1710 (System Center Configuration Manager 1710)"></a>バージョン 1710 (System Center Configuration Manager 1710)</h2><h3 id="タスク-シーケンス"><a href="#タスク-シーケンス" class="headerlink" title="タスク シーケンス"></a>タスク シーケンス</h3><ul><li>Configuration Manager 管理コンソール上での仮想ハード ディスク (VHD) の管理</li><li>ダイナミック ディスクへの変換・展開ツールのインストール</li></ul><h2 id="バージョン-1702-System-Center-Configuration-Manager-1702"><a href="#バージョン-1702-System-Center-Configuration-Manager-1702" class="headerlink" title="バージョン 1702 (System Center Configuration Manager 1702)"></a>バージョン 1702 (System Center Configuration Manager 1702)</h2><h3 id="ソフトウェア更新ポイント"><a href="#ソフトウェア更新ポイント" class="headerlink" title="ソフトウェア更新ポイント"></a>ソフトウェア更新ポイント</h3><ul><li>ネットワーク負荷分散 (NLB) クラスターを使用したソフトウェア更新ポイント<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/configure/high-availability-options#redundancy-for-important-site-system-roles">Configuration Manager の高可用性オプション - 重要なサイト システムの役割の冗長性</a></li></ul></li></ul><h2 id="バージョン-1606-System-Center-Configuration-Manager-1606"><a href="#バージョン-1606-System-Center-Configuration-Manager-1606" class="headerlink" title="バージョン 1606 (System Center Configuration Manager 1606)"></a>バージョン 1606 (System Center Configuration Manager 1606)</h2><h3 id="タスク-シーケンス-1"><a href="#タスク-シーケンス-1" class="headerlink" title="タスク シーケンス"></a>タスク シーケンス</h3><ul><li>変数: OSDPreserveDriveLetter<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/osd/understand/task-sequence-variables#osdpreservedriveletter">タスク シーケンス変数 - 非推奨の変数</a></li></ul></li></ul><h2 id="バージョン-1511-System-Center-Configuration-Manager-1511"><a href="#バージョン-1511-System-Center-Configuration-Manager-1511" class="headerlink" title="バージョン 1511 (System Center Configuration Manager 1511)"></a>バージョン 1511 (System Center Configuration Manager 1511)</h2><h3 id="その他-1"><a href="#その他-1" class="headerlink" title="その他"></a>その他</h3><ul><li>ネットワーク アクセス保護 (NAP)<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/deprecated/removed-and-deprecated-cmfeatures#network-access-protection">Configuration Managerの削除および非推奨の機能 - ネットワーク アクセス保護</a></li></ul></li><li>帯域外管理<ul><li>(参考情報) <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/deprecated/removed-and-deprecated-cmfeatures#out-of-band-management">Configuration Managerの削除および非推奨の機能 - 帯域外管理</a></li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;Configuration Manager では バージョン アップにより、新機能の実装や、機能の修正が行われておりますが、機能の削除も行われております。&lt;br&gt;今回</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>WSUS でクライアントが正常に認識されない SusClientID の重複とは</title>
    <link href="https://jpmem.github.io/blog/wsus/2022-05-18_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2022-05-18_01/</id>
    <published>2022-05-17T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.797Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。 WSUS サポート チームです。<br>WSUS サーバーに正常にアクセス可能な状態のソース PC からインストールイメージを作成し、ほかの PC にイメージを展開して建てた端末について、 WSUS 　サーバー側へ接続した際に、クライアントが表示されたりされなかったりといったように正常に認識されなくなる事象が発生することがございます。<br>今回はそのような事象がなぜ起こるのか対処方法を含めご紹介していきたいと思います。</p><h1 id="SusClientID-の重複とは"><a href="#SusClientID-の重複とは" class="headerlink" title="SusClientID の重複とは"></a>SusClientID の重複とは</h1><p>WSUS サーバーはクライアントを SusClientID という一意の ID で識別しています。<br>この SusClientID は、sysprep /generalize コマンドを実行し一般化することでリセットされますが、sysprep /generalize コマンドを実行をしていないマスターイメージをもとに複製した場合、同じ SusClientID を持つ端末が複製されて、SusClientID の重複が発生します。<br>そのため、ホスト名などが異なる場合にも SusClientID が重複しておりますと同じクライアントとして認識し、クライアントが正常に認識されない事象が発生いたします。</p><p>SusClientID は以下のレジストリキーにその値が格納されています。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate</span><br></pre></td></tr></table></figure><p>重複している場合は、以下の手順にて SusClientId を削除いただきますと、SusClientId は自動生成され重複状態が解消します。</p><p>手順</p><ol><li>問題のクライアントに管理者権限を持つユーザーでログオンし、コマンド プロンプトを「管理者として実行」にて起動します。</li><li>管理者として実行にて起動したコマンド プロンプトで、下記コマンドでサービスを停止します。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net stop usosvc</span><br><span class="line">net stop wuauserv</span><br></pre></td></tr></table></figure><ol start="3"><li>“regedit” コマンドでレジストリエディタを起動し、下記サブキーの中に存在するエントリをすべて削除します。</li></ol><p>・サブキー；<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate]</p><p>・削除するエントリ：（一部は存在しない場合もあります。クライアントのバージョンや使用経緯により異なります）<br>PingID<br>AccountDomainSid<br>SusClientId<br>SusClientIdValidation</p><ol start="4"><li>管理者として実行にて起動したコマンド プロンプトで、下記コマンドでサービスを開始します。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net start usosvc</span><br><span class="line">net start wuauserv</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。 WSUS サポート チームです。&lt;br&gt;WSUS サーバーに正常にアクセス可能な状態のソース PC からインストールイメージを作成し、ほかの PC にイメージを展開して建てた端末について、 WSUS 　サーバー側へ接続した際に、クライアントが表示され</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>クラウド PC で日本語入力ができない場合のチェック項目について</title>
    <link href="https://jpmem.github.io/blog/w365/2022-05-13_01/"/>
    <id>https://jpmem.github.io/blog/w365/2022-05-13_01/</id>
    <published>2022-05-12T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.729Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は、Windows 365 のクラウド PC で、日本語入力ができない場合のチェック項目ついてご紹介します。<br>言語を日本語にしているにも関わらず、メモ帳や Edge の検索欄に英語しか入力ができない際にご確認いただければ幸いです。  </p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2022/5/13 時点での内容についての記載となっております。<br>今後内容が更新されることもございますので、その点ご承知置きくださいますようお願い致します。</p><h3 id="A-言語が日本語になっているか"><a href="#A-言語が日本語になっているか" class="headerlink" title="A. 言語が日本語になっているか"></a>A. 言語が日本語になっているか</h3><p>そもそも言語とキーボードの設定が日本語になっているか確認します。  </p><ol><li>スタートメニューから [設定] を選択し、[時刻と言語] を選択します。  </li><li>[言語] を選択し、Windows の表示言語が日本語になっているか確認します。  </li><li>[優先する言語] 欄から日本語を選択し、[オプション] を選択します。<br><img src="/blog/w365/2022-05-13_01/2022-05-13-08-57-14.png">  </li><li>[ハードウェア キーボード レイアウト] が “日本語キーボード（106/109 キー）” になっているか確認します。 “英語キーボード（101/102 キー）” になっている場合は日本語に変更し、再起動を実施します。<br><img src="/blog/w365/2022-05-13_01/2022-05-13-09-00-13.png">  </li><li>再起動後、メモ帳などで日本語が入力できるか確認します。  </li></ol><h3 id="B-代替キーボード-レイアウトが有効化になっているか"><a href="#B-代替キーボード-レイアウトが有効化になっているか" class="headerlink" title="B. 代替キーボード レイアウトが有効化になっているか"></a>B. 代替キーボード レイアウトが有効化になっているか</h3><p>こちらはブラウザーからアクセスしている場合にチェックする項目です。そのため、リモート デスクトップ接続している場合は後述の [C. Touch Keyboard and Handwriting Panel Service が有効になっているか] の項目をご確認ください。  </p><ol><li>画面右上の歯車マークから [セッション中] を選択します。<br><img src="/blog/w365/2022-05-13_01/2022-05-13-09-07-00.png">  </li><li>[代替キーボード レイアウトの有効化] を有効にし、[リモート キーボード レイアウトの選択] を “日本語キーボード（106/109 キー）” に設定し、Update を選択します。<br><img src="/blog/w365/2022-05-13_01/2022-05-13-09-26-57.png">  </li><li>一度セッションを切断する必要があるので、[現在] を選択した状態で Continue を選択します。<br><img src="/blog/w365/2022-05-13_01/2022-05-13-09-11-04.png">  </li><li>クラウド PC に再接続後、日本語が入力できるか確認します。    </li></ol><h3 id="C-Touch-Keyboard-and-Handwriting-Panel-Service-が有効になっているか"><a href="#C-Touch-Keyboard-and-Handwriting-Panel-Service-が有効になっているか" class="headerlink" title="C. Touch Keyboard and Handwriting Panel Service が有効になっているか"></a>C. Touch Keyboard and Handwriting Panel Service が有効になっているか</h3><p>Touch Keyboard and Handwriting Panel Service は日本語入力をはじめとして、様々な入力機能に使われているサービスです。このサービスが無効化されているとそれらの機能が正しく動作できません。<br>以下の手順で Touch Keyboard and Handwriting Panel Service が有効になっているかご確認いただき、無効になっている場合は有効としていただくようお願いいたします。  </p><ol><li>スタートボタンを右クリックし、[ファイル名を指定して実行] を選択します。  </li><li>services.msc と入力し、[OK] を選択します。  </li><li>Touch Keyboard and Handwriting Panel Service をダブルクリックします。  </li><li>[スタートアップの種類] が [無効] になっていれば、[自動] または [手動] に変更し、[OK] を選択します。  </li><li>クラウド PC を再起動し、Touch Keyboard and Handwriting Panel Service が実行中となっていることを確認します。<br><img src="/blog/w365/2022-05-13_01/2022-05-13-10-07-14.png">  </li><li>メモ帳などで日本語が入力できるか確認します。  </li></ol><p>以上、日本語入力ができない場合のチェック項目ついてご紹介させていただきましたので、参考になれば幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は、Windows 365 のクラウド PC で、日本語入力ができない場合のチェック項目ついてご紹介します。&lt;br&gt;言語を日本語にしているにも関わらず、メモ帳や E</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>ccmcache フォルダー配下のキャッシュ クリア方法</title>
    <link href="https://jpmem.github.io/blog/mecm/20220511_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20220511_01/</id>
    <published>2022-05-10T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.685Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>Configuration Manager を利用したアプリケーションや更新プログラムの配布運用をされているなかで、管理対象クライアントに対して過去配布したコンテンツを一括で削除されたいと思われたことはございませんか？<br>また、クライアント設定で指定したクライアント キャッシュのサイズを超過していることがあると不思議に思われたことはありませんか？<br>今回は、クライアント キャッシュの動作と管理対象デバイスへ配布したコンテンツをサーバーから一括で削除する方法についてご紹介させていただきます。</p><p>管理対象デバイスにコンテンツ（アプリケーション、パッケージや更新プログラム　など）を展開すると、管理対象デバイスはクライアント キャッシュ（ccmcache フォルダー）にコンテンツのダウンロードを行います。<br>クライアント キャッシュは、指定されたキャッシュ サイズまでコンテンツのダウンロードし保存します。<br>次に、新しいコンテンツをダウンロードする際に、指定されたキャッシュ サイズ（累積）を超えるコンテンツのダウンロードを行う場合は、新しいコンテンツをクライアント キャッシュ内にダウンロードを行うための領域を確保するのに、古いコンテンツを自動で削除してからダウンロードを行います。<br>ここまでが基本動作となりますが、ソフトウェア更新プログラム機能で配布した更新プログラムはクライアント キャッシュのサイズに関係なくダウンロードするため、指定したクライアント キャッシュのサイズを超過することが起きます。</p><p>実際にコンテンツのダウンロードが行われる際のコンテンツ情報（サイズ）を見てみましょう。<br>確認するログは、管理対象デバイスに生成される ”CAS.log” となります。</p><ul><li>パッケージを展開した場合</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**** Received request for content PS10001B.2, size(KB) 1048848, under context System with priority Low, persist duration 0</span><br><span class="line">CacheManager: ADD new cache entry &#123;93CCFA37-5CC3-4E6E-A99A-21B120F10276&#125; for content PS10001B.2, Size : 1048848K, RefCount : 1, LastRef Minutes : 0, State : ACTIVE, PersistDuration : 0, Location : C:\Windows\ccmcache\1.</span><br></pre></td></tr></table></figure><ul><li>アプリケーションを展開した場合</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**** Received request for content Content_8e82e01e-98fc-47c7-9f41-7f13b78e93a6.1, size(KB) 5532, under context System with priority Medium, persist duration 0</span><br><span class="line">CacheManager: ADD new cache entry &#123;611DEEB6-C117-4998-92AB-D996C28E2C49&#125; for content Content_8e82e01e-98fc-47c7-9f41-7f13b78e93a6.1, Size : 5532K, RefCount : 1, LastRef Minutes : 0, State : ACTIVE, PersistDuration : 0, Location : C:\Windows\ccmcache\2.</span><br></pre></td></tr></table></figure><ul><li>機能更新プログラムを展開した場合</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**** Received request for content 627d1aed-c707-4b2f-8dc5-5ce588ef8308.1, size(KB) 0, under context System with priority Medium, persist duration 0</span><br><span class="line">CacheManager: ADD new cache entry &#123;160D2012-B37D-4AE1-B3B2-B4C94CF24E80&#125; for content 627d1aed-c707-4b2f-8dc5-5ce588ef8308.1, Size : 3749136K, RefCount : 1, LastRef Minutes : 0, State : ACTIVE, PersistDuration : 0, Location : C:\Windows\ccmcache\1.</span><br></pre></td></tr></table></figure><p>  ※「627d1aed-c707-4b2f-8dc5-5ce588ef8308」は、Windows 10 バージョン 21H2 の機能更新プログラムの ID となります。</p><ul><li>累積更新プログラムを展開した場合</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**** Received request for content 9f8e1ae1-c800-4603-aa6d-378d65ba48f4.1, size(KB) 0, under context System with priority Medium, persist duration 0</span><br><span class="line">CacheManager: ADD new cache entry &#123;9CD3EEA7-DFD7-4EC2-ACB6-6A39972DDBF1&#125; for content 9f8e1ae1-c800-4603-aa6d-378d65ba48f4.1, Size : 655018K, RefCount : 1, LastRef Minutes : 0, State : ACTIVE, PersistDuration : 0, Location : C:\Windows\ccmcache\7.</span><br></pre></td></tr></table></figure><p>  ※「9f8e1ae1-c800-4603-aa6d-378d65ba48f4」は、2022-03 x64 ベース システム用 Windows 10 Version 21H1 の累積更新プログラム (KB5011487) の ID となります。</p><p>ご覧のとおり、パッケージとアプリケーションのデータ サイズは展開するデータ サイズと同一のデータ サイズでリクエストを受け取りますが、一方で機能更新プログラムおよび累積更新プログラムのデータ サイズは数百 MB や数 GB の実際のデータ サイズではなく、0KB としてリクエストを受け取っていることが確認できます。</p><h1 id="クライアント-キャッシュのクリア方法"><a href="#クライアント-キャッシュのクリア方法" class="headerlink" title="クライアント キャッシュのクリア方法"></a>クライアント キャッシュのクリア方法</h1><p>通常、クライアント キャッシュのクリアする場合、管理対象デバイス上で [コントロールパネル] にございます [Configuration Manager] の [キャッシュ] タブより、個別にキャッシュのクリアが必要となります。<br>しかしながら、こちらは管理者権限を持ち合わせたアカウントでないと実行いただけなく、また、ご利用者様にてご実施いただく必要があります。</p><p>以下にご案内する PowerShell スクリプトを実行することにより、管理対象デバイス上にて [Configuration Manager] でキャッシュのクリアを行わずに、ダウンロードしたコンテンツを削除いただけます。</p><h2 id="ccmcache-フォルダー内すべて削除"><a href="#ccmcache-フォルダー内すべて削除" class="headerlink" title="ccmcache フォルダー内すべて削除"></a>ccmcache フォルダー内すべて削除</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$UIResourceMgr</span> = <span class="built_in">New-Object</span> <span class="literal">-Com</span> <span class="string">&quot;UIResource.UIResourceMgr&quot;</span></span><br><span class="line"><span class="variable">$Cache</span> = <span class="variable">$UIResourceMgr</span>.GetCacheInfo()</span><br><span class="line"><span class="variable">$Cache</span>.GetCacheElements() | % &#123;<span class="variable">$Cache</span>.DeleteCacheElement(<span class="variable">$_</span>.CacheElementID)&#125;</span><br></pre></td></tr></table></figure><h2 id="ソフトウェア更新プログラムのみすべて削除"><a href="#ソフトウェア更新プログラムのみすべて削除" class="headerlink" title="ソフトウェア更新プログラムのみすべて削除"></a>ソフトウェア更新プログラムのみすべて削除</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$UIResourceMgr</span> = <span class="built_in">New-Object</span> <span class="literal">-Com</span> <span class="string">&quot;UIResource.UIResourceMgr&quot;</span></span><br><span class="line"><span class="variable">$Cache</span> = <span class="variable">$UIResourceMgr</span>.GetCacheInfo()</span><br><span class="line"><span class="variable">$Cache</span>.GetCacheElements() | <span class="built_in">where-object</span> &#123;<span class="variable">$_</span>.ContentId.Length <span class="operator">-ne</span> <span class="number">8</span> <span class="operator">-and</span> <span class="variable">$_</span>.ContentId <span class="operator">-notlike</span> <span class="string">&#x27;conten*&#x27;</span>&#125; | % &#123;<span class="variable">$Cache</span>.DeleteCacheElement(<span class="variable">$_</span>.CacheElementID)&#125;</span><br></pre></td></tr></table></figure><h1 id="リモートによるクライアント-キャッシュのクリア方法"><a href="#リモートによるクライアント-キャッシュのクリア方法" class="headerlink" title="リモートによるクライアント キャッシュのクリア方法"></a>リモートによるクライアント キャッシュのクリア方法</h1><h2 id="方法-1：スクリプト機能"><a href="#方法-1：スクリプト機能" class="headerlink" title="方法 1：スクリプト機能"></a>方法 1：スクリプト機能</h2><p>MECM の標準機能であるスクリプト機能を利用して、デバイス単位、または、デバイス コレクションに登録されたデバイスに対して一括でキャッシュのクリアを実行いただけます。<br>上述でご案内している PowerShell コマンドレットを登録しておくだけで任意のタイミングで実行いただけますので是非ご活用ください。<br>なお、スクリプト機能は以下のブログにて詳細にご説明していますので、こちらをご確認ください。</p><p>Title:スクリプト機能のご紹介<br>URL:<a href="https://jpmem.github.io/blog/mecm/20211025_01/">https://jpmem.github.io/blog/mecm/20211025_01/</a></p><h2 id="方法-2：パッケージ配布"><a href="#方法-2：パッケージ配布" class="headerlink" title="方法 2：パッケージ配布"></a>方法 2：パッケージ配布</h2><p>方法の 2 つ目は PowerShell コマンドレットを PS1 形式のスクリプト ファイルにし、パッケージングして配布する方法です。<br>方法 1 のスクリプト機能とは異なり即時性はございませんが、定期的に削除するようスケジュール設定できるメリットがございます。<br>定期的にクライアント キャッシュ上のコンテンツを削除する運用を取り入れたい場合にはパッケージ配布機能をご選択ください。</p><ul><li>1）パッケージの作成</li></ul><ol><li>MECM コンソールにて、[ソフトウェア ライブラリ] - [概要] - [アプリケーション管理] - [パッケージ] を開きます。</li><li>[パッケージ] を右クリックし、[パッケージの作成] をクリックします。</li><li>[パッケージとプログラムの作成ウィザード] の [パッケージ] より、[名前] に任意の名前を入力し、[このパッケージにソース ファイルを含める] にチェックを入れます。</li><li>[ソース フォルダー] の参照ボタンをクリックし、上述にご案内している PowerShell コマンドレットの *.PS1 ファイルを、スクリプト ファイルの格納場所 (共有フォルダー パス) を指定し、[次へ] をクリックします。</li><li>[プログラムの種類] にて、[次へ] をクリックします。</li><li>[標準プログラム] にて、[名前] に任意の名前を指定し、ログオン状態に関わらずスクリプトを実行するために次のように指定します。<br>　・コマンドライン<br>　　-32bit OS の場合：powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden -File .&lt;ファイル名&gt;.ps1<br>　　-64bit OS の場合：%windir%\sysnative\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden -File .&lt;ファイル名&gt;.ps1<br>　　　　※&lt;ファイル名&gt;.ps1 の「ファイル名」には、事前に作成したスクリプト ファイルの名に変更ください。<br>　・プログラムの実行条件<br>　　ユーザーのログオン状態に関係なし<br>　・実行モード<br>　　管理者権限で実行する</li><li>[要件] より、[次へ] をクリックします。</li><li>[概要] より、設定内容を確認して、[次へ] をクリックします。</li><li>[完了] より、正常に完了したことを確認し、[閉じる] をクリックします。</li></ol><ul><li>2） パッケージの展開</li></ul><ol><li>作成したパッケージを右クリックし、[展開] をクリックします。</li><li>ソフトウェアの展開ウィザードの [全般] より、[参照] をクリックし、配布先のコレクションを指定して [次へ] をクリックします。</li><li>[コンテンツ] より、[追加] をクリックし配布ポイントを選択し、[次へ] をクリックします。</li><li>[展開設定] より、目的を “必須” に設定して、[次へ] をクリックします。</li><li>[スケジュール] より、[割り当てスケジュール] から [新規] をクリックします。</li><li>[割り当てスケジュール] より、[スケジュール] をクリックします。<br>  ※直ちに実行されたい場合は、[次のイベントの直後に割り当てる] の “直ちに” をご指定ください。</li><li>[カスタム スケジュール] ページにおいて開始時刻を設定し、繰り返しパターンを設定して [OK] をクリックします。</li><li>[割り当てスケジュール] より、[OK] をクリックします。</li><li>[スケジュール] にて、[再実行の動作] を [プログラムを常に再実行する] に設定して [次へ] をクリックします。</li><li>[ユーザー側の表示と操作] より、必要に応じて通知設定を設定し [次へ] をクリックします。</li><li>[配布ポイント] より、上段の展開オプションを [配布ポイントからプログラムを実行する] に設定し [次へ] をクリックします。</li></ol><p>※ご参考<br><img src="/blog/mecm/20220511_01/1.png" alt="image.png"><br>  注：[配布ポイントからコンテンツをダウンロードしてローカルで実行する] を選択した場合はコンテンツ実行に失敗するため、パッケージのダウンロードは行わないようにします。  </p><ol start="12"><li>[概要] より、設定内容を確認して、[次へ] をクリックします。  </li><li>[完了] より、正常に完了したことを確認し、[閉じる] をクリックします。</li></ol><p>展開完了後、クライアントが MECM とポーリングを行うと展開ポリシーをダウンロードして順次実行されますので、クライアント キャッシュ上のコンテンツが削除されるのを待ちます。</p><h2 id="応用：n-日前のコンテンツを削除"><a href="#応用：n-日前のコンテンツを削除" class="headerlink" title="応用：n 日前のコンテンツを削除"></a>応用：n 日前のコンテンツを削除</h2><p>クライアント キャッシュ上のコンテンツが一気に削除されるのは心配という場合には、以下にご紹介する PowerShell コマンドレットにて、現在の日にちより前のコンテンツを削除条件としていただくことも可能ですので、こちらのご利用もご検討ください。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$targetdate</span>=(<span class="built_in">Get-Date</span>).AddDays(<span class="literal">-xx</span>)</span><br><span class="line"><span class="variable">$UIResourceMgr</span> = <span class="built_in">New-Object</span> <span class="literal">-Com</span> <span class="string">&quot;UIResource.UIResourceMgr&quot;</span></span><br><span class="line"><span class="variable">$Cache</span> = <span class="variable">$UIResourceMgr</span>.GetCacheInfo()</span><br><span class="line"><span class="variable">$Cache</span>.GetCacheElements() | <span class="built_in">where</span> &#123;<span class="variable">$_</span>.LastReferenceTime <span class="operator">-lt</span> <span class="variable">$targetdate</span>&#125; | % &#123;<span class="variable">$Cache</span>.DeleteCacheElement(<span class="variable">$_</span>.CacheElementID)&#125;</span><br></pre></td></tr></table></figure><p>※「xx」の箇所については、現在の日時より前のコンテンツを削除する日数をご指定ください。<br>　 例えば、90 日前とする場合は、「$targetdate=(Get-Date).AddDays(-90)」とします。</p><ul><li>免責事項<br>当ブログ内でご紹介しているサンプル スクリプトは弊社環境で検証した上でご案内しておりますが、弊社にてその動作を保証するものではございません。<br>ご使用の際は、お客様の環境に合わせて変更いただき、十分にテストした上で、ご利用くださいますようお願いいたします。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;Configuration Manager を利用したアプリケーションや更新プログラムの配布運用をされているなかで、管理対象クライアントに対して過去配布したコンテンツを一</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>WSUS メンテナンスガイド新版</title>
    <link href="https://jpmem.github.io/blog/wsus/2022-05-09_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2022-05-09_01/</id>
    <published>2022-05-08T15:00:00.000Z</published>
    <updated>2022-07-21T05:52:57.793Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。 WSUS サポート チームです。<br>今回は、 WSUS でご実施いただきたいメンテナンスについてご紹介します。<br>長期運用や利用状況に従って、 WSUS のパフォーマンスは低下してしまいます。<br>WSUS を安定稼働させるためには日頃のメンテナンスが非常に重要となります為、ご利用環境での定期的な実施をご検討ください。</p><p>A. IIS チューニング設定<br>B. カスタム インデックスの追加<br>C. WSUS DB インデックスの再構成<br>D. データベースの統計情報の更新とインデックスの再構築<br>E. 不要な更新プログラムを「拒否済み」にする<br>F. WSUS のクリーンアップ ウィザード  </p><h1 id="A-IIS-チューニング設定"><a href="#A-IIS-チューニング設定" class="headerlink" title="A. IIS チューニング設定"></a>A. IIS チューニング設定</h1><p>クライアントから大量のスキャンが要求された場合に、WsusPool でメモリのリサイクルが頻発することにより、IIS の保護機能が働き WsusPool が停止するという事象が発生することがあります。その為、予め IIS のチューニング設定を実施することがお勧めです。<br>※以下の値はあくまでも参考値ですので、ご利用環境に合わせてパフォーマンスモニターなどをご利用いただきご調整ください。</p><p>具体的な手順は以下のとおりです。</p><ol><li>WSUS サーバー上で IIS マネージャーを起動します。</li><li>左ペインより、アプリケーション プールを選択し、中央ペインに表示された WsusPool を右クリックして [詳細設定] をクリックします。</li><li>以下の設定を行い、[OK] をクリックします。</li></ol><p>[(全般)] -&gt; [キューの長さ] : 2000<br>[CPU] -&gt; [制限 (%)] : 0<br>[ラピッド フェール保護] -&gt; [エラー間隔 (分)] : 30<br>[ラピッド フェール保護] -&gt; [最大エラー数] : 60<br>[リサイクル] -&gt; [プライベート メモリ制限 (KB)] : 8000000 (※)<br>[リサイクル] -&gt; [仮想メモリ制限 (KB)] : 0</p><p>(※) サーバーのメモリ搭載量が 8 GB 未満の場合は、4000000 に設定することをお勧めします。<br>搭載量が 20 GB を超える場合は、場合によって 16000000 など大きな値にしても問題ありません。</p><h1 id="B-カスタム-インデックスの追加"><a href="#B-カスタム-インデックスの追加" class="headerlink" title="B. カスタム インデックスの追加"></a>B. カスタム インデックスの追加</h1><p>データベースにカスタム インデックスを追加しておくことで、クエリパフォーマンスを向上させることができます。<br>予めカスタム インデックスを追加しておくことがお勧めです。</p><p>具体的な手順は以下のとおりです。</p><p>SUSDB データベースでカスタム インデックスを作成するために使用します。<br>これは 一度限りの作業であり、データベースのパフォーマンスを大幅に向上させることができるため、<br>実施いただくことを推奨しております。手順は以下の通りです。</p><ol><li>SQL Server Management Studio を管理者権限を持つアカウントで起動して、WSUS データベースに接続します。  </li></ol><p><img src="/blog/wsus/2022-05-09_01/2022-05-09_01_1.png">  </p><p>サーバーの種類 : データベース エンジン<br>サーバー名 :<br>Windows Internal Database をご利用の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\.\pipe\Microsoft##WID\tsql\query</span><br></pre></td></tr></table></figure><p>SQL サーバーをご利用の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">サーバー名を入力</span><br></pre></td></tr></table></figure><p>認証 : Windows 認証</p><ol start="2"><li>[新しいクエリ] をクリックし、クエリ ウィンドウに以下の SQL を入力して [実行] をクリックします。<br><img src="/blog/wsus/2022-05-09_01/2022-05-09_01_2.png">  </li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- Create custom index in tbLocalizedPropertyForRevision</span><br><span class="line">USE [SUSDB]</span><br><span class="line"></span><br><span class="line">CREATE NONCLUSTERED INDEX [nclLocalizedPropertyID] ON [dbo].[tbLocalizedPropertyForRevision]</span><br><span class="line">(</span><br><span class="line">     [LocalizedPropertyID] ASC</span><br><span class="line">)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- Create custom index in tbRevisionSupersedesUpdate</span><br><span class="line">CREATE NONCLUSTERED INDEX [nclSupercededUpdateID] ON [dbo].[tbRevisionSupersedesUpdate]</span><br><span class="line">(</span><br><span class="line">     [SupersededUpdateID] ASC</span><br><span class="line">)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]</span><br></pre></td></tr></table></figure><ol start="3"><li>SQL Server Management Studio を閉じます。  </li></ol><p>(補足) 以下のようなエラーが発生した場合には、既にカスタムインデックスが作成されていることを示します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">メッセージ 1913、レベル 16、状態 1、行 4</span><br><span class="line">&#x27;nclLocalizedPropertyID&#x27; という名前のインデックスまたは統計が既に テーブル &#x27;dbo.tbLocalizedPropertyForRevision&#x27; に存在するので、この操作に失敗しました。</span><br></pre></td></tr></table></figure><p>参考 <a href="https://docs.microsoft.com/ja-JP/troubleshoot/mem/configmgr/wsus-maintenance-guide#create-custom-indexes">カスタムインデックスを作成する</a></p><h1 id="C-WSUS-DB-インデックスの再構成"><a href="#C-WSUS-DB-インデックスの再構成" class="headerlink" title="C. WSUS DB インデックスの再構成"></a>C. WSUS DB インデックスの再構成</h1><p>運用継続に伴い、データベースが劣化しパフォーマンスが低下していきます。<br>インデックスの再構成を実施することにより、断片化比率に応じてデータベースのパフォーマンスを改善します。<br>手順については以下のブログでご紹介しておりますのでご参照ください。<br><a href="https://jpmem.github.io/blog/wsus/2014-03-05_01/">WSUS DB インデックスの再構成の手順について</a></p><h1 id="D-データベースの統計情報の更新とインデックスの再構築"><a href="#D-データベースの統計情報の更新とインデックスの再構築" class="headerlink" title="D. データベースの統計情報の更新とインデックスの再構築"></a>D. データベースの統計情報の更新とインデックスの再構築</h1><p>A. ～ C. を継続的に実施いただいているご状況でもなお、パフォーマンスの低下が見られる場合には、データベース パフォーマンスの改善を目的として、統計情報の更新クエリ (update statistics)、インデックスの再構築 (DBCC DBREINDEX) をご実施ください。<br>※ C. との内容の違いとして、C. は断片化比率に応じてインデックスの再構成を実施していることに対して、D. では全テーブル全インデックスを対象としてインデックスの再構築と統計情報の更新を行っています。  </p><ol><li>SQL Server Management Studio を管理者権限を持つアカウントで起動して、WSUS データベースに接続します。  </li></ol><p><img src="/blog/wsus/2022-05-09_01/2022-05-09_01_1.png">  </p><p>サーバーの種類 : データベース エンジン<br>サーバー名 :<br>Windows Internal Database をご利用の場合  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\.\pipe\Microsoft##WID\tsql\query</span><br></pre></td></tr></table></figure><p>SQL サーバーをご利用の場合  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">サーバー名を入力</span><br></pre></td></tr></table></figure><p>認証 : Windows 認証  </p><ol start="2"><li>[新しいクエリ] をクリックし、クエリ ウィンドウに以下の SQL を入力して [実行] をクリックします。<br><img src="/blog/wsus/2022-05-09_01/2022-05-09_01_2.png">  </li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Use SUSDB</span><br><span class="line">exec sp_msforeachtable &#x27;update statistics ? with fullscan&#x27;</span><br><span class="line">Go</span><br><span class="line"></span><br><span class="line">Use SUSDB</span><br><span class="line">Exec sp_MSForEachtable &#x27;DBCC DBREINDEX (&#x27;&#x27;?&#x27;&#x27;)&#x27;</span><br><span class="line">Go</span><br></pre></td></tr></table></figure><p>処理には数時間を要する場合がございます。完了するまでお待ちください。</p><h1 id="E-不要な更新プログラムを「拒否済み」にする"><a href="#E-不要な更新プログラムを「拒否済み」にする" class="headerlink" title="E. 不要な更新プログラムを「拒否済み」にする"></a>E. 不要な更新プログラムを「拒否済み」にする</h1><p>不要な更新プログラムを 「拒否済み」にすることで、 クライアントがスキャン処理をする対象の更新プログラムを減らすことができる為、WSUS の負荷を下げることにつながります。<br>実施内容については、以下のブログをご参照ください。</p><p><a href="https://jpmem.github.io/blog/wsus/2017-12-11_01/">不要な更新プログラムは「拒否済み」に設定しよう！</a></p><h1 id="F-WSUS-のクリーンアップ-ウィザード"><a href="#F-WSUS-のクリーンアップ-ウィザード" class="headerlink" title="F. WSUS のクリーンアップ ウィザード"></a>F. WSUS のクリーンアップ ウィザード</h1><p>WSUS の機能としてクリーンアップウィザードがございます。こちらについても定期的な実施をお勧めしております。<br>各実施内容については以下のブログでご紹介しておりますのでご参照ください。<br><a href="https://jpmem.github.io/blog/wsus/2017-12-05_01/">WSUS のクリーンアップ ウィザードについて</a></p><p>※階層構成（レプリカ）の WSUS をご利用の場合には、実施順序にご留意いただく必要がございます。<br>以下のブログをご参照ください。<br><a href="https://jpmem.github.io/blog/wsus/2012-06-07_01/">レプリカ構成では サーバー クリーンアップ ウィザード にご注意ください</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。 WSUS サポート チームです。&lt;br&gt;今回は、 WSUS でご実施いただきたいメンテナンスについてご紹介します。&lt;br&gt;長期運用や利用状況に従って、 WSUS のパフォーマンスは低下してしまいます。&lt;br&gt;WSUS を安定稼働させるためには日頃のメ</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
</feed>
