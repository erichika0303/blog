<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Microsoft Endpoint Manager Support Blog</title>
  
  <subtitle>日本マイクロソフトの Microsoft Endpoint Manager に関するサポート情報のブログです。</subtitle>
  <link href="https://jpmem.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpmem.github.io/blog/"/>
  <updated>2021-10-04T03:27:58.872Z</updated>
  <id>https://jpmem.github.io/blog/</id>
  
  <author>
    <name>Microsoft Endpoint Manager Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>重複 GUID の対処について</title>
    <link href="https://jpmem.github.io/blog/mecm/20210922_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20210922_01/</id>
    <published>2021-09-21T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.872Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>本日は、お客様をサポートする中、我々が頻繁に遭遇する「重複 GUID 問題」についてご案内させて頂きます。<br>是非、運用されている Configuration Manager (CM) について定期的にご確認いただき、System Health を良い状態に保つ一助にして頂きたく存じます。</p><h2 id="重複-GUID-問題-とは"><a href="#重複-GUID-問題-とは" class="headerlink" title="重複 GUID 問題 とは"></a>重複 GUID 問題 とは</h2><p>CM がクライアントの同定のために引き当てる、GUID “XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX” の形式の番号が、複数の端末にて重複してしまう問題です。</p><h2 id="何が問題なの"><a href="#何が問題なの" class="headerlink" title="何が問題なの?"></a>何が問題なの?</h2><p>CM がクライアントの同定を正しく行えなくなってしまうので、下記のような事象が発生します。<br>CM のほぼ全ての機能が正しく利用出来なくなってしまいます。</p><ul><li>意図しない端末に対して、アプリケーション、パッケージ、更新プログラム、タスクシーケンスの配布を行ってしまう。</li><li>収集したインベントリ情報が正しい端末に紐付かない (収集したインベントリ情報を信頼できなくなってしまう)</li></ul><h2 id="どうして問題が発生するの？"><a href="#どうして問題が発生するの？" class="headerlink" title="どうして問題が発生するの？"></a>どうして問題が発生するの？</h2><p>CM はクライアントが CM の管理ポイントに初めて接続した際に GUID を生成し、クライアント側に伝えます。そのクライアント側に伝えられた GUID は %windir%\SMSCFG.ini に保管されます。この一連の流れにより CM サーバーにクライアント情報が登録されます。クライアントは、この SMSCFG.ini に記載の GUID を利用して CM とのやりとりを行います。  </p><p>ということは、この登録作業が終わってしまっている CM のクライアントのデータを複製すると、複製元のクライアントと、複製先のクライアントにて、SMSCFG.ini もまた複製されてしまうわけですから、GUID も同じものを使ってしまいます。本当は違うクライアントでも、CM サーバーから見ると、GUID が同じなので、同じ端末と見なしてしまいます。</p><h2 id="どのような時に問題が発生するの？"><a href="#どのような時に問題が発生するの？" class="headerlink" title="どのような時に問題が発生するの？"></a>どのような時に問題が発生するの？</h2><p>CM への登録が終わってしまっている CM クライアントを複製した場合に発生します。<br>つまり、以下のような場合です。</p><ul><li>CM 登録済み OS のイメージをキャプチャして、キッティングの際のベースイメージとした場合。</li><li>CM 登録済みの仮想マシンを仮想マシンテンプレートとした場合。</li><li>CM 登録済みの仮想マシンをクローンした場合。</li><li>CM 登録済みのバックアップを他のマシンにリストアし、並行稼働した場合。</li></ul><p>特に VDI をご利用されている環境で多く発生している印象です。</p><h2 id="どのように問題を察知すれば良いの"><a href="#どのように問題を察知すれば良いの" class="headerlink" title="どのように問題を察知すれば良いの?"></a>どのように問題を察知すれば良いの?</h2><p>CM のデータベーステーブル System_HIST には CMが管理している端末についてホスト名が変わった際の履歴が残っております。このテーブルにて、MachineID と SMSID が同じなのに、ホスト名が頻繁に切り替わっているものがあった場合、GUID 重複が発生している可能性が非常に高いと判断できます。なお、本テーブルにて MachineID と SMSID が同じレコードの中で、TimeKey が最も古い端末が複製元となっている可能性が高いため、調査の参考にして頂ければと存じます。 </p><p>CM 管理者の方には本テーブル内容の確認を定期運用作業に組み込むことをお勧めいたします。</p><h2 id="どのように問題を解決すれば良いの？"><a href="#どのように問題を解決すれば良いの？" class="headerlink" title="どのように問題を解決すれば良いの？"></a>どのように問題を解決すれば良いの？</h2><p>環境の複製先と、複製元の端末にて以下の対処を実施ください。</p><h3 id="複製先端末"><a href="#複製先端末" class="headerlink" title="複製先端末"></a>複製先端末</h3><p>以下の手順で対処を実行ください。</p><ol><li>CCMExec サービスを停止します。</li><li>以下の Powershell スクリプトを実行します。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WMIObject</span> <span class="literal">-Namespace</span> root\CCMVDI <span class="literal">-Class</span> CCM_VDI_Identity_Store_Configuration <span class="literal">-Filter</span> “Name&lt;&gt;’RDV’” | <span class="built_in">Remove-WMIObject</span></span><br><span class="line"><span class="built_in">Remove-Item</span> <span class="literal">-Path</span> HKLM:\Software\Microsoft\SystemCertificates\SMS\Certificates <span class="literal">-Recurse</span> <span class="literal">-Force</span></span><br><span class="line"><span class="built_in">Remove-Item</span> <span class="literal">-Path</span> C:\Windows\SMSCFG.ini <span class="literal">-Force</span> <span class="literal">-ErrorAction</span> SilentlyContinue</span><br></pre></td></tr></table></figure></li><li>CCMExec サービスを起動します。</li></ol><h4 id="複製先端末が複数の場合の対処"><a href="#複製先端末が複数の場合の対処" class="headerlink" title="複製先端末が複数の場合の対処"></a>複製先端末が複数の場合の対処</h4><ol><li>重複している GUID を持つ端末を集めたデバイスコレクションを作成します。下記の WQL クエリをご利用ください。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span>  SMS_R_System <span class="keyword">where</span> SMS_R_System.SMSUniqueIdentifier <span class="operator">=</span> <span class="string">&#x27;[重複 GUID を起こしている GUID]&#x27;</span></span><br></pre></td></tr></table></figure></li><li>上記コレクションに対して単体対処の時に利用したPowershellをパッケージで配布します。パッケージ配布の際のコマンドは以下を指定ください。<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden -File XXXX.ps1</span><br></pre></td></tr></table></figure></li><li>パッケージを配布されたクライアントは再起動され次第、新しい GUID を順次取得します。配布対象のコレクションに所属するクライアント数が少なくなっていけば事象解消し始めていることになります。</li></ol><h3 id="複製元端末-マスターイメージ"><a href="#複製元端末-マスターイメージ" class="headerlink" title="複製元端末 (マスターイメージ)"></a>複製元端末 (マスターイメージ)</h3><ol><li>下記ブログにてご案内している手順で CM クライアントを完全アンインストールください。</li></ol><ul><li><a href="https://jpmem.github.io/blog/mecm/20190327_01/">https://jpmem.github.io/blog/mecm/20190327_01/</a></li></ul><ol start="2"><li>(Citrix VDI 端末のマスターイメージの場合) Powershellを管理者権限で開き、以下を実行ください。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WmiObject</span> <span class="literal">-Namespace</span> root\CCMVDI <span class="literal">-Class</span> CCM_VDI_Identity_Store_Configuration <span class="literal">-Filter</span> <span class="string">&quot;Name=&#x27;Citrix&#x27;&quot;</span> | <span class="built_in">Remove-WmiObject</span></span><br></pre></td></tr></table></figure></li><li>CM コンソールから、重複していた GUID を持つデバイスのレコードを削除します。</li><li>以下のマスターイメージ用の CM クライアント インストール手順を実施します。</li><li>マスターイメージを取得します。</li></ol><h4 id="マスターイメージ用-CM-クライアント-インストール手順"><a href="#マスターイメージ用-CM-クライアント-インストール手順" class="headerlink" title="マスターイメージ用 CM クライアント インストール手順"></a>マスターイメージ用 CM クライアント インストール手順</h4><h5 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h5><ul><li>SMS Agent Host サービスの停止とスタート アップの種類の変更<br>[管理ツール] - [サービス] を起動し、SMS Agent Host サービスを停止します。また、マスター イメージ採取前に自動でサービスが起動しないように、右クリックしてプロパティを開き、スタートアップの種類を [手動] に変更します。</li></ul><p>また、タスクスケジューラを開き [Microsoft] - [Configuration Manager] にある [Configuration Manager Health Evaluation] タスクを右クリックして [無効] にします。<br>これによって、SMS Agent Host サービスが自動で起動しないようになります。</p><h5 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h5><ol><li><p>以下の手順にて、サイト コードが “未割り当て” の状態でエージェントのセットアップを行います。</p><ol><li>サイト サーバーより、SCCM インストール フォルダー 配下に存在する Client フォルダーをコピーし保存します。インストール フォルダーの初期設定は以下になります。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\Program Files\Microsoft Configuration Manager\Client</span><br></pre></td></tr></table></figure></li><li>参照コンピューターにローカル管理者権限をもつユーザーでログインします。</li><li> 項番 1) でコピーした Client フォルダーを、クライアント上の任意のフォルダーに格納します。</li><li>サイト サーバーと通信できないようにするため、ネットワーク ケーブルを抜きます。</li><li>[管理者として実行] にてコマンド プロンプトを開き、cd コマンドでクライアントに格納した Client フォルダーに移動します。</li><li>以下のコマンドを実行します。<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccmsetup.exe</span><br></pre></td></tr></table></figure>※オプションなしで ccmsetup.exe を実行することにより、”未割り当て” の状態でエージェントがセットアップされます。</li><li>タスクマネージャーを起動して [プロセス] タブにて ccmsetup.exe が表示されなくなるまで待ちます。</li><li>[コントロール パネル] -&gt; [システムとセキュリティ] -&gt; [Configuration Manager] を開き、以下のようにサイト コードが “未割り当て” の状態であることを確認します。<ul><li>[コンポーネント] タブ : 「CCM 通知エージェント」以外のすべての項目が「インストール済み」であることを確認します。</li><li>※ 「CCM 通知エージェント」は「無効」になります。</li><li>[サイト] タブ : 「現在の割り当てサイト コード」が空欄であることを確認します。</li></ul></li></ol></li><li><p>SMS Agent Host サービスの停止とスタート アップの種類の変更<br>[管理ツール] - [サービス] を起動し、SMS Agent Host サービスを停止します。また、マスター イメージ採取前に自動でサービスが起動しないように、右クリックしてプロパティを開き、スタートアップの種類を [手動] に変更します。</p></li><li><p>SCCM で使用する自己署名証明書を削除する<br>以下の手順で自己署名証明書を削除します。  </p><ol><li>コマンド プロンプトを開き、”mmc” を入力して実行します。</li><li>[ファイル] - [スナップインの追加と削除] をクリックします。</li><li>左ペインから [証明書] をクリックして [追加] ボタンをクリックします。</li><li>“コンピューター アカウント” にチェックを入れて、[次へ] をクリックします。</li><li>“ローカル コンピューター” にチェックし、[完了] をクリックします。</li><li>右ペインに “証明書（ローカル コンピューター）” が追加されていることを確認し [OK] をクリックします。</li><li>左ペインにて、[証明書] - [SMS] - [証明書] を選択します。</li><li>中央ペインに表示された 2 つの “SMS” 証明書に対して、それぞれ右クリックして [削除] を選択します。<br>「選択された証明書を永久的に削除しますか?」というメッセージが表示されますので、[はい] を選択します。</li><li>[ファイル] - [終了] をクリックします。「コンソールの設定を コンソール1 に保存しますか?」というメッセージが表示されますので、[いいえ] を選択して、mmc を終了します。</li></ol></li><li><p>SCCM 独自の信頼キーと管理ポイントの証明書を削除する</p></li></ol><p>エージェントのインストール完了後に、もしネットワークに接続して、SCCM サーバー(管理ポイント サーバー) との通信が可能となった場合、参照コンピューターが、SCCM で使用する信頼キーと管理ポイントの証明書を WMI の中に保持した状態となる可能性があります。</p><p>この場合、参照コンピューターに保存されている信頼キーや管理ポイントの証明書を削除する必要があります。wbemtest より、WMI 名前空間 “root\ccm\locationservices” に接続できない場合は、SCCM サーバーと一度も接続がされていないため、問題ありません。接続できる場合は、情報を削除するため、以下の手順を実施してください。</p><p>以下の内容をサンプルとしてスクリプトを作成し、ps1 ファイルとして保存します。本スクリプトを実行することで、信頼キーや管理ポイントの証明書も削除されます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">gwmi</span> <span class="literal">-namespace</span> root\ccm\locationservices <span class="literal">-class</span> trustedrootkey | <span class="built_in">rwmi</span></span><br></pre></td></tr></table></figure><p>スクリプトを作成した後、参照コンピューターでコマンド プロンプトを “管理者として実行” にて起動し、<br>以下のコマンドを実行します。</p><p>※) C:\Temp にスクリプト DeleteTRK.ps1 を保存した場合</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Temp</span><br><span class="line">powershell.exe DeleteTRK.ps1</span><br></pre></td></tr></table></figure><p>スクリプト実行完了後、以下の手順で、正常に信頼キーや証明書が削除されたことを確認します。</p><ol><li><p>コマンド プロンプトを “管理者として実行” にて起動して wbemtest を実行し、”root\ccm\locationservices” 名前空間に接続します。</p></li><li><p>「スーパークラス名の入力」はブランクのまま、「クラスの列挙」を “再帰” を有効にして実行します。</p></li><li><p>一覧から “TrustedRootKey” を選択し、ダブルクリックして開きます。</p></li><li><p> 開いた画面で「インスタンス」をクリックします。</p></li><li><p> インスタンスが存在しないことを確認します。</p></li><li><p>SMS Agent Host サービスのスタート アップの種類の変更</p></li></ol><p>[管理ツール] - [サービス] を起動し、SMS Agent Host サービスを右クリックしてプロパティを開き、スタートアップの種類を [自動（遅延開始）] に変更します。SMS Agent Host サービスを開始しないように注意してください。<br>また、タスクスケジューラを開き [Microsoft] - [Configuration Manager] にある [Configuration Manager Health Evaluation] タスクを右クリックして [有効] にします。<br>SMS Agent Host サービスを手動で開始しないように注意してください。</p><ol start="6"><li>マスターイメージの採取<br>sysprep /generalize が実行された参照コンピューターをキャプチャして、マスター イメージを採取します。</li></ol><h2 id="どのように問題を予防すれば良いの"><a href="#どのように問題を予防すれば良いの" class="headerlink" title="どのように問題を予防すれば良いの?"></a>どのように問題を予防すれば良いの?</h2><p>恐れながら基本的に運用による予防をお願い致します。マスターイメージをキャプチャされる際は、CM に登録されないように。また、CMクライアントで管理されている実利用の端末（検証用途ではない）が仮想マシンで<br>作成されている場合、安易に仮想マシンの複製を行わないようにご対応ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;本日は、お客様をサポートする中、我々が頻繁に遭遇する「重複 GUID 問題」についてご案内させて頂きます。&lt;br&gt;是非、運用されている Configuration M</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 用にリモート デスクトップ クライアントをセットアップする手順</title>
    <link href="https://jpmem.github.io/blog/w365/2021-09-13_01/"/>
    <id>https://jpmem.github.io/blog/w365/2021-09-13_01/</id>
    <published>2021-09-12T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.880Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は、Windows 365 に接続する際に、リモート デスクトップ クライアントをセットアップする手順についてご案内します。</p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2021/9/13 時点で判明している内容についての記載となっております。今後内容が更新されることもございますので、その点ご承知置きくださいますようお願い致します。</p><h2 id="リモート-デスクトップ-クライアントを利用する理由"><a href="#リモート-デスクトップ-クライアントを利用する理由" class="headerlink" title="リモート デスクトップ クライアントを利用する理由"></a>リモート デスクトップ クライアントを利用する理由</h2><p>Windows クライアントから Windows 365 に接続するクライアントには、ブラウザのWeb クライアント、リモートデスクトップ クライアント、およびストア アプリのリモート デスクトップ クライアントがございますが、下記URLに記載の通り、各種デバイスのリダイレクション機能についてはそれぞれでサポート範囲が異なります。</p><p><a href="https://docs.microsoft.com/en-us/windows-365/manage-rdp-device-redirections#redirection-support">https://docs.microsoft.com/en-us/windows-365/manage-rdp-device-redirections#redirection-support</a></p><p>2021/9/13時点では最も制約が少ないクライアントがリモート デスクトップ クライアントとなります。<br>以下では、こちらのクライアントのことを MSRDC と呼びます。</p><p>なお、従来よりリモート デスクトップ接続用途にご利用頂いております、mstsc は Windows 365への接続が出来ません。</p><p><img src="/blog/w365/2021-09-13_01/20210913_01_01.png"></p><h2 id="リモート-デスクトップ-クライアント-MSRDC-の-URL"><a href="#リモート-デスクトップ-クライアント-MSRDC-の-URL" class="headerlink" title="リモート デスクトップ クライアント (MSRDC) の URL"></a>リモート デスクトップ クライアント (MSRDC) の URL</h2><p>下記ページにて MSRDC をご紹介しております。<br><a href="https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/remote-desktop-clients">https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/remote-desktop-clients</a></p><h2 id="リモート-デスクトップ-クライアント-MSRDC-のダウンロード"><a href="#リモート-デスクトップ-クライアント-MSRDC-のダウンロード" class="headerlink" title="リモート デスクトップ クライアント (MSRDC) のダウンロード"></a>リモート デスクトップ クライアント (MSRDC) のダウンロード</h2><p>下記ページにてご利用のPCのアーキテクチャに合ったものをダウンロードください。</p><p><a href="https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/windowsdesktop#install-the-client">https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/windowsdesktop#install-the-client</a></p><h2 id="リモート-デスクトップ-クライアント-MSRDC-のインストール"><a href="#リモート-デスクトップ-クライアント-MSRDC-のインストール" class="headerlink" title="リモート デスクトップ クライアント (MSRDC) のインストール"></a>リモート デスクトップ クライアント (MSRDC) のインストール</h2><ol><li><p>ダウンロードしたMSIファイルを開くとインストール ウィザードが開きます。「次へ」をクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_02.png"></p></li><li><p>「マイクロソフト ソフトウェア ライセンス条項」をご確認の上、「使用許諾契約書に同意します」にチェックを入れ、「次へ」をクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_03.png"></p></li><li><p>ご利用のユーザーの範囲を選択して、「インストール」をクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_04.png"></p></li><li><p>インストール画面の表示後、インストールが完了します。「完了」ボタンをクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_05.png"></p></li></ol><h2 id="リモート-デスクトップ-クライアント-MSRDC-の接続設定"><a href="#リモート-デスクトップ-クライアント-MSRDC-の接続設定" class="headerlink" title="リモート デスクトップ クライアント (MSRDC) の接続設定"></a>リモート デスクトップ クライアント (MSRDC) の接続設定</h2><ol><li><p>MSRDC を初回起動すると、下記の画面が表示されます。「URLで登録」を選択します。<br><img src="/blog/w365/2021-09-13_01/20210913_01_06.png"></p></li><li><p>下記ページで案内されているWindows 365 のサブスクライブ ページ (<a href="https://rdweb.wvd.microsoft.com/api/arm/feeddiscovery">https://rdweb.wvd.microsoft.com/api/arm/feeddiscovery</a>) を登録し、「次へ」をクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_07.png"></p></li></ol><p><a href="https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/windowsdesktop#subscribe-with-url">https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/windowsdesktop#subscribe-with-url</a></p><p><img src="/blog/w365/2021-09-13_01/20210913_01_08.png"></p><ol start="3"><li><p>認証ページが表示されるので、Windows 365 ライセンスを割り当てたアカウントで認証を行います。<br><img src="/blog/w365/2021-09-13_01/20210913_01_09.png"></p></li><li><p>登録が完了すると、ライセンスに割り当てられている Windows 365 クラウドPCが表示されます。<br><img src="/blog/w365/2021-09-13_01/20210913_01_10.png"></p></li></ol><h2 id="リモート-デスクトップ-クライアント-MSRDC-への接続"><a href="#リモート-デスクトップ-クライアント-MSRDC-への接続" class="headerlink" title="リモート デスクトップ クライアント (MSRDC)への接続"></a>リモート デスクトップ クライアント (MSRDC)への接続</h2><ol><li><p>MSRDCを起動し、表示されているクラウド PCをダブルクリックします。<br><img src="/blog/w365/2021-09-13_01/20210913_01_10.png"></p></li><li><p>クラウド PCの接続アカウント情報の入力を求められます。<br><img src="/blog/w365/2021-09-13_01/20210913_01_11.png"></p></li><li><p>認証に成功するとクラウド PCへ接続できます。<br><img src="/blog/w365/2021-09-13_01/20210913_01_12.png"></p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は、Windows 365 に接続する際に、リモート デスクトップ クライアントをセットアップする手順についてご案内します。&lt;/p&gt;
&lt;h2 id=&quot;免責事項&quot;&gt;&lt;</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 Cloud PC を日本語化する手順</title>
    <link href="https://jpmem.github.io/blog/w365/2021-08-20_01/"/>
    <id>https://jpmem.github.io/blog/w365/2021-08-20_01/</id>
    <published>2021-08-19T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.872Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。  </p><p>本日は Windows 365 でプロビジョニングした Cloud PC を日本語化する手順をご紹介します。<br>Windows 365 Enterprise の場合は、カスタム イメージを登録できますので、日本語化したイメージをプロビジョニングすれば、最初から日本語化された Cloud PC を利用できることになりますが、Windows 365 Business の場合は、カスタム イメージを使用することができず、英語版の Windows が動作する Cloud PC を利用することになります。</p><p>日本語化するための方法に関するお問い合わせも多くいただいておりますので、ここでは Windows 365 Business で用意した Cloud PC を日本語化する手順の例をご紹介します。</p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2021/8/20 時点の内容についての記載となっております。今後内容が更新されることもございますので、その点ご承知置きくださいますようお願い致します。</p><h2 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h2><ol><li><p><a href="https://windows365.microsoft.com/">https://windows365.microsoft.com</a> にアクセスし、Cloud PC を利用可能なユーザーでサインインして Cloud PC にログインします。</p></li><li><p>スタート メニューより歯車のマークを選択し、[Settings] を立ち上げます。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820150826185.png"></p></li><li><p>[Time &amp; Language] を選択します。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820150846942.png"></p></li><li><p>[Date &amp; time] の [Time zone] を “(UTC +09:00) Osaka, Sapporo, Tokyo” に設定します。</p><p><img src="/blog/w365/2021-08-20_01/image-20210827151309134.png"></p></li><li><p>[Region] を選択し、[Region] を “Japan”、[Regional format] を “Japanese (Japan)” に設定します。</p><p><img src="/blog/w365/2021-08-20_01/image-20210827151509134.png"></p></li><li><p>[Language] - [Add a language] を選択します。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820150903020.png"></p></li><li><p>“Japanese” を追加し、[Next] をクリックします。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151025805.png"></p></li><li><p>下記のように選択し、[Install] をクリックします。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151042379.png"></p></li><li><p>言語パックのインストールが開始されます。インストールが完了すると、下記のように通知されるため、[Yes, sign out now.] を選択し、一旦サインアウトします。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151101169.png"></p></li><li><p>再度 Cloud PC にサインインし、管理者として実行にて起動した PowerShell コンソールで、以下のコマンドを実行し、システム ロケールを ja-JP に変更します。  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-WinSystemLocale</span> <span class="literal">-SystemLocale</span> ja<span class="literal">-JP</span></span><br></pre></td></tr></table></figure></li><li><p>スタート メニューより歯車のマークを選択し、[設定] を立ち上げ直します。</p></li></ol><p>   <img src="/blog/w365/2021-08-20_01/image-20210820151139511.png"></p><ol start="12"><li>[時刻と言語] を選択します。</li></ol><p>   <img src="/blog/w365/2021-08-20_01/image-20210820151159119.png"></p><ol start="13"><li><p>[言語] - [日本語] を選択して [オプション] をクリックします。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151218317.png"></p></li><li><p>ハードウェア キーボード レイアウトより [レイアウトを変更する] を選択して、日本語キーボードをご利用の場合は、設定を変更して [今すぐ再起動する] を選択し、再起動を行います。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151237059.png"></p></li><li><p>再起動後に接続することで、日本語入力が出来ないか、ご確認ください。なお、IME の準備が整ってない場合、IME の切り替え時に下記のような通知が行われますため、この場合、数分程度お待ちいただけますと幸いです。</p><p><img src="/blog/w365/2021-08-20_01/image-20210820151247994.png"></p></li><li><p>ブラウザから利用する場合には、PC に接続後、下記の設定も有効化してください。</p></li></ol><p>   <img src="/blog/w365/2021-08-20_01/image-20210820151309134.png">4</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;本日は Windows 365 でプロビジョニングした Cloud PC を日本語化する手順をご紹介します。&lt;br&gt;Windows 365 Enterpri</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 FAQ</title>
    <link href="https://jpmem.github.io/blog/w365/2021-08-16_01/"/>
    <id>https://jpmem.github.io/blog/w365/2021-08-16_01/</id>
    <published>2021-08-15T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.872Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は Windows 365 のご利用においてよくお問い合わせを受ける内容に対するご回答 (FAQ) をお伝えします。</p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2021/8/16 時点で判明している内容についての記載となっております。今後内容が更新されることもございますので、その点ご承知置きくださいますようお願い致します。</p><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="Business-amp-Enterprise-共通"><a href="#Business-amp-Enterprise-共通" class="headerlink" title="Business &amp; Enterprise 共通"></a>Business &amp; Enterprise 共通</h3><h4 id="Windows-365-を試してみたいが、使用方法がわからない"><a href="#Windows-365-を試してみたいが、使用方法がわからない" class="headerlink" title="Windows 365 を試してみたいが、使用方法がわからない"></a>Windows 365 を試してみたいが、使用方法がわからない</h4><p>Business と Enterprise で構築方法が異なります。下記にまとまっておりますのでご参照ください。  </p><ul><li><a href="https://zenn.dev/takuyaot/books/507584243171c2">いまはじ！ Windows 365 - Business 編 (Zenn.dev) </a>  </li><li><a href="https://zenn.dev/takuyaot/books/60c3ced87ba86f">いまはじ！ Windows 365 - Enterprise 編 (Zenn.dev) </a>  </li></ul><h4 id="Windows-365-で-Windows-11-にアップグレードしたが、うまく動かない"><a href="#Windows-365-で-Windows-11-にアップグレードしたが、うまく動かない" class="headerlink" title="Windows 365 で Windows 11 にアップグレードしたが、うまく動かない"></a>Windows 365 で Windows 11 にアップグレードしたが、うまく動かない</h4><p>Windows 11 にご興味をお持ち頂きありがとうございます。<br>現在 Windows 11 のリリース状況は Insider Preview のため、Windows 365 クラウド PCを評価環境としてご利用されることをお考えの方も多くいらっしゃるかと存じますが、 現時点に置いて Windows 365 は Windows 11 Insider Preview をサポートしておりませんので、ご理解賜りますようお願い致します。</p><h4 id="Android-や-iPhone-で接続した時に、カメラやマイク等が使えない"><a href="#Android-や-iPhone-で接続した時に、カメラやマイク等が使えない" class="headerlink" title="Android や iPhone で接続した時に、カメラやマイク等が使えない"></a>Android や iPhone で接続した時に、カメラやマイク等が使えない</h4><p>コピー &amp; ペースト、USBの接続、カメラ、マイク、ペン、プリンター、スキャナー等のリダイレクション可否は接続元のクライアントによって異なります。<br>下記にまとまっておりますので、ご参照ください。<br><a href="https://docs.microsoft.com/en-us/windows-365/manage-rdp-device-redirections#redirection-support">https://docs.microsoft.com/en-us/windows-365/manage-rdp-device-redirections#redirection-support</a></p><h4 id="Office-アプリのサインイン時にエラーが発生する"><a href="#Office-アプリのサインイン時にエラーが発生する" class="headerlink" title="Office アプリのサインイン時にエラーが発生する"></a>Office アプリのサインイン時にエラーが発生する</h4><p>下記記事にまとめておりますので、ご参照ください。<br><a href="https://jpmem.github.io/blog/w365/2021-08-11_02/">https://jpmem.github.io/blog/w365/2021-08-11_02/</a></p><h4 id="Android-や-iPhone-での-Windows-365-の使用はサポートされているか"><a href="#Android-や-iPhone-での-Windows-365-の使用はサポートされているか" class="headerlink" title="Android や iPhone での Windows 365 の使用はサポートされているか"></a>Android や iPhone での Windows 365 の使用はサポートされているか</h4><p>Windows 365 サポート対象デバイスは、Android と iPhone も含まれます。Windows 365 のハードウェア要件は以下の公開情報にてご案内しておりますので、ご確認ください。</p><p><a href="https://docs.microsoft.com/en-us/windows-365/end-user-hardware-requirements">https://docs.microsoft.com/en-us/windows-365/end-user-hardware-requirements</a></p><p>但し、以下の公開情報にございますとおり、ブラウザでの接続はサポートされておりませんので、リモート デスクトップ アプリで Windows 365 に接続してください。</p><p><a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#windows-365-home-page">https://docs.microsoft.com/ja-jp/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#windows-365-home-page</a></p><blockquote><p>ユーザーは、[ブラウザーで 開く] を選択 してクラウド PC を開きます。<br>注意<br>モバイル デバイスは現在サポートされていません。  </p></blockquote><h3 id="Business"><a href="#Business" class="headerlink" title="Business"></a>Business</h3><h4 id="Windows-365-の利用開始が「クラウドPCを設定します」のまま進まない"><a href="#Windows-365-の利用開始が「クラウドPCを設定します」のまま進まない" class="headerlink" title="Windows 365 の利用開始が「クラウドPCを設定します」のまま進まない"></a>Windows 365 の利用開始が「クラウドPCを設定します」のまま進まない</h4><p>下記記事にてまとめておりますので、ご参照ください。<br><a href="https://jpmem.github.io/blog/w365/2021-08-11_01/">https://jpmem.github.io/blog/w365/2021-08-11_01/</a></p><h4 id="アプリケーションがインストールできない"><a href="#アプリケーションがインストールできない" class="headerlink" title="アプリケーションがインストールできない"></a>アプリケーションがインストールできない</h4><p>恐れながら、現在のWindows 365 Business は英語版の Windows 10 が既定で動作しているために、日本語版のみをサポートするアプリケーションにおいて問題が生じている可能性がございます。大変恐縮でございますが、各アプリケーションの開発元等に、英語版の Windoows 10に対応しているか、また対応している場合はインストール時の注意点等がないか、ご確認くださいますようお願い致します。</p><h4 id="固定-IP-アドレスを割り当てたい"><a href="#固定-IP-アドレスを割り当てたい" class="headerlink" title="固定 IP アドレスを割り当てたい"></a>固定 IP アドレスを割り当てたい</h4><p>誠に恐縮ながら、現在固定 IP アドレスの割り当てをサポートしておりません。</p><h4 id="Azure-の-VPN-機能-を利用したい"><a href="#Azure-の-VPN-機能-を利用したい" class="headerlink" title="Azure の VPN 機能 を利用したい"></a>Azure の VPN 機能 を利用したい</h4><p>大変申し訳ないのですが、Windows 365 Business では Express Route や Site to Site VPN はご利用できません。<br>Windows 365 Entertprise のご利用をご検討くださいませ。</p><h4 id="クラウド-PC-が動作するデータセンターの所在地-リージョン-の選択、変更は可能か"><a href="#クラウド-PC-が動作するデータセンターの所在地-リージョン-の選択、変更は可能か" class="headerlink" title="クラウド PC が動作するデータセンターの所在地 (リージョン) の選択、変更は可能か"></a>クラウド PC が動作するデータセンターの所在地 (リージョン) の選択、変更は可能か</h4><p>Windows 365 Businessでは展開時にご利用の地域からなるべく近いリージョンを選定する動作となりますが、その時点での各リージョンのリソースの負荷状況を考慮した上で自動的に判断されるため、お客様により明示的にリージョンを選択したり変更することはできません。</p><h3 id="Enterprise"><a href="#Enterprise" class="headerlink" title="Enterprise"></a>Enterprise</h3><h4 id="ユーザーのライセンスを割り当てても利用開始にならない。"><a href="#ユーザーのライセンスを割り当てても利用開始にならない。" class="headerlink" title="ユーザーのライセンスを割り当てても利用開始にならない。"></a>ユーザーのライセンスを割り当てても利用開始にならない。</h4><p>下記記事にも記載がございますが、Enterprise の場合、オンプレミスAD ドメイン コントローラー連携した Hybrid Azure AD Join 環境の構築が必要となります。</p><p><a href="https://jpmem.github.io/blog/w365/2021-08-04_01/">https://jpmem.github.io/blog/w365/2021-08-04_01/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は Windows 365 のご利用においてよくお問い合わせを受ける内容に対するご回答 (FAQ) をお伝えします。&lt;/p&gt;
&lt;h2 id=&quot;免責事項&quot;&gt;&lt;a hr</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 Business のプロビジョニングが長時間経過しても終了しない場合について</title>
    <link href="https://jpmem.github.io/blog/w365/2021-08-11_01/"/>
    <id>https://jpmem.github.io/blog/w365/2021-08-11_01/</id>
    <published>2021-08-10T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.872Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は多くの皆様からお問い合わせを頂いております、Windows 365 Business のプロビジョニングが長時間経過しても終了しない場合に、ご確認いただきたい内容についてお伝え致します。</p><p>また、本内容と同内容が、下記 Microsoft Docs でも公開されております。併せてご確認くださいませ。</p><p><a href="https://docs.microsoft.com/en-us/microsoft-365/admin/setup/troubleshoot-windows-365-business?view=o365-worldwide">https://docs.microsoft.com/en-us/microsoft-365/admin/setup/troubleshoot-windows-365-business?view=o365-worldwide</a></p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2021/8/25 時点で判明している内容についての記載となっております。今後内容が更新されることもございますので、その点ご承知置きくださいますよう<br>お願い致します。</p><h2 id="対象読者"><a href="#対象読者" class="headerlink" title="対象読者"></a>対象読者</h2><p>Windows 365 Business のプロビジョニングが長時間経過しても終了しないお客様。<br>(Windows 365 Enterprise とは異なりますのでご注意ください)</p><h2 id="プロビジョニングが完了しない場合のチェック事項"><a href="#プロビジョニングが完了しない場合のチェック事項" class="headerlink" title="プロビジョニングが完了しない場合のチェック事項"></a>プロビジョニングが完了しない場合のチェック事項</h2><p>以下の点についてご確認くださいませ。</p><ol><li>Azure AD デバイス登録設定の確認</li><li>“Windows 365 BPRT Permanent User” ユーザー (旧名:”CloudPCBPRT”) ユーザーの確認</li><li>Azure AD デバイス登録時の多要素認証が無効化されているか確認</li><li>Azure AD の デバイス 登録設定の確認</li><li>多要素認証がセットアップをブロックしていないかの確認</li><li> Intune の自動登録設定</li></ol><h3 id="Azure-AD-デバイス登録設定の確認"><a href="#Azure-AD-デバイス登録設定の確認" class="headerlink" title="Azure AD デバイス登録設定の確認"></a>Azure AD デバイス登録設定の確認</h3><p>Azure AD デバイスに登録可能な設定かどうかご確認ください。</p><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[デバイス] を選択する。</li><li>[デバイスの設定] を選択する。</li><li>[ユーザーはデバイスを Azure AD に参加させることができます] が 「すべて」 に設定されていることを確認する。</li></ol><h3 id="“Windows-365-BPRT-Permanent-User”-ユーザー-旧名-“CloudPCBPRT”-の確認"><a href="#“Windows-365-BPRT-Permanent-User”-ユーザー-旧名-“CloudPCBPRT”-の確認" class="headerlink" title="“Windows 365 BPRT Permanent User” ユーザー(旧名: “CloudPCBPRT”)の確認"></a>“Windows 365 BPRT Permanent User” ユーザー(旧名: “CloudPCBPRT”)の確認</h3><p>初めてお客様が Azure AD テナントに Windows 365 ライセンスを割り当てた際、ご利用の Azure AD テナントに “Windows 365 BPRT Permanent User” (旧名:”CloudPCBPRT”) という名前のユーザー ID が自動生成されます。<br>本 ID は Windows 365 Business の クラウド PC のプロビジョニングに必要な ID ですので、絶対に削除しないでください。</p><p>上記につきましては、下記URLにも注意事項として記載がございます。<br><a href="https://docs.microsoft.com/en-us/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#assign-licenses-to-users">https://docs.microsoft.com/en-us/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#assign-licenses-to-users</a></p><p>※旧名: “CloudPCBPRT”ユーザーは2021/8/25より順次”Windows 365 BPRT Permanent User”に自動変更されておりますのでご承知置きください。</p><p>完全削除されていない場合は、下記にご案内します手順で復旧できますが、完全削除してしまった場合はお手数をおかけして恐縮でございますが、サポート チケットをご依頼くださいますようお願い致します。</p><p>こちらの ID の存在は下記からご確認可能です。</p><h4 id="“Windows-365-BPRT-Permanent-User”-の表示"><a href="#“Windows-365-BPRT-Permanent-User”-の表示" class="headerlink" title="“Windows 365 BPRT Permanent User” の表示"></a>“Windows 365 BPRT Permanent User” の表示</h4><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[ユーザー] を選択する。</li><li>[すべてのユーザー (プレビュー)] が選択されていることを確認する。</li><li>[ユーザーの検索] に “Windows 365 BPRT Permanent User” を入力し、ユーザーが表示されることを確認する。</li></ol><p><img src="/blog/w365/2021-08-11_01/20210811_01_01.png"></p><h4 id="“Windows-365-BPRT-Permanent-User”-旧名-Cloud-PCBPRT-を完全削除していない場合の復帰"><a href="#“Windows-365-BPRT-Permanent-User”-旧名-Cloud-PCBPRT-を完全削除していない場合の復帰" class="headerlink" title="“Windows 365 BPRT Permanent User” (旧名: Cloud PCBPRT) を完全削除していない場合の復帰"></a>“Windows 365 BPRT Permanent User” (旧名: Cloud PCBPRT) を完全削除していない場合の復帰</h4><ol><li>Azure ポータルにアクセスする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[ユーザー] - [削除されたユーザー(プレビュー)] を選択。</li><li>[Windows 365 BPRT Permanent User] を選択後,「ユーザーの復元」を選択し、「OK」をクリック。</li></ol><h3 id="Azure-AD-の-デバイス-登録設定の確認"><a href="#Azure-AD-の-デバイス-登録設定の確認" class="headerlink" title="Azure AD の デバイス 登録設定の確認"></a>Azure AD の デバイス 登録設定の確認</h3><p>デバイスを Azure AD に参加させる際の登録設定が下記の通りとなっていることを確認ください。</p><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[デバイス] を選択する。</li><li>[デバイスの設定] を選択する。</li><li>[Azure AD を使用してデバイスを登録または参加させるには Multi-Factor Authentication が必要です] が「いいえ」 に設定されていることを確認する。</li></ol><p><img src="/blog/w365/2021-08-11_01/20210811_01_02.png"></p><h3 id="Azure-AD-デバイス登録時の多要素認証が無効化されているか確認"><a href="#Azure-AD-デバイス登録時の多要素認証が無効化されているか確認" class="headerlink" title="Azure AD デバイス登録時の多要素認証が無効化されているか確認"></a>Azure AD デバイス登録時の多要素認証が無効化されているか確認</h3><p>デバイスを Azure AD に参加させる際のMulti-Factor Authentication 認証 (多要素認証) につきましては下記手順で無効化されていることをご確認くださいますようお願い致します。</p><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[デバイス] を選択する。</li><li>[デバイスの設定] を選択する。</li><li>[Azure AD を使用してデバイスを登録または参加させるには Multi-Factor Authentication が必要です] が「いいえ」 に設定されていることを確認する。</li></ol><p><img src="../2021-08-11_01/20210811_01_02.png"></p><h3 id="多要素認証がセットアップをブロックしていないかの確認"><a href="#多要素認証がセットアップをブロックしていないかの確認" class="headerlink" title="多要素認証がセットアップをブロックしていないかの確認"></a>多要素認証がセットアップをブロックしていないかの確認</h3><p>Azure AD Premium P1 以上で、条件付きアクセスを設定されているお客様について、テナント内で初めて Windows 365 のホームページ (<a href="https://windows365.microsoft.com/">https://windows365.microsoft.com</a>) にアクセスするユーザーをお選びください。該当のユーザーにつきまして、下記手順にて多要素認証が無効化されていることをご確認ください。</p><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>サービスの検索欄に「条件付きアクセス」を入力し、検索された結果をクリックする。</li><li>ポリシー一覧に何も表示されなければ、「Intuneの自動登録設定」の確認に進む。</li><li>設定されているポリシーそれぞれをクリックし、「アクセス制御」「許可」の欄が「0個のコントロールが選択されました」となっていれば、次のポリシーを選択する。</li><li>「N個のコントロールが選択されました」となっている場合、リンクをクリックし、もし「多要素認証を要求する」が有効化されていた場合、無効化し、保存する。</li><li>全てのポリシーにおいて「多要素認証を要求する」を無効化し、「Intuneの自動登録設定」の確認に進む。</li></ol><p><img src="../2021-08-11_01/20210811_01_05.png"></p><h3 id="Intune-の自動登録設定"><a href="#Intune-の自動登録設定" class="headerlink" title="Intune の自動登録設定"></a>Intune の自動登録設定</h3><p>Intune をご利用されている場合、自動登録が有効になっている場合がございます。自動登録が有効になっている場合、”CloudPCBPPRT” ユーザーに Intune のライセンスを付与する必要がございます。Intune をご利用されていない場合、自動登録が無効化されていることをご確認ください。</p><h4 id="Intune-の自動登録が有効になっている場合の確認"><a href="#Intune-の自動登録が有効になっている場合の確認" class="headerlink" title="Intune の自動登録が有効になっている場合の確認"></a>Intune の自動登録が有効になっている場合の確認</h4><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[モビリティ MDM および MAM] を選択する。</li><li>[Microsoft Intune] を選択する。</li><li>[MDM ユーザー スコープ]が「すべて」となっていることを確認する。</li></ol><p><img src="/blog/w365/2021-08-11_01/20210811_01_03.png"></p><ol start="6"><li>Azure ポータル画面に戻る。</li><li>[Azure Active Directory] を選択する。</li><li>[ユーザー] を選択する。</li><li>[すべてのユーザー (プレビュー)] が選択されていることを確認する。</li><li>[ユーザーの検索] に “CloudPCBPRT” を入力し、ユーザーが表示されることを確認する。</li><li>“CloudPCBPRT” ユーザーを選択する。</li><li>[ライセンス] を選択し、Intune を含むライセンスが割当たっていることを確認する。</li><li>割当たっていない場合、[割り当て] を選択し、Intune を含むライセンスを割り当てる。</li></ol><h4 id="Intune-の自動登録が無効になっている場合の確認"><a href="#Intune-の自動登録が無効になっている場合の確認" class="headerlink" title="Intune の自動登録が無効になっている場合の確認"></a>Intune の自動登録が無効になっている場合の確認</h4><ol><li>Azure ポータルにログインする。 (<a href="https://portal.azure.com/">https://portal.azure.com/</a>)</li><li>[Azure Active Directory] を選択する。</li><li>[モビリティ MDM および MAM] を選択する。</li><li>[Microsoft Intune] を選択する。</li><li>[MDM ユーザー スコープ]が「なし」となっていることを確認する。</li></ol><p><img src="/blog/w365/2021-08-11_01/20210811_01_04.png"></p><h2 id="上記実施後の再プロビジョニング手順について"><a href="#上記実施後の再プロビジョニング手順について" class="headerlink" title="上記実施後の再プロビジョニング手順について"></a>上記実施後の再プロビジョニング手順について</h2><p>Windows 365 Business は新しいユーザーを作成して、ライセンスの再割り当てを実施することでプロビジョニングのリトライが実施されます。上記実施後や、上記設定に問題が無いがプロビジョニングが完了しない場合は下記手順をお試しください。</p><ol><li>Microsoft 365 管理センター (<a href="https://admin.microsoft.com/">https://admin.microsoft.com/</a>) にアクセスする。アカウントが要求された場合は管理者アカウントのIDとパスワードでログインする。</li><li>画面左ペインより [課金情報] - [ライセンス] を選択し、ご利用の Windows 365 for Business サブスクリプションを選択する。</li><li>現在ライセンス割り当てを行っているユーザーを選択し、「ライセンスの割り当て解除」を行う。</li><li>しばらく時間をおく。(30分程度推奨)</li><li>画面左ペインより [ユーザー] - [アクティブなユーザー] を選択し [ユーザーの追加]をクリックする。</li><li>ウィザードに従ってユーザーの追加を完了する。</li><li>画面左ペインより [課金情報] - [ライセンス] を選択し、ご利用の Windows 365 for Business サブスクリプションを選択する。</li><li>上記画面で「ライセンス割り当て」をクリックし、新規に作成したユーザーを設定する。</li><li><a href="https://windows365.microsoft.com/">https://windows365.microsoft.com/</a> にアクセスし、プロビジョニング完了を待機する。通常は1-2時間程度でプロビジョニングが完了する。</li></ol><h2 id="上記実施後もプロビジョニングが成功しない場合について"><a href="#上記実施後もプロビジョニングが成功しない場合について" class="headerlink" title="上記実施後もプロビジョニングが成功しない場合について"></a>上記実施後もプロビジョニングが成功しない場合について</h2><p>上記実施いただいてもプロビジョニングが完了しない場合、お手数をおかけして恐縮でございますが、サポートリクエストの発行をお願い致します。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は多くの皆様からお問い合わせを頂いております、Windows 365 Business のプロビジョニングが長時間経過しても終了しない場合に、ご確認いただきたい内容</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 で Microsoft 365 Apps のユーザー ログイン に失敗する</title>
    <link href="https://jpmem.github.io/blog/w365/2021-08-11_02/"/>
    <id>https://jpmem.github.io/blog/w365/2021-08-11_02/</id>
    <published>2021-08-10T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.872Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は多くの皆様からお問い合わせを頂いております、Windows 365 で Microsoft 365 Apps にログインしようとした時に<br>エラーが発生する場合の対処についてお伝え致します。</p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>下記内容は 2021/8/11 時点で判明している内容についての記載となっております。今後内容が更新されることもございますので、その点ご承知置きくださいますよう<br>お願い致します。</p><h2 id="対象"><a href="#対象" class="headerlink" title="対象"></a>対象</h2><p>下記の Microsoft 365 ライセンスをお使いのお客様。</p><ul><li>Microsoft 365 Personal</li><li>Microsoft 365 Business Standard</li></ul><h2 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h2><p>Windows 365 ライセンスで作成したクラウド PC で、Microsoft 365 Apps にログインしようとした時に下記画面のように<br>“Account Issue: The products we found in your account cannot be used to activate Office in shared computer scenarios.” とエラー表示される</p><p><img src="/blog/w365/2021-08-11_02/20210811_02_01.png"></p><h2 id="解決策"><a href="#解決策" class="headerlink" title="解決策"></a>解決策</h2><p>お手数をおかけして大変恐縮でございますが、<br>クラウド PC にインストールされている Microsoft 365 Apps をアンインストールし、<a href="https://www.office.com/">office.com</a> から Microsoft 365 Apps のバイナリをダウンロード、インストールくださいますよう<br>お願い致します。</p><h2 id="エラー原因"><a href="#エラー原因" class="headerlink" title="エラー原因"></a>エラー原因</h2><p>クラウド PC にインストールされている Microsoft 365 Apps の前提ライセンスとお客様が利用されているライセンスが異なるために本件発生致します。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>本件、下記公開情報にも記載がございますのでご確認くださいませ。</p><p><a href="https://docs.microsoft.com/en-us/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#installing-apps">https://docs.microsoft.com/en-us/microsoft-365/admin/setup/get-started-windows-365-business?view=o365-worldwide#installing-apps</a></p><h2 id="補足情報"><a href="#補足情報" class="headerlink" title="補足情報"></a>補足情報</h2><p>Windows 365 のライセンスに Microsoft 365 のライセンスは含まれておりません。<br>同様に Microsoft 365 のライセンスに Windows 365 のライセンスも含まれておりません。それぞれ別途購入が必要となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は多くの皆様からお問い合わせを頂いております、Windows 365 で Microsoft 365 Apps にログインしようとした時に&lt;br&gt;エラーが発生する場</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 Enterprise をご利用の際の注意点</title>
    <link href="https://jpmem.github.io/blog/w365/2021-08-04_01/"/>
    <id>https://jpmem.github.io/blog/w365/2021-08-04_01/</id>
    <published>2021-08-03T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.872Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。<br>本日は、米国時間 8 月 2 日より一般提供を開始いたしました「Windows 365」の Enterprise をご利用いただく上での注意点をご紹介いたします。</p><h2 id="プランの違い"><a href="#プランの違い" class="headerlink" title="プランの違い"></a>プランの違い</h2><p>Windows 365 には、現在 Business と Enterprise という 2 つのプランがございます。<br>各プランの違いにつきましては、次の公開情報をご確認ください。</p><p><a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/get-started-with-windows-365-business/ba-p/2595485">Get started with Windows 365 Business - Microsoft Tech Community</a></p><table><thead><tr><th></th><th>Windows 365 Business</th><th>Windows 365 Enterprise</th></tr></thead><tbody><tr><td>製品ページから直接クリックしてプロビジョニング</td><td>X</td><td></td></tr><tr><td>「ドメインなし」の設定</td><td>X</td><td></td></tr><tr><td>セルフサービス トラブル シューティング – リセット</td><td>X</td><td></td></tr><tr><td>「クラウド保存」（最小限のAzureストレージと場合によってはOneDrive for Business）</td><td>X</td><td>X</td></tr><tr><td>セルフサービス アップグレード</td><td></td><td>X</td></tr><tr><td>ユニバーサル プリントの統合</td><td></td><td>X</td></tr><tr><td>パートナー/プログラムによる有効化（Graph API、MSPツール）</td><td></td><td>X</td></tr><tr><td>カスタム イメージの使用</td><td></td><td>X</td></tr><tr><td>イメージの管理 (保存、複製、展開)</td><td></td><td>X</td></tr><tr><td>Microsoft Endpoint Manager のポリシー展開によるプロビジョニング、管理、およびガイド付きシナリオ</td><td></td><td>X</td></tr><tr><td>エンドポイント分析のレポートと監視</td><td></td><td>X</td></tr><tr><td>サービス ヘルス、運用ヘルス アラート</td><td></td><td>X</td></tr><tr><td>オンプレミス (ネットワーク、アプリ、リソース) への接続 + 診断</td><td></td><td>X</td></tr><tr><td>Microsoft Endpoint Manager ベースの高度なトラブルシューティングとデバイス管理</td><td></td><td>X</td></tr></tbody></table><h2 id="構築時の注意点"><a href="#構築時の注意点" class="headerlink" title="構築時の注意点"></a>構築時の注意点</h2><p>上述のとおり、Windows 365 Business と Enterprise では使用できる機能が異なりますが、大きな違いとしては Windows 365 Enterprise をご利用いただく場合、<strong>オンプレミス Active Directory と Azure Active Directory を同期したハイブリッド Azure AD 参加可能な環境が必要</strong>となりますので、ご注意ください。</p><p>そのため、Windows 365 Enterprise の場合は、Business の場合と異なり、ライセンスを割り当てただけではご利用いただけませんので、何卒ご留意くださいますようお願い申し上げます。</p><p>なお、Windows 365 Enterprise を評価される場合は、以下のドキュメントに評価環境の構築手順のガイドが紹介されておりますので、ご参考賜れますと幸いです。</p><p><a href="https://zenn.dev/takuyaot/books/60c3ced87ba86f">いますぐ始める！ Windows 365 (zenn.dev)</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Microsoft Endpoint Manager サポート チームです。&lt;br&gt;本日は、米国時間 8 月 2 日より一般提供を開始いたしました「Windows 365」の Enterprise をご利用いただく上での注意点をご紹介いたします。&lt;/p</summary>
      
    
    
    
    
    <category term="Windows 365" scheme="https://jpmem.github.io/blog/tags/Windows-365/"/>
    
  </entry>
  
  <entry>
    <title>System Center 2012 / R2 Configuration Manager のサポートが残り 1 年を切りました</title>
    <link href="https://jpmem.github.io/blog/mecm/20210802_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20210802_01/</id>
    <published>2021-08-01T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.872Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>長年ご愛顧いただいております System Center 2012 Configuration Manager 関連の下記製品の EoS (End of Support) が 2022 年 7 月 12 日までとなっております。</p><ul><li><a href="https://docs.microsoft.com/en-us/lifecycle/products/microsoft-system-center-2012-configuration-manager">System Center 2012 Configuration Manager</a></li><li><a href="https://docs.microsoft.com/en-us/lifecycle/products/microsoft-system-center-2012-r2-configuration-manager">System Center 2012 R2 Configuration Manaer</a></li><li><a href="https://docs.microsoft.com/en-us/lifecycle/products/microsoft-system-center-2012-endpoint-protection">System Center 2012 Endpoint Protection</a></li><li><a href="https://docs.microsoft.com/en-us/lifecycle/products/microsoft-system-center-2012-r2-endpoint-protection">System Center 2012 R2 Endpoint Protection</a></li></ul><p>EoS を迎えた製品につきましては、以下の提供が行われなくなります。</p><ul><li>EoS 後発生しうる問題へのテクニカルサポート</li><li>セキュリティ更新や修正</li><li>EoS 後の SCEP に対する定義ファイル、エンジンやプラットフォームの更新</li></ul><p>大変恐縮でございますが、ご利用のお客様におかれましては、 Microsoft Endpoint Configuration Manager (MECM) Current Branch 等への移行計画の策定、ご対応くださいますようお願い致します。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;長年ご愛顧いただいております System Center 2012 Configuration Manager 関連の下記製品の EoS (End of Support)</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Endpoint Configuration Manager 環境の HTTP のみの通信が非推奨となります</title>
    <link href="https://jpmem.github.io/blog/mecm/20210414_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20210414_01/</id>
    <published>2021-04-13T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.868Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>Microsoft Endpoint Configuration Manager (以下 MECM) 環境において、今後クライアントと Configuration Manager 間の HTTP のみの通信が非推奨となります。<br>そのため、通信を HTTPS または拡張 HTTP を有効にすることで、より安全な通信方法をサイトで有効にして頂く必要がございます。</p><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/deprecated/removed-and-deprecated-cmfeatures">Configuration Manager から削除された機能と非推奨の機能</a></p><p>MECM の バージョン 2103 以降については MECM のアップグレードを行って頂く際の前提条件のチェック時においても、”警告” として、HTTP が非推奨になる旨のメッセージが表示されるようになりましたため、対処の手段である HTTPS とする方法や拡張 HTTP を有効にするための情報をご案内します。</p><p><img src="/blog/mecm/20210414_01/1.png"></p><h2 id="サイトで-HTTPS-を有効にする方法について"><a href="#サイトで-HTTPS-を有効にする方法について" class="headerlink" title="サイトで HTTPS を有効にする方法について"></a>サイトで HTTPS を有効にする方法について</h2><p>通信を PKI の証明書を利用して、 HTTPS とする場合には以下の 3 つの設定変更が必要です。</p><ul><li><p>クライアントと通信を行うための役割である管理ポイント、配布ポイント、ソフトウェア更新ポイントをサイトシステムのプロパティ上で HTTPS を受け入れる設定に変更を行う。</p></li><li><p>IIS で HTTPS 通信を受け入れるように Web サーバー証明書を準備し、対象の IIS のサイトにバインドする。</p></li></ul><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/network/example-deployment-of-pki-certificates#deploy-the-web-server-certificate-for-site-systems-that-run-iis">IIS を実行するサイト システム用の Web サーバー証明書の展開</a></p><ul><li>MECM クライアント にクライアント認証用途のコンピューター証明書を配布する。</li></ul><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/network/example-deployment-of-pki-certificates#deploy-the-client-certificate-for-windows-computers">Windows コンピューター用のクライアント証明書の展開</a></p><h2 id="サイトで-拡張-HTTP-を有効にする方法について"><a href="#サイトで-拡張-HTTP-を有効にする方法について" class="headerlink" title="サイトで 拡張 HTTP を有効にする方法について"></a>サイトで 拡張 HTTP を有効にする方法について</h2><p>PKI 証明書を発行できる環境がない、または 管理が大変などの事情があるお客様向けに Configuration Manager の機能で通信を保護する機能が拡張 HTTP となります。</p><p>拡張 HTTP の主な目的は以下の通りです。</p><ul><li>PKI サーバー認証証明書を必要とせずに機密性のクライアント通信を保護できる。</li><li>クライアントは、ネットワーク アクセス アカウント、クライアント PKI 証明書、Windows 認証を必要とせずに、配布ポイントからコンテンツに安全にアクセスできる。</li></ul><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/hierarchy/enhanced-http">拡張 HTTP</a></p><p>また、拡張 HTTP 環境の構成手順についてはサイトのプロパティより、 [HTTP サイト システムには Configuration Manager によって生成された証明書を使用する] オプションを有効にするだけになります。</p><p><img src="/blog/mecm/20210414_01/2.png"></p><p>お客様の環境によって、上記手段のご検討を頂けますようお願い申し上げます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;Microsoft Endpoint Configuration Manager (以下 MECM) 環境において、今後クライアントと Configuration Man</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>WSUS メンテナンス ガイド</title>
    <link href="https://jpmem.github.io/blog/wsus/2020-07-21_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2020-07-21_01/</id>
    <published>2020-07-20T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.896Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。<br>本日は WSUS サーバーのメンテナンス方法について、纏めてご紹介をいたします。</p><p>WSUS は月々リリースされる更新プログラムを配信出来るよう、更新プログラムの情報をサーバー上に溜め込む必要があります。しかし、この製品の性質上、日々メンテナンスを実施しないと、データベースや情報が肥大化し、様々な障害や弊害が発生しやすくなってしまいます。<br>弊サポート部門へいただく様々なお問い合わせも、最終的にはこのいずれかの対処に行き着くことが、ほとんどですので是非 WSUS をこれから導入・構築される方々、また既に運用されている方々は、ご一読ください！</p><h2 id="WSUS-の各種メンテナンス"><a href="#WSUS-の各種メンテナンス" class="headerlink" title="WSUS の各種メンテナンス"></a>WSUS の各種メンテナンス</h2><p>一般的な WSUS のメンテナンスとして、下記の 3 種類のメンテナンスは更新プログラムのリリースと合わせて、月 1 回程度実行していただくことをオススメしております。各メンテナンスについては、既に以下のブログで、それぞれ紹介していますので、WSUS をご利用いただいている方で、まだ読んだことがない方は一度内容をご覧ください。</p><ol><li><a href="https://jpmem.github.io/blog/wsus/2014-03-05_01/">WSUS DB インデックスの再構成の手順について</a></li><li><a href="https://jpmem.github.io/blog/wsus/2017-12-05_01/">WSUS のクリーンアップ ウィザードについて</a></li><li><a href="https://jpmem.github.io/blog/wsus/2017-12-11_01/">不要な更新プログラムは「拒否済み」に設定しよう！</a></li></ol><p>また、これらのメンテナンスはいずれもコマンド ライン等から実行出来るため、タスク スケジューラと組み合わせて自動化することが可能です。今回は自動化の手順とそれに伴う注意事項も紹介しますので、運用の中に取り入れる上で参考としていただけると幸いです。</p><h2 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項"></a>注意事項</h2><p>以下にメンテナンスを実施いただく上での注意事項をご案内します。メンテナンスの自動化を行う前に、必ずご一読ください。</p><ul><li>初めてメンテナンスを実施する場合には、各メンテナンスが正常に動作することを一度必ずご確認ください。特に何年も運用しているような環境で、<strong>初めてメンテナンスを実施する場合には、処理が長時間 (数十時間 ～) に及ぶ可能性もあるので、ご留意ください。</strong> </li><li>各メンテナンスと WSUS の同期は、なるべく同じ時刻に実行されないようにしてください。いずれのメンテナンスも WSUS の負荷が高くなる可能性があるため、各メンテナンスを同時に実行したり、<strong>メンテナンスと同期を同時に実行すると失敗することがあります。</strong></li><li>「3」のブログで紹介している置き換えが行われた更新プログラムを「拒否済み」に設定するスクリプトを利用して貰えると、新しい更新プログラムにて置き換えられている古い更新プログラムのみを、簡単に「拒否済み」に設定することが可能です。今回ご案内の手順でも、このスクリプトを利用します。<strong>ただし、最新の更新プログラムを常に配信するような運用をしていない場合 (リリース後 1 ヶ月遅れで配信したり、特定の更新を除外して配信しているような場合) には、配信対処の更新プログラムが「拒否済み」に設定されてしまうこともあるため、ご注意ください。</strong></li><li>レプリカ構成の WSUS を利用している場合には、「2」のクリーンアップ ウィザードは上位のサーバーから実行する必要があるため、上位のサーバーから順番にメンテナンスが実行されるよう、スケジュールをしてください。 </li><li>階層構成の WSUS の場合でも「1」「2」のメンテナンスについては、上位下位双方の WSUS にて実施してください。なお。レプリカ構成の WSUS の場合には、「3」の「拒否済み」の設定については、上位の WSUS サーバーだけで実施すれば問題ありません。</li></ul><h2 id="メンテナンスの自動化"><a href="#メンテナンスの自動化" class="headerlink" title="メンテナンスの自動化"></a>メンテナンスの自動化</h2><p>それでは各メンテナンスを自動化する方法について、それぞれ紹介していきます。</p><h3 id="SUSDB-のインデックス再構築をタスク-スケジューラから自動実行させる"><a href="#SUSDB-のインデックス再構築をタスク-スケジューラから自動実行させる" class="headerlink" title="SUSDB のインデックス再構築をタスク スケジューラから自動実行させる"></a>SUSDB のインデックス再構築をタスク スケジューラから自動実行させる</h3><ol><li><p><a href="https://github.com/microsoft-jpcssmem/WSUS/releases/latest/download/WsusDBMaintenance.sql">こちら</a>より、インデックスの SUSDB のインデックス再構築を行うスクリプトを入手し、WSUS サーバー上に保存します。(WsusDBMaintenance.sql 等)</p></li><li><p>スタート メニューより、タスク スケジューラを立ち上げます。</p></li><li><p>[基本タスクの作成] を選択し、任意の名前を付けます。</p><p><img src="/blog/wsus/2020-07-21_01/image-20210731021225318.png"></p></li><li><p>インデックスの再構築を実施するスケジュールを指定します。以下の例では、毎月第一日曜日の AM 2:00 に実行するよう指定しています。</p><p><img src="/blog/wsus/2020-07-21_01/image-20210731021243281.png"></p></li><li><p>[プログラムの開始] を選択して、以下のような指定を行ないます。以下の指定では -i オプションで手順 1 で保存したスクリプトのパスを指定し、-o にてスクリプトの実行ログの出力パスを指定しています。</p></li></ol><p>Windows Server 2012 以降の WSUS で WID を利用している場合の指定例<br><code>&quot;C:\Program Files\Microsoft SQL Server\110\Tools\Binn\SQLCMD.exe&quot; -S \\.\pipe\Microsoft##WID\tsql\query -i C:\WSUS\WsusDBMaintenance.sql -o c:\WSUS\reindexout.txt</code><br>※ SQL Server を利用している場合には -S にて SQL Server のインスタンス名を指定します。<br><img src="/blog/wsus/2020-07-21_01/image-20210731021305833.png"></p><ol start="6"><li><p>以下のような警告が出力されますが [はい] を選択して、そのままタスクの作成を完了させます。</p><p><img src="/blog/wsus/2020-07-21_01/image-20210731021324032.png"></p></li><li><p>作成したタスクを右クリックして [プロパティ] を選択し、以下の 2 つの設定を行って [OK] をクリックします。</p><p><img src="/blog/wsus/2020-07-21_01/image-20210731021339489.png"></p></li><li><p>試しに作成したタスクを右クリックして [実行する] を選択して実行してみましょう。ログを確認してエラー等が出力されておらず、最後の方に <strong>“Statistics for all tables have been updated”</strong> または <strong>“全テーブルの統計が更新されました”</strong> が出力されていれば、問題なくタスクの登録が出来ています。</p></li></ol><h3 id="クリーンアップ-ウィザードをタスク-スケジューラから自動実行させる"><a href="#クリーンアップ-ウィザードをタスク-スケジューラから自動実行させる" class="headerlink" title="クリーンアップ ウィザードをタスク スケジューラから自動実行させる"></a>クリーンアップ ウィザードをタスク スケジューラから自動実行させる</h3><ol><li>インデックスの再構築の自動化の手順と同様にタスク スケジューラを起動し、基本タスクの作成を行ない、クリーンアップ ウィザードを実行するスケジュールを指定 (上述の手順 2 ~ 4) します。<br>※ インデックスの再構築とはスケジュールが被らないよう、インデックス再構築の実行開始の数時間後や別の日等を指定します。</li><li>[プログラムの開始] を選択して、実行したいクリーンアップの項目に合わせて、以下のような指定を行ないます。</li></ol><p>Windows Server 2012 以降の WSUS で WID を利用しており、全ての項目を実行する場合の指定例<br><code>Powershell -Command &quot;Invoke-WsusServerCleanup -CompressUpdates -CleanupObsoleteUpdates -CleanupObsoleteComputers -CleanupUnneededContentFiles -DeclineExpiredUpdates -DeclineSupersededUpdates&quot; &gt; C:\WSUS\wsusClean.txt</code><br>※ オプションとクリーンアップの各項目の対応については、<a href="https://jpmem.github.io/blog/wsus/2017-12-05_01/#%E5%8F%82%E8%80%83%E6%83%85%E5%A0%B1-%E5%AE%9A%E6%9C%9F%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%AE%E6%96%B9%E6%B3%95">こちらのブログの参考情報</a>を参照してください、</p><ol><li>インデックスの再構築の自動化の手順と同様にタスクの作成を完了 (上述の手順 6 ～ 7) させます。</li><li>試しに作成したタスクを右クリックして [実行する] を選択して実行してみましょう。出力ファイルに以下のようにエラー等が出力されていなければ、正常に登録されています。<br>出来ています。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">削除された古い更新プログラム:0</span><br><span class="line">拒否された期限切れの更新プログラム: 0</span><br><span class="line">削除された古い更新プログラム:87</span><br><span class="line">圧縮された更新プログラム:0</span><br><span class="line">削除された古いコンピューター:0</span><br><span class="line">解放されたディスク領域:0</span><br></pre></td></tr></table></figure><h3 id="不要な更新プログラムの「拒否済み」設定をタスク-スケジューラから自動実行させる"><a href="#不要な更新プログラムの「拒否済み」設定をタスク-スケジューラから自動実行させる" class="headerlink" title="不要な更新プログラムの「拒否済み」設定をタスク スケジューラから自動実行させる"></a>不要な更新プログラムの「拒否済み」設定をタスク スケジューラから自動実行させる</h3></li><li><a href="https://github.com/microsoft-jpcssmem/WSUS/releases/latest/download/Decline-SupersededUpdates.ps1">こちら</a> より、置き換えられた更新プログラムを「拒否済み」に設定するスクリプトを入手し、WSUS サーバー上に保存します。(Decline-SupersededUpdates.ps1 等)</li><li>インデックスの再構築の時と同様にタスク スケジューラを起動し、基本タスクの作成を行ない、不要な更新プログラムの「拒否済み」設定を実行するスケジュールを指定 (上述の手順 2 ~ 4) します。<br>※ こちらもインデックスの再構築やクリーンアップ ウィザードとはスケジュールが被らないよう、他のメンテナンスの実行開始の数時間後や別の日等を指定します。</li><li>[プログラムの開始] を選択して、以下のようにスクリプトを指定します。本指定については、利用しているポート番号によって -Port 以降の指定を変更する必要があるので、ご注意ください。Windows Server 2012 以降の WSUS 環境は既定で 8530 となります。<br><code>powershell -ExecutionPolicy Unrestricted -Command &quot;C:\WSUS\Decline-SupersededUpdates.ps1 -UpdateServer localhost -Port 8530&quot;</code>  </li><li>インデックスの再構築の自動化の手順と同様にタスクの作成を完了 (上述の手順 6 ～ 7) させます。</li><li>試しに作成したタスクを右クリックして [実行する] を選択して実行してみましょう。出力ファイル SupersededUpdates.csv や SupersededUpdatesBackup.csv が出力されていれば、正常に登録されています。</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;br&gt;本日は WSUS サーバーのメンテナンス方法について、纏めてご紹介をいたします。&lt;/p&gt;
&lt;p&gt;WSUS は月々リリースされる更新プログラムを配信出来るよう、更新プログラムの情報をサーバー上に溜め込む必要がありま</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>System Center Configuration Manager Current Branch クライアントに関連する情報を完全に削除する方法</title>
    <link href="https://jpmem.github.io/blog/mecm/20190327_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20190327_01/</id>
    <published>2019-03-26T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.868Z</updated>
    
    <content type="html"><![CDATA[<p>皆様、こんにちは。System Center Configuration Manager サポート チームです。</p><p>以前のバージョンの System Center Configuration Manager クライアントを完全に削除する手順については、次の通りご紹介しておりますが、今回は最新版である System Center Configuration Manager Current Branch の場合の手順をご案内します。</p><p><a href="https://social.msdn.microsoft.com/Forums/ja-JP/bb8fc444-ec6e-43ac-a077-9ebea7abb4a2/sccm2012-sccm?forum=jpsccmwsus">https://social.msdn.microsoft.com/Forums/ja-JP/bb8fc444-ec6e-43ac-a077-9ebea7abb4a2/sccm2012-sccm?forum=jpsccmwsus</a></p><p>System Center Configuration Manager クライアントの完全削除は、クライアントが正常に動作していないように見える場合に有効な手順です。本手順を実施してから、クライアントの再インストールを実施することで解消できる問題も多くありますので、回避優先の対処が求められる場合に、是非お役立てください。</p><blockquote><p><strong>注意事項 : 本手順は、SCCM クライアントがインストールされた、サイト サーバー、サイト システム サーバー (SCCM のサーバー側の管理ポイント・配布ポイントなどの役割を持つサーバー) では行わないでください。手順中で削除が必要なレジストリ キーは、SCCM のサーバー側各機能でも使用していることが多く、サイト サーバー、サイト システムとしての役割に支障をきたします。本手順は、あくまでも、クライアント OS の SCCM クライアントへのトラブルシュートや、マスター イメージ準備のためにご利用ください。</strong></p></blockquote><hr><ol><li>System Center Configuration Manager クライアントをアンインストールします。</li></ol><p>コマンド プロンプトを管理者として実行し、以下のコマンドを実行します。</p><p><code>%Windir%\ccmsetup\ccmsetup.exe /uninstall</code></p><blockquote><p>コントロールパネルを開き、”Configuration Manager” という項目が消えたら、アンインストール完了と判断出来ます。また、アンインストールが成功すると、ccmsetup.log に以下のログが記録されます。</p></blockquote><p><code>Uninstall succeeded.</code></p><ol start="2"><li>下記フォルダー、ファイルを削除します。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%windir%\CCM</span><br><span class="line">%windir%\ccmsetup</span><br><span class="line">%windir%\SMSCFG.ini</span><br></pre></td></tr></table></figure><ol start="3"><li>下記レジストリが残存している場合、削除します。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\SMS</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\CCM</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\CCMSetup</span><br></pre></td></tr></table></figure><ol start="4"><li>以下の手順で、SMS 証明書 (自己署名証明書) を削除します。</li></ol><ol><li>コマンド プロンプトを開き、”mmc” を入力して実行します。</li><li>[ファイル] - [スナップインの追加と削除] をクリックします。</li><li>左ペインから [証明書] をクリックして [追加] ボタンをクリックします。</li><li>“コンピューター アカウント” にチェックを入れて、[次へ] をクリックします。</li><li>“ローカル コンピューター” にチェックし、[完了] をクリックします。</li><li>右ペインに “証明書（ローカル コンピューター）” が追加されていることを確認し [OK] をクリックします。</li><li>左ペインにて、[証明書] - [SMS] - [証明書] を選択します。</li><li>中央ペインに表示された 2 つの “SMS” 証明書に対して、それぞれ右クリックして [削除] を選択します。「選択された証明書を永久的に削除しますか？」というメッセージが表示されますので、[はい] を選択します。</li><li>[ファイル] - [終了] をクリックします。「コンソールの設定を コンソール 1 に保存しますか？」というメッセージが表示されますので、[いいえ] を選択して、mmc を終了します。</li></ol><blockquote><p>PKI 証明書を利用している環境（HTTPS 構成）の場合<br>PKI 証明書を利用している場合は同様に以下の手順で PKI 証明書を削除します。</p><ol><li>コマンド プロンプトを開き、”mmc” を入力して実行します。</li><li>[ファイル] - [スナップインの追加と削除] をクリックします。</li><li>左ペインから [証明書] をクリックして [追加] ボタンをクリックします。</li><li>“コンピューター アカウント” にチェックを入れて、[次へ] をクリックします。</li><li>“ローカル コンピューター” にチェックし、[完了] をクリックします。</li><li>右ペインに “証明書（ローカル コンピューター）” が追加されていることを確認し [OK] をクリックします。</li><li>左ペインにて、[証明書] - [個人] - [証明書] を選択します。カスタム ストアを利用している場合は、該当箇所を選択してください。</li><li>中央ペインに表示された SCCM の HTTPS 接続用クライアント証明書を右クリックして [削除] を選択します。<br>「選択された証明書を永久的に削除しますか?」というメッセージが表示されますので、[はい] を選択します。</li><li>[ファイル] - [終了] をクリックします。「コンソールの設定を コンソール1 に保存しますか?」というメッセージが表示されますので、[いいえ] を選択して、mmc を終了します。</li></ol></blockquote><ol start="5"><li>下記フォルダーに移動し、”19c5cf…” ではじまるファイルが存在する場合には削除、またはリネームして別フォルダーにコピーします。(該当のファイルが存在しない場合も問題ありません。)</li></ol><p><code>C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys</code></p><blockquote><p>※ ProgramData フォルダーは隠しフォルダーです。</p></blockquote><ol start="6"><li>ソフトウェア センターのショートカットが含まれる下記フォルダーを削除します。SCCM 管理コンソールをインストールしている場合は、「Configuraiotn Manager コンソール」のリンクなども本フォルダーに含まれます。管理コンソールはアンインストールしない場合などは、必要に応じて「ソフトウェア センター」のショートカットのみ削除してください。</li></ol><p><code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Microsoft System Center</code></p><blockquote><p>※ ProgramData フォルダーは隠しフォルダーです。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;皆様、こんにちは。System Center Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;以前のバージョンの System Center Configuration Manager クライアントを完全に削除する手順については、次の通りご</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>WSUS の同期先の URL の追加について</title>
    <link href="https://jpmem.github.io/blog/wsus/2019-02-14_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2019-02-14_01/</id>
    <published>2019-02-13T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.896Z</updated>
    
    <content type="html"><![CDATA[<p>2019/03/04 更新：公開情報を更新いたしました。</p><p>みなさま、こんにちは。WSUS サポート チームです。</p><p>WSUS の同期時に接続する URL については以下の公開情報の「2.1.1. Connection from the WSUS server to the Internet」の箇所にて紹介をしておりますが、今回接続先の URL の追加を行いましたため紹介をいたします。</p><ul><li>Step 2: Configure WSUS</li></ul><p><a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#BKM_ConfigurenetworkConnections">https://docs.microsoft.com/en-us/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#BKM_ConfigurenetworkConnections</a></p><p>具体的には、WSUS サーバーが弊社サイトから更新プログラムをダウンロードする際に以下の URL を追加で利用するように変更を行いました。ご不便をおかけしますが、プロキシやファイア ウォールにて接続先の URL を制御している場合には、以下の URL に対する通信についても許可していただけますようお願い申し上げます。</p><p>[ 追加 URL ]</p><p><a href="http://dl.delivery.mp.microsoft.com/">http://dl.delivery.mp.microsoft.com</a></p><p><a href="https://dl.delivery.mp.microsoft.com/">https://dl.delivery.mp.microsoft.com</a></p><p>※1 上述の公開情報についても更新を行う予定です。</p><p>※2 本ブログの執筆時点 (2019 年 2 月 14 日) で本 URL がダウンロード時に用いられている更新プログラムは、Windows 10 Version 1709 向けの KB4486996 のみとなります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;2019/03/04 更新：公開情報を更新いたしました。&lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;/p&gt;
&lt;p&gt;WSUS の同期時に接続する URL については以下の公開情報の「2.1.1. Connection from the WSUS s</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>System Center Configuration Manager AD OU に基づくデバイス コレクションの作成について</title>
    <link href="https://jpmem.github.io/blog/mecm/20181010_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20181010_01/</id>
    <published>2018-10-09T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.848Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。</p><p>日本マイクロソフト System Center Configuration Manager サポートの金です。</p><p>本日は、System Center Configuration Manager Current Branch (以下、SCCM CB) にて、Active Directory の組織単位 (以下、OU) に基づいて、デバイス コレクションを作成する方法をご紹介させていただきます。</p><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><hr><p>AD の OU に基づくコレクションの作成の際には、事前に、Active Directory システムの探索が実施されている必要があります。</p><p>SCCM の探索方法から、”Active Directory システムの探索” が正しく設定され、有効になっていることを確認してください。<br><img src="/blog/mecm/20181010_01/20181010_01_01.png"></p><h2 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h2><hr><p>本手順では、以下の OU をサンプルとしておりますので、お客様の環境に応じて、設定内容を変更していただきますようお願いいたします。</p><p>contoso.local/TestClient/TestOU<br><img src="/blog/mecm/20181010_01/20181010_01_02.png"></p><ol><li><p>SCCM プライマリ サイト サーバーにサインインし、[Configuration Manager コンソール] を開きます。</p></li><li><p>[資産とコンプライアンス] - [概要] - [デバイス コレクション] を右クリックし、[デバイス コレクションの作成] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_03.png"></p></li><li><p>[デバイス コレクションの作成ウィザード] が表示されますので、[全般] 画面で、”名前” に任意の名前を入力し、”限定コレクション” に、[すべてのシステム] を指定後、[次へ] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_04.png"></p></li></ol><ol start="4"><li><p>[メンバーシップの規則] で、[規則の追加] - [クエリ規則] を選択します。<br><img src="/blog/mecm/20181010_01/20181010_01_05.png"></p></li><li><p>[クエリ規則のプロパティ] 画面が表示されますので、[クエリ ステートメントの編集] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_06.png"></p></li><li><p>[クエリ ステートメントのプロパティ] 画面が表示されますので、[条件] タブを開きます。<br><img src="/blog/mecm/20181010_01/20181010_01_07.png"></p></li><li><p>[条件プロパティ] 画面で、”条件の種類” が、[単純な値] であることを確認し、[選択] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_08.png"></p></li><li><p>[属性の選択] の画面が表示されますので、以下のとおり選択し、[OK] をクリックします。</p></li></ol><ul><li>属性クラス : システム リソース</li><li>属性 : システム OU 名<br><img src="/blog/mecm/20181010_01/20181010_01_09.png"></li></ul><ol start="9"><li>[条件プロパティ] に戻りますので、”演算子” と “値” を、以下のように設定し、[OK] をクリックします。</li></ol><ul><li>演算子 : が次と類似</li><li>値 (例) : contoso.local/TestClient/TestOU<br>値につきましては、お客様の環境に合わせて変更してください。<br>“ドメイン名/OU名 (親)/OU名 (子)” の形式となります。<br><img src="/blog/mecm/20181010_01/20181010_01_10.png"></li></ul><ol start="10"><li><p>[クエリ ステートメントのプロパティ] 画面に戻りますので、[OK] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_11.png"></p></li><li><p>[クエリ条件のプロパティ] 画面に戻りますので、[OK] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_12.png"></p></li><li><p>[デバイス コレクションの作成ウィザード] に戻りますので、[次へ] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_13.png"></p></li><li><p>[概要] の画面で、[次へ] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_14.png"></p></li><li><p>[完了] の画面で、[閉じる] をクリックします。<br><img src="/blog/mecm/20181010_01/20181010_01_15.png"></p></li><li><p>[Configuration Manager コンソール] - [資産とコンプライアンス] - [概要] - [デバイス コレクション] の画面にて、上記で作成したデバイス コレクションが表示されていることを確認し、アイコンに、砂時計のマークがなくなるまで待機します。<br><img src="/blog/mecm/20181010_01/20181010_01_16.png"></p></li><li><p>アイコンに、砂時計のマークがなくなりましたら、コレクションをダブルクリックし、指定した OU に所属しているデバイスが該当コレクションに入っていることを確認します。<br><img src="/blog/mecm/20181010_01/20181010_01_17.png"></p></li></ol><p>以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。&lt;/p&gt;
&lt;p&gt;日本マイクロソフト System Center Configuration Manager サポートの金です。&lt;/p&gt;
&lt;p&gt;本日は、System Center Configuration Manager Current Branch </summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>デバイスに適用されないiOSやAndroidポリシーのトラブルシューティング</title>
    <link href="https://jpmem.github.io/blog/intune/%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AB%E9%81%A9%E7%94%A8%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84iOS%E3%82%84Android%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%AE%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/"/>
    <id>https://jpmem.github.io/blog/intune/%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AB%E9%81%A9%E7%94%A8%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84iOS%E3%82%84Android%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%AE%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/</id>
    <published>2018-09-27T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.788Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Microsoft Intune サポートチームの中村です。</p><p>ユーザーが、iOS や Android のポリシーをデバイスに展開したのに、デバイスに適用されないという問題を抱えているのを見かけます。 しかしそれは、ポリシーが OS のバージョンとデバイスの種類と互換性がないか、ポリシーがユーザーまたはデバイスに対して誤ってターゲット設定されているという単純な原因によるものかもしれません。 これを解決する別の方法は、以下に記載したトラブルシューティングの手順に従うことです。</p><ol><li><p>ユーザーを選択したら、Intune ライセンスとアカウント状態が緑色のチェックで表示されていることを確認します。</p></li><li><p>同じページのデバイスで、トラブルシューティングするデバイスを探し、管理者に MDM または EAS/MDM が表示されていることを確認します。 もしこれらの項目が表示されない場合、そのデバイスは登録されていません。 登録されるまでコンプラインアンスポリシーまたはデバイス構成プロファイルを受信しないでしょう。 アプリ保護ポリシー ( MAM ポリシーとしても知られています ) では、登録は必要ありません。</p></li><li><p>Azure AD の結合の種類がワークプレースを表示していることを確認します。もし未登録と表示されているようでしたら、登録中に問題を発生している可能性があります。デバイスの登録を解除して再登録すると、この問題が解決されます。</p></li><li><p>Intune に準拠していると Azure AD に準拠しているが、はいと表示されていることを確認します。 いずれかの項目にいいえと表示されている場合は、以下の問題の 1 つを示唆している可能性があります。</p></li></ol><ul><li>デバイスが、組織のコンプライアンスポリシーで定義された要求を満たしていない。</li><li>デバイスが Intune サービスに接続されていない。</li></ul><ol start="5"><li>最後のチェックインに、最近の日時が表示されていることを確認します。デバイスは少なくとも 8 時間ごとに Intune で確認します。もし最後のチェックインから 24 時間以上経過していたら、デバイスに問題が生じている可能性があります。チェックインできないデバイスは、 Intune からポリシーを受信することが出来ません。デバイスを強制的にチェックインさせるためには、デバイスの OS に一致する以下の一連の手順に従ってください。これらのステップはどのデバイスからも実行可能です。</li></ol><p>6.<br>a. Android に対しては Company Portal app を開いて、デバイスを選択する &gt; リストから問題のデバイス &gt; デバイス設定の確認<br>b. iOS に対しては Company Portal app を開いて、デバイスを選択する &gt; リストから問題のデバイス &gt; 設定の確認<br>c. Windows に対してはデバイスの設定を開き、アカウントを選択する &gt; 職場または学校にアクセス &gt; 該当する接続 &gt; 情報 &gt; 同期</p><p>7  デバイスのポリシーの詳細を見るためにデバイスを選択します。</p><ol start="8"><li>デバイス &gt; 管理で、デバイスの準拠とデバイス構成の両方に移動し、割り当てようとしているデバイスポリシーが一覧表示されていることを確認します。</li></ol><p>9)<br>a. もしポリシーが一覧表示されている場合はその状態を確認します。</p><ul><li>該当なし - このポリシーはこのプラットフォームでサポートされていません。例えば、iOS のポリシーは Android 端末では機能しません。 Samsung の KNOX ポリシーは、 Samsung 以外の KNOX 端末では機能しません。</li><li>競合 - Intune がオーバーライドできないデバイス上の既存の設定があります。</li><li>保留中 - デバイスは Intune にチェックインして、ポリシーを取得していません。</li><li>エラー - Intune documentation で考えられるエラーの一覧を確認します。</li></ul><p>b. もしポリシーが一覧表示されていない場合、ポリシーは正しく割り当てられていません。ポリシーの作成に戻り、ユーザーデバイスにポリシーを割り当てます。</p><p>これにより iOS や Android のポリシーがデバイスに適用されない理由を絞り込むことが出来ます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Microsoft Intune サポートチームの中村です。&lt;/p&gt;
&lt;p&gt;ユーザーが、iOS や Android のポリシーをデバイスに展開したのに、デバイスに適用されないという問題を抱えているのを見かけます。 しかしそれは、ポリシーが OS のバージョンとデ</summary>
      
    
    
    
    
    <category term="Intune" scheme="https://jpmem.github.io/blog/tags/Intune/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Intune の「制限付きアプリ」と「アプリの表示/非表示」機能について</title>
    <link href="https://jpmem.github.io/blog/intune/MicrosoftIntune_constraintedapp_and_displayfunction/"/>
    <id>https://jpmem.github.io/blog/intune/MicrosoftIntune_constraintedapp_and_displayfunction/</id>
    <published>2018-09-25T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.788Z</updated>
    
    <content type="html"><![CDATA[<p>※ 2018/9/26 追記</p><p>「制限付きアプリ」機能がコンプライアンス ポリシーの機能として復活し、利用できるようになりました。(iOS と Android Enterprise)</p><p>これにより、指定したアプリがインストールされている端末を「非準拠」と見なすことができます。</p><p><img src="/blog/intune/MicrosoftIntune_constraintedapp_and_displayfunction/1_MicrosoftIntune_constraintedapp_and_displayfunction.png"></p><p>こんにちは。Microsoft Intune サポート チームです。<br>iOS を利用するユーザーから「端末で使用を許可／禁止するアプリを指定したい」という要望が多くあがります。<br>今回はそのための機能について説明します。</p><p>iOS 用のデバイス制限プロファイルでは、一見類似する 2 つの設定項目があります。<br>それが「制限付きアプリ」と「アプリの表示/非表示」機能です。<br>このうち「制限付きアプリ」機能は現在利用されておらず、「アプリの表示/非表示」機能を利用する必要があります。</p><h2 id="■-アプリの表示-非表示機能"><a href="#■-アプリの表示-非表示機能" class="headerlink" title="■ アプリの表示/非表示機能"></a>■ アプリの表示/非表示機能</h2><p>「アプリの表示/非表示」機能は、iOS 端末上に表示されるアプリを制限する機能です。<br>※ この機能を利用するには、iOS 端末を「<a href="https://support.apple.com/ja-jp/HT202837">監視モード</a>」に設定する必要があります。<br>ホワイトリスト形式で、指定したアプリだけが表示されるようにしたり、ブラックリスト形式で指定したアプリを非表示にすることができます。<br>この機能で非表示状態になったアプリは、iOS 画面にアプリのアイコンが表示されないだけでなく、実際にそのアプリを使用することができません。<br>例えば、Word アプリを非表示にした場合、Outlook アプリに添付された Word ファイルを Word アプリで開くことができなくなります。</p><p>「アプリの表示/非表示」の設定画面はこのようになっています。</p><p><img src="/blog/intune/MicrosoftIntune_constraintedapp_and_displayfunction/1_MicrosoftIntune_constraintedapp_and_displayfunction.png"></p><p>[アプリ URL] または [アプリ バンドル ID] でアプリを特定していますので、この 2 つのいずれかを正確に入力します。</p><ul><li>App Store に公開されているアプリであれば、[アプリ URL] で指定できます。</li><li>iOS にビルトインされているアプリの場合は [アプリ バンドル ID] で指定できます。<a href="https://docs.microsoft.com/ja-jp/mem/intune/configuration/device-restrictions-ios#bundle-id-reference-for-built-in-ios-apps">組み込みアプリのバンドル ID 一覧</a><br>指定するアプリの数が多く、手動での登録がお手間になる場合は、アプリ一覧をインポート・エクスポートする機能もあります。</li></ul><p>注意点としては、複数の「アプリの表示/非表示」プロファイルを同一の端末に展開するとエラーになる点です。<br>これは Apple Configurator のカスタム プロファイルを使用した場合も同様です。<br>「アプリの表示/非表示」設定は、1 デバイスに 1 プロファイルだけが割り当てられるようにしてください。</p><h2 id="■-制限付きアプリ機能について"><a href="#■-制限付きアプリ機能について" class="headerlink" title="■ 制限付きアプリ機能について"></a>■ 制限付きアプリ機能について</h2><p>※ 2018/9/26 追記</p><p>「制限付きアプリ」機能がコンプライアンス ポリシーの機能として復活し、利用できるようになりました。(iOS と Android Enterprise)</p><p>これにより、指定したアプリがインストールされている端末を「非準拠」と見なすことができます。</p><p>「制限付きアプリ」機能は元々 Intune のクラシック コンソール時代に利用されていた機能です。<br>Silverlight で動作する、以前のコンソールを覚えている方もいらっしゃるでしょう。<br>この機能では、「アプリの表示/非表示」のようにアプリの利用を禁止する直接的な効力はありませんでした。<br>管理者が指定したアプリが端末にインストールされているか、いないかという情報を端末側で監査し、クラシック コンソールのレポートで確認する機能でした。<br>Intune が Azure 管理ポータルに移行するにあたり、クラシック コンソールでの MDM 管理機能やレポート機能が廃止されております。</p><p>※移行はテナントごとに行われ、2017 年 10 月 ～ 2018 年 6 月頃には、実質的に「制限付きアプリ」機能は利用できない状態になっています。</p><p>一方で、デバイスからはインベントリとしてアプリの情報が収集されていますので、この情報を基に監査を行うことができます。<br>Azure ポータルの [Intune] - [モバイル アプリ] - [検出されたアプリ] には、インベントリされた全アプリの一覧が表示されます。<br>この情報をエクスポートして、監査に利用することができます。<br>企業所有端末からはインストールされた全アプリ情報が、個人所有端末からは Intune で管理されたアプリの情報のみが収集されます。</p><p>「制限付きアプリ」機能では、実質的に BYOD 端末について、ユーザーのアプリの情報を監査できるというプライバシー上の課題がありましたが、インベントリ機能ではこの課題は解消されています。</p><p>このように、「アプリの表示/非表示」機能を上手く活用することで、組織のアプリ使用を制限可能です。</p><p>また、インベントリ情報を活用することで、社給端末で利用されているアプリ情報を取得可能です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;※ 2018/9/26 追記&lt;/p&gt;
&lt;p&gt;「制限付きアプリ」機能がコンプライアンス ポリシーの機能として復活し、利用できるようになりました。(iOS と Android Enterprise)&lt;/p&gt;
&lt;p&gt;これにより、指定したアプリがインストールされている端末を「非準拠</summary>
      
    
    
    
    
    <category term="Intune" scheme="https://jpmem.github.io/blog/tags/Intune/"/>
    
  </entry>
  
  <entry>
    <title>System Center Configuration Manager における BranchCache、ピアキャッシュ機能について - その 1 (概要編)</title>
    <link href="https://jpmem.github.io/blog/mecm/20180911_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20180911_01/</id>
    <published>2018-09-10T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.848Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。</p><p>日本マイクロソフト System Center Configuration Manager サポートの金です。</p><p>SCCM を運用されている中で、ネットワーク回線が細い拠点を管理対象としている場合、コンテンツの配布によるネットワークの負荷を分散させる工夫が必要な場面がございます。</p><p>本日は、コンテンツの配布の際にネットワークの負荷を軽減できる BranchCache の機能や、ピアキャッシュの機能の概要についてご紹介させていただきますので、お役立ていただけますと幸いでございます。</p><p> これから案内させていただく内容は、以下の流れになります。</p><hr><ol><li><p>BranchCache / ピアキャッシュ機能のご説明</p></li><li><p>BranchCache / ピアキャッシュ機能の設定箇所</p></li><li><p>ピアキャッシュ ログの確認方法</p></li></ol><hr><p>以下は、詳細内容となります。</p><h2 id="1-BranchCache-ピアキャッシュ機能のご説明"><a href="#1-BranchCache-ピアキャッシュ機能のご説明" class="headerlink" title="1. BranchCache / ピアキャッシュ機能のご説明"></a>1. BranchCache / ピアキャッシュ機能のご説明</h2><p>BranchCache 機能とピアキャッシュ機能は、個別に利用することも、両方同時に利用することも可能でございます。</p><p>両機能を同時にご利用の場合は、ピアキャッシュの機能が優先的に動作します。</p><p>以下に、それぞれの機能の詳細についてご記載いたします。</p><h3 id="1-BranchCache-機能について"><a href="#1-BranchCache-機能について" class="headerlink" title="(1) BranchCache 機能について"></a>(1) BranchCache 機能について</h3><p>BranchCache 機能は、Windows OS 固有の機能で、SCCM と連携してお使いいただけます。</p><h3 id="1-1-機能の特徴"><a href="#1-1-機能の特徴" class="headerlink" title="(1) - 1. 機能の特徴"></a>(1) - 1. 機能の特徴</h3><p>BranchCache 機能の特徴といたしましては、以下のようなものがございます。</p><ul><li><p>ログが出力されないため、動作確認には Performance Monitor 等の別途ツールが必要となる</p></li><li><p>更新プログラム、パッケージ、タスク シーケンスは展開可能だが、WinPE を利用した OS 展開はできない</p></li><li><p>キャッシュフォルダーを別途使用する</p></li></ul><p>%Windir%\ServiceProfile\NetworkSerivce\AppData\PeerDistPub</p><ul><li><p>マルチキャスト通信を使用するため、同じサブネットでのみ使用可能である</p></li><li><p>データのやり取りは、ブロック単位で行われる</p></li></ul><h3 id="1-2-設定時の挙動"><a href="#1-2-設定時の挙動" class="headerlink" title="(1) - 2. 設定時の挙動"></a>(1) - 2. 設定時の挙動</h3><p>BranchCache を有効と設定した場合、コンテンツを展開した際に、以下のように挙動します。</p><ol><li><p>SCCM からコレクションに対して、コンテンツを展開し、コンテンツが配布ポイントに配布されます。</p></li><li><p>端末 A が、同じサブネットにある端末に対して、コンテンツのキャッシュがないか探索します。</p></li><li><p>キャッシュが見つからなかった場合、配布ポイントからダウンロードを行います。</p></li><li><p>端末 A は、ダウンロードしたコンテンツの一部のブロックをキャッシュします。</p></li><li><p>端末 B が、同じサブネットにある端末に対して、コンテンツのキャッシュがないか探索します。</p></li><li><p>端末 A から、コンテンツの一部のキャッシュが見つかったため、ダウンロードを行います。</p></li><li><p>端末 B は、同じサブネットにある端末に対して、残りのコンテンツのキャッシュを探索します。</p></li><li><p>端末 C から、コンテンツの一部のキャッシュが見つかったため、ダウンロードを行います。</p></li><li><p>端末 B は、同じサブネット上で、コンテンツのキャッシュが見つからなくなるまで上記の動きを繰り返し、最終的に見つからなかった部分については、配布ポイントからダウンロードを行います。</p></li><li><p>端末 B は、ダウンロードしたコンテンツの一部をキャッシュします。</p></li></ol><h3 id="2-ピアキャッシュ機能について"><a href="#2-ピアキャッシュ機能について" class="headerlink" title="(2) ピアキャッシュ機能について"></a>(2) ピアキャッシュ機能について</h3><p>ピアキャッシュは、SCCM 独自の機能となり、SCCM cb 1610 でプレリリースされ、1710 から正式にサポートしております。</p><h3 id="2-1-機能の特徴"><a href="#2-1-機能の特徴" class="headerlink" title="(2) - 1. 機能の特徴"></a>(2) - 1. 機能の特徴</h3><p>ピアキャッシュの特徴は、以下のようなものがございます。</p><ul><li><p>ログが出力されるため、動作確認が可能である</p></li><li><p>更新プログラム、パッケージ等はもちろん、OS も展開可能である</p></li><li><p>SCCM のキャッシュフォルダーの ccmcache を使用する</p></li></ul><p>%Windir%\ccmcache</p><ul><li><p>サブネットが異なる場合でも、境界グループ内であれば使用可能である</p></li><li><p>データのやり取りは、パッケージ単位で行われる</p></li><li><p>SCCM コンソールから、ピアキャッシュのダウンロード状況が確認可能である</p></li></ul><h3 id="2-2-留意点"><a href="#2-2-留意点" class="headerlink" title="(2) - 2. 留意点"></a>(2) - 2. 留意点</h3><p>バージョン 1702 以降からは、以下のいずれかの条件に合致した場合、アクセスが制限されますので、ご留意ください。</p><p>詳しくは、下記のご参考資料 1 をご覧ください。</p><ul><li><p>バッテリ低下モードの場合。</p></li><li><p>コンテンツの要求時に CPU 負荷が 80% を超えている場合。</p></li><li><p>ディスク I/O の AvgDiskQueueLength が 10 を超えている場合。</p></li><li><p>新たにコンピューターに接続できない場合。</p></li></ul><h3 id="2-3-設定時の挙動"><a href="#2-3-設定時の挙動" class="headerlink" title="(2) - 3. 設定時の挙動"></a>(2) - 3. 設定時の挙動</h3><p>ピアキャッシュを有効と設定した場合、コンテンツを展開した際に、以下のように挙動します。</p><ol><li><p>SCCM からコレクションに対して、コンテンツを展開し、コンテンツが配布ポイントに配布されます。</p></li><li><p>ピアキャッシュ ソースとして設定されている端末 A が、管理ポイントに対して、コンテンツのダウンロードが可能な場所を問い合わせます。</p></li><li><p>管理ポイントは、端末 A と同じ境界グループの中で、コンテンツのダウンロードが可能な場所のリストを返します。</p></li><li><p>管理ポイントからのリストには、配布ポイントの場所のみがあったため、端末 A は、配布ポイントからコンテンツのダウンロードを行います。</p></li><li><p>端末 A は、管理ポイントに、自分が持っているキャッシュの情報を報告します。</p></li><li><p>管理ポイントは、同じコンテンツのダウンロード場所をリクエストしてくる端末 B に対して、端末 A と配布ポイントの場所を返します。</p></li><li><p>端末 B は、端末 A、配布ポイントのどちらかからコンテンツをダウンロードします。</p></li></ol><p>端末 B が、ピアキャッシュ ソースとして設定されていない場合は、ここで処理が完了し、ピアキャッシュ ソースとして設定されている場合は、管理ポイントに、自分が持っているキャッシュの情報を報告します。</p><p>&lt; ご参考資料 &gt;</p><ol><li>“Configuration Manager クライアントのピアキャッシュ”</li></ol><p>ピアキャッシュの機能の詳細については、以下の公開資料がございます。</p><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/hierarchy/client-peer-cache">https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/hierarchy/client-peer-cache</a></p><ol start="2"><li>“BranchCache vs. Peer Cache” (英文)</li></ol><p>以下は、英文となっておりますが、BranchCache と ピアキャッシュの差異について</p><p>記載されており、機能の導入をご検討される際に、お役立ていただけますと幸いです。</p><p><a href="https://blogs.technet.microsoft.com/swisspfe/2018/01/25/branch-cache-vs-peer-cache/">https://blogs.technet.microsoft.com/swisspfe/2018/01/25/branch-cache-vs-peer-cache/</a></p><h2 id="2-BranchCache-ピアキャッシュ機能の設定箇所"><a href="#2-BranchCache-ピアキャッシュ機能の設定箇所" class="headerlink" title="2. BranchCache / ピアキャッシュ機能の設定箇所"></a>2. BranchCache / ピアキャッシュ機能の設定箇所</h2><p>以下に、それぞれの機能を利用するにあたり、必要な設定箇所を記載させていただきます。</p><h3 id="1-BranchCache-機能の設定箇所"><a href="#1-BranchCache-機能の設定箇所" class="headerlink" title="(1) BranchCache 機能の設定箇所"></a>(1) BranchCache 機能の設定箇所</h3><ol><li><p>配布ポイントの役割を持つサイト サーバーに、BranchCache 機能を追加します。</p></li><li><p>[Configuration Manager コンソール] - [管理] - [概要] - [配布ポイント] から、配布ポイントのプロパティを開き、</p></li></ol><p>[全般] タブで、”この配布ポイントの BranchCache を有効にして構成する” にチェックを入れ、適用します。</p><ol start="3"><li>[Configuration Manager コンソール] - [管理] - [概要] - [クライアント設定] から、</li></ol><p>以下のカスタム クライアント設定を作成し、お客様の環境に合わせて設定後、コレクションに展開します。</p><p>“クライアント キャッシュの設定”</p><ul><li><p>BranchCache の構成 : “はい”</p></li><li><p>BranchCache の有効化 : “はい”</p></li></ul><p>その他の項目は、任意で設定してください。</p><ol start="4"><li>コンテンツを展開する際に、展開ウィザードの [配布ポイント] の画面で、以下にチェックを入れます。</li></ol><p>“同じサブネットにあるほかのクライアントとのコンテンツの共有を許可する”</p><p><img src="/blog/mecm/20180911_01/20180911_01_01.png"></p><h2 id="2-ピアキャッシュ機能の設定箇所"><a href="#2-ピアキャッシュ機能の設定箇所" class="headerlink" title="(2) ピアキャッシュ機能の設定箇所"></a>(2) ピアキャッシュ機能の設定箇所</h2><ol><li><p>ピアキャッシュ機能を有効とする境界グループを作成します。</p></li><li><p>[Configuration Manager コンソール] - [資産とコンプライアンス] - [概要] - [デバイス コレクション] から、</p></li></ol><p>新しいデバイス コレクションを作成し、ピアキャッシュ ソースとして指定したいデバイスを追加します。</p><ol start="3"><li>[Configuration Manager コンソール] - [管理] - [概要] - [クライアント設定] から、</li></ol><p>カスタム クライアント設定を作成し、お客様の環境に合わせて設定後、コレクションに展開します。</p><p>“クライアント キャッシュの設定”</p><ul><li><p>完全な OS 状の Configuration Manager クライアントでコンテンツを共有できるようにする : “はい”</p></li><li><p>初期ネットワーク ブロードキャスト用ポート: “任意” (既定 8004)</p></li><li><p>ピアからのコンテンツのダウンロード用ポート : “任意” (既定 8003)</p></li></ul><p>その他の項目は、任意で設定してください。</p><p><img src="/blog/mecm/20180911_01/20180911_01_02.png"></p><p>&lt; ご参考資料 &gt;</p><p>以下の資料に、クライアント設定の詳細が記載されております。</p><p>“System Center Configuration Manager のクライアント設定について”</p><ul><li>“クライアント キャッシュ設定”</li></ul><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/deploy/about-client-settings#client-cache-settings">https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/deploy/about-client-settings#client-cache-settings</a></p><h2 id="3-ピアキャッシュ-ログの確認方法"><a href="#3-ピアキャッシュ-ログの確認方法" class="headerlink" title="3. ピアキャッシュ ログの確認方法"></a>3. ピアキャッシュ ログの確認方法</h2><p>ピアキャッシュ機能を有効にし、最初のピアキャッシュ ソース クライアントが配布ポイントからコンテンツをダウンロードした後、以下のログに、コンテンツがキャッシュされたことが出力されます。</p><h3 id="StateMessage-log"><a href="#StateMessage-log" class="headerlink" title="StateMessage.log"></a>StateMessage.log</h3><p>———— 出力例 ————</p><p>Adding message with TopicType 7200 and TopicId Cache add T020000B.1 to WMI StateMessage 2018/05/17 10:41:59 36728 (0x8F78) State message(State ID : 1) with TopicType 7200 and TopicId Cache add T020000B.1 has been recorded for SYSTEM StateMessage 2018/05/17 10:41:59 36728 (0x8F78) Successfully forwarded State Messages to the MP StateMessage 2018/05/17 10:43:00 36728 (0x8F78)</p><p>———— 出力例 ————   他のクライアントが、ピアキャッシュ ソースとなっているクライアントから、コンテンツをダウンロードする際は、以下の 3 つのログに、その旨が出力されます。</p><h3 id="CAS-log"><a href="#CAS-log" class="headerlink" title="CAS.log"></a>CAS.log</h3><p>———— 出力例 ————</p><p>**** Received request for content T020000B.1, size(KB) 737, under context System with priority Low. ContentAccess 2018/05/17 10:47:03 3228 (0x0C9C)<br>CacheManager: There are currently 0 bytes used for cached content items (0 total, 0 active, 0 tombstoned, 0 expired). ContentAccess 2018/05/17 10:47:03 3228 (0x0C9C)</p><p>(中略)</p><p>Download started for content T020000B.1 ContentAccess 2018/05/17 10:47:04 3228 (0x0C9C)<br>Location update from CTM for content T020000B.1 and request {A6D8A569-FDC5-48DA-9CEC-5F77D27663B9} ContentAccess 2018/05/17 10:47:04 3712 (0x0E80)<br>Matching DP location found 0 - <a href="https://contoso-cl04.contoso.local:8003/sccm_branchcache$/t020000b">https://contoso-cl04.contoso.local:8003/sccm_branchcache$/t020000b</a> (Locality: PEER) ContentAccess 2018/05/17 10:47:04 3712 (0x0E80)<br>Matching DP location found 1 - <a href="http://tamai-cm02.tamai-ms.local/sms_dp_smspkg$/t020000b">http://tamai-cm02.tamai-ms.local/sms_dp_smspkg$/t020000b</a> (Locality: BOUNDARYGROUP) ContentAccess 2018/05/17 10:47:04 3712 (0x0E80)<br>Download request only, ignoring location update ContentAccess 2018/05/17 10:47:04 3712 (0x0E80)</p><p>———— 出力例 ————</p><h3 id="ContentTransferManager-log"><a href="#ContentTransferManager-log" class="headerlink" title="ContentTransferManager.log"></a>ContentTransferManager.log</h3><p>———— 出力例 ————</p><p>Starting CTM job {18E631ED-390B-4725-9010-1F9132E4BD7F}. ContentTransferManager 2018/05/17 10:47:03 3228 (0x0C9C)<br>Created CTM job {18E631ED-390B-4725-9010-1F9132E4BD7F} for user S-1-5-18 ContentTransferManager 2018/05/17 10:47:03 3228 (0x0C9C)<br>Created and Sent Location Request ‘{21A682C1-51B7-4C63-9FBE-ED3141CEEC29}’ for package T020000B ContentTransferManager 2018/05/17 10:47:04 3712 (0x0E80)<br>CTM job {18E631ED-390B-4725-9010-1F9132E4BD7F} entered phase CCM_DOWNLOADSTATUS_WAITING_CONTENTLOCATIONS ContentTransferManager 2018/05/17 10:47:04 3712 (0x0E80)<br>Queued location request ‘{21A682C1-51B7-4C63-9FBE-ED3141CEEC29}’ for CTM job ‘{18E631ED-390B-4725-9010-1F9132E4BD7F}’. ContentTransferManager 2018/05/17 10:47:04 3712 (0x0E80)<br>Persisted locations for CTM job {18E631ED-390B-4725-9010-1F9132E4BD7F}:<br>(PEER) <a href="https://contoso-cl04.contoso.local:8003/SCCM_BranchCache$/T020000B">https://CONTOSO-CL04.CONTOSO.local:8003/SCCM_BranchCache$/T020000B</a> (BOUNDARYGROUP) <a href="http://tamai-cm02.tamai-ms.local/SMS_DP_SMSPKG$/T020000B">http://TAMAI-CM02.tamai-ms.local/SMS_DP_SMSPKG$/T020000B</a> ContentTransferManager 2018/05/17 10:47:04 2352 (0x0930)</p><p>(中略)</p><p>CTM job {18E631ED-390B-4725-9010-1F9132E4BD7F} successfully processed download completion. ContentTransferManager 2018/05/17 10:47:52 3712 (0x0E80)cess 2018/05/17 10:47:04 3712 (0x0E80)</p><p>———— 出力例 ————</p><h3 id="DataTransferService-log"><a href="#DataTransferService-log" class="headerlink" title="DataTransferService.log"></a>DataTransferService.log</h3><p>———— 出力例 ————</p><p>DTSJob {CCB7F7D2-8E93-47F1-9BCB-AAFB4CF93C0F} created to download from ‘<a href="https://contoso-cl04.contoso.local:8003/SCCM_BranchCache$/T020000B&#39;">https://CONTOSO-CL04.CONTOSO.local:8003/SCCM_BranchCache$/T020000B&#39;</a> to ‘C:\Windows\ccmcache\1’. DataTransferService 2018/05/17 10:47:05 2352 (0x0930)<br>DTSJob {CCB7F7D2-8E93-47F1-9BCB-AAFB4CF93C0F} in state ‘DownloadingManifest’. DataTransferService 2018/05/17 10:47:05 3712 (0x0E80)<br>Raising event:<br>instance of CCM_CcmHttp_Status<br>{<br>ClientID = “GUID:64C1E4AF-793E-4B65-BBD9-8DC0C33E7087”;<br>DateTime = “20180517014712.077000+000”;<br>HostName = “CONTOSO-CL04.CONTOSO.local”;<br>HRESULT = “0x00000000”;<br>ProcessID = 2316;<br>StatusCode = 0;<br>ThreadID = 2248;<br>};</p><p>(中略)</p><p>DTS job {CCB7F7D2-8E93-47F1-9BCB-AAFB4CF93C0F} has completed:<br>Status : SUCCESS,<br>Start time : 05/17/2018 10:47:05,<br>Completion time : 05/17/2018 10:47:52,<br>Elapsed time : 47 seconds DataTransferService 2018/05/17 10:47:52 3500 (0x0DAC) </p><p>———— 出力例 ————</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。&lt;/p&gt;
&lt;p&gt;日本マイクロソフト System Center Configuration Manager サポートの金です。&lt;/p&gt;
&lt;p&gt;SCCM を運用されている中で、ネットワーク回線が細い拠点を管理対象としている場合、コンテンツの配布によるネッ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>SCCM CB 自動クライアント アップグレード手順</title>
    <link href="https://jpmem.github.io/blog/mecm/20180823_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20180823_01/</id>
    <published>2018-08-22T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.816Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。</p><p>日本マイクロソフト System Center Configuration Manager サポートチームです。</p><p>本日は、System Center Configuration Manager Current Branch (以下、SCCM CB) クライアントをサイトのバージョンアップ後、自動的にアップグレードする手順についてご案内させていただきます。<br>SCCM CB クライアントのアップグレード方法は、以下のように、複数がございます。</p><p>・自動クライアント アップグレード<br>・クライアント プッシュ インストール<br>・グループ ポリシーによるインストール<br>・ログオン スクリプトによるインストール<br>・手動インストール<br>・アップグレード インストール</p><p>お客様環境の運用方式に従い、お選びいただけますが、その中で、これからご案内する自動クライアント アップグレードは、一番作業の手間が少ない方法となりますので、クライアントのアップグレードの際に、本機能のご利用をご検討いただけますと幸いです。</p><h2 id="クライアント-アップグレード動作の流れ"><a href="#クライアント-アップグレード動作の流れ" class="headerlink" title="クライアント アップグレード動作の流れ"></a>クライアント アップグレード動作の流れ</h2><ol><li><p>[Configuration Manager コンソール] を開き、以下の画面に移動します。<br>[管理] - [概要] - [サイトの構成] - [サイト]<br><img src="/blog/mecm/20180823_01/20180823_01_01.png"></p></li><li><p>リボンメニューから、[階層設定] をクリックします。<br><img src="/blog/mecm/20180823_01/20180823_01_02.png"></p></li><li><p>[階層設定のプロパティ] の画面で、[クライアント アップグレード] タブを開きます。<br><img src="/blog/mecm/20180823_01/20180823_01_03.png"></p></li><li><p>[実稼働クライアント バージョン] が、アップグレードしたいクライアントのバージョンと一致していることを確認し、”実稼働クライアントを使用して階層内のすべてのクライアントをアップグレードする” にチェックを入れます。</p></li><li><p>“階層内のすべてのクライアントの自動アップグレードを有効にするオプションを選択しました。…” とのメッセージが表示されますので、[OK] をクリックします。<br><img src="/blog/mecm/20180823_01/20180823_01_04.png"></p></li><li><p>[実稼働クライアント バージョン] の、”実稼働クライアントを使用して階層内のすべてのクライアントをアップグレードする” にチェックが入ったことを確認し、”次の日数以内にクライアントを自動アップグレードする” の設定を行います。<br>選択可能な範囲は、1 から 31 となります。<br>ここで指定した期間内のランダムなタイミングで、クライアントがアップグレードされます。<br><img src="/blog/mecm/20180823_01/20180823_01_05.png"></p></li><li><p>[OK] ボタンをクリックし、画面を閉じます。</p></li><li><p>[管理] - [概要] - [更新とサービス] に移動し、最新バージョンの更新項目を選択の上、リボンメニューから [実稼働前クライアントの昇格] をクリックします。<br>ここで、確認メッセージが表示されますので、[昇格] をクリックします。<br><img src="/blog/mecm/20180823_01/20180823_01_06.png"></p></li></ol><p>手順は、以上となります。</p><p>管理対象が多い大規模の環境では、自動クライアント アップグレードの機能を有効にすることで、一気にクライアントのアップグレードがされ、ネットワークを逼迫することが懸念点として考えられますが、上記の設定画面にて、自動アップグレードの期間を長く指定してきただくことで、ネットワークの負荷を分散することができます。</p><p>例えば、指定可能な最長日数の 31 としていただきますと、クライアントは、1 ~ 31 日の期間中、ランダムの日付に、アップグレードを行います。<br>念の為、具体的なクライアントのアップグレード動作を、補足説明いたしますのでご参考いただけますと幸いです。</p><h2 id="クライアント-アップグレードの動作の流れ"><a href="#クライアント-アップグレードの動作の流れ" class="headerlink" title="クライアント アップグレードの動作の流れ"></a>クライアント アップグレードの動作の流れ</h2><ol><li> SCCM サーバにおいて自動クライアント アップグレードを有効にする際に、アップグレード期間を指定します。</li><li>クライアントが自動クライアント アップグレードのポリシーを受信します。</li><li>クライアントのタスク スケジューラに、指定した日数内で、ランダムな日時に開始されるクライアント アップグレードのタスクが登録されます。</li><li>登録されたタスクに開始時刻に、クライアントはそれぞれアップグレードを開始します。<br><img src="/blog/mecm/20180823_01/20180823_01_07.png"><br><img src="/blog/mecm/20180823_01/20180823_01_08.png"></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。&lt;/p&gt;
&lt;p&gt;日本マイクロソフト System Center Configuration Manager サポートチームです。&lt;/p&gt;
&lt;p&gt;本日は、System Center Configuration Manager Current Branch</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>System Center Configuration Manager サイトのアップグレード手順</title>
    <link href="https://jpmem.github.io/blog/mecm/20180823_02/"/>
    <id>https://jpmem.github.io/blog/mecm/20180823_02/</id>
    <published>2018-08-22T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.824Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。</p><p>日本マイクロソフト System Center Configuration Manager サポートチームです。</p><p>本日は、System Center Configuration Manager Current Branch (以下、SCCM CB) をアップグレードする手順をご案内させていただきます。<br>SCCM CB のバージョンアップは、最上位のサイト サーバーで実施します。<br>中央管理サイト サーバーがある階層型の環境の場合、中央管理サイト サーバーで、プライマリ サイト サーバーの環境の場合は、プライマリ サイト サーバーで実施してください。<br>最上位のサイト サーバーがアップグレードされる過程で、その配下のサイト サーバーや、管理ポイント、配布ポイント等のサイトシステムは、自動的に更新されます。</p><p>これから、SCCM CB 1710 から、最新バージョンの SCCM CB 1802 へのアップグレード手順をご案内いたします。<br>また、SCCM CB でのアップグレードは累積となり、新しいバージョンが古いバージョンの内容を含んでおりますため、中間バージョンを踏まずに、最新バージョンにアップグレードすることができます。<br>なお、SCCM CB の場合、他のバージョンからでも、本手順と同様な手順でアップグレードすることができます。</p><h3 id="本手順は、以下の流れとなっております。"><a href="#本手順は、以下の流れとなっております。" class="headerlink" title="本手順は、以下の流れとなっております。"></a>本手順は、以下の流れとなっております。</h3><hr><p>A. SCCM CB バージョンアップの手順<br>B. アップグレードの状況を確認する手順<br>C. SCCM CB バージョンを確認する手順<br>D. サイト システムのアップグレード完了を確認する手順</p><hr><h2 id="A-SCCM-CB-バージョンアップの手順"><a href="#A-SCCM-CB-バージョンアップの手順" class="headerlink" title="A. SCCM CB バージョンアップの手順"></a>A. SCCM CB バージョンアップの手順</h2><ol><li>[Configuration Manager コンソール] から、以下の画面に移動します。</li></ol><p>-[管理] - [概要] - [更新とサービス]<br><img src="/blog/mecm/20180823_02/20180823_02_01.png"></p><ol start="2"><li><p>[更新とサービス] の一覧から、”Configuration Manager 1802” の [状態] を確認します。<br><img src="/blog/mecm/20180823_02/20180823_02_02.png"></p></li><li><p>[状態] が、”ダウンロード可能” の場合は、”Configuration Manager 1802” と右クリックし、[ダウンロード] をクリックします。<br>[状態] が、”インストール” の場合は、”インストールの準備完了” の場合は、既にダウンロード済みとなりますので、手順 7 からご実施ください。<br><img src="/blog/mecm/20180823_02/20180823_02_03.png"></p></li><li><p>“更新プログラムを確認しています。…” とのメッセージが表示されますので、[OK] をクリックします。<br><img src="/blog/mecm/20180823_02/20180823_02_04.png"></p></li><li><p>ダウンロードが開始されますので、ダウンロードが完了するまで、しばらく待機します。</p></li><li><p>ダウンロードが完了し、上記の手順 2 の 画面の [更新とサービス] の一覧から、”Configuration Manager 1802” の [状態] が “インストールの準備完了” となっていることを確認します。<br><img src="/blog/mecm/20180823_02/20180823_02_05.png"></p></li><li><p>“Configuration Manager 1802” を右クリックし、[更新プログラム パックのインストール] をクリックします。<br><img src="/blog/mecm/20180823_02/20180823_02_06.png"></p></li><li><p>[Configuration Manager 更新ウィザード] が表示されますので、[全般] の画面で、[次へ] をクリックします。<br><img src="/blog/mecm/20180823_02/20180823_02_07.png"></p></li><li><p>[機能] の画面で、追加したい機能がございましたら、チェックを入れ、[次へ] をクリックします。<br>機能は、必要になった場合、後から追加することもできます。<br>本手順では、既定のとおり、そのまま [次へ] とさせていただきます。<br><img src="/blog/mecm/20180823_02/20180823_02_08.png"></p></li><li><p>[クライアント更新プログラムのオプション] の画面で、サイトとともに、そのままクライアントをアップグレードする場合は、”検証なしでアップグレードする” を選択し、[次へ] をクリックします。<br>クライアント アップグレードの検証をする場合は、”実稼働前コレクションで検証する” を選択し、検証用コレクションを指定後、[次へ] をクリックします。<br>本手順では、既定のとおり、”検証なしでアップグレードする” を選択させていただきます。<br><img src="/blog/mecm/20180823_02/20180823_02_09.png"></p></li><li><p>[ライセンス条項] の画面で、”ライセンス条項およびプライバシーに関する声明に同意する” にチェックを入れ、[次へ] をクリックします。<br><img src="/blog/mecm/20180823_02/20180823_02_10.png"></p></li><li><p>[概要] の画面で、[次へ] をクリックします。<br><img src="/blog/mecm/20180823_02/20180823_02_11.png"></p></li><li><p>更新ウィザードが正常に完了したことを確認し、[閉じる] をクリックします。<br><img src="/blog/mecm/20180823_02/20180823_02_12.png"></p></li><li><p>“Configuration Manager 1802” の [状態] が、”前提条件をチェックしています” と更新され、前提条件のチェック処理が開始されます。</p></li></ol><p>前提条件で問題なく合格した場合、そのままインストールに進みますので、しばらく待機します。<br>インストールの状況を確認する手順につきましては、本文の最後に補足として記載させていただきます。<br><img src="/blog/mecm/20180823_02/20180823_02_13.png"></p><ol start="15"><li><p>インストールが完了しますと、 “Configuration Manager 1802” の [状態] が、”インストール済み” と更新されます。<br><img src="/blog/mecm/20180823_02/20180823_02_14.png"></p></li><li><p>[Configuration Manager 1802 修正プログラム” をインストールする場合は、上記のインストール手順と同様に、対象更新プログラムをダウンロード後、インストールをご実施いただくことで、適用可能です。<br>上記で、SCCM CB のバージョンアップ後、コンソールの操作を行う際に、”新しいバージョンのコンソールを使用できます” のメッセージが表示される場合、[OK] をクリックします。</p></li></ol><p>コンソールが閉じられ、コンソールのバージョンアップが開始されますので、しばらく待機した後に、コンソールを開いてくださいますようお願いいたします。<br><img src="/blog/mecm/20180823_02/20180823_02_15.png"></p><h2 id="B-アップグレードの状況を確認する手順"><a href="#B-アップグレードの状況を確認する手順" class="headerlink" title="B. アップグレードの状況を確認する手順"></a>B. アップグレードの状況を確認する手順</h2><ol><li><p>[Configuration Manager コンソール] から、以下の画面に移動します。<br>[管理] - [概要] - [更新とサービス]<br><img src="/blog/mecm/20180823_02/20180823_02_16.png"></p></li><li><p>[更新とサービス] の一覧から、”Configuration Manager 1802” を選択し、画面の下段にある “ステータスの表示” をクリックします。<br><img src="/blog/mecm/20180823_02/20180823_02_17.png"></p></li><li><p>続きます画面で、リボンメニューから、”ステータスの表示” のボタンをクリックします。<br><img src="/blog/mecm/20180823_02/20180823_02_18.png"></p></li><li><p>[更新プログラム パッケージのインストール ステータス] の画面にて、インストール状況がご確認いただけます。<br><img src="/blog/mecm/20180823_02/20180823_02_19.png"></p></li></ol><h2 id="C-SCCM-CB-バージョンを確認する手順"><a href="#C-SCCM-CB-バージョンを確認する手順" class="headerlink" title="C. SCCM CB バージョンを確認する手順"></a>C. SCCM CB バージョンを確認する手順</h2><ol><li><p>[Configuration Manager コンソール] の左上にある逆三角形のボタンをクリックし、[Configuration Manager のバージョン情報] をクリックします。<br><img src="/blog/mecm/20180823_02/20180823_02_20.png"></p></li><li><p>[System Center Configuration Manager のバージョン情報] の画面の”バージョン” にて、サイトのバージョンをご確認いただけます。<br><img src="/blog/mecm/20180823_02/20180823_02_21.png"></p></li></ol><h2 id="D-サイト-システムのアップグレード完了を確認する手順"><a href="#D-サイト-システムのアップグレード完了を確認する手順" class="headerlink" title="D. サイト システムのアップグレード完了を確認する手順"></a>D. サイト システムのアップグレード完了を確認する手順</h2><p>上述の通り、サイトのアップグレードが完了すると、管理ポイントや配布ポイントなどのサイト システムは自動的にアップグレードが行われます。</p><p>以下の手順で、サイトのアップグレード後にサイト システムのアップグレードが成功していることをご確認頂けます。</p><h2 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h2><ol><li><p>Configuration Manager コンソールを開き、以下の順に展開します。<br>[監視] - [概要] - [システムのステータス] - [コンポーネントのステータス]</p></li><li><p>右ペインに表示された一覧から、以下のコンポーネントを右クリックし、 [メッセージ表示] - [すべて] をクリックします。</p></li></ol><p>管理ポイントの場合 : SMS_MP_CONTROL_MANAGER<br>配布ポイントの場合 : SMS_DISTRIBUTION_MANAGER<br>ソフトウェアの更新ポイントの場合 : SMS_WSUS_CONFIGURATION_MANAGER</p><ol start="3"><li><p>表示期間を設定するダイアログ ボックスが開きますので、”1 ヵ月前” などアップグレード完了日時を含む期間を選択し、[OK] をクリックします。</p></li><li><p>アップグレードされた付近の日時にて、以下のようにメッセージ ID 1017, 1018, 1019 のログが記録されていることを確認します。</p></li></ol><p>記録されていれば、コンポーネントが正常にアップグレードされたと判断頂けます。</p><p>・管理ポイント (SMS_MP_CONTROL_MANAGER)<br>重要度 種類 サイト コード 日付/時刻 システム コンポーネント メッセージ ID 説明<br>情報 マイルストーン T01 2018/03/26 23:13:09 MP01.MS.LOCAL SMS_MP_CONTROL_MANAGER 500 このコンポーネントが開始しました。<br>情報 マイルストーン T01 2018/03/26 23:13:07 MP01.MS.LOCAL SMS_MP_CONTROL_MANAGER <strong>1019</strong> <strong>サイト</strong> <strong>コンポーネント</strong> <strong>マネージャーは、このサイト</strong> <strong>システムにこのコンポーネントを正常に再インストールしました。</strong><br>情報 マイルストーン T01 2018/03/26 23:11:12 MP01.MS.LOCAL SMS_MP_CONTROL_MANAGER 1018 サイト コンポーネント マネージャーは、このサイト システムにこのコンポーネントを再インストールしています。<br>情報 マイルストーン T01 2018/03/26 23:08:02 MP01.MS.LOCAL SMS_MP_CONTROL_MANAGER 1017 サイト コンポーネント マネージャーは、このサイト システムにこのコンポーネントを再インストールする必要があることを検出しました。サイト コンポーネント マネージャーは、コンポーネントが正常にインストールされるまで、60 分ごとにインストールを試行します。</p><p>・配布ポイント (SMS_DISTRIBUTION_MANAGER)<br>情報 マイルストーン T01 2018/03/26 23:12:38 DP01.MS.LOCAL SMS_DISTRIBUTION_MANAGER 500 このコンポーネントが開始しました。<br>情報 マイルストーン T01 2018/03/26 23:12:37 DP01.MS.LOCAL SMS_DISTRIBUTION_MANAGER <strong>1019</strong> <strong>サイト</strong> <strong>コンポーネント</strong> <strong>マネージャーは、このサイト</strong> <strong>システムにこのコンポーネントを正常に再インストールしました。</strong><br>情報 マイルストーン T01 2018/03/26 23:12:37 DP01.MS.LOCAL SMS_DISTRIBUTION_MANAGER 1018 サイト コンポーネント マネージャーは、このサイト システムにこのコンポーネントを再インストールしています。<br>情報 マイルストーン T01 2018/03/26 23:08:01 DP01.MS.LOCAL SMS_DISTRIBUTION_MANAGER 1017 サイト コンポーネント マネージャーは、このサイト システムにこのコンポーネントを再インストールする必要があることを検出しました。サイト コンポーネント マネージャーは、コンポーネントが正常にインストールされるまで、60 分ごとにインストールを試行します。</p><p>・ソフトウェアの更新ポイント (SMS_WSUS_CONFIGURATION_MANAGER)<br>情報 マイルストーン T01 2018/03/26 23:24:36 SUP01.MS.LOCAL SMS_WSUS_CONFIGURATION_MANAGER 500 このコンポーネントが開始しました。<br>情報 マイルストーン T01 2018/03/26 23:24:35 SUP01.MS.LOCAL SMS_WSUS_CONFIGURATION_MANAGER <strong>1019</strong> <strong>サイト</strong> <strong>コンポーネント</strong> <strong>マネージャーは、このサイト</strong> <strong>システムにこのコンポーネントを正常に再インストールしました。</strong><br>情報 マイルストーン T01 2018/03/26 23:24:28 SUP01.MS.LOCAL SMS_WSUS_CONFIGURATION_MANAGER 1018 サイト コンポーネント マネージャーは、このサイト システムにこのコンポーネントを再インストールしています。<br>情報 マイルストーン T01 2018/03/26 23:09:16 SUP01.MS.LOCAL SMS_WSUS_CONFIGURATION_MANAGER 1017 サイト コンポーネント マネージャーは、このサイト システムにこのコンポーネントを再インストールする必要があることを検出しました。サイト コンポーネント マネージャーは、コンポーネントが正常にインストールされるまで、60 分ごとにインストールを試行します。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。&lt;/p&gt;
&lt;p&gt;日本マイクロソフト System Center Configuration Manager サポートチームです。&lt;/p&gt;
&lt;p&gt;本日は、System Center Configuration Manager Current Branch</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>インターネットベースのクライアント管理 (IBCM) のセットアップに関する注意事項につきまして</title>
    <link href="https://jpmem.github.io/blog/mecm/20180706_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20180706_01/</id>
    <published>2018-07-05T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.816Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>本記事では、Microsoft Endpoint Configuration Manager (以下 MECM) を利用し、インターネット ベースのクライアント管理 (Internet-Based Client Management: IBCM) 環境を構成する上で、証明書の取り扱いに関する注意事項をご紹介いたします。</p><h2 id="目次："><a href="#目次：" class="headerlink" title="目次："></a>目次：</h2><h3 id="1-IBCM-の概要・仕組み"><a href="#1-IBCM-の概要・仕組み" class="headerlink" title="(1) IBCM の概要・仕組み"></a>(1) IBCM の概要・仕組み</h3><h3 id="2-サーバー証明書のサブジェクト名について"><a href="#2-サーバー証明書のサブジェクト名について" class="headerlink" title="(2) サーバー証明書のサブジェクト名について"></a>(2) サーバー証明書のサブジェクト名について</h3><h3 id="3-ccmsetup-exe-で付与するオプション"><a href="#3-ccmsetup-exe-で付与するオプション" class="headerlink" title="(3) ccmsetup.exe で付与するオプション"></a>(3) ccmsetup.exe で付与するオプション</h3><h3 id="4-サイトサーバーのプロパティ設定の変更"><a href="#4-サイトサーバーのプロパティ設定の変更" class="headerlink" title="(4) サイトサーバーのプロパティ設定の変更"></a>(4) サイトサーバーのプロパティ設定の変更</h3><hr><h2 id="1-IBCM-の概要・仕組み-1"><a href="#1-IBCM-の概要・仕組み-1" class="headerlink" title="(1) IBCM の概要・仕組み"></a>(1) IBCM の概要・仕組み</h2><p>IBCM では、企業ネットワークに接続されておらず、標準的なインターネットに接続されている MECM クライアントを管理できます。<br>公衆ネットワーク上のクライアント コンピューターの管理には、高いセキュリティが求められるので、インターネット ベースのクライアント管理では、クライアントとその接続先サイト システム サーバーで PKI 証明書を使用する必要があります。  </p><p>当環境では、VPN 接続は不要であるため、インターネット接続のみでインベントリ収集や更新プログラムの配信などを行いたいシナリオでご利用いただけます。<br>詳細は以下 URL に記載がございますのでご参照ください。  </p><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/plan-internet-based-client-management">System Center Configuration Manager でインターネット ベースのクライアント管理を計画する</a>  </p><hr><h2 id="2-サーバー証明書のサブジェクト名について-1"><a href="#2-サーバー証明書のサブジェクト名について-1" class="headerlink" title="(2) サーバー証明書のサブジェクト名について"></a>(2) サーバー証明書のサブジェクト名について</h2><p>サーバ―証明書のサブジェクト名については、IBCM サーバーの場合、インターネット経由の接続のほか、イントラネット経由の接続も受け付ける場合には、2 つのサブジェクト名が必要となります。<br>シナリオとしては、イントラネット接続でセットアップを行い、インターネット接続に切り替えた場合に利用するシナリオが考えられますので、IBCM サーバーのサーバー証明書では、2 つのサブジェクト名を含めるよう考慮をすることが一般的です。<br>証明書の発行方法については、以下 URL に記載がございますのでご参照ください。  </p><p>なお、証明書の発行を外部公的証明機関に委託する場合には、サブジェクト名が 2 つ入れることが可能であるか必ずご確認下さい。<br>サービス プランによっては、複数のサブジェクト名の登録ができず、MECM の証明書に必要な要件を実現できない場合がございます。  </p><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/network/example-deployment-of-pki-certificates">System Center Configuration Manager PKI 証明書の展開手順の例: Windows Server 2008 証明機関</a>  </p><blockquote><p>サイト システムがイントラネット経由のクライアント接続のみを許可する場合は、サイト システム サーバーのイントラネット FQDN は server1.internal.contoso.com になります。「server1.internal.contoso.com」と入力し、[追加] を選択します。<br>サイト システムがイントラネットからとインターネットからのクライアント接続を許可する場合は、 サイト システム サーバーのイントラネット FQDN は server1.internal.contoso.com で、サイト システム サーバーのインターネット FQDN は server.contoso.comとなります。</p><p>「server1.internal.contoso.com」と入力し、[追加] を選択します。<br>「server.contoso.com」と入力し、[追加] を選択します。</p></blockquote><hr><h2 id="3-ccmsetup-exe-で付与するオプション-1"><a href="#3-ccmsetup-exe-で付与するオプション-1" class="headerlink" title="(3) ccmsetup.exe で付与するオプション"></a>(3) ccmsetup.exe で付与するオプション</h2><p>IBCM 環境では、インターネット上で名前解決をするための、インターネット FQDN を取得する必要がございます。<br>こちらはドメイン取得サービスから取得したインターネットに公開する FQDN を、インターネットに公開する MECM のサイトシステムのインターネット FQDN として登録します。<br>また、MECM エージェントのセットアップ時に、CCMHOSTNAME オプションにインターネット FQDN を指定します。  </p><p>お問い合わせが多いシナリオとしては、ccmsetup.exe 実行時にオプションが不足していることによって、MECM エージェントの登録に失敗するといったことがございます。<br>そのため、MECM クライアントをセットアップする際の注意事項についてコマンド オプションの例と共にご紹介いたします。  </p><p>// 前提<br>ドメイン名：contoso.local<br>IBCM サーバーのイントラネット FQDN ：IBCM-Intra.contoso.local<br>IBCM サーバーのインターネット FQDN：IBCM-Internet.public.com<br>サイトコード：P01  </p><p>// コマンド例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccmsetup.exe /UsePKICert /NoCRLCheck SMSSITECODE=P01 SMSMP=https://IBCM-Intra.contoso.local CCMHOSTNAME=IBCM-Internet.public.com</span><br></pre></td></tr></table></figure><p>-詳細<br>オプションを列挙しますと、以下の通りです。<br>ccmsetup.exe<br>/UsePKICert<br>/NoCRLCheck<br>SMSSITECODE=P01<br>SMSMP=<a href="https://ibcm-intra.contoso.local/">https://IBCM-Intra.contoso.local</a> &gt;&gt;&gt; イントラネット FQDN を指定します。<br>CCMHOSTNAME=IBCM-Internet.public.com &gt;&gt;&gt; インターネット FQDN を指定します。  </p><p>このシナリオにおいては、イントラネット環境でも https を利用する想定であるため、SMSMP に https:// を付与することがポイントです。<br>なお、http 構成である場合には、http:// は不要です。  </p><h3 id="※-補足-1"><a href="#※-補足-1" class="headerlink" title="※ 補足 1."></a>※ 補足 1.</h3><p>IBCM クライアントの新規セットアップおよび、アップグレード シナリオにおいては、社内イントラネット環境へ接続されている必要がございます。<br>非イントラネット接続状態で、インターネット上でセットアップを行うためには、VPN  接続などを介して社内イントラネット環境へ接続を行いセットアップを行います。  </p><p>参考)<br><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/clients/deploy/deploy-clients-to-windows-computers#BKMK_ClientInternet">インターネット ベースのクライアント管理</a></p><blockquote><p>インターネット上のクライアントをインストールするには、以下のサポートされる方法の 1 つから選択します。<br>・これらのクライアントが VPN でイントラネットに一時的に接続するためのメカニズムを提供します。 その後、適切なクライアント インストール方法を使ってクライアントをインストールします。<br>-注意<br>Configuration Manager では、インターネット ベースの管理ポイントまたはインターネット ベースのソフトウェア更新ポイントからクライアントを直接インストールすることはサポートしていません。</p></blockquote><h3 id="※-補足-2"><a href="#※-補足-2" class="headerlink" title="※ 補足 2."></a>※ 補足 2.</h3><p>インターネット管理ポイントを設定している場合は、インストール時に CCMHOSTNAMEオプションを指定しない場合も、イントラネットのドメインや、管理ポイントから、情報を受け取けとった場合に、インターネット管理ポイントの情報が入ります。<br>クライアントからインターネット管理ポイントの情報を削除したとしても、上記タイミングにて再設定されるため、インターネット管理ポイントを構成している限りクライアントからその情報を恒久的に削除いただくことはできません。  </p><hr><h2 id="4-サイトサーバーのプロパティ設定の変更-1"><a href="#4-サイトサーバーのプロパティ設定の変更-1" class="headerlink" title="(4) サイトサーバーのプロパティ設定の変更"></a>(4) サイトサーバーのプロパティ設定の変更</h2><p>(1) ～ (3) の設定が問題ないにも関わらず、インターネット クライアントを管理できない (インベントリが報告されない、など) シナリオもございます。<br>その場合、以下のチェック ボックスの状態をご確認ください。この設定は、既定でオンになっていますので、オフにします。</p><ol><li>ConfigMgr コンソール画面で、[管理] ワークスペースをクリックし、左ペインの [サイトの構成] – [サイト] をクリックして、プライマリ サイトを右クリックし、[プロパティ] をクリックします。</li><li>[クライアント コンピューターの通信方法] タブをクリックし、[サイト システムの証明書失効リスト (CRL) をチェックする] のチェックを外して、[OK] をクリックします。<br><img src="/blog/mecm/20180706_01/1.png"></li></ol><p>この設定を行う理由は、インターネット環境にいるクライアントが、IBCM 用管理ポイントと通信し、ドメイン環境のエンタープライズ CA から発行されたサーバー証明書を受け取った際、インターネット環境であることによって、証明書の証明書失効リスト (CRL) のチェックが行えず、SSL 接続に失敗するためです。(エンタープライズ CA では、既定で Ldap パスの CRL が証明書に記載されているため、ドメイン利用前提の Ldap パスへの疎通に失敗する結果となります。)  </p><p>また、イントラネット環境であっても、ワークグループ クライアントのセットアップの場合には、MECM クライアントエージェントのインストール時に、Ldap パスの CRL にアクセスできないためセットアップに失敗します。<br>そのため、上記チェックをオフにして、CRL のチェックをしないようにすることで、管理ができるようになります。  </p><h3 id="補足"><a href="#補足" class="headerlink" title="補足)"></a>補足)</h3><p>当該項目にチェックを入れてよい場合のシナリオについては、CRL を HTTP パスで外部公開しているか、エンタープライズ CA にて外部公開可能な HTTP パスの CRL を公開し、証明書内に HTTP の CRL パスを記載している場合のみ利用できます。<br>この場合には、クライアントが IBCM サーバーから受け取ったサーバー証明書の HTTP パスの CRL チェックが成功します。<br>当設定は、このような追加要件がある場合にのみチェックを付ける項目となりますので、ご留意ください。  </p><h3 id="参考"><a href="#参考" class="headerlink" title="参考)"></a>参考)</h3><p><a href="http://download.microsoft.com/download/F/0/D/F0D20D4C-B594-4341-924C-55DFF50FED88/SCCM_CB_EvalGuide_jp.docx">SCCM(CB)_評価ガイド_環境構築編</a><br>-10.3.4        証明書失効リストによるチェックの無効化  </p><p><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/get-started/capabilities-in-technical-preview-1606">System Center Configuration Manager の Technical Preview 1606 の機能</a></p><blockquote><p>-クライアント証明書の認証用にプライマリ サイトを構成する<br>[サイト システムの証明書失効リスト (CRL) をチェックする] の横のチェック ボックスがオフになっていることを確認します。<br>このオプションは、CRL をパブリックに公開した場合にのみ必要になります。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;本記事では、Microsoft Endpoint Configuration Manager (以下 MECM) を利用し、インターネット ベースのクライアント管理 (I</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager ReportServer データベースのトランザクションログ肥大化への対策</title>
    <link href="https://jpmem.github.io/blog/mecm/20180629_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20180629_01/</id>
    <published>2018-06-28T15:00:00.000Z</published>
    <updated>2021-10-04T03:27:58.816Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。System Center サポートチームです。</p><p>本ポストでは、Configuration Manager の ReportServer データベースのトランザクションログ肥大化への対策をご紹介いたします。</p><p>Configuration Manager でレポート機能を利用されている環境で、ReportServer データベースのトランザクションログファイルが肥大化し、HDD が逼迫したというお問い合わせよくいただきます。</p><p>これは SQL Server Reporting Services (SSRS) の ReportServer データベースを完全復旧モデルで運用されていて、トランザクションログの切り捨てを実行していない環境で発生します。</p><p>Configuration Manager で使用する SSRS のデータベースは、破損しても基本的にレポーティングサービスの役割を再構築することで復旧はできますので、普段の運用ではバックアップもあまり必要なく復旧モデルも単純で問題ありません。(カスタムレポートを利用している場合は、バックアップが重要です。文末の参考情報をご参照ください。)</p><p>もしも、ご利用の環境で ReportServer データベースが肥大化して HDD が逼迫する問題が生じた場合には、以下にご紹介する SQL Server Management Studio を用いた、単純モデルへの変更および、圧縮方法をご利用ください。</p><h2 id="データベース復旧モデルの変更手順-復旧モデルの変更およびトランザクションログの縮小"><a href="#データベース復旧モデルの変更手順-復旧モデルの変更およびトランザクションログの縮小" class="headerlink" title="データベース復旧モデルの変更手順 復旧モデルの変更およびトランザクションログの縮小"></a>データベース復旧モデルの変更手順 復旧モデルの変更およびトランザクションログの縮小</h2><ol><li><p>SQL Server Management Studio で 対象の SQL Server に接続します。</p></li><li><p>左上の “新しいクエリ” ボタンを押し、クエリ入力画面を開きます。</p></li><li><p>現在のトランザクションログサイズと使用率を確認します。    </p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    dbcc sqlperf(logspace);</span><br><span class="line">    go</span><br><span class="line">    ```  </span><br><span class="line">    </span><br><span class="line">    <span class="operator">-</span> 肥大化していると対象のデータベースは、トランザクションログファイルが大きく使用率が高いことが確認いただけます。</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> データベース復旧モデルを「単純」に変更します。  </span><br><span class="line">    ```<span class="keyword">sql</span></span><br><span class="line">    use master</span><br><span class="line">    go</span><br><span class="line">    <span class="keyword">alter</span> database <span class="operator">&lt;</span>データベース名<span class="operator">&gt;</span> <span class="keyword">set</span> recovery simple;</span><br></pre></td></tr></table></figure><p> 例: データベース名が ReportServer の場合  </p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    use master;</span><br><span class="line">    go</span><br><span class="line">    <span class="keyword">alter</span> database ReportServer <span class="keyword">set</span> recovery simple;</span><br><span class="line">    go</span><br><span class="line">    ```  </span><br><span class="line"></span><br><span class="line">    <span class="operator">-</span> 上記の実行により、復旧モデルの変更とチェックポイントが実行されます。単純復旧モデルとなりチェックポイントが実行されますと、トランザクションレコードを切り捨て、空き領域となります。</span><br><span class="line"></span><br><span class="line">    復旧モデルの変更は、対象データベースがトランザクション実行中でも、使用中のユーザーがいても実行できます。変更に伴い、再起動なども必要ありません。</span><br><span class="line"></span><br><span class="line">    ここで再び、上記 <span class="number">3</span>) の dbcc sqlperf(logspace) を実行しますと、ファイルサイズは同じでも使用率が減少していると思います。</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> トランザクションログファイルの論理名とサイズを確認します。</span><br><span class="line"></span><br><span class="line">    ```<span class="keyword">sql</span></span><br><span class="line">    Use <span class="operator">&lt;</span>データベース名<span class="operator">&gt;</span></span><br><span class="line">    Go</span><br><span class="line">    <span class="keyword">select</span> file_id,name [論理名] ,<span class="built_in">CAST</span>(size <span class="keyword">as</span> <span class="type">BIGINT</span>)<span class="operator">*</span><span class="number">8192</span><span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span> [LogSize(MB)],physical_name <span class="keyword">from</span> sys.database_files <span class="keyword">where</span> type_desc <span class="operator">=</span> <span class="string">&#x27;log&#x27;</span>;</span><br></pre></td></tr></table></figure><p> 論理名の欄には、ReportServer_log と出力されます。</p></li><li><p>トランザクションログを圧縮します。<br>トランザクションログファイルの論理名、圧縮後のサイズ（ターゲットサイズ）を指定し、圧縮を実行します。</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Use <span class="operator">&lt;</span>データベース名<span class="operator">&gt;</span>;</span><br><span class="line">Go</span><br><span class="line">dbcc shrinkfile(<span class="string">&#x27;論理名&#x27;</span>,ターゲットサイズ(MB));</span><br><span class="line">go</span><br></pre></td></tr></table></figure><p> 例: 論理名が ReportServer_log、圧縮後のサイズを 1 GB とする場合</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use ReportServer;</span><br><span class="line">go</span><br><span class="line">dbcc shrinkfile(<span class="string">&#x27;ReportServer_log&#x27;</span>, <span class="number">1024</span>); go</span><br></pre></td></tr></table></figure><p> ※トランザクションログに空きがあるにも関わらず指定したターゲットサイズまで圧縮されないことがあります。</p><p> トランザクションログファイルは、内部的に仮想ログ ファイルに分割されています。並び順が後ろの方の仮想ログを現在使用中の場合には、その位置までしか圧縮できず、十分に圧縮されない場合があるためです。</p><p> この場合には、しばらく時間を空け、対象データベースに対してチェックポイントを実行後に、圧縮を再度実行して下さい。</p><ul><li><p>チェックポイントの実行</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use <span class="operator">&lt;</span>データベース名<span class="operator">&gt;</span>;</span><br><span class="line">go</span><br><span class="line">checkpoint;</span><br><span class="line">go</span><br></pre></td></tr></table></figure></li></ul></li></ol><p>手順は以上となります。</p><h2 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h2><p>復旧モデルと、ログ管理の詳細については、以下の技術文書もよろしければご参照ください。</p><ul><li>単純復旧モデルでのバックアップ<br><a href="http://msdn.microsoft.com/ja-jp/library/ms191164(v=sql.100).aspx">http://msdn.microsoft.com/ja-jp/library/ms191164(v=sql.100).aspx</a></li><li>完全復旧モデルでのバックアップ<br><a href="http://msdn.microsoft.com/ja-jp/library/ms190217(v=sql.100).aspx">http://msdn.microsoft.com/ja-jp/library/ms190217(v=sql.100).aspx</a></li><li>トランザクション ログの管理<br><a href="http://msdn.microsoft.com/ja-jp/library/ms345583(v=sql.100).aspx">http://msdn.microsoft.com/ja-jp/library/ms345583(v=sql.100).aspx</a></li><li>トランザクション ログのバックアップ<br><a href="http://msdn.microsoft.com/ja-jp/library/ms190440(v=sql.100).aspx">http://msdn.microsoft.com/ja-jp/library/ms190440(v=sql.100).aspx</a></li><li>HowTo: Management Studio を使ってトランザクションログファイル (ldf) のサイズを小さくする方法<br><a href="https://blogs.msdn.microsoft.com/jpsql/2017/09/29/howto-management-studio-ldf/">https://blogs.msdn.microsoft.com/jpsql/2017/09/29/howto-management-studio-ldf/</a></li></ul><p>Reporting Services の定義済みのレポートを変更した場合や、カスタム レポートを作成した場合は、レポート サーバー データベース ファイルのバックアップを取ることが重要です。以下のページもご確認ください。</p><ul><li>Reporting Services のカスタム レポートのバックアップ<br><a href="https://docs.microsoft.com/ja-jp/sccm/protect/understand/backup-and-recovery/#back-up-custom-reporting-services-reports">https://docs.microsoft.com/ja-jp/sccm/protect/understand/backup-and-recovery\#back-up-custom-reporting-services-reports</a></li></ul><h1 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h1><p>このドキュメントは現状有姿で提供され、 このドキュメントに記載されている情報や見解 (URL 等のインターネット Web サイトに関する情報を含む) は、将来予告なしに変更されることがあります。 お客様は、その使用に関するリスクを負うものとします。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。System Center サポートチームです。&lt;/p&gt;
&lt;p&gt;本ポストでは、Configuration Manager の ReportServer データベースのトランザクションログ肥大化への対策をご紹介いたします。&lt;/p&gt;
&lt;p&gt;Configuration</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
</feed>
